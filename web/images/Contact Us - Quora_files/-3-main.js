/**
 * Name: main.js
 * URL: http://qsf.ec.quoracdn.net/-3-main.js870ea82430637ad4.js
 * Generated: 1480648509771310
 * Files: /third_party/json2.js, /shared/util.js, /gating.js, /shared/log.settings.js, /shared/log.js, /interface/helpers.js, /settings.js, /interface/settings.js, /jquery.js, /shared/core/rpc.js, /shared/Class.js, /shared/w2.context.js, /shared/events/types.js, /shared/eventemitter.js, /shared/events/hub.js, /shared/events/scope.js, /shared/events/proxy.js, /shared/events/helpers.js, /shared/events/index.js, /third_party/browser.js, /shared/browser.js, /shared/client.js, /unified_view/mobile_overlays.js, /shared/siteuri.js, /video.js, /shared/qlocal_storage.js, /shared/window_manager.js, /w2.dialog.js, /webnode2.js, /ajax.js, /w2.errors.js, /shared/perf.js, /shared/viewport.js, /tchannel_up.js, /fx.js, /w2.livenode.js, /shared/loading.js, /shared/debounce.js, /shared/rpc_manager.js, /actions.js, /w2.rpc.js, /interface/rpc.js, /shared/logging.js, /shared/scroll_animation_handler.js, /shared/keyboard_event_handler.js, /w2.modal.js, /interface/modal.js, /shared/core/component.js, /shared/cookies.js, /shared/loadjs.js, /shared/facebook.js, /shared/resource_timing.js, /third_party/timing.js, /shared/paint_timing.js, /shared/e2e.js, /shared/fastclick.js, /interface/jquery.js, /shared/beforeunload.js, /third_party/jquery.migrate.js, /datepicker.js, /jquery.webnode2.js, /shared/frame_busting.js, /visibility.js, /tooltip.js, /qtext.js, /init.js, /facebook.js, /oauth.js, /shared/twitter.js, /twitter.js, /shared/mathjax.js, /shared/recaptcha.js, /shared/action_log.js, /third_party/cf.js, /shared/cf.js, /unified_view/signup/_signup.js, /shared/twitter_oembed.js, /view/modal.js, /login.js, /network.js, /view/captcha.js, /view/reauth.js, /unified_view/insertion_query.js, /unified_view/lazy_load_images.js, /shared/links_logger.js, /shared/service_worker_init.js, /shared/client_tracker.js, /shared/activity_metrics.js, /app/view/activation/endorsement.js, /app/view/activation/endorsement/endorse_by_topic.js, /app/view/activation/endorsement/endorse_by_user.js, /app/view/activation/endorsement/modal.js, /app/view/activation/facebook.js, /app/view/activation/profile_topics.js, /app/view/activation/progress.js, /app/view/share/connect.js, /app/view/activation/twitter.js, /view/inline_editor.js, /view/dialog.js, /shared/keystrokes.js, /app/view/admin.js, /unified_view/modal.js, /simscroll.js, /third_party/autosize.js, /view/selector.js, /third_party/blockadblock.js, /shared/blockadblock.js, /app/view/ads.js, /view/fixable2.js, /app/view/ama.js, /app/view/ama/self_serve.js, /shared/views.js, /app/view/answer.js, /app/view/answer_wiki.js, /app/view/ask.js, /app/view/board.js, /app/view/board/blog.js, /app/view/board/create_box.js, /app/view/board/follow_invite.js, /app/view/board/view_tracker.js, /app/view/board/item.js, /app/view/board/settings.js, /app/view/board/submission.js, /shared/upload.js, /view/upload.js, /app/view/bug_report.js, /app/view/comment.js, /third_party/prettify.js, /shared/prettyprint.js, /shared/mathify.js, /app/view/common.js, /app/view/components.js, /shared/google_.js, /app/view/contact_importer.js, /app/view/draft.js, /third_party/truncate.js, /truncate.js, /app/view/embed.js, /app/view/error.js, /view/paged_list.js, /shared/toast.js, /unified_view/toggle.js, /app/view/home.js, /app/view/feed.js, /app/view/feed/ama.js, /app/view/feed/question.js, /app/view/feed/answer.js, /app/view/feed/feedback.js, /unified_view/button/abstract.js, /unified_view/button/write_answer.js, /app/view/feed/modal.js, /app/view/funnel.js, /app/view/growl.js, /app/view/intro_to_quora.js, /shared/youtube.js, /view/livenode.js, /app/view/layout.js, /app/view/link.js, /app/view/linkedin_.js, /app/view/login.js, /app/view/manage.js, /app/view/messages.js, /app/view/moderation/appeal.js, /app/view/moderation/flag.js, /view/hover_menu.js, /app/view/topic_selector.js, /view/editable_list.js, /app/view/navigation.js, /app/view/network/selector.js, /app/view/notifications.js, /app/view/notifications/base.js, /app/view/notifications/header.js, /app/view/nux.js, /app/view/nux/dialog.js, /app/view/nux/existing_user.js, /app/view/nux/find_friends.js, /app/view/oauth.js, /app/view/payment/payable.js, /app/view/payment/receivable.js, /app/view/people_selector.js, /app/view/photo.js, /view/pmsg.js, /app/view/pmsg/pmsg.js, /app/view/post.js, /app/view/prize/add_answer.js, /app/view/query/filters.js, /app/view/query/query.js, /app/view/question.js, /app/view/share.js, /app/view/question/add_answer.js, /app/view/question/answer_tag.js, /app/view/question/ask_question.js, /app/view/question/cant_answer.js, /app/view/question/disclaimer.js, /app/view/site_header/logged_in.js, /app/view/question/lookup_bar.js, /shared/email.js, /shared/linkify.js, /qtext2/util.js, /qtext2/quirks.js, /qtext2/extension/base.js, /qtext2/extension/link_interaction.js, /qtext2/ui.js, /unified_view/qtext2/editor/mobile.js, /unified_view/qtext2/editor.js, /app/view/question/lookup_bar_details.js, /app/view/question/merge/_merge.js, /app/view/question/merge/modal.js, /app/view/question/merge/selector.js, /app/view/question/not_helpful.js, /app/view/question/question_add.js, /app/view/question/suggested_answer.js, /app/view/question/wanted_answer.js, /app/view/quora_meets_bagel.js, /unified_view/action_bar/overflow_menu/base.js, /app/view/reading_list.js, /app/view/settings.js, /app/view/share/form.js, /app/view/share/modal.js, /input_validate.js, /app/view/signup_validation.js, /app/view/site_header.js, /app/view/site_header/logged_out.js, /app/view/static.js, /app/view/suggestions.js, /app/view/survey/question_page.js, /app/view/thanks.js, /app/view/thread.js, /app/view/threaded_comments.js, /app/view/topic.js, /app/view/topic/edit_topic_modal.js, /view/reorderable_list.js, /app/view/topic/faq.js, /app/view/topic/flag.js, /app/view/topic/leaderboard.js, /app/view/topic/location.js, /app/view/topic/merge.js, /app/view/topic/topic_create.js, /app/view/topic/topic_list.js, /app/view/topic/topic_ontology.js, /app/view/topic/topic_redesign.js, /app/view/tumblr.js, /app/view/tutorial.js, /app/view/user.js, /app/view/user/content.js, /app/view/user/profile.js, /app/view/user/setup_.js, /app/view/user/subscribe.js, /app/view/user/topics.js, /unified_view/switch.js, /app/view/user_settings/notifications.js, /app/view/user_settings/settings.js, /app/view/user_stats.js, /app/view/vc.js, /app/view/write.js, /app/view/zapdos/card.js, /swfobject.js, /flash.js, /google_.js, /shared/inline_css.js, /shared/skyfall.js, /unified_view/a2a.js, /unified_view/util.js, /sticky.js, /unified_view/action_bar/base.js, /unified_view/action_bar/_action_bar.js, /unified_view/action_bar/answer.js, /unified_view/action_bar/blog.js, /unified_view/action_bar/overflow_menu/answer.js, /unified_view/action_bar/overflow_menu/comment.js, /unified_view/action_bar/overflow_menu/profile.js, /unified_view/privacy.js, /unified_view/action_bar/overflow_menu/question.js, /unified_view/action_bar/overflow_menu/shared.js, /unified_view/action_bar/question.js, /unified_view/action_bar/shared.js, /unified_view/action_bar/user.js, /unified_view/answer/credibility.js, /unified_view/button/ads.js, /unified_view/button/downvote.js, /unified_view/button/follow.js, /unified_view/button/network.js, /unified_view/button/notif.js, /unified_view/button/pause_ad.js, /unified_view/button/pin.js, /unified_view/button/prize.js, /unified_view/button/upvote.js, /unified_view/button/writing_list.js, /unified_view/captcha.js, /unified_view/carousel.js, /unified_view/cf.js, /unified_view/character_counter.js, /unified_view/components.js, /unified_view/cookie_warning.js, /unified_view/credential.js, /shared/datetime.js, /unified_view/datetime_.js, /unified_view/download_csv.js, /unified_view/feed/explanation.js, /unified_view/feed/feedback.js, /unified_view/feed/modal.js, /unified_view/form.js, /unified_view/home/logged_out_feed.js, /unified_view/lazy.js, /unified_view/mobile_debug.js, /unified_view/multifeed/_multifeed.js, /unified_view/multifeed/view_tracker.js, /unified_view/multifeed/story.js, /unified_view/multifeed/write.js, /unified_view/network/invite.js, /unified_view/network/join.js, /interface/oauth.js, /unified_view/signup/facebook.js, /unified_view/signup/google.js, /unified_view/network/login.js, /unified_view/network/signup.js, /unified_view/network/switcher.js, /unified_view/paged_list.js, /unified_view/notifications.js, /unified_view/nux.js, /shared/stripeLoader.js, /unified_view/payment/_payment.js, /unified_view/payment/money.js, /unified_view/pmsg.js, /shared/prize_views.js, /unified_view/prize/_prize.js, /unified_view/prize/collect.js, /unified_view/prize/sponsor.js, /unified_view/qtext.js, /unified_view/qtext2/photo_search.js, /qtext2.js, /qtext2/keys.js, /qtext2/shortcuts.js, /qtext2/tooltip.js, /unified_view/qtext2/toolbar.js, /unified_view/question/prompt.js, /unified_view/question/rad.js, /unified_view/question/text.js, /unified_view/settings/languages.js, /unified_view/settings/privacy.js, /unified_view/signup/conversion_logging.js, /unified_view/signup/oauth.js, /third_party/smyte.js, /unified_view/smyte.js, /unified_view/survey.js, /unified_view/translation.js, /unified_view/write/writing_list.js, /unified_view/main.js, /view/announcement.js, /view/board_selector.js, /view/datetime_.js, /view/embed.js, /view/filter_nav_list.js, /view/filterable_list.js, /view/fixable_component.js, /view/follower_list.js, /view/invisibleinfo.js, /view/link_selector.js, /view/notif.js, /view/photo.js, /view/placepicker.js, /view/privacy.js, /view/repeat_offender.js, /view/suggested_edits.js, /view/tooltip.js, /view/user.js, /view/voter_list.js, /main.js, /shared/main-loaded.js
 */
define("third_party/json2",["shared/polyfills"],function third_party_json2(require,exports,module){if(typeof JSON!=="object"){window.JSON={}}(function(){"use strict";var rx_one=/^[\],:{}\s]*$/;var rx_two=/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g;var rx_three=/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g;var rx_four=/(?:^|:|,)(?:\s*\[)+/g;var rx_escapable=/[\\\"\u0000-\u001f\u007f-\u009f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g;var rx_dangerous=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g;function f(e){return e<10?"0"+e:e}function this_value(){return this.valueOf()}if(typeof Date.prototype.toJSON!=="function"){Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null};Boolean.prototype.toJSON=this_value;
Number.prototype.toJSON=this_value;String.prototype.toJSON=this_value}var gap;var indent;var meta;var rep;function quote(e){rx_escapable.lastIndex=0;return rx_escapable.test(e)?'"'+e.replace(rx_escapable,function(e){var t=meta[e];return typeof t==="string"?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'}function str(e,t){var i;var n;var s;var o;var r=gap;var a;var d=t[e];if(d&&typeof d==="object"&&typeof d.toJSON==="function"){d=d.toJSON(e)}if(typeof rep==="function"){d=rep.call(t,e,d)}switch(typeof d){case"string":return quote(d);case"number":return isFinite(d)?String(d):"null";case"boolean":case"null":return String(d);case"object":if(!d){return"null"}gap+=indent;a=[];if(Object.prototype.toString.apply(d)==="[object Array]"){o=d.length;for(i=0;i<o;i+=1){a[i]=str(i,d)||"null"}s=a.length===0?"[]":gap?"[\n"+gap+a.join(",\n"+gap)+"\n"+r+"]":"["+a.join(",")+"]";gap=r;return s}if(rep&&typeof rep==="object"){o=rep.length;for(i=0;i<o;i+=1){if(typeof rep[i]==="string"){n=rep[i];
s=str(n,d);if(s){a.push(quote(n)+(gap?": ":":")+s)}}}}else{for(n in d){if(Object.prototype.hasOwnProperty.call(d,n)){s=str(n,d);if(s){a.push(quote(n)+(gap?": ":":")+s)}}}}s=a.length===0?"{}":gap?"{\n"+gap+a.join(",\n"+gap)+"\n"+r+"}":"{"+a.join(",")+"}";gap=r;return s}}if(typeof JSON.stringify!=="function"){meta={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};JSON.stringify=function(e,t,i){var n;gap="";indent="";if(typeof i==="number"){for(n=0;n<i;n+=1){indent+=" "}}else if(typeof i==="string"){indent=i}rep=t;if(t&&typeof t!=="function"&&(typeof t!=="object"||typeof t.length!=="number")){throw new Error("JSON.stringify")}return str("",{"":e})}}if(typeof JSON.parse!=="function"){JSON.parse=function(text,reviver){var j;function walk(e,t){var i;var n;var s=e[t];if(s&&typeof s==="object"){for(i in s){if(Object.prototype.hasOwnProperty.call(s,i)){n=walk(s,i);if(n!==undefined){s[i]=n}else{delete s[i]}}}}return reviver.call(e,t,s)}text=String(text);rx_dangerous.lastIndex=0;
if(rx_dangerous.test(text)){text=text.replace(rx_dangerous,function(e){return"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})}if(rx_one.test(text.replace(rx_two,"@").replace(rx_three,"]").replace(rx_four,""))){j=eval("("+text+")");return typeof reviver==="function"?walk({"":j},""):j}throw new SyntaxError("JSON.parse")}}})()});define("shared/util",["shared/polyfills"],function e(require,exports,t){exports.extend=function(e,t){e=e||{};for(var i=1;i<arguments.length;i++){if(!arguments[i]){continue}for(var n in arguments[i]){if(arguments[i].hasOwnProperty(n)){e[n]=arguments[i][n]}}}return e};exports.documentFragmentFromString=function(e){var t=document.createElement("div");t.innerHTML=e;var i=document.createDocumentFragment(),n=t.firstChild,s=null;while(n){s=n.nextSibling;i.appendChild(n);n=s}return i};var i=exports.isPlainObject=function(e){if(Object.prototype.toString.call(e)!="[object Object]"){return false}var t=e.constructor;if(typeof t!=="function"){return false}var i=t.prototype;
if(Object.prototype.toString.call(i)!="[object Object]"){return false}if(i.hasOwnProperty("isPrototypeOf")===false){return false}return true};var n=exports.cloneObject=function(e){if(!Array.isArray(e)&&!i(e)){return e}var t=e.constructor();var s=Object.keys(e);for(var o=0;o<s.length;o++){var r=s[o];t[r]=n(e[r])}return t};exports.firstScrollingParent=function(e){var t=null;if(e){t=e.parentNode}while(t&&t!==document.body){var i=window.getComputedStyle(t);if(i&&i.getPropertyValue("overflow-y")==="scroll"){return t}t=t.parentNode}return document.body};exports.makeEnum=function(e){var t={};var i=Array.isArray(e);for(var n in e){if(e.hasOwnProperty(n)){n=i?e[n]:n;t[n]=n}}return t};exports.once=function(e){var t;return function(){if(t){return}t=true;e.apply(this,arguments)}}});define("shared/log.settings",["shared/polyfills","gating"],function t(require,exports,e){exports.resetSettings=function(e){var t=require("gating").client_side_logging,i,n;e.enable(!!t);if(t){e.scopes.resetLevel("",e.level.error);
for(i in t){n=t[i];e.scopes.resetLevel(i,e.level[n])}}}});define("shared/log",["shared/polyfills","shared/util","shared/log.settings"],function n(require,exports,e){(function(e){var t=new Date;var i=function(e){return Array.prototype.join.call(e," ")};var n=require("shared/util");var s=e.log=exports.log=function(){return s.log.apply(s,arguments)};var o=e.console;var r=o||{};var a=window&&window.navigator.appName=="Microsoft Internet Explorer";if(a){var d=/MSIE ([0-9]{1,}[.0-9]{0,})/;if(d.exec(window.navigator.userAgent)!==null&&parseFloat(RegExp.$1)>=8){r={};r.log=function(){if(o&&o.log){o.log(i(arguments))}};r.info=function(){if(o&&o.log){o.info(i(arguments))}};r.warn=function(){if(o&&o.log){o.warn(i(arguments))}};r.error=function(){if(o&&o.log){o.error(i(arguments))}}}else{r={}}}var l=["log","info","warn","error"];var c=function(){};for(var u in l){var h=l[u];if(!r[h]){r[h]=c}}var f=function(e){if(e===undefined){e=null}this.level=e;this.children={}};f.prototype.setLevel=function(e,t,i){
var n=this.tryGetChild(e,i);if(n===null){if(t===undefined){t=null}this.level=t;return}if(n.child===undefined){this.children[n.name]=n.child=new f}n.child.setLevel(e,t,n.continueFrom);this.optimize(n.name)};f.prototype.removeChildren=function(e,t){var i=this.tryGetChild(e,t);if(i===null){this.children={};return}if(i.child===undefined){return}i.child.removeChildren(e,i.continueFrom);this.optimize(i.name)};f.prototype.optimize=function(e){var t=this.children[e];if(t!==undefined&&t.level===null&&t.childCount()===0){delete this.children[e]}};f.prototype.childCount=function(){var e=0;for(var t in this.children){if(this.children.hasOwnProperty(t)){e++}}return e};f.prototype.getLevel=function(e,t){var i=this.tryGetChild(e,t);if(i===null||i.child===undefined){return this.level}var n=i.child.getLevel(e,i.continueFrom);if(n!==null){return n}return this.level};f.prototype.print=function(e,t,i){var n=this.level===null?i:this.level;s.console.log(e+t+": "+s.level.toString(n)+(this.level===null?" (inherited)":""));
for(t in this.children){var o=this.children[t];o.print(e+"  ",t,n)}};f.prototype.tryGetChild=function(e,t){if("string"!==typeof e){throw new Error("Scope must be string.")}t=t||0;if(t>=e.length){return null}var i=e.indexOf(".",t);var n=null;if(i<0){i=e.length;n=e.substr(t,i-t)}else{n=e.substr(t,i-t);i++}return{name:n,child:this.children[n],continueFrom:i}};var p=function(e,t,n){this.time=new Date;this.level=e;this.scope=t;this.data=n;this.message=i(n)};p.prototype.toString=function(){return s.level.toString(this.level).concat(" ",this._timeToString(),", ",this.scope,": ",this.message)};p.prototype.print=function(){var e=this.level=="trace"?"log":this.level;s.console[s.level.toString(e)].apply(s.console,[this._timeToString()+", "+this.scope+":"].concat(this.data))};p.prototype.checkScope=function(e){return this.scope==e||this.scope.startsWith(e+".")};p.prototype._timeToString=function(){return((this.time-t)/1e3).toString()+"s"};var g=function(e){this.list=e||[]};g.prototype.toString=function(){
return this.list.join("\r\n")};g.prototype.print=function(){for(var e in this.list){this.list[e].print()}};g.prototype.add=function(e){return this.list.push(e)};g.prototype.count=function(){return this.list.length};g.prototype.getLast=function(){if(this.list.length===0){return null}return this.list[this.list.length-1]};g.prototype.clear=function(){this.list=[]};g.prototype.filter=function(e,t){var i,n;if(typeof e=="function"){i=Array.prototype.filter.apply(this.list,arguments);return new g(i)}if(t===undefined&&typeof e=="string"){t=e;e=null}var s=typeof e==="number";if(!s){var o={};for(n in e){o[e[n]]=e[n]}e=o}i=[];for(n in this.list){var r=this.list[n];if(e!==null&&e!==undefined&&(s?r.level<e:!(r.level in e))){continue}if(t!==null&&t!==undefined&&!r.checkScope(t)){continue}i.push(r)}return new g(i)};var m={enabled:null,outputEnabled:true,entries:new g,level:{none:0,trace:1,log:2,info:3,warn:4,error:5,toString:function(e){switch(e){case 0:return"none";case 1:return"trace";case 2:return"log";
case 3:return"info";case 4:return"warn";case 5:return"error";default:throw new Error("Unknown log.level value.")}}},scopes:{root:new f(0),cache:{},setLevel:function(e,t){this.root.setLevel(e,t);this.cache={}},resetLevel:function(e,t){this.root.removeChildren(e);this.root.setLevel(e,t);this.cache={}},removeChildren:function(e){this.root.removeChildren(e);this.cache={}},getLevel:function(e){if(this.cache[e]===undefined){this.cache[e]=this.root.getLevel(e)||s.level.none}return this.cache[e]},hasLevel:function(e,t){var i=this.getLevel(e);return i<=t&&i!=s.level.none},print:function(e){s.console.log("Log scopes:");this.root.print("  ","(root)")}},enabledImpl:{console:r,trace:function(e){var t=this._tryAddLogEntry(s.level.log,e,Array.prototype.slice.call(arguments,1));if(t===null){return null}if(s.outputEnabled){if(s.console.trace){s.console.trace()}else{s.console.log.call(s.console,("Stack trace:\r\n"+s._getStackTrace()).replace("\r\n","\r\n  "))}}return t},log:function(e){return this._tryAddLogEntry(s.level.log,e,Array.prototype.slice.call(arguments,1));
},info:function(e){return this._tryAddLogEntry(s.level.info,e,Array.prototype.slice.call(arguments,1))},warn:function(e){return this._tryAddLogEntry(s.level.warn,e,Array.prototype.slice.call(arguments,1))},error:function(e){return this._tryAddLogEntry(s.level.error,e,Array.prototype.slice.call(arguments,1))},_tryAddLogEntry:function(e,t,i){if(!s.scopes.hasLevel(t,e)){return null}var n=new p(e,t,i);s.entries.add(n);if(s.outputEnabled){n.print()}return n},_getStackTrace:function(){var e=[];var t=false;try{s.dont.exist+=0}catch(i){var n,s,o;if(i.stack){n=i.stack.split("\n");for(s=0,o=n.length;s<o;s++){if(n[s].match(/^\s*[A-Za-z0-9\-_\$]+\(/)){e.push(n[s])}}e.shift();t=true}else if(window&&window.opera&&i.message){n=i.message.split("\n");for(s=0,o=n.length;s<o;s++){if(n[s].match(/^\s*[A-Za-z0-9\-_\$]+\(/)){var r=n[s];if(n[s+1]){r+=" at "+n[s+1];s++}e.push(r)}}e.shift();t=true}}if(!t){var a=arguments.callee.caller;while(a){var d=a.toString();var l=d.substring(d.indexOf("function"),d.indexOf("{"))||"anonymous";
e.push(l);a=a.caller}}return e.join("\r\n")}},disabledImpl:{console:{log:function(){},trace:function(){},info:function(){},warn:function(){}},log:function(){},trace:function(){},info:function(){},warn:function(){},error:function(){}},enable:function(e){e=e===undefined?true:e;if(s.enabled===e){return}s.enabled=e;var t=e?s.enabledImpl:s.disabledImpl;n.extend(s,t)},disable:function(){s.enable(false)},enableOutput:function(e){e=e===null?true:e;s.outputEnabled=e},disableOutput:function(){s.enableOutput(false)},resetSettings:function(){require("shared/log.settings").resetSettings(s);s("log.resetSettings","Settings are reset to default.")}};n.extend(s,m);s.resetSettings()})(window)});define("interface/helpers",["shared/polyfills"],function s(require,exports,e){function t(e,t,i,n){var s;var o=function(t){if(n&&n(t)){return e}return t};var r=function(i){var n=e[i],s=t[i];if(n!==undefined){if(typeof n==="function"){e[i]=function(){var e=this._super,i;if(typeof s==="function"){this._super=s.bind(t);
}try{i=n.apply(this,arguments)}finally{this._super=e}return o(i)}}else{throw new TypeError("You can't override members that aren't functions.")}}else{if(typeof s==="function"){var r=function(){return o(s.apply(this,arguments))};var a=r.bind(t);a.bind=function(e){return r.bind(e)};e[i]=a}else{Object.defineProperty(e,i,{get:function(){return o(t[i])},set:function(){throw new Error("You cannot set a wrapped property on an outer object. "+"Please talk to Platform team if you feel you need this.")},enumerable:true})}}};if(i){for(s=0;s<i.length;s++){r(i[s])}}return e}function i(e){throw new Error("Sorry, "+e+" is not implemented yet. Please yell at Platform team.")}exports.wrap=t;exports.notImplemented=i});define("interface/settings",["shared/polyfills","interface/helpers","settings"],function o(require,exports,e){var t=require("interface/helpers").wrap,i=require("settings");var n=["action","batchedServerCallUrl","clientTrackerTrail","controller","delayQTextOnLoad","enableClientTracker","enableFrameBusting","interface_strings","isCrawler","isLoggedIn","pageIsMobile","serverCallUrl","windowId"];
t(exports,i,n)});define("jquery",["shared/polyfills"],function r(require,exports,e){(function(e,t){var i=e.document,n=e.navigator,s=e.location;var o=function(){var s=function(e,t){return new s.fn.init(e,t,a)},o=e.jQuery,r=e.$,a,d=/^(?:[^#<]*(<[\w\W]+>)[^>]*$|#([\w\-]*)$)/,l=/\S/,c=/^\s+/,u=/\s+$/,h=/\d/,f=/^<(\w+)\s*\/?>(?:<\/\1>)?$/,p=/^[\],:{}\s]*$/,g=/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,m=/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,v=/(?:^|:|,)(?:\s*\[)+/g,_=/(webkit)[ \/]([\w.]+)/,w=/(opera)(?:.*version)?[ \/]([\w.]+)/,b=/(msie) ([\w.]+)/,y=/(mozilla)(?:.*? rv:([\w.]+))?/,C=/-([a-z]|[0-9])/gi,x=/^-ms-/,k=function(e,t){return(t+"").toUpperCase()},S=n.userAgent,E,T,L,M=Object.prototype.toString,D=Object.prototype.hasOwnProperty,A=Array.prototype.push,I=Array.prototype.slice,q=String.prototype.trim,N=Array.prototype.indexOf,O={};s.fn=s.prototype={constructor:s,init:function(e,n,o){var r,a,l,c;if(!e){return this}if(e.nodeType){this.context=this[0]=e;this.length=1;
return this}if(e==="body"&&!n&&i.body){this.context=i;this[0]=i.body;this.selector=e;this.length=1;return this}if(typeof e==="string"){if(e.charAt(0)==="<"&&e.charAt(e.length-1)===">"&&e.length>=3){r=[null,e,null]}else{r=d.exec(e)}if(r&&(r[1]||!n)){if(r[1]){n=n instanceof s?n[0]:n;c=n?n.ownerDocument||n:i;l=f.exec(e);if(l){if(s.isPlainObject(n)){e=[i.createElement(l[1])];s.fn.attr.call(e,n,true)}else{e=[c.createElement(l[1])]}}else{l=s.buildFragment([r[1]],[c]);e=(l.cacheable?s.clone(l.fragment):l.fragment).childNodes}return s.merge(this,e)}else{a=i.getElementById(r[2]);if(a&&a.parentNode){if(a.id!==r[2]){return o.find(e)}this.length=1;this[0]=a}this.context=i;this.selector=e;return this}}else if(!n||n.jquery){return(n||o).find(e)}else{return this.constructor(n).find(e)}}else if(s.isFunction(e)){return o.ready(e)}if(e.selector!==t){this.selector=e.selector;this.context=e.context}return s.makeArray(e,this)},selector:"",jquery:"1.7",length:0,size:function(){return this.length},toArray:function(){
return I.call(this,0)},get:function(e){return e==null?this.toArray():e<0?this[this.length+e]:this[e]},pushStack:function(e,t,i){var n=this.constructor();if(s.isArray(e)){A.apply(n,e)}else{s.merge(n,e)}n.prevObject=this;n.context=this.context;if(t==="find"){n.selector=this.selector+(this.selector?" ":"")+i}else if(t){n.selector=this.selector+"."+t+"("+i+")"}return n},each:function(e,t){return s.each(this,e,t)},ready:function(e){s.bindReady();T.add(e);return this},eq:function(e){return e===-1?this.slice(e):this.slice(e,+e+1)},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},slice:function(){return this.pushStack(I.apply(this,arguments),"slice",I.call(arguments).join(","))},map:function(e){return this.pushStack(s.map(this,function(t,i){return e.call(t,i,t)}))},end:function(){return this.prevObject||this.constructor(null)},push:A,sort:[].sort,splice:[].splice};s.fn.init.prototype=s.fn;s.extend=s.fn.extend=function(){var e,i,n,o,r,a,d=arguments[0]||{},l=1,c=arguments.length,u=false;
if(typeof d==="boolean"){u=d;d=arguments[1]||{};l=2}if(typeof d!=="object"&&!s.isFunction(d)){d={}}if(c===l){d=this;--l}for(;l<c;l++){if((e=arguments[l])!=null){for(i in e){n=d[i];o=e[i];if(d===o){continue}if(u&&o&&(s.isPlainObject(o)||(r=s.isArray(o)))){if(r){r=false;a=n&&s.isArray(n)?n:[]}else{a=n&&s.isPlainObject(n)?n:{}}d[i]=s.extend(u,a,o)}else if(o!==t){d[i]=o}}}}return d};s.extend({noConflict:function(t){if(e.$===s){e.$=r}if(t&&e.jQuery===s){e.jQuery=o}return s},isReady:false,readyWait:1,holdReady:function(e){if(e){s.readyWait++}else{s.ready(true)}},ready:function(e){if(e===true&&!--s.readyWait||e!==true&&!s.isReady){if(!i.body){return setTimeout(s.ready,1)}s.isReady=true;if(e!==true&&--s.readyWait>0){return}T.fireWith(i,[s]);if(s.fn.trigger){s(i).trigger("ready").unbind("ready")}}},bindReady:function(){if(T){return}T=s.Callbacks("once memory");if(i.readyState==="complete"){return setTimeout(s.ready,1)}if(i.addEventListener){i.addEventListener("DOMContentLoaded",L,false);e.addEventListener("load",s.ready,false);
}else if(i.attachEvent){i.attachEvent("onreadystatechange",L);e.attachEvent("onload",s.ready);var t=false;try{t=e.frameElement==null}catch(n){}if(i.documentElement.doScroll&&t){R()}}},isFunction:function(e){return s.type(e)==="function"},isArray:Array.isArray||function(e){return s.type(e)==="array"},isWindow:function(e){return e&&typeof e==="object"&&"setInterval"in e},isNumeric:function(e){return e!=null&&h.test(e)&&!isNaN(e)},type:function(e){return e==null?String(e):O[M.call(e)]||"object"},isPlainObject:function(e){if(!e||s.type(e)!=="object"||e.nodeType||s.isWindow(e)){return false}try{if(e.constructor&&!D.call(e,"constructor")&&!D.call(e.constructor.prototype,"isPrototypeOf")){return false}}catch(i){return false}var n;for(n in e){}return n===t||D.call(e,n)},isEmptyObject:function(e){for(var t in e){return false}return true},error:function(e){throw e},parseJSON:function(t){if(typeof t!=="string"||!t){return null}t=s.trim(t);if(e.JSON&&e.JSON.parse){return e.JSON.parse(t)}if(p.test(t.replace(g,"@").replace(m,"]").replace(v,""))){
return new Function("return "+t)()}s.error("Invalid JSON: "+t)},parseXML:function(i){var n,o;try{if(e.DOMParser){o=new DOMParser;n=o.parseFromString(i,"text/xml")}else{n=new ActiveXObject("Microsoft.XMLDOM");n.async="false";n.loadXML(i)}}catch(r){n=t}if(!n||!n.documentElement||n.getElementsByTagName("parsererror").length){s.error("Invalid XML: "+i)}return n},noop:function(){},globalEval:function(t){if(t&&l.test(t)){(e.execScript||function(t){e["eval"].call(e,t)})(t)}},camelCase:function(e){return e.replace(x,"ms-").replace(C,k)},nodeName:function(e,t){return e.nodeName&&e.nodeName.toUpperCase()===t.toUpperCase()},each:function(e,i,n){var o,r=0,a=e.length,d=a===t||s.isFunction(e);if(n){if(d){for(o in e){if(i.apply(e[o],n)===false){break}}}else{for(;r<a;){if(i.apply(e[r++],n)===false){break}}}}else{if(d){for(o in e){if(i.call(e[o],o,e[o])===false){break}}}else{for(;r<a;){if(i.call(e[r],r,e[r++])===false){break}}}}return e},trim:q?function(e){return e==null?"":q.call(e)}:function(e){return e==null?"":e.toString().replace(c,"").replace(u,"");
},makeArray:function(e,t){var i=t||[];if(e!=null){var n=s.type(e);if(e.length==null||n==="string"||n==="function"||n==="regexp"||s.isWindow(e)){A.call(i,e)}else{s.merge(i,e)}}return i},inArray:function(e,t,i){var n;if(t){if(N){return N.call(t,e,i)}n=t.length;i=i?i<0?Math.max(0,n+i):i:0;for(;i<n;i++){if(i in t&&t[i]===e){return i}}}return-1},merge:function(e,i){var n=e.length,s=0;if(typeof i.length==="number"){for(var o=i.length;s<o;s++){e[n++]=i[s]}}else{while(i[s]!==t){e[n++]=i[s++]}}e.length=n;return e},grep:function(e,t,i){var n=[],s;i=!!i;for(var o=0,r=e.length;o<r;o++){s=!!t(e[o],o);if(i!==s){n.push(e[o])}}return n},map:function(e,i,n){var o,r,a=[],d=0,l=e.length,c=e instanceof s||l!==t&&typeof l==="number"&&(l>0&&e[0]&&e[l-1]||l===0||s.isArray(e));if(c){for(;d<l;d++){o=i(e[d],d,n);if(o!=null){a[a.length]=o}}}else{for(r in e){o=i(e[r],r,n);if(o!=null){a[a.length]=o}}}return a.concat.apply([],a)},guid:1,proxy:function(e,i){if(typeof i==="string"){var n=e[i];i=e;e=n}if(!s.isFunction(e)){
return t}var o=I.call(arguments,2),r=function(){return e.apply(i,o.concat(I.call(arguments)))};r.guid=e.guid=e.guid||r.guid||s.guid++;return r},access:function(e,i,n,o,r,a){var d=e.length;if(typeof i==="object"){for(var l in i){s.access(e,l,i[l],o,r,n)}return e}if(n!==t){o=!a&&o&&s.isFunction(n);for(var c=0;c<d;c++){r(e[c],i,o?n.call(e[c],c,r(e[c],i)):n,a)}return e}return d?r(e[0],i):t},now:function(){return(new Date).getTime()},uaMatch:function(e){e=e.toLowerCase();var t=_.exec(e)||w.exec(e)||b.exec(e)||e.indexOf("compatible")<0&&y.exec(e)||[];return{browser:t[1]||"",version:t[2]||"0"}},sub:function(){function e(t,i){return new e.fn.init(t,i)}s.extend(true,e,this);e.superclass=this;e.fn=e.prototype=this();e.fn.constructor=e;e.sub=this.sub;e.fn.init=function n(i,o){if(o&&o instanceof s&&!(o instanceof e)){o=e(o)}return s.fn.init.call(this,i,o,t)};e.fn.init.prototype=e.fn;var t=e(i);return e},browser:{}});s.each("Boolean Number String Function Array Date RegExp Object".split(" "),function(e,t){
O["[object "+t+"]"]=t.toLowerCase()});E=s.uaMatch(S);if(E.browser){s.browser[E.browser]=true;s.browser.version=E.version}if(s.browser.webkit){s.browser.safari=true}if(l.test("Â ")){c=/^[\s\xA0]+/;u=/[\s\xA0]+$/}a=s(i);if(i.addEventListener){L=function(){i.removeEventListener("DOMContentLoaded",L,false);s.ready()}}else if(i.attachEvent){L=function(){if(i.readyState==="complete"){i.detachEvent("onreadystatechange",L);s.ready()}}}function R(){if(s.isReady){return}try{i.documentElement.doScroll("left")}catch(e){setTimeout(R,1);return}s.ready()}if(typeof define==="function"&&define.amd&&define.amd.jQuery){define("jquery",[],function(){return s})}return s}();var r={};function a(e){var t=r[e]={},i,n;e=e.split(/\s+/);for(i=0,n=e.length;i<n;i++){t[e[i]]=true}return t}o.Callbacks=function(e){e=e?r[e]||a(e):{};var i=[],n=[],s,d,l,c,u,h=function(t){var n,s,r,a,d;for(n=0,s=t.length;n<s;n++){r=t[n];a=o.type(r);if(a==="array"){h(r)}else if(a==="function"){if(!e.unique||!p.has(r)){i.push(r)}}}},f=function(t,o){
o=o||[];s=!e.memory||[t,o];d=true;u=l||0;l=0;c=i.length;for(;i&&u<c;u++){if(i[u].apply(t,o)===false&&e.stopOnFalse){s=true;break}}d=false;if(i){if(!e.once){if(n&&n.length){s=n.shift();p.fireWith(s[0],s[1])}}else if(s===true){p.disable()}else{i=[]}}},p={add:function(){if(i){var e=i.length;h(arguments);if(d){c=i.length}else if(s&&s!==true){l=e;f(s[0],s[1])}}return this},remove:function(){if(i){var t=arguments,n=0,s=t.length;for(;n<s;n++){for(var o=0;o<i.length;o++){if(t[n]===i[o]){if(d){if(o<=c){c--;if(o<=u){u--}}}i.splice(o--,1);if(e.unique){break}}}}}return this},has:function(e){if(i){var t=0,n=i.length;for(;t<n;t++){if(e===i[t]){return true}}}return false},empty:function(){i=[];return this},disable:function(){i=n=s=t;return this},disabled:function(){return!i},lock:function(){n=t;if(!s||s===true){p.disable()}return this},locked:function(){return!n},fireWith:function(t,i){if(n){if(d){if(!e.once){n.push([t,i])}}else if(!(e.once&&s)){f(t,i)}}return this},fire:function(){p.fireWith(this,arguments);
return this},fired:function(){return!!s}};return p};var d=[].slice;o.extend({Deferred:function(e){var t=o.Callbacks("once memory"),i=o.Callbacks("once memory"),n=o.Callbacks("memory"),s="pending",r={resolve:t,reject:i,notify:n},a={done:t.add,fail:i.add,progress:n.add,state:function(){return s},isResolved:t.fired,isRejected:i.fired,then:function(e,t,i){d.done(e).fail(t).progress(i);return this},always:function(){return d.done.apply(d,arguments).fail.apply(d,arguments)},pipe:function(e,t,i){return o.Deferred(function(n){o.each({done:[e,"resolve"],fail:[t,"reject"],progress:[i,"notify"]},function(e,t){var i=t[0],s=t[1],r;if(o.isFunction(i)){d[e](function(){r=i.apply(this,arguments);if(r&&o.isFunction(r.promise)){r.promise().then(n.resolve,n.reject,n.notify)}else{n[s+"With"](this===d?n:this,[r])}})}else{d[e](n[s])}})}).promise()},promise:function(e){if(e==null){e=a}else{for(var t in a){e[t]=a[t]}}return e}},d=a.promise({}),l;for(l in r){d[l]=r[l].fire;d[l+"With"]=r[l].fireWith}d.done(function(){
s="resolved"},i.disable,n.lock).fail(function(){s="rejected"},t.disable,n.lock);if(e){e.call(d,d)}return d},when:function(e){var t=d.call(arguments,0),i=0,n=t.length,s=new Array(n),r=n,a=n,l=n<=1&&e&&o.isFunction(e.promise)?e:o.Deferred(),c=l.promise();function u(e){return function(i){t[e]=arguments.length>1?d.call(arguments,0):i;if(!--r){l.resolveWith(l,t)}}}function h(e){return function(t){s[e]=arguments.length>1?d.call(arguments,0):t;l.notifyWith(c,s)}}if(n>1){for(;i<n;i++){if(t[i]&&t[i].promise&&o.isFunction(t[i].promise)){t[i].promise().then(u(i),l.reject,h(i))}else{--r}}if(!r){l.resolveWith(l,t)}}else if(l!==e){l.resolveWith(l,n?[e]:[])}return c}});o.support=function(){var e=i.createElement("div"),t=i.documentElement,n,s,r,a,d,l,c,u,h,f,p,g,m,v,_,w,b;e.setAttribute("className","t");e.innerHTML="   <link/><table></table><a href='/a' style='top:1px;float:left;opacity:.55;'>a</a><input type='checkbox'/><nav></nav>";n=e.getElementsByTagName("*");s=e.getElementsByTagName("a")[0];if(!n||!n.length||!s){
return{}}r=i.createElement("select");a=r.appendChild(i.createElement("option"));d=e.getElementsByTagName("input")[0];c={leadingWhitespace:e.firstChild.nodeType===3,tbody:!e.getElementsByTagName("tbody").length,htmlSerialize:!!e.getElementsByTagName("link").length,style:/top/.test(s.getAttribute("style")),hrefNormalized:s.getAttribute("href")==="/a",opacity:/^0.55/.test(s.style.opacity),cssFloat:!!s.style.cssFloat,unknownElems:!!e.getElementsByTagName("nav").length,checkOn:d.value==="on",optSelected:a.selected,getSetAttribute:e.className!=="t",enctype:!!i.createElement("form").enctype,submitBubbles:true,changeBubbles:true,focusinBubbles:false,deleteExpando:true,noCloneEvent:true,inlineBlockNeedsLayout:false,shrinkWrapBlocks:false,reliableMarginRight:true};d.checked=true;c.noCloneChecked=d.cloneNode(true).checked;r.disabled=true;c.optDisabled=!a.disabled;try{delete e.test}catch(y){c.deleteExpando=false}if(!e.addEventListener&&e.attachEvent&&e.fireEvent){e.attachEvent("onclick",function(){
c.noCloneEvent=false});e.cloneNode(true).fireEvent("onclick")}d=i.createElement("input");d.value="t";d.setAttribute("type","radio");c.radioValue=d.value==="t";d.setAttribute("checked","checked");e.appendChild(d);u=i.createDocumentFragment();u.appendChild(e.lastChild);c.checkClone=u.cloneNode(true).cloneNode(true).lastChild.checked;e.innerHTML="";e.style.width=e.style.paddingLeft="1px";h=i.getElementsByTagName("body")[0];p=i.createElement(h?"div":"body");g={visibility:"hidden",width:0,height:0,border:0,margin:0,background:"none"};if(h){o.extend(g,{position:"absolute",left:"-999px",top:"-999px"})}for(w in g){p.style[w]=g[w]}p.appendChild(e);f=h||t;f.insertBefore(p,f.firstChild);c.appendChecked=d.checked;c.boxModel=e.offsetWidth===2;if("zoom"in e.style){e.style.display="inline";e.style.zoom=1;c.inlineBlockNeedsLayout=e.offsetWidth===2;e.style.display="";e.innerHTML="<div style='width:4px;'></div>";c.shrinkWrapBlocks=e.offsetWidth!==2}e.innerHTML="<table><tr><td style='padding:0;border:0;display:none'></td><td>t</td></tr></table>";
m=e.getElementsByTagName("td");b=m[0].offsetHeight===0;m[0].style.display="";m[1].style.display="none";c.reliableHiddenOffsets=b&&m[0].offsetHeight===0;e.innerHTML="";if(i.defaultView&&i.defaultView.getComputedStyle){l=i.createElement("div");l.style.width="0";l.style.marginRight="0";e.appendChild(l);c.reliableMarginRight=(parseInt((i.defaultView.getComputedStyle(l,null)||{marginRight:0}).marginRight,10)||0)===0}if(e.attachEvent){for(w in{submit:1,change:1,focusin:1}){_="on"+w;b=_ in e;if(!b){e.setAttribute(_,"return;");b=typeof e[_]==="function"}c[w+"Bubbles"]=b}}o(function(){var e,t,n,s,r,a,d=1,l="position:absolute;top:0;left:0;width:1px;height:1px;margin:0;",u="visibility:hidden;border:0;",f="style='"+l+"border:5px solid #000;padding:0;'",g="<div "+f+"><div></div></div>"+"<table "+f+" cellpadding='0' cellspacing='0'>"+"<tr><td></td></tr></table>";h=i.getElementsByTagName("body")[0];if(!h){return}e=i.createElement("div");e.style.cssText=u+"width:0;height:0;position:static;top:0;margin-top:"+d+"px";
h.insertBefore(e,h.firstChild);p=i.createElement("div");p.style.cssText=l+u;p.innerHTML=g;e.appendChild(p);t=p.firstChild;n=t.firstChild;r=t.nextSibling.firstChild.firstChild;a={doesNotAddBorder:n.offsetTop!==5,doesAddBorderForTableAndCells:r.offsetTop===5};n.style.position="fixed";n.style.top="20px";a.fixedPosition=n.offsetTop===20||n.offsetTop===15;n.style.position=n.style.top="";t.style.overflow="hidden";t.style.position="relative";a.subtractsBorderForOverflowNotVisible=n.offsetTop===-5;a.doesNotIncludeMarginInBodyOffset=h.offsetTop!==d;h.removeChild(e);p=e=null;o.extend(c,a)});p.innerHTML="";f.removeChild(p);p=u=r=a=h=l=e=d=null;return c}();o.boxModel=o.support.boxModel;var l=/^(?:\{.*\}|\[.*\])$/,c=/([A-Z])/g;o.extend({cache:{},uuid:0,expando:"jQuery"+(o.fn.jquery+Math.random()).replace(/\D/g,""),noData:{embed:true,object:"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000",applet:true},hasData:function(e){e=e.nodeType?o.cache[e[o.expando]]:e[o.expando];return!!e&&!h(e)},data:function(e,i,n,s){
if(!o.acceptData(e)){return}var r,a,d,l=o.expando,c=typeof i==="string",u=e.nodeType,h=u?o.cache:e,f=u?e[o.expando]:e[o.expando]&&o.expando,p=i==="events";if((!f||!h[f]||!p&&!s&&!h[f].data)&&c&&n===t){return}if(!f){if(u){e[o.expando]=f=++o.uuid}else{f=o.expando}}if(!h[f]){h[f]={};if(!u){h[f].toJSON=o.noop}}if(typeof i==="object"||typeof i==="function"){if(s){h[f]=o.extend(h[f],i)}else{h[f].data=o.extend(h[f].data,i)}}r=a=h[f];if(!s){if(!a.data){a.data={}}a=a.data}if(n!==t){a[o.camelCase(i)]=n}if(p&&!a[i]){return r.events}if(c){d=a[i];if(d==null){d=a[o.camelCase(i)]}}else{d=a}return d},removeData:function(e,t,i){if(!o.acceptData(e)){return}var n,s,r,a=o.expando,d=e.nodeType,l=d?o.cache:e,c=d?e[o.expando]:o.expando;if(!l[c]){return}if(t){n=i?l[c]:l[c].data;if(n){if(o.isArray(t)){t=t}else if(t in n){t=[t]}else{t=o.camelCase(t);if(t in n){t=[t]}else{t=t.split(" ")}}for(s=0,r=t.length;s<r;s++){delete n[t[s]]}if(!(i?h:o.isEmptyObject)(n)){return}}}if(!i){delete l[c].data;if(!h(l[c])){return}}
if(o.support.deleteExpando||!l.setInterval){delete l[c]}else{l[c]=null}if(d){if(o.support.deleteExpando){delete e[o.expando]}else if(e.removeAttribute){e.removeAttribute(o.expando)}else{e[o.expando]=null}}},_data:function(e,t,i){return o.data(e,t,i,true)},acceptData:function(e){if(e.nodeName){var t=o.noData[e.nodeName.toLowerCase()];if(t){return!(t===true||e.getAttribute("classid")!==t)}}return true}});o.fn.extend({data:function(e,i){var n,s,r,a=null;if(typeof e==="undefined"){if(this.length){a=o.data(this[0]);if(this[0].nodeType===1&&!o._data(this[0],"parsedAttrs")){s=this[0].attributes;for(var d=0,l=s.length;d<l;d++){r=s[d].name;if(r.indexOf("data-")===0){r=o.camelCase(r.substring(5));u(this[0],r,a[r])}}o._data(this[0],"parsedAttrs",true)}}return a}else if(typeof e==="object"){return this.each(function(){o.data(this,e)})}n=e.split(".");n[1]=n[1]?"."+n[1]:"";if(i===t){a=this.triggerHandler("getData"+n[1]+"!",[n[0]]);if(a===t&&this.length){a=o.data(this[0],e);a=u(this[0],e,a)}return a===t&&n[1]?this.data(n[0]):a;
}else{return this.each(function(){var t=o(this),s=[n[0],i];t.triggerHandler("setData"+n[1]+"!",s);o.data(this,e,i);t.triggerHandler("changeData"+n[1]+"!",s)})}},removeData:function(e){return this.each(function(){o.removeData(this,e)})}});function u(e,i,n){if(n===t&&e.nodeType===1){var s="data-"+i.replace(c,"-$1").toLowerCase();n=e.getAttribute(s);if(typeof n==="string"){try{n=n==="true"?true:n==="false"?false:n==="null"?null:o.isNumeric(n)?parseFloat(n):l.test(n)?o.parseJSON(n):n}catch(r){}o.data(e,i,n)}else{n=t}}return n}function h(e){for(var t in e){if(t==="data"&&o.isEmptyObject(e[t])){continue}if(t!=="toJSON"){return false}}return true}function f(e,t,i){var n=t+"defer",s=t+"queue",r=t+"mark",a=o._data(e,n);if(a&&(i==="queue"||!o._data(e,s))&&(i==="mark"||!o._data(e,r))){setTimeout(function(){if(!o._data(e,s)&&!o._data(e,r)){o.removeData(e,n,true);a.fire()}},0)}}o.extend({_mark:function(e,t){if(e){t=(t||"fx")+"mark";o._data(e,t,(o._data(e,t)||0)+1)}},_unmark:function(e,t,i){if(e!==true){
i=t;t=e;e=false}if(t){i=i||"fx";var n=i+"mark",s=e?0:(o._data(t,n)||1)-1;if(s){o._data(t,n,s)}else{o.removeData(t,n,true);f(t,i,"mark")}}},queue:function(e,t,i){var n;if(e){t=(t||"fx")+"queue";n=o._data(e,t);if(i){if(!n||o.isArray(i)){n=o._data(e,t,o.makeArray(i))}else{n.push(i)}}return n||[]}},dequeue:function(e,t){t=t||"fx";var i=o.queue(e,t),n=i.shift(),s={};if(n==="inprogress"){n=i.shift()}if(n){if(t==="fx"){i.unshift("inprogress")}o._data(e,t+".run",s);n.call(e,function(){o.dequeue(e,t)},s)}if(!i.length){o.removeData(e,t+"queue "+t+".run",true);f(e,t,"queue")}}});o.fn.extend({queue:function(e,i){if(typeof e!=="string"){i=e;e="fx"}if(i===t){return o.queue(this[0],e)}return this.each(function(){var t=o.queue(this,e,i);if(e==="fx"&&t[0]!=="inprogress"){o.dequeue(this,e)}})},dequeue:function(e){return this.each(function(){o.dequeue(this,e)})},delay:function(e,t){e=o.fx?o.fx.speeds[e]||e:e;t=t||"fx";return this.queue(t,function(t,i){var n=setTimeout(t,e);i.stop=function(){clearTimeout(n);
}})},clearQueue:function(e){return this.queue(e||"fx",[])},promise:function(e,i){if(typeof e!=="string"){i=e;e=t}e=e||"fx";var n=o.Deferred(),s=this,r=s.length,a=1,d=e+"defer",l=e+"queue",c=e+"mark",u;function h(){if(!--a){n.resolveWith(s,[s])}}while(r--){if(u=o.data(s[r],d,t,true)||(o.data(s[r],l,t,true)||o.data(s[r],c,t,true))&&o.data(s[r],d,o.Callbacks("once memory"),true)){a++;u.add(h)}}h();return n.promise()}});var p=/[\n\t\r]/g,g=/\s+/,m=/\r/g,v=/^(?:button|input)$/i,_=/^(?:button|input|object|select|textarea)$/i,w=/^a(?:rea)?$/i,b=/^(?:autofocus|autoplay|async|checked|controls|defer|disabled|hidden|loop|multiple|open|readonly|required|scoped|selected)$/i,y=o.support.getSetAttribute,C,x,k;o.fn.extend({attr:function(e,t){return o.access(this,e,t,true,o.attr)},removeAttr:function(e){return this.each(function(){o.removeAttr(this,e)})},prop:function(e,t){return o.access(this,e,t,true,o.prop)},removeProp:function(e){e=o.propFix[e]||e;return this.each(function(){try{this[e]=t;delete this[e];
}catch(i){}})},addClass:function(e){var t,i,n,s,r,a,d;if(o.isFunction(e)){return this.each(function(t){o(this).addClass(e.call(this,t,this.className))})}if(e&&typeof e==="string"){t=e.split(g);for(i=0,n=this.length;i<n;i++){s=this[i];if(s.nodeType===1){if(!s.className&&t.length===1){s.className=e}else{r=" "+s.className+" ";for(a=0,d=t.length;a<d;a++){if(!~r.indexOf(" "+t[a]+" ")){r+=t[a]+" "}}s.className=o.trim(r)}}}}return this},removeClass:function(e){var i,n,s,r,a,d,l;if(o.isFunction(e)){return this.each(function(t){o(this).removeClass(e.call(this,t,this.className))})}if(e&&typeof e==="string"||e===t){i=(e||"").split(g);for(n=0,s=this.length;n<s;n++){r=this[n];if(r.nodeType===1&&r.className){if(e){a=(" "+r.className+" ").replace(p," ");for(d=0,l=i.length;d<l;d++){a=a.replace(" "+i[d]+" "," ")}r.className=o.trim(a)}else{r.className=""}}}}return this},toggleClass:function(e,t){var i=typeof e,n=typeof t==="boolean";if(o.isFunction(e)){return this.each(function(i){o(this).toggleClass(e.call(this,i,this.className,t),t);
})}return this.each(function(){if(i==="string"){var s,r=0,a=o(this),d=t,l=e.split(g);while(s=l[r++]){d=n?d:!a.hasClass(s);a[d?"addClass":"removeClass"](s)}}else if(i==="undefined"||i==="boolean"){if(this.className){o._data(this,"__className__",this.className)}this.className=this.className||e===false?"":o._data(this,"__className__")||""}})},hasClass:function(e){var t=" "+e+" ",i=0,n=this.length;for(;i<n;i++){if(this[i].nodeType===1&&(" "+this[i].className+" ").replace(p," ").indexOf(t)>-1){return true}}return false},val:function(e){var i,n,s,r=this[0];if(!arguments.length){if(r){i=o.valHooks[r.nodeName.toLowerCase()]||o.valHooks[r.type];if(i&&"get"in i&&(n=i.get(r,"value"))!==t){return n}n=r.value;return typeof n==="string"?n.replace(m,""):n==null?"":n}return t}s=o.isFunction(e);return this.each(function(n){var r=o(this),a;if(this.nodeType!==1){return}if(s){a=e.call(this,n,r.val())}else{a=e}if(a==null){a=""}else if(typeof a==="number"){a+=""}else if(o.isArray(a)){a=o.map(a,function(e){return e==null?"":e+"";
})}i=o.valHooks[this.nodeName.toLowerCase()]||o.valHooks[this.type];if(!i||!("set"in i)||i.set(this,a,"value")===t){this.value=a}})}});o.extend({valHooks:{option:{get:function(e){var t=e.attributes.value;return!t||t.specified?e.value:e.text}},select:{get:function(e){var t,i,n,s,r=e.selectedIndex,a=[],d=e.options,l=e.type==="select-one";if(r<0){return null}i=l?r:0;n=l?r+1:d.length;for(;i<n;i++){s=d[i];if(s.selected&&(o.support.optDisabled?!s.disabled:s.getAttribute("disabled")===null)&&(!s.parentNode.disabled||!o.nodeName(s.parentNode,"optgroup"))){t=o(s).val();if(l){return t}a.push(t)}}if(l&&!a.length&&d.length){return o(d[r]).val()}return a},set:function(e,t){var i=o.makeArray(t);o(e).find("option").each(function(){this.selected=o.inArray(o(this).val(),i)>=0});if(!i.length){e.selectedIndex=-1}return i}}},attrFn:{val:true,css:true,html:true,text:true,data:true,width:true,height:true,offset:true},attr:function(e,i,n,s){var r,a,d,l=e.nodeType;if(!e||l===3||l===8||l===2){return t}if(s&&i in o.attrFn){
return o(e)[i](n)}if(!("getAttribute"in e)){return o.prop(e,i,n)}d=l!==1||!o.isXMLDoc(e);if(d){i=i.toLowerCase();a=o.attrHooks[i]||(b.test(i)?x:C)}if(n!==t){if(n===null){o.removeAttr(e,i);return t}else if(a&&"set"in a&&d&&(r=a.set(e,n,i))!==t){return r}else{e.setAttribute(i,""+n);return n}}else if(a&&"get"in a&&d&&(r=a.get(e,i))!==null){return r}else{r=e.getAttribute(i);return r===null?t:r}},removeAttr:function(e,t){var i,n,s,r,a=0;if(e.nodeType===1){n=(t||"").split(g);r=n.length;for(;a<r;a++){s=n[a].toLowerCase();i=o.propFix[s]||s;o.attr(e,s,"");e.removeAttribute(y?s:i);if(b.test(s)&&i in e){e[i]=false}}}},attrHooks:{type:{set:function(e,t){if(v.test(e.nodeName)&&e.parentNode){o.error("type property can't be changed")}else if(!o.support.radioValue&&t==="radio"&&o.nodeName(e,"input")){var i=e.value;e.setAttribute("type",t);if(i){e.value=i}return t}}},value:{get:function(e,t){if(C&&o.nodeName(e,"button")){return C.get(e,t)}return t in e?e.value:null},set:function(e,t,i){if(C&&o.nodeName(e,"button")){
return C.set(e,t,i)}e.value=t}}},propFix:{tabindex:"tabIndex",readonly:"readOnly","for":"htmlFor","class":"className",maxlength:"maxLength",cellspacing:"cellSpacing",cellpadding:"cellPadding",rowspan:"rowSpan",colspan:"colSpan",usemap:"useMap",frameborder:"frameBorder",contenteditable:"contentEditable"},prop:function(e,i,n){var s,r,a,d=e.nodeType;if(!e||d===3||d===8||d===2){return t}a=d!==1||!o.isXMLDoc(e);if(a){i=o.propFix[i]||i;r=o.propHooks[i]}if(n!==t){if(r&&"set"in r&&(s=r.set(e,n,i))!==t){return s}else{return e[i]=n}}else{if(r&&"get"in r&&(s=r.get(e,i))!==null){return s}else{return e[i]}}},propHooks:{tabIndex:{get:function(e){var i=e.getAttributeNode("tabindex");return i&&i.specified?parseInt(i.value,10):_.test(e.nodeName)||w.test(e.nodeName)&&e.href?0:t}}}});o.attrHooks.tabindex=o.propHooks.tabIndex;x={get:function(e,i){var n,s=o.prop(e,i);return s===true||typeof s!=="boolean"&&(n=e.getAttributeNode(i))&&n.nodeValue!==false?i.toLowerCase():t},set:function(e,t,i){var n;if(t===false){
o.removeAttr(e,i)}else{n=o.propFix[i]||i;if(n in e){e[n]=true}e.setAttribute(i,i.toLowerCase())}return i}};if(!y){k={name:true,id:true};C=o.valHooks.button={get:function(e,i){var n;n=e.getAttributeNode(i);return n&&(k[i]?n.nodeValue!=="":n.specified)?n.nodeValue:t},set:function(e,t,n){var s=e.getAttributeNode(n);if(!s){s=i.createAttribute(n);e.setAttributeNode(s)}return s.nodeValue=t+""}};o.attrHooks.tabindex.set=C.set;o.each(["width","height"],function(e,t){o.attrHooks[t]=o.extend(o.attrHooks[t],{set:function(e,i){if(i===""){e.setAttribute(t,"auto");return i}}})});o.attrHooks.contenteditable={get:C.get,set:function(e,t,i){if(t===""){t="false"}C.set(e,t,i)}}}if(!o.support.hrefNormalized){o.each(["href","src","width","height"],function(e,i){o.attrHooks[i]=o.extend(o.attrHooks[i],{get:function(e){var n=e.getAttribute(i,2);return n===null?t:n}})})}if(!o.support.style){o.attrHooks.style={get:function(e){return e.style.cssText.toLowerCase()||t},set:function(e,t){return e.style.cssText=""+t}};
}if(!o.support.optSelected){o.propHooks.selected=o.extend(o.propHooks.selected,{get:function(e){var t=e.parentNode;if(t){t.selectedIndex;if(t.parentNode){t.parentNode.selectedIndex}}return null}})}if(!o.support.enctype){o.propFix.enctype="encoding"}if(!o.support.checkOn){o.each(["radio","checkbox"],function(){o.valHooks[this]={get:function(e){return e.getAttribute("value")===null?"on":e.value}}})}o.each(["radio","checkbox"],function(){o.valHooks[this]=o.extend(o.valHooks[this],{set:function(e,t){if(o.isArray(t)){return e.checked=o.inArray(o(e).val(),t)>=0}}})});var S=/\.(.*)$/,E=/^(?:textarea|input|select)$/i,T=/\./g,L=/ /g,M=/[^\w\s.|`]/g,D=/^([^\.]*)?(?:\.(.+))?$/,A=/\bhover(\.\S+)?/,I=/^key/,q=/^(?:mouse|contextmenu)|click/,N=/^(\w*)(?:#([\w\-]+))?(?:\.([\w\-]+))?$/,O=function(e){var t=N.exec(e);if(t){t[1]=(t[1]||"").toLowerCase();t[3]=t[3]&&new RegExp("(?:^|\\s)"+t[3]+"(?:\\s|$)")}return t},R=function(e,t){return(!t[1]||e.nodeName.toLowerCase()===t[1])&&(!t[2]||e.id===t[2])&&(!t[3]||t[3].test(e.className));
},P=function(e){return o.event.special.hover?e:e.replace(A,"mouseenter$1 mouseleave$1")};o.event={add:function(e,i,n,s,r){var a,d,l,c,u,h,f,p,g,m,v,_;if(e.nodeType===3||e.nodeType===8||!i||!n||!(a=o._data(e))){return}if(n.handler){g=n;n=g.handler}if(!n.guid){n.guid=o.guid++}l=a.events;if(!l){a.events=l={}}d=a.handle;if(!d){a.handle=d=function(e){return typeof o!=="undefined"&&(!e||o.event.triggered!==e.type)?o.event.dispatch.apply(d.elem,arguments):t};d.elem=e}i=P(i).split(" ");for(c=0;c<i.length;c++){u=D.exec(i[c])||[];h=u[1];f=(u[2]||"").split(".").sort();_=o.event.special[h]||{};h=(r?_.delegateType:_.bindType)||h;_=o.event.special[h]||{};p=o.extend({type:h,origType:u[1],data:s,handler:n,guid:n.guid,selector:r,namespace:f.join(".")},g);if(r){p.quick=O(r);if(!p.quick&&o.expr.match.POS.test(r)){p.isPositional=true}}v=l[h];if(!v){v=l[h]=[];v.delegateCount=0;if(!_.setup||_.setup.call(e,s,f,d)===false){if(e.addEventListener){e.addEventListener(h,d,false)}else if(e.attachEvent){e.attachEvent("on"+h,d);
}}}if(_.add){_.add.call(e,p);if(!p.handler.guid){p.handler.guid=n.guid}}if(r){v.splice(v.delegateCount++,0,p)}else{v.push(p)}o.event.global[h]=true}e=null},global:{},remove:function(e,t,i,n){var s=o.hasData(e)&&o._data(e),r,a,d,l,c,u,h,f,p,g,m;if(!s||!(h=s.events)){return}t=P(t||"").split(" ");for(r=0;r<t.length;r++){a=D.exec(t[r])||[];d=a[1];l=a[2];if(!d){l=l?"."+l:"";for(u in h){o.event.remove(e,u+l,i,n)}return}f=o.event.special[d]||{};d=(n?f.delegateType:f.bindType)||d;g=h[d]||[];c=g.length;l=l?new RegExp("(^|\\.)"+l.split(".").sort().join("\\.(?:.*\\.)?")+"(\\.|$)"):null;if(i||l||n||f.remove){for(u=0;u<g.length;u++){m=g[u];if(!i||i.guid===m.guid){if(!l||l.test(m.namespace)){if(!n||n===m.selector||n==="**"&&m.selector){g.splice(u--,1);if(m.selector){g.delegateCount--}if(f.remove){f.remove.call(e,m)}}}}}}else{g.length=0}if(g.length===0&&c!==g.length){if(!f.teardown||f.teardown.call(e,l)===false){o.removeEvent(e,d,s.handle)}delete h[d]}}if(o.isEmptyObject(h)){p=s.handle;if(p){p.elem=null;
}o.removeData(e,["events","handle"],true)}},customEvent:{getData:true,setData:true,changeData:true},trigger:function(i,n,s,r){if(s&&(s.nodeType===3||s.nodeType===8)){return}var a=i.type||i,d=[],l,c,u,h,f,p,g,m,v,_;if(a.indexOf("!")>=0){a=a.slice(0,-1);c=true}if(a.indexOf(".")>=0){d=a.split(".");a=d.shift();d.sort()}if((!s||o.event.customEvent[a])&&!o.event.global[a]){return}i=typeof i==="object"?i[o.expando]?i:new o.Event(a,i):new o.Event(a);i.type=a;i.isTrigger=true;i.exclusive=c;i.namespace=d.join(".");i.namespace_re=i.namespace?new RegExp("(^|\\.)"+d.join("\\.(?:.*\\.)?")+"(\\.|$)"):null;p=a.indexOf(":")<0?"on"+a:"";if(r||!s){i.preventDefault()}if(!s){l=o.cache;for(u in l){if(l[u].events&&l[u].events[a]){o.event.trigger(i,n,l[u].handle.elem,true)}}return}i.result=t;if(!i.target){i.target=s}n=n!=null?o.makeArray(n):[];n.unshift(i);g=o.event.special[a]||{};if(g.trigger&&g.trigger.apply(s,n)===false){return}v=[[s,g.bindType||a]];if(!r&&!g.noBubble&&!o.isWindow(s)){_=g.delegateType||a;f=null;
for(h=s.parentNode;h;h=h.parentNode){v.push([h,_]);f=h}if(f&&f===s.ownerDocument){v.push([f.defaultView||f.parentWindow||e,_])}}for(u=0;u<v.length;u++){h=v[u][0];i.type=v[u][1];m=(o._data(h,"events")||{})[i.type]&&o._data(h,"handle");if(m){m.apply(h,n)}m=p&&h[p];if(m&&o.acceptData(h)){m.apply(h,n)}if(i.isPropagationStopped()){break}}i.type=a;if(!i.isDefaultPrevented()){if((!g._default||g._default.apply(s.ownerDocument,n)===false)&&!(a==="click"&&o.nodeName(s,"a"))&&o.acceptData(s)){if(p&&s[a]&&(a!=="focus"&&a!=="blur"||i.target.offsetWidth!==0)&&!o.isWindow(s)){f=s[p];if(f){s[p]=null}o.event.triggered=a;s[a]();o.event.triggered=t;if(f){s[p]=f}}}}return i.result},dispatch:function(i){i=o.event.fix(i||e.event);var n=(o._data(this,"events")||{})[i.type]||[],s=n.delegateCount,r=[].slice.call(arguments,0),a=!i.exclusive&&!i.namespace,d=(o.event.special[i.type]||{}).handle,l=[],c,u,h,f,p,g,m,v,_,w,b;r[0]=i;i.delegateTarget=this;if(s&&!i.target.disabled&&!(i.button&&i.type==="click")){for(h=i.target;h!=this;h=h.parentNode||this){
p={};m=[];for(c=0;c<s;c++){v=n[c];_=v.selector;w=p[_];if(v.isPositional){w=(w||(p[_]=o(_))).index(h)>=0}else if(w===t){w=p[_]=v.quick?R(h,v.quick):o(h).is(_)}if(w){m.push(v)}}if(m.length){l.push({elem:h,matches:m})}}}if(n.length>s){l.push({elem:this,matches:n.slice(s)})}for(c=0;c<l.length&&!i.isPropagationStopped();c++){g=l[c];i.currentTarget=g.elem;for(u=0;u<g.matches.length&&!i.isImmediatePropagationStopped();u++){v=g.matches[u];if(a||!i.namespace&&!v.namespace||i.namespace_re&&i.namespace_re.test(v.namespace)){i.data=v.data;i.handleObj=v;func=d||v.handler;if(e.log&&e.log.enabled)e.log("jquery.dispatch","On "+i.type+", invoking",func);f=func.apply(g.elem,r);if(f!==t){i.result=f;if(f===false){i.preventDefault();i.stopPropagation()}}}}}return i.result},props:"attrChange attrName relatedNode srcElement altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),
filter:function(e,t){if(e.which==null){e.which=t.charCode!=null?t.charCode:t.keyCode}return e}},mouseHooks:{props:"button buttons clientX clientY fromElement offsetX offsetY pageX pageY screenX screenY toElement wheelDelta".split(" "),filter:function(e,n){var s,o,r,a=n.button,d=n.fromElement;if(e.pageX==null&&n.clientX!=null){s=e.target.ownerDocument||i;o=s.documentElement;r=s.body;e.pageX=n.clientX+(o&&o.scrollLeft||r&&r.scrollLeft||0)-(o&&o.clientLeft||r&&r.clientLeft||0);e.pageY=n.clientY+(o&&o.scrollTop||r&&r.scrollTop||0)-(o&&o.clientTop||r&&r.clientTop||0)}if(!e.relatedTarget&&d){e.relatedTarget=d===e.target?n.toElement:d}if(!e.which&&a!==t){e.which=a&1?1:a&2?3:a&4?2:0}return e}},fix:function(e){if(e[o.expando]){return e}var n,s,r=e,a=o.event.fixHooks[e.type]||{},d=a.props?this.props.concat(a.props):this.props;e=o.Event(r);for(n=d.length;n;){s=d[--n];e[s]=r[s]}if(!e.target){e.target=r.srcElement||i}if(e.target.nodeType===3){e.target=e.target.parentNode}if(e.metaKey===t){e.metaKey=e.ctrlKey;
}return a.filter?a.filter(e,r):e},special:{ready:{setup:o.bindReady},focus:{delegateType:"focusin",noBubble:true},blur:{delegateType:"focusout",noBubble:true},beforeunload:{setup:function(e,t,i){if(o.isWindow(this)){this.onbeforeunload=i}},teardown:function(e,t){if(this.onbeforeunload===t){this.onbeforeunload=null}}}},simulate:function(e,t,i,n){var s=o.extend(new o.Event,i,{type:e,isSimulated:true,originalEvent:{}});if(n){o.event.trigger(s,null,t)}else{o.event.dispatch.call(t,s)}if(s.isDefaultPrevented()){i.preventDefault()}}};o.event.handle=o.event.dispatch;o.removeEvent=i.removeEventListener?function(e,t,i){if(e.removeEventListener){e.removeEventListener(t,i,false)}}:function(e,t,i){if(e.detachEvent){e.detachEvent("on"+t,i)}};o.Event=function(t,i){if(!(this instanceof o.Event)){return new o.Event(t,i)}if(t&&t.type){this.originalEvent=t;this.type=t.type;this.isDefaultPrevented=t.defaultPrevented||t.returnValue===false||t.getPreventDefault&&t.getPreventDefault()?F:B}else{this.type=t}if(i){
o.extend(this,i)}this.timeStamp=t&&t.timeStamp||o.now();if(e.log&&e.log.enabled)e.log("jquery.Event","New event object: "+this.type,this);this[o.expando]=true};function B(){return false}function F(){return true}o.Event.prototype={preventDefault:function(){this.isDefaultPrevented=F;var e=this.originalEvent;if(!e){return}if(e.preventDefault){e.preventDefault()}else{e.returnValue=false}},stopPropagation:function(){this.isPropagationStopped=F;var e=this.originalEvent;if(!e){return}if(e.stopPropagation){e.stopPropagation()}e.cancelBubble=true},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=F;this.stopPropagation()},isDefaultPrevented:B,isPropagationStopped:B,isImmediatePropagationStopped:B};o.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(t,i){o.event.special[t]=o.event.special[i]={delegateType:i,bindType:i,handle:function(t){var i=this,n=t.relatedTarget,s=t.handleObj,r=s.selector,a,d;if(!n||s.origType===t.type||n!==i&&!o.contains(i,n)){a=t.type;t.type=s.origType;
func=s.handler;if(e.log&&e.log.enabled)e.log("jquery.mouse*","On "+t.type+", invoking",func);d=func.apply(this,arguments);t.type=a}return d}}});if(!o.support.submitBubbles){o.event.special.submit={setup:function(){if(o.nodeName(this,"form")){return false}o.event.add(this,"click._submit keypress._submit",function(e){var i=e.target,n=o.nodeName(i,"input")||o.nodeName(i,"button")?i.form:t;if(n&&!n._submit_attached){o.event.add(n,"submit._submit",function(e){if(this.parentNode){o.event.simulate("submit",this.parentNode,e,true)}});n._submit_attached=true}})},teardown:function(){if(o.nodeName(this,"form")){return false}o.event.remove(this,"._submit")}}}if(!o.support.changeBubbles){o.event.special.change={setup:function(){if(E.test(this.nodeName)){if(this.type==="checkbox"||this.type==="radio"){o.event.add(this,"propertychange._change",function(e){if(e.originalEvent.propertyName==="checked"){this._just_changed=true}});o.event.add(this,"click._change",function(e){if(this._just_changed){this._just_changed=false;
o.event.simulate("change",this,e,true)}})}return false}o.event.add(this,"beforeactivate._change",function(e){var t=e.target;if(E.test(t.nodeName)&&!t._change_attached){o.event.add(t,"change._change",function(e){if(this.parentNode&&!e.isSimulated){o.event.simulate("change",this.parentNode,e,true)}});t._change_attached=true}})},handle:function(e){var t=e.target;if(this!==t||e.isSimulated||e.isTrigger||t.type!=="radio"&&t.type!=="checkbox"){return e.handleObj.handler.apply(this,arguments)}},teardown:function(){o.event.remove(this,"._change");return E.test(this.nodeName)}}}if(!o.support.focusinBubbles){o.each({focus:"focusin",blur:"focusout"},function(e,t){var n=0,s=function(e){o.event.simulate(t,e.target,o.event.fix(e),true)};o.event.special[t]={setup:function(){if(n++===0){i.addEventListener(e,s,true)}},teardown:function(){if(--n===0){i.removeEventListener(e,s,true)}}}})}o.fn.extend({on:function(e,i,n,s,r){var a,d;if(typeof e==="object"){if(typeof i!=="string"){n=i;i=t}for(d in e){this.on(d,i,n,e[d],r);
}return this}if(n==null&&s==null){s=i;n=i=t}else if(s==null){if(typeof i==="string"){s=n;n=t}else{s=n;n=i;i=t}}if(s===false){s=B}else if(!s){return this}if(r===1){a=s;s=function(e){o().off(e);return a.apply(this,arguments)};s.guid=a.guid||(a.guid=o.guid++)}return this.each(function(){o.event.add(this,e,s,n,i)})},one:function(e,t,i,n){return this.on.call(this,e,t,i,n,1)},off:function(e,i,n){if(e&&e.preventDefault&&e.handleObj){var s=e.handleObj;o(e.delegateTarget).off(s.namespace?s.type+"."+s.namespace:s.type,s.selector,s.handler);return this}if(typeof e==="object"){for(var r in e){this.off(r,i,e[r])}return this}if(i===false||typeof i==="function"){n=i;i=t}if(n===false){n=B}return this.each(function(){o.event.remove(this,e,n,i)})},bind:function(e,t,i){return this.on(e,null,t,i)},unbind:function(e,t){return this.off(e,null,t)},live:function(e,t,i){o(this.context).on(e,this.selector,t,i);return this},die:function(e,t){o(this.context).off(e,this.selector||"**",t);return this},delegate:function(e,t,i,n){
return this.on(t,e,i,n)},undelegate:function(e,t,i){return arguments.length==1?this.off(e,"**"):this.off(t,e,i)},trigger:function(e,t){return this.each(function(){o.event.trigger(e,t,this)})},triggerHandler:function(e,t){if(this[0]){return o.event.trigger(e,t,this[0],true)}},toggle:function(e){var t=arguments,i=e.guid||o.guid++,n=0,s=function(i){var s=(o._data(this,"lastToggle"+e.guid)||0)%n;o._data(this,"lastToggle"+e.guid,s+1);i.preventDefault();return t[s].apply(this,arguments)||false};s.guid=i;while(n<t.length){t[n++].guid=i}return this.click(s)},hover:function(e,t){return this.mouseenter(e).mouseleave(t||e)}});o.each(("blur focus focusin focusout load resize scroll unload click dblclick "+"mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave "+"change select submit keydown keypress keyup error contextmenu").split(" "),function(e,t){o.fn[t]=function(e,i){if(i==null){i=e;e=null}return arguments.length>0?this.bind(t,e,i):this.trigger(t)};if(o.attrFn){o.attrFn[t]=true}if(I.test(t)){
o.event.fixHooks[t]=o.event.keyHooks}if(q.test(t)){o.event.fixHooks[t]=o.event.mouseHooks}});(function(){var e=/((?:\((?:\([^()]+\)|[^()]+)+\)|\[(?:\[[^\[\]]*\]|['"][^'"]*['"]|[^\[\]'"]+)+\]|\\.|[^ >+~,(\[\\]+)+|[>+~])(\s*,\s*)?((?:.|\r|\n)*)/g,n="sizcache"+(Math.random()+"").replace(".",""),s=0,r=Object.prototype.toString,a=false,d=true,l=/\\/g,c=/\r\n/g,u=/\W/;[0,0].sort(function(){d=false;return 0});var h=function(t,n,s,o){s=s||[];n=n||i;var a=n;if(n.nodeType!==1&&n.nodeType!==9){return[]}if(!t||typeof t!=="string"){return s}var d,l,c,u,f,m,v,w,b=true,y=h.isXML(n),C=[],x=t;do{e.exec("");d=e.exec(x);if(d){x=d[3];C.push(d[1]);if(d[2]){u=d[3];break}}}while(d);if(C.length>1&&g.exec(t)){if(C.length===2&&p.relative[C[0]]){l=k(C[0]+C[1],n,o)}else{l=p.relative[C[0]]?[n]:h(C.shift(),n);while(C.length){t=C.shift();if(p.relative[t]){t+=C.shift()}l=k(t,l,o)}}}else{if(!o&&C.length>1&&n.nodeType===9&&!y&&p.match.ID.test(C[0])&&!p.match.ID.test(C[C.length-1])){f=h.find(C.shift(),n,y);n=f.expr?h.filter(f.expr,f.set)[0]:f.set[0];
}if(n){f=o?{expr:C.pop(),set:_(o)}:h.find(C.pop(),C.length===1&&(C[0]==="~"||C[0]==="+")&&n.parentNode?n.parentNode:n,y);l=f.expr?h.filter(f.expr,f.set):f.set;if(C.length>0){c=_(l)}else{b=false}while(C.length){m=C.pop();v=m;if(!p.relative[m]){m=""}else{v=C.pop()}if(v==null){v=n}p.relative[m](c,v,y)}}else{c=C=[]}}if(!c){c=l}if(!c){h.error(m||t)}if(r.call(c)==="[object Array]"){if(!b){s.push.apply(s,c)}else if(n&&n.nodeType===1){for(w=0;c[w]!=null;w++){if(c[w]&&(c[w]===true||c[w].nodeType===1&&h.contains(n,c[w]))){s.push(l[w])}}}else{for(w=0;c[w]!=null;w++){if(c[w]&&c[w].nodeType===1){s.push(l[w])}}}}else{_(c,s)}if(u){h(u,a,s,o);h.uniqueSort(s)}return s};h.uniqueSort=function(e){if(b){a=d;e.sort(b);if(a){for(var t=1;t<e.length;t++){if(e[t]===e[t-1]){e.splice(t--,1)}}}}return e};h.matches=function(e,t){return h(e,null,null,t)};h.matchesSelector=function(e,t){return h(t,null,null,[e]).length>0};h.find=function(e,t,i){var n,s,o,r,a,d;if(!e){return[]}for(s=0,o=p.order.length;s<o;s++){a=p.order[s];
if(r=p.leftMatch[a].exec(e)){d=r[1];r.splice(1,1);if(d.substr(d.length-1)!=="\\"){r[1]=(r[1]||"").replace(l,"");n=p.find[a](r,t,i);if(n!=null){e=e.replace(p.match[a],"");break}}}}if(!n){n=typeof t.getElementsByTagName!=="undefined"?t.getElementsByTagName("*"):[]}return{set:n,expr:e}};h.filter=function(e,i,n,s){var o,r,a,d,l,c,u,f,g,m=e,v=[],_=i,w=i&&i[0]&&h.isXML(i[0]);while(e&&i.length){for(a in p.filter){if((o=p.leftMatch[a].exec(e))!=null&&o[2]){c=p.filter[a];u=o[1];r=false;o.splice(1,1);if(u.substr(u.length-1)==="\\"){continue}if(_===v){v=[]}if(p.preFilter[a]){o=p.preFilter[a](o,_,n,v,s,w);if(!o){r=d=true}else if(o===true){continue}}if(o){for(f=0;(l=_[f])!=null;f++){if(l){d=c(l,o,f,_);g=s^d;if(n&&d!=null){if(g){r=true}else{_[f]=false}}else if(g){v.push(l);r=true}}}}if(d!==t){if(!n){_=v}e=e.replace(p.match[a],"");if(!r){return[]}break}}}if(e===m){if(r==null){h.error(e)}else{break}}m=e}return _};h.error=function(e){throw"Syntax error, unrecognized expression: "+e};var f=h.getText=function(e){
var t,i,n=e.nodeType,s="";if(n){if(n===1){if(typeof e.textContent==="string"){return e.textContent}else if(typeof e.innerText==="string"){return e.innerText.replace(c,"")}else{for(e=e.firstChild;e;e=e.nextSibling){s+=f(e)}}}else if(n===3||n===4){return e.nodeValue}}else{for(t=0;i=e[t];t++){if(i.nodeType!==8){s+=f(i)}}}return s};var p=h.selectors={order:["ID","NAME","TAG"],match:{ID:/#((?:[\w\u00c0-\uFFFF\-]|\\.)+)/,CLASS:/\.((?:[\w\u00c0-\uFFFF\-]|\\.)+)/,NAME:/\[name=['"]*((?:[\w\u00c0-\uFFFF\-]|\\.)+)['"]*\]/,ATTR:/\[\s*((?:[\w\u00c0-\uFFFF\-]|\\.)+)\s*(?:(\S?=)\s*(?:(['"])(.*?)\3|(#?(?:[\w\u00c0-\uFFFF\-]|\\.)*)|)|)\s*\]/,TAG:/^((?:[\w\u00c0-\uFFFF\*\-]|\\.)+)/,CHILD:/:(only|nth|last|first)-child(?:\(\s*(even|odd|(?:[+\-]?\d+|(?:[+\-]?\d*)?n\s*(?:[+\-]\s*\d+)?))\s*\))?/,POS:/:(nth|eq|gt|lt|first|last|even|odd)(?:\((\d*)\))?(?=[^\-]|$)/,PSEUDO:/:((?:[\w\u00c0-\uFFFF\-]|\\.)+)(?:\((['"]?)((?:\([^\)]+\)|[^\(\)]*)+)\2\))?/},leftMatch:{},attrMap:{"class":"className","for":"htmlFor"},attrHandle:{
href:function(e){return e.getAttribute("href")},type:function(e){return e.getAttribute("type")}},relative:{"+":function(e,t){var i=typeof t==="string",n=i&&!u.test(t),s=i&&!n;if(n){t=t.toLowerCase()}for(var o=0,r=e.length,a;o<r;o++){if(a=e[o]){while((a=a.previousSibling)&&a.nodeType!==1){}e[o]=s||a&&a.nodeName.toLowerCase()===t?a||false:a===t}}if(s){h.filter(t,e,true)}},">":function(e,t){var i,n=typeof t==="string",s=0,o=e.length;if(n&&!u.test(t)){t=t.toLowerCase();for(;s<o;s++){i=e[s];if(i){var r=i.parentNode;e[s]=r.nodeName.toLowerCase()===t?r:false}}}else{for(;s<o;s++){i=e[s];if(i){e[s]=n?i.parentNode:i.parentNode===t}}if(n){h.filter(t,e,true)}}},"":function(e,t,i){var n,o=s++,r=x;if(typeof t==="string"&&!u.test(t)){t=t.toLowerCase();n=t;r=C}r("parentNode",t,o,e,n,i)},"~":function(e,t,i){var n,o=s++,r=x;if(typeof t==="string"&&!u.test(t)){t=t.toLowerCase();n=t;r=C}r("previousSibling",t,o,e,n,i)}},find:{ID:function(e,t,i){if(typeof t.getElementById!=="undefined"&&!i){var n=t.getElementById(e[1]);
return n&&n.parentNode?[n]:[]}},NAME:function(e,t){if(typeof t.getElementsByName!=="undefined"){var i=[],n=t.getElementsByName(e[1]);for(var s=0,o=n.length;s<o;s++){if(n[s].getAttribute("name")===e[1]){i.push(n[s])}}return i.length===0?null:i}},TAG:function(e,t){if(typeof t.getElementsByTagName!=="undefined"){return t.getElementsByTagName(e[1])}}},preFilter:{CLASS:function(e,t,i,n,s,o){e=" "+e[1].replace(l,"")+" ";if(o){return e}for(var r=0,a;(a=t[r])!=null;r++){if(a){if(s^(a.className&&(" "+a.className+" ").replace(/[\t\n\r]/g," ").indexOf(e)>=0)){if(!i){n.push(a)}}else if(i){t[r]=false}}}return false},ID:function(e){return e[1].replace(l,"")},TAG:function(e,t){return e[1].replace(l,"").toLowerCase()},CHILD:function(e){if(e[1]==="nth"){if(!e[2]){h.error(e[0])}e[2]=e[2].replace(/^\+|\s*/g,"");var t=/(-?)(\d*)(?:n([+\-]?\d*))?/.exec(e[2]==="even"&&"2n"||e[2]==="odd"&&"2n+1"||!/\D/.test(e[2])&&"0n+"+e[2]||e[2]);e[2]=t[1]+(t[2]||1)-0;e[3]=t[3]-0}else if(e[2]){h.error(e[0])}e[0]=s++;return e;
},ATTR:function(e,t,i,n,s,o){var r=e[1]=e[1].replace(l,"");if(!o&&p.attrMap[r]){e[1]=p.attrMap[r]}e[4]=(e[4]||e[5]||"").replace(l,"");if(e[2]==="~="){e[4]=" "+e[4]+" "}return e},PSEUDO:function(t,i,n,s,o){if(t[1]==="not"){if((e.exec(t[3])||"").length>1||/^\w/.test(t[3])){t[3]=h(t[3],null,null,i)}else{var r=h.filter(t[3],i,n,true^o);if(!n){s.push.apply(s,r)}return false}}else if(p.match.POS.test(t[0])||p.match.CHILD.test(t[0])){return true}return t},POS:function(e){e.unshift(true);return e}},filters:{enabled:function(e){return e.disabled===false&&e.type!=="hidden"},disabled:function(e){return e.disabled===true},checked:function(e){return e.checked===true},selected:function(e){if(e.parentNode){e.parentNode.selectedIndex}return e.selected===true},parent:function(e){return!!e.firstChild},empty:function(e){return!e.firstChild},has:function(e,t,i){return!!h(i[3],e).length},header:function(e){return/h\d/i.test(e.nodeName)},text:function(e){var t=e.getAttribute("type"),i=e.type;return e.nodeName.toLowerCase()==="input"&&"text"===i&&(t===i||t===null);
},radio:function(e){return e.nodeName.toLowerCase()==="input"&&"radio"===e.type},checkbox:function(e){return e.nodeName.toLowerCase()==="input"&&"checkbox"===e.type},file:function(e){return e.nodeName.toLowerCase()==="input"&&"file"===e.type},password:function(e){return e.nodeName.toLowerCase()==="input"&&"password"===e.type},submit:function(e){var t=e.nodeName.toLowerCase();return(t==="input"||t==="button")&&"submit"===e.type},image:function(e){return e.nodeName.toLowerCase()==="input"&&"image"===e.type},reset:function(e){var t=e.nodeName.toLowerCase();return(t==="input"||t==="button")&&"reset"===e.type},button:function(e){var t=e.nodeName.toLowerCase();return t==="input"&&"button"===e.type||t==="button"},input:function(e){return/input|select|textarea|button/i.test(e.nodeName)},focus:function(e){return e===e.ownerDocument.activeElement}},setFilters:{first:function(e,t){return t===0},last:function(e,t,i,n){return t===n.length-1},even:function(e,t){return t%2===0},odd:function(e,t){return t%2===1;
},lt:function(e,t,i){return t<i[3]-0},gt:function(e,t,i){return t>i[3]-0},nth:function(e,t,i){return i[3]-0===t},eq:function(e,t,i){return i[3]-0===t}},filter:{PSEUDO:function(e,t,i,n){var s=t[1],o=p.filters[s];if(o){return o(e,i,t,n)}else if(s==="contains"){return(e.textContent||e.innerText||f([e])||"").indexOf(t[3])>=0}else if(s==="not"){var r=t[3];for(var a=0,d=r.length;a<d;a++){if(r[a]===e){return false}}return true}else{h.error(s)}},CHILD:function(e,t){var i,s,o,r,a,d,l,c=t[1],u=e;switch(c){case"only":case"first":while(u=u.previousSibling){if(u.nodeType===1){return false}}if(c==="first"){return true}u=e;case"last":while(u=u.nextSibling){if(u.nodeType===1){return false}}return true;case"nth":i=t[2];s=t[3];if(i===1&&s===0){return true}o=t[0];r=e.parentNode;if(r&&(r[n]!==o||!e.nodeIndex)){d=0;for(u=r.firstChild;u;u=u.nextSibling){if(u.nodeType===1){u.nodeIndex=++d}}r[n]=o}l=e.nodeIndex-s;if(i===0){return l===0}else{return l%i===0&&l/i>=0}}},ID:function(e,t){return e.nodeType===1&&e.getAttribute("id")===t;
},TAG:function(e,t){return t==="*"&&e.nodeType===1||!!e.nodeName&&e.nodeName.toLowerCase()===t},CLASS:function(e,t){return(" "+(e.className||e.getAttribute("class"))+" ").indexOf(t)>-1},ATTR:function(e,t){var i=t[1],n=h.attr?h.attr(e,i):p.attrHandle[i]?p.attrHandle[i](e):e[i]!=null?e[i]:e.getAttribute(i),s=n+"",o=t[2],r=t[4];return n==null?o==="!=":!o&&h.attr?n!=null:o==="="?s===r:o==="*="?s.indexOf(r)>=0:o==="~="?(" "+s+" ").indexOf(r)>=0:!r?s&&n!==false:o==="!="?s!==r:o==="^="?s.indexOf(r)===0:o==="$="?s.substr(s.length-r.length)===r:o==="|="?s===r||s.substr(0,r.length+1)===r+"-":false},POS:function(e,t,i,n){var s=t[2],o=p.setFilters[s];if(o){return o(e,i,t,n)}}}};var g=p.match.POS,m=function(e,t){return"\\"+(t-0+1)};for(var v in p.match){p.match[v]=new RegExp(p.match[v].source+/(?![^\[]*\])(?![^\(]*\))/.source);p.leftMatch[v]=new RegExp(/(^(?:.|\r|\n)*?)/.source+p.match[v].source.replace(/\\(\d+)/g,m))}var _=function(e,t){e=Array.prototype.slice.call(e,0);if(t){t.push.apply(t,e);return t;
}return e};try{Array.prototype.slice.call(i.documentElement.childNodes,0)[0].nodeType}catch(w){_=function(e,t){var i=0,n=t||[];if(r.call(e)==="[object Array]"){Array.prototype.push.apply(n,e)}else{if(typeof e.length==="number"){for(var s=e.length;i<s;i++){n.push(e[i])}}else{for(;e[i];i++){n.push(e[i])}}}return n}}var b,y;if(i.documentElement.compareDocumentPosition){b=function(e,t){if(e===t){a=true;return 0}if(!e.compareDocumentPosition||!t.compareDocumentPosition){return e.compareDocumentPosition?-1:1}return e.compareDocumentPosition(t)&4?-1:1}}else{b=function(e,t){if(e===t){a=true;return 0}else if(e.sourceIndex&&t.sourceIndex){return e.sourceIndex-t.sourceIndex}var i,n,s=[],o=[],r=e.parentNode,d=t.parentNode,l=r;if(r===d){return y(e,t)}else if(!r){return-1}else if(!d){return 1}while(l){s.unshift(l);l=l.parentNode}l=d;while(l){o.unshift(l);l=l.parentNode}i=s.length;n=o.length;for(var c=0;c<i&&c<n;c++){if(s[c]!==o[c]){return y(s[c],o[c])}}return c===i?y(e,o[c],-1):y(s[c],t,1)};y=function(e,t,i){
if(e===t){return i}var n=e.nextSibling;while(n){if(n===t){return-1}n=n.nextSibling}return 1}}(function(){var e=i.createElement("div"),n="script"+(new Date).getTime(),s=i.documentElement;e.innerHTML="<a name='"+n+"'/>";s.insertBefore(e,s.firstChild);if(i.getElementById(n)){p.find.ID=function(e,i,n){if(typeof i.getElementById!=="undefined"&&!n){var s=i.getElementById(e[1]);return s?s.id===e[1]||typeof s.getAttributeNode!=="undefined"&&s.getAttributeNode("id").nodeValue===e[1]?[s]:t:[]}};p.filter.ID=function(e,t){var i=typeof e.getAttributeNode!=="undefined"&&e.getAttributeNode("id");return e.nodeType===1&&i&&i.nodeValue===t}}s.removeChild(e);s=e=null})();(function(){var e=i.createElement("div");e.appendChild(i.createComment(""));if(e.getElementsByTagName("*").length>0){p.find.TAG=function(e,t){var i=t.getElementsByTagName(e[1]);if(e[1]==="*"){var n=[];for(var s=0;i[s];s++){if(i[s].nodeType===1){n.push(i[s])}}i=n}return i}}e.innerHTML="<a href='#'></a>";if(e.firstChild&&typeof e.firstChild.getAttribute!=="undefined"&&e.firstChild.getAttribute("href")!=="#"){
p.attrHandle.href=function(e){return e.getAttribute("href",2)}}e=null})();if(i.querySelectorAll){(function(){var e=h,t=i.createElement("div"),n="__sizzle__";t.innerHTML="<p class='TEST'></p>";if(t.querySelectorAll&&t.querySelectorAll(".TEST").length===0){return}h=function(t,s,o,r){s=s||i;if(!r&&!h.isXML(s)){var a=/^(\w+$)|^\.([\w\-]+$)|^#([\w\-]+$)/.exec(t);if(a&&(s.nodeType===1||s.nodeType===9)){if(a[1]){return _(s.getElementsByTagName(t),o)}else if(a[2]&&p.find.CLASS&&s.getElementsByClassName){return _(s.getElementsByClassName(a[2]),o)}}if(s.nodeType===9){if(t==="body"&&s.body){return _([s.body],o)}else if(a&&a[3]){var d=s.getElementById(a[3]);if(d&&d.parentNode){if(d.id===a[3]){return _([d],o)}}else{return _([],o)}}try{return _(s.querySelectorAll(t),o)}catch(l){}}else if(s.nodeType===1&&s.nodeName.toLowerCase()!=="object"){var c=s,u=s.getAttribute("id"),f=u||n,g=s.parentNode,m=/^\s*[+~]/.test(t);if(!u){s.setAttribute("id",f)}else{f=f.replace(/'/g,"\\$&")}if(m&&g){s=s.parentNode}try{if(!m||g){
return _(s.querySelectorAll("[id='"+f+"'] "+t),o)}}catch(v){}finally{if(!u){c.removeAttribute("id")}}}}return e(t,s,o,r)};for(var s in e){h[s]=e[s]}t=null})()}(function(){var e=i.documentElement,t=e.matchesSelector||e.mozMatchesSelector||e.webkitMatchesSelector||e.msMatchesSelector;if(t){var n=!t.call(i.createElement("div"),"div"),s=false;try{t.call(i.documentElement,"[test!='']:sizzle")}catch(o){s=true}h.matchesSelector=function(e,i){i=i.replace(/\=\s*([^'"\]]*)\s*\]/g,"='$1']");if(!h.isXML(e)){try{if(s||!p.match.PSEUDO.test(i)&&!/!=/.test(i)){var o=t.call(e,i);if(o||!n||e.document&&e.document.nodeType!==11){return o}}}catch(r){}}return h(i,null,null,[e]).length>0}}})();(function(){var e=i.createElement("div");e.innerHTML="<div class='test e'></div><div class='test'></div>";if(!e.getElementsByClassName||e.getElementsByClassName("e").length===0){return}e.lastChild.className="e";if(e.getElementsByClassName("e").length===1){return}p.order.splice(1,0,"CLASS");p.find.CLASS=function(e,t,i){if(typeof t.getElementsByClassName!=="undefined"&&!i){
return t.getElementsByClassName(e[1])}};e=null})();function C(e,t,i,s,o,r){for(var a=0,d=s.length;a<d;a++){var l=s[a];if(l){var c=false;l=l[e];while(l){if(l[n]===i){c=s[l.sizset];break}if(l.nodeType===1&&!r){l[n]=i;l.sizset=a}if(l.nodeName.toLowerCase()===t){c=l;break}l=l[e]}s[a]=c}}}function x(e,t,i,s,o,r){for(var a=0,d=s.length;a<d;a++){var l=s[a];if(l){var c=false;l=l[e];while(l){if(l[n]===i){c=s[l.sizset];break}if(l.nodeType===1){if(!r){l[n]=i;l.sizset=a}if(typeof t!=="string"){if(l===t){c=true;break}}else if(h.filter(t,[l]).length>0){c=l;break}}l=l[e]}s[a]=c}}}if(i.documentElement.contains){h.contains=function(e,t){return e!==t&&(e.contains?e.contains(t):true)}}else if(i.documentElement.compareDocumentPosition){h.contains=function(e,t){return!!(e.compareDocumentPosition(t)&16)}}else{h.contains=function(){return false}}h.isXML=function(e){var t=(e?e.ownerDocument||e:0).documentElement;return t?t.nodeName!=="HTML":false};var k=function(e,t,i){var n,s=[],o="",r=t.nodeType?[t]:t;while(n=p.match.PSEUDO.exec(e)){
o+=n[0];e=e.replace(p.match.PSEUDO,"")}e=p.relative[e]?e+"*":e;for(var a=0,d=r.length;a<d;a++){h(e,r[a],s,i)}return h.filter(o,s)};h.attr=o.attr;h.selectors.attrMap={};o.find=h;o.expr=h.selectors;o.expr[":"]=o.expr.filters;o.unique=h.uniqueSort;o.text=h.getText;o.isXMLDoc=h.isXML;o.contains=h.contains})();var U=/Until$/,j=/^(?:parents|prevUntil|prevAll)/,H=/,/,Q=/^.[^:#\[\.,]*$/,W=Array.prototype.slice,V=o.expr.match.POS,z={children:true,contents:true,next:true,prev:true};o.fn.extend({find:function(e){var t=this,i,n;if(typeof e!=="string"){return o(e).filter(function(){for(i=0,n=t.length;i<n;i++){if(o.contains(t[i],this)){return true}}})}var s=this.pushStack("","find",e),r,a,d;for(i=0,n=this.length;i<n;i++){r=s.length;o.find(e,this[i],s);if(i>0){for(a=r;a<s.length;a++){for(d=0;d<r;d++){if(s[d]===s[a]){s.splice(a--,1);break}}}}}return s},has:function(e){var t=o(e);return this.filter(function(){for(var e=0,i=t.length;e<i;e++){if(o.contains(this,t[e])){return true}}})},not:function(e){return this.pushStack(K(this,e,false),"not",e);
},filter:function(e){return this.pushStack(K(this,e,true),"filter",e)},is:function(e){return!!e&&(typeof e==="string"?V.test(e)?o(e,this.context).index(this[0])>=0:o.filter(e,this).length>0:this.filter(e).length>0)},closest:function(e,t){var i=[],n,s,r=this[0];if(o.isArray(e)){var a=1;while(r&&r.ownerDocument&&r!==t){for(n=0;n<e.length;n++){if(o(r).is(e[n])){i.push({selector:e[n],elem:r,level:a})}}r=r.parentNode;a++}return i}var d=V.test(e)||typeof e!=="string"?o(e,t||this.context):0;for(n=0,s=this.length;n<s;n++){r=this[n];while(r){if(d?d.index(r)>-1:o.find.matchesSelector(r,e)){i.push(r);break}else{r=r.parentNode;if(!r||!r.ownerDocument||r===t||r.nodeType===11){break}}}}i=i.length>1?o.unique(i):i;return this.pushStack(i,"closest",e)},index:function(e){if(!e){return this[0]&&this[0].parentNode?this.prevAll().length:-1}if(typeof e==="string"){return o.inArray(this[0],o(e))}return o.inArray(e.jquery?e[0]:e,this)},add:function(e,t){var i=typeof e==="string"?o(e,t):o.makeArray(e&&e.nodeType?[e]:e),n=o.merge(this.get(),i);
return this.pushStack(G(i[0])||G(n[0])?n:o.unique(n))},andSelf:function(){return this.add(this.prevObject)}});function G(e){return!e||!e.parentNode||e.parentNode.nodeType===11}o.each({parent:function(e){var t=e.parentNode;return t&&t.nodeType!==11?t:null},parents:function(e){return o.dir(e,"parentNode")},parentsUntil:function(e,t,i){return o.dir(e,"parentNode",i)},next:function(e){return o.nth(e,2,"nextSibling")},prev:function(e){return o.nth(e,2,"previousSibling")},nextAll:function(e){return o.dir(e,"nextSibling")},prevAll:function(e){return o.dir(e,"previousSibling")},nextUntil:function(e,t,i){return o.dir(e,"nextSibling",i)},prevUntil:function(e,t,i){return o.dir(e,"previousSibling",i)},siblings:function(e){return o.sibling(e.parentNode.firstChild,e)},children:function(e){return o.sibling(e.firstChild)},contents:function(e){return o.nodeName(e,"iframe")?e.contentDocument||e.contentWindow.document:o.makeArray(e.childNodes)}},function(e,t){o.fn[e]=function(i,n){var s=o.map(this,t,i),r=W.call(arguments);
if(!U.test(e)){n=i}if(n&&typeof n==="string"){s=o.filter(n,s)}s=this.length>1&&!z[e]?o.unique(s):s;if((this.length>1||H.test(n))&&j.test(e)){s=s.reverse()}return this.pushStack(s,e,r.join(","))}});o.extend({filter:function(e,t,i){if(i){e=":not("+e+")"}return t.length===1?o.find.matchesSelector(t[0],e)?[t[0]]:[]:o.find.matches(e,t)},dir:function(e,i,n){var s=[],r=e[i];while(r&&r.nodeType!==9&&(n===t||r.nodeType!==1||!o(r).is(n))){if(r.nodeType===1){s.push(r)}r=r[i]}return s},nth:function(e,t,i,n){t=t||1;var s=0;for(;e;e=e[i]){if(e.nodeType===1&&++s===t){break}}return e},sibling:function(e,t){var i=[];for(;e;e=e.nextSibling){if(e.nodeType===1&&e!==t){i.push(e)}}return i}});function K(e,t,i){t=t||0;if(o.isFunction(t)){return o.grep(e,function(e,n){var s=!!t.call(e,n,e);return s===i})}else if(t.nodeType){return o.grep(e,function(e,n){return e===t===i})}else if(typeof t==="string"){var n=o.grep(e,function(e){return e.nodeType===1});if(Q.test(t)){return o.filter(t,n,!i)}else{t=o.filter(t,n)}}
return o.grep(e,function(e,n){return o.inArray(e,t)>=0===i})}function J(e){var t=X.split(" "),i=e.createDocumentFragment();if(i.createElement){while(t.length){i.createElement(t.pop())}}return i}var X="abbr article aside audio canvas datalist details figcaption figure footer "+"header hgroup mark meter nav output progress section summary time video",Y=/ jQuery\d+="(?:\d+|null)"/g,Z=/^\s+/,ee=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,te=/<([\w:]+)/,ie=/<tbody/i,ne=/<|&#?\w+;/,se=/<(?:script|style)/i,oe=/<(?:script|object|embed|option|style)/i,re=new RegExp("<(?:"+X.replace(" ","|")+")","i"),ae=/checked\s*(?:[^=]|=\s*.checked.)/i,de=/\/(java|ecma)script/i,le=/^\s*<!(?:\[CDATA\[|\-\-)/,ce={option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],
area:[1,"<map>","</map>"],_default:[0,"",""]},ue=J(i);ce.optgroup=ce.option;ce.tbody=ce.tfoot=ce.colgroup=ce.caption=ce.thead;ce.th=ce.td;if(!o.support.htmlSerialize){ce._default=[1,"div<div>","</div>"]}o.fn.extend({text:function(e){if(o.isFunction(e)){return this.each(function(t){var i=o(this);i.text(e.call(this,t,i.text()))})}if(typeof e!=="object"&&e!==t){return this.empty().append((this[0]&&this[0].ownerDocument||i).createTextNode(e))}return o.text(this)},wrapAll:function(e){if(o.isFunction(e)){return this.each(function(t){o(this).wrapAll(e.call(this,t))})}if(this[0]){var t=o(e,this[0].ownerDocument).eq(0).clone(true);if(this[0].parentNode){t.insertBefore(this[0])}t.map(function(){var e=this;while(e.firstChild&&e.firstChild.nodeType===1){e=e.firstChild}return e}).append(this)}return this},wrapInner:function(e){if(o.isFunction(e)){return this.each(function(t){o(this).wrapInner(e.call(this,t))})}return this.each(function(){var t=o(this),i=t.contents();if(i.length){i.wrapAll(e)}else{t.append(e);
}})},wrap:function(e){return this.each(function(){o(this).wrapAll(e)})},unwrap:function(){return this.parent().each(function(){if(!o.nodeName(this,"body")){o(this).replaceWith(this.childNodes)}}).end()},append:function(){return this.domManip(arguments,true,function(e){if(this.nodeType===1){this.appendChild(e)}})},prepend:function(){return this.domManip(arguments,true,function(e){if(this.nodeType===1){this.insertBefore(e,this.firstChild)}})},before:function(){if(this[0]&&this[0].parentNode){return this.domManip(arguments,false,function(e){this.parentNode.insertBefore(e,this)})}else if(arguments.length){var e=o(arguments[0]);e.push.apply(e,this.toArray());return this.pushStack(e,"before",arguments)}},after:function(){if(this[0]&&this[0].parentNode){return this.domManip(arguments,false,function(e){this.parentNode.insertBefore(e,this.nextSibling)})}else if(arguments.length){var e=this.pushStack(this,"after",arguments);e.push.apply(e,o(arguments[0]).toArray());return e}},remove:function(e,t){
for(var i=0,n;(n=this[i])!=null;i++){if(!e||o.filter(e,[n]).length){if(!t&&n.nodeType===1){o.cleanData(n.getElementsByTagName("*"));o.cleanData([n])}if(n.parentNode){n.parentNode.removeChild(n)}}}return this},empty:function(){for(var e=0,t;(t=this[e])!=null;e++){if(t.nodeType===1){o.cleanData(t.getElementsByTagName("*"))}while(t.firstChild){t.removeChild(t.firstChild)}}return this},clone:function(e,t){e=e==null?false:e;t=t==null?e:t;return this.map(function(){return o.clone(this,e,t)})},html:function(e){if(e===t){return this[0]&&this[0].nodeType===1?this[0].innerHTML.replace(Y,""):null}else if(typeof e==="string"&&!se.test(e)&&(o.support.leadingWhitespace||!Z.test(e))&&!ce[(te.exec(e)||["",""])[1].toLowerCase()]){e=e.replace(ee,"<$1></$2>");try{for(var i=0,n=this.length;i<n;i++){if(this[i].nodeType===1){o.cleanData(this[i].getElementsByTagName("*"));this[i].innerHTML=e}}}catch(s){this.empty().append(e)}}else if(o.isFunction(e)){this.each(function(t){var i=o(this);i.html(e.call(this,t,i.html()));
})}else{this.empty().append(e)}return this},replaceWith:function(e){if(this[0]&&this[0].parentNode){if(o.isFunction(e)){return this.each(function(t){var i=o(this),n=i.html();i.replaceWith(e.call(this,t,n))})}if(typeof e!=="string"){e=o(e).detach()}return this.each(function(){var t=this.nextSibling,i=this.parentNode;o(this).remove();if(t){o(t).before(e)}else{o(i).append(e)}})}else{return this.length?this.pushStack(o(o.isFunction(e)?e():e),"replaceWith",e):this}},detach:function(e){return this.remove(e,true)},domManip:function(e,i,n){var s,r,a,d,l=e[0],c=[];if(!o.support.checkClone&&arguments.length===3&&typeof l==="string"&&ae.test(l)){return this.each(function(){o(this).domManip(e,i,n,true)})}if(o.isFunction(l)){return this.each(function(s){var r=o(this);e[0]=l.call(this,s,i?r.html():t);r.domManip(e,i,n)})}if(this[0]){d=l&&l.parentNode;if(o.support.parentNode&&d&&d.nodeType===11&&d.childNodes.length===this.length){s={fragment:d}}else{s=o.buildFragment(e,this,c)}a=s.fragment;if(a.childNodes.length===1){
r=a=a.firstChild}else{r=a.firstChild}if(r){i=i&&o.nodeName(r,"tr");for(var u=0,h=this.length,f=h-1;u<h;u++){n.call(i?he(this[u],r):this[u],s.cacheable||h>1&&u<f?o.clone(a,true,true):a)}}if(c.length){o.each(c,_e)}}return this}});function he(e,t){return o.nodeName(e,"table")?e.getElementsByTagName("tbody")[0]||e.appendChild(e.ownerDocument.createElement("tbody")):e}function fe(e,t){if(t.nodeType!==1||!o.hasData(e)){return}var i,n,s,r=o._data(e),a=o._data(t,r),d=r.events;if(d){delete a.handle;a.events={};for(i in d){for(n=0,s=d[i].length;n<s;n++){o.event.add(t,i+(d[i][n].namespace?".":"")+d[i][n].namespace,d[i][n],d[i][n].data)}}}if(a.data){a.data=o.extend({},a.data)}}function pe(e,t){var i;if(t.nodeType!==1){return}if(t.clearAttributes){t.clearAttributes()}if(t.mergeAttributes){t.mergeAttributes(e)}i=t.nodeName.toLowerCase();if(i==="object"){t.outerHTML=e.outerHTML}else if(i==="input"&&(e.type==="checkbox"||e.type==="radio")){if(e.checked){t.defaultChecked=t.checked=e.checked}if(t.value!==e.value){
t.value=e.value}}else if(i==="option"){t.selected=e.defaultSelected}else if(i==="input"||i==="textarea"){t.defaultValue=e.defaultValue}t.removeAttribute(o.expando)}o.buildFragment=function(e,t,n){var s,r,a,d,l=e[0];if(t&&t[0]){d=t[0].ownerDocument||t[0]}if(!d.createDocumentFragment){d=i}if(e.length===1&&typeof l==="string"&&l.length<512&&d===i&&l.charAt(0)==="<"&&!oe.test(l)&&(o.support.checkClone||!ae.test(l))&&(!o.support.unknownElems&&re.test(l))){r=true;a=o.fragments[l];if(a&&a!==1){s=a}}if(!s){s=d.createDocumentFragment();o.clean(e,d,s,n)}if(r){o.fragments[l]=a?s:1}return{fragment:s,cacheable:r}};o.fragments={};o.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(e,t){o.fn[e]=function(i){var n=[],s=o(i),r=this.length===1&&this[0].parentNode;if(r&&r.nodeType===11&&r.childNodes.length===1&&s.length===1){s[t](this[0]);return this}else{for(var a=0,d=s.length;a<d;a++){var l=(a>0?this.clone(true):this).get();o(s[a])[t](l);
n=n.concat(l)}return this.pushStack(n,e,s.selector)}}});function ge(e){if(typeof e.getElementsByTagName!=="undefined"){return e.getElementsByTagName("*")}else if(typeof e.querySelectorAll!=="undefined"){return e.querySelectorAll("*")}else{return[]}}function me(e){if(e.type==="checkbox"||e.type==="radio"){e.defaultChecked=e.checked}}function ve(e){var t=(e.nodeName||"").toLowerCase();if(t==="input"){me(e)}else if(t!=="script"&&typeof e.getElementsByTagName!=="undefined"){o.grep(e.getElementsByTagName("input"),me)}}o.extend({clone:function(e,t,i){var n=e.cloneNode(true),s,r,a;if((!o.support.noCloneEvent||!o.support.noCloneChecked)&&(e.nodeType===1||e.nodeType===11)&&!o.isXMLDoc(e)){pe(e,n);s=ge(e);r=ge(n);for(a=0;s[a];++a){if(r[a]){pe(s[a],r[a])}}}if(t){fe(e,n);if(i){s=ge(e);r=ge(n);for(a=0;s[a];++a){fe(s[a],r[a])}}}s=r=null;return n},clean:function(e,t,n,s){var r;t=t||i;if(typeof t.createElement==="undefined"){t=t.ownerDocument||t[0]&&t[0].ownerDocument||i}var a=[],d;for(var l=0,c;(c=e[l])!=null;l++){
if(typeof c==="number"){c+=""}if(!c){continue}if(typeof c==="string"){if(!ne.test(c)){c=t.createTextNode(c)}else{c=c.replace(ee,"<$1></$2>");var u=(te.exec(c)||["",""])[1].toLowerCase(),h=ce[u]||ce._default,f=h[0],p=t.createElement("div");if(t===i){ue.appendChild(p)}else{J(t).appendChild(p)}p.innerHTML=h[1]+c+h[2];while(f--){p=p.lastChild}if(!o.support.tbody){var g=ie.test(c),m=u==="table"&&!g?p.firstChild&&p.firstChild.childNodes:h[1]==="<table>"&&!g?p.childNodes:[];for(d=m.length-1;d>=0;--d){if(o.nodeName(m[d],"tbody")&&!m[d].childNodes.length){m[d].parentNode.removeChild(m[d])}}}if(!o.support.leadingWhitespace&&Z.test(c)){p.insertBefore(t.createTextNode(Z.exec(c)[0]),p.firstChild)}c=p.childNodes}}var v;if(!o.support.appendChecked){if(c[0]&&typeof(v=c.length)==="number"){for(d=0;d<v;d++){ve(c[d])}}else{ve(c)}}if(c.nodeType){a.push(c)}else{a=o.merge(a,c)}}if(n){r=function(e){return!e.type||de.test(e.type)};for(l=0;a[l];l++){if(s&&o.nodeName(a[l],"script")&&(!a[l].type||a[l].type.toLowerCase()==="text/javascript")){
s.push(a[l].parentNode?a[l].parentNode.removeChild(a[l]):a[l])}else{if(a[l].nodeType===1){var _=o.grep(a[l].getElementsByTagName("script"),r);a.splice.apply(a,[l+1,0].concat(_))}n.appendChild(a[l])}}}return a},cleanData:function(e){var t,i,n=o.cache,s=o.event.special,r=o.support.deleteExpando;for(var a=0,d;(d=e[a])!=null;a++){if(d.nodeName&&o.noData[d.nodeName.toLowerCase()]){continue}i=d[o.expando];if(i){t=n[i];if(t&&t.events){for(var l in t.events){if(s[l]){o.event.remove(d,l)}else{o.removeEvent(d,l,t.handle)}}if(t.handle){t.handle.elem=null}}if(r){delete d[o.expando]}else if(d.removeAttribute){d.removeAttribute(o.expando)}delete n[i]}}}});function _e(e,t){if(t.src){o.ajax({url:t.src,async:false,dataType:"script"})}else{o.globalEval((t.text||t.textContent||t.innerHTML||"").replace(le,"/*$0*/"))}if(t.parentNode){t.parentNode.removeChild(t)}}var we=/alpha\([^)]*\)/i,be=/opacity=([^)]*)/,ye=/([A-Z]|^ms)/g,Ce=/^-?\d+(?:px)?$/i,xe=/^-?\d/,ke=/^([\-+])=([\-+.\de]+)/,Se={position:"absolute",
visibility:"hidden",display:"block"},Ee=["Left","Right"],Te=["Top","Bottom"],$e,Le,Me;o.fn.css=function(e,i){if(arguments.length===2&&i===t){return this}return o.access(this,e,i,true,function(e,i,n){return n!==t?o.style(e,i,n):o.css(e,i)})};o.extend({cssHooks:{opacity:{get:function(e,t){if(t){var i=$e(e,"opacity","opacity");return i===""?"1":i}else{return e.style.opacity}}}},cssNumber:{fillOpacity:true,fontWeight:true,lineHeight:true,opacity:true,orphans:true,widows:true,zIndex:true,zoom:true},cssProps:{"float":o.support.cssFloat?"cssFloat":"styleFloat"},style:function(e,i,n,s){if(!e||e.nodeType===3||e.nodeType===8||!e.style){return}var r,a,d=o.camelCase(i),l=e.style,c=o.cssHooks[d];i=o.cssProps[d]||d;if(n!==t){a=typeof n;if(a==="string"&&(r=ke.exec(n))){n=+(r[1]+1)*+r[2]+parseFloat(o.css(e,i));a="number"}if(n==null||a==="number"&&isNaN(n)){return}if(a==="number"&&!o.cssNumber[d]){n+="px"}if(!c||!("set"in c)||(n=c.set(e,n))!==t){try{l[i]=n}catch(u){}}}else{if(c&&"get"in c&&(r=c.get(e,false,s))!==t){
return r}return l[i]}},css:function(e,i,n){var s,r;i=o.camelCase(i);r=o.cssHooks[i];i=o.cssProps[i]||i;if(i==="cssFloat"){i="float"}if(r&&"get"in r&&(s=r.get(e,true,n))!==t){return s}else if($e){return $e(e,i)}},swap:function(e,t,i){var n={};for(var s in t){n[s]=e.style[s];e.style[s]=t[s]}i.call(e);for(s in t){e.style[s]=n[s]}}});o.curCSS=o.css;o.each(["height","width"],function(e,t){o.cssHooks[t]={get:function(e,i,n){var s;if(i){if(e.offsetWidth!==0){return De(e,t,n)}else{o.swap(e,Se,function(){s=De(e,t,n)})}return s}},set:function(e,t){if(Ce.test(t)){t=parseFloat(t);if(t>=0){return t+"px"}}else{return t}}}});if(!o.support.opacity){o.cssHooks.opacity={get:function(e,t){return be.test((t&&e.currentStyle?e.currentStyle.filter:e.style.filter)||"")?parseFloat(RegExp.$1)/100+"":t?"1":""},set:function(e,t){var i=e.style,n=e.currentStyle,s=o.isNumeric(t)?"alpha(opacity="+t*100+")":"",r=n&&n.filter||i.filter||"";i.zoom=1;if(t>=1&&o.trim(r.replace(we,""))===""){i.removeAttribute("filter");if(n&&!n.filter){
return}}i.filter=we.test(r)?r.replace(we,s):r+" "+s}}}o(function(){if(!o.support.reliableMarginRight){o.cssHooks.marginRight={get:function(e,t){var i;o.swap(e,{display:"inline-block"},function(){if(t){i=$e(e,"margin-right","marginRight")}else{i=e.style.marginRight}});return i}}}});if(i.defaultView&&i.defaultView.getComputedStyle){Le=function(e,i){var n,s,r;i=i.replace(ye,"-$1").toLowerCase();if(!(s=e.ownerDocument.defaultView)){return t}if(r=s.getComputedStyle(e,null)){n=r.getPropertyValue(i);if(n===""&&!o.contains(e.ownerDocument.documentElement,e)){n=o.style(e,i)}}return n}}if(i.documentElement.currentStyle){Me=function(e,t){var i,n,s,o=e.currentStyle&&e.currentStyle[t],r=e.style;if(o===null&&r&&(s=r[t])){o=s}if(!Ce.test(o)&&xe.test(o)){i=r.left;n=e.runtimeStyle&&e.runtimeStyle.left;if(n){e.runtimeStyle.left=e.currentStyle.left}r.left=t==="fontSize"?"1em":o||0;o=r.pixelLeft+"px";r.left=i;if(n){e.runtimeStyle.left=n}}return o===""?"auto":o}}$e=Le||Me;function De(e,t,i){var n=t==="width"?e.offsetWidth:e.offsetHeight,s=t==="width"?Ee:Te;
if(n>0){if(i!=="border"){o.each(s,function(){if(!i){n-=parseFloat(o.css(e,"padding"+this))||0}if(i==="margin"){n+=parseFloat(o.css(e,i+this))||0}else{n-=parseFloat(o.css(e,"border"+this+"Width"))||0}})}return n+"px"}n=$e(e,t,t);if(n<0||n==null){n=e.style[t]||0}n=parseFloat(n)||0;if(i){o.each(s,function(){n+=parseFloat(o.css(e,"padding"+this))||0;if(i!=="padding"){n+=parseFloat(o.css(e,"border"+this+"Width"))||0}if(i==="margin"){n+=parseFloat(o.css(e,i+this))||0}})}return n+"px"}if(o.expr&&o.expr.filters){o.expr.filters.hidden=function(e){var t=e.offsetWidth,i=e.offsetHeight;return t===0&&i===0||!o.support.reliableHiddenOffsets&&(e.style&&e.style.display||o.css(e,"display"))==="none"};o.expr.filters.visible=function(e){return!o.expr.filters.hidden(e)}}var Ae=/%20/g,Ie=/\[\]$/,qe=/\r?\n/g,Ne=/#.*$/,Oe=/^(.*?):[ \t]*([^\r\n]*)\r?$/gm,Re=/^(?:color|date|datetime|datetime-local|email|hidden|month|number|password|range|search|tel|text|time|url|week)$/i,Pe=/^(?:about|app|app\-storage|.+\-extension|file|res|widget):$/,Be=/^(?:GET|HEAD)$/,Fe=/^\/\//,Ue=/\?/,je=/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,He=/^(?:select|textarea)/i,Qe=/\s+/,We=/([?&])_=[^&]*/,Ve=/^([\w\+\.\-]+:)(?:\/\/([^\/?#:]*)(?::(\d+))?)?/,ze=o.fn.load,Ge={},Ke={},Je,Xe,Ye=["*/"]+["*"];
try{Je=s.href}catch(Ze){Je=i.createElement("a");Je.href="";Je=Je.href}Xe=Ve.exec(Je.toLowerCase())||[];function et(e){return function(t,i){if(typeof t!=="string"){i=t;t="*"}if(o.isFunction(i)){var n=t.toLowerCase().split(Qe),s=0,r=n.length,a,d,l;for(;s<r;s++){a=n[s];l=/^\+/.test(a);if(l){a=a.substr(1)||"*"}d=e[a]=e[a]||[];d[l?"unshift":"push"](i)}}}}function tt(e,i,n,s,o,r){o=o||i.dataTypes[0];r=r||{};r[o]=true;var a=e[o],d=0,l=a?a.length:0,c=e===Ge,u;for(;d<l&&(c||!u);d++){u=a[d](i,n,s);if(typeof u==="string"){if(!c||r[u]){u=t}else{i.dataTypes.unshift(u);u=tt(e,i,n,s,u,r)}}}if((c||!u)&&!r["*"]){u=tt(e,i,n,s,"*",r)}return u}function it(e,i){var n,s,r=o.ajaxSettings.flatOptions||{};for(n in i){if(i[n]!==t){(r[n]?e:s||(s={}))[n]=i[n]}}if(s){o.extend(true,e,s)}}o.fn.extend({load:function(e,i,n){if(typeof e!=="string"&&ze){return ze.apply(this,arguments)}else if(!this.length){return this}var s=e.indexOf(" ");if(s>=0){var r=e.slice(s,e.length);e=e.slice(0,s)}var a="GET";if(i){if(o.isFunction(i)){
n=i;i=t}else if(typeof i==="object"){i=o.param(i,o.ajaxSettings.traditional);a="POST"}}var d=this;o.ajax({url:e,type:a,dataType:"html",data:i,complete:function(e,t,i){i=e.responseText;if(e.isResolved()){e.done(function(e){i=e});d.html(r?o("<div>").append(i.replace(je,"")).find(r):i)}if(n){d.each(n,[i,t,e])}}});return this},serialize:function(){return o.param(this.serializeArray())},serializeArray:function(){return this.map(function(){return this.elements?o.makeArray(this.elements):this}).filter(function(){return this.name&&!this.disabled&&(this.checked||He.test(this.nodeName)||Re.test(this.type))}).map(function(e,t){var i=o(this).val();return i==null?null:o.isArray(i)?o.map(i,function(e,i){return{name:t.name,value:e.replace(qe,"\r\n")}}):{name:t.name,value:i.replace(qe,"\r\n")}}).get()}});o.each("ajaxStart ajaxStop ajaxComplete ajaxError ajaxSuccess ajaxSend".split(" "),function(e,t){o.fn[t]=function(e){return this.bind(t,e)}});o.each(["get","post"],function(e,i){o[i]=function(e,n,s,r){
if(o.isFunction(n)){r=r||s;s=n;n=t}return o.ajax({type:i,url:e,data:n,success:s,dataType:r})}});o.extend({getScript:function(e,i){return o.get(e,t,i,"script")},getJSON:function(e,t,i){return o.get(e,t,i,"json")},ajaxSetup:function(e,t){if(t){it(e,o.ajaxSettings)}else{t=e;e=o.ajaxSettings}it(e,t);return e},ajaxSettings:{url:Je,isLocal:Pe.test(Xe[1]),global:true,type:"GET",contentType:"application/x-www-form-urlencoded",processData:true,async:true,accepts:{xml:"application/xml, text/xml",html:"text/html",text:"text/plain",json:"application/json, text/javascript","*":Ye},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText"},converters:{"* text":e.String,"text html":true,"text json":o.parseJSON,"text xml":o.parseXML},flatOptions:{context:true,url:true}},ajaxPrefilter:et(Ge),ajaxTransport:et(Ke),ajax:function(e,i){if(typeof e==="object"){i=e;e=t}i=i||{};var n=o.ajaxSetup({},i),s=n.context||n,r=s!==n&&(s.nodeType||s instanceof o)?o(s):o.event,a=o.Deferred(),d=o.Callbacks("once memory"),l=n.statusCode||{},c,u={},h={},f,p,g,m,v,_=0,w,b,y={
readyState:0,setRequestHeader:function(e,t){if(!_){var i=e.toLowerCase();e=h[i]=h[i]||e;u[e]=t}return this},getAllResponseHeaders:function(){return _===2?f:null},getResponseHeader:function(e){var i;if(_===2){if(!p){p={};while(i=Oe.exec(f)){p[i[1].toLowerCase()]=i[2]}}i=p[e.toLowerCase()]}return i===t?null:i},overrideMimeType:function(e){if(!_){n.mimeType=e}return this},abort:function(e){e=e||"abort";if(g){g.abort(e)}C(0,e);return this}};function C(e,i,u,h){if(_===2){return}_=2;if(m){clearTimeout(m)}g=t;f=h||"";y.readyState=e>0?4:0;var p,v,b,C=i,x=u?st(n,y,u):t,k,S;if(e>=200&&e<300||e===304){if(n.ifModified){if(k=y.getResponseHeader("Last-Modified")){o.lastModified[c]=k}if(S=y.getResponseHeader("Etag")){o.etag[c]=S}}if(e===304){C="notmodified";p=true}else{try{v=ot(n,x);C="success";p=true}catch(E){C="parsererror";b=E}}}else{b=C;if(!C||e){C="error";if(e<0){e=0}}}y.status=e;y.statusText=""+(i||C);if(p){a.resolveWith(s,[v,C,y])}else{a.rejectWith(s,[y,C,b])}y.statusCode(l);l=t;if(w){r.trigger("ajax"+(p?"Success":"Error"),[y,n,p?v:b]);
}d.fireWith(s,[y,C]);if(w){r.trigger("ajaxComplete",[y,n]);if(!--o.active){o.event.trigger("ajaxStop")}}}a.promise(y);y.success=y.done;y.error=y.fail;y.complete=d.add;y.statusCode=function(e){if(e){var t;if(_<2){for(t in e){l[t]=[l[t],e[t]]}}else{t=e[y.status];y.then(t,t)}}return this};n.url=((e||n.url)+"").replace(Ne,"").replace(Fe,Xe[1]+"//");n.dataTypes=o.trim(n.dataType||"*").toLowerCase().split(Qe);if(n.crossDomain==null){v=Ve.exec(n.url.toLowerCase());n.crossDomain=!!(v&&(v[1]!=Xe[1]||v[2]!=Xe[2]||(v[3]||(v[1]==="http:"?80:443))!=(Xe[3]||(Xe[1]==="http:"?80:443))))}if(n.data&&n.processData&&typeof n.data!=="string"){n.data=o.param(n.data,n.traditional)}tt(Ge,n,i,y);if(_===2){return false}w=n.global;n.type=n.type.toUpperCase();n.hasContent=!Be.test(n.type);if(w&&o.active++===0){o.event.trigger("ajaxStart")}if(!n.hasContent){if(n.data){n.url+=(Ue.test(n.url)?"&":"?")+n.data;delete n.data}c=n.url;if(n.cache===false){var x=o.now(),k=n.url.replace(We,"$1_="+x);n.url=k+(k===n.url?(Ue.test(n.url)?"&":"?")+"_="+x:"");
}}if(n.data&&n.hasContent&&n.contentType!==false||i.contentType){y.setRequestHeader("Content-Type",n.contentType)}if(n.ifModified){c=c||n.url;if(o.lastModified[c]){y.setRequestHeader("If-Modified-Since",o.lastModified[c])}if(o.etag[c]){y.setRequestHeader("If-None-Match",o.etag[c])}}y.setRequestHeader("Accept",n.dataTypes[0]&&n.accepts[n.dataTypes[0]]?n.accepts[n.dataTypes[0]]+(n.dataTypes[0]!=="*"?", "+Ye+"; q=0.01":""):n.accepts["*"]);for(b in n.headers){y.setRequestHeader(b,n.headers[b])}if(n.beforeSend&&(n.beforeSend.call(s,y,n)===false||_===2)){y.abort();return false}for(b in{success:1,error:1,complete:1}){y[b](n[b])}g=tt(Ke,n,i,y);if(!g){C(-1,"No Transport")}else{y.readyState=1;if(w){r.trigger("ajaxSend",[y,n])}if(n.async&&n.timeout>0){m=setTimeout(function(){y.abort("timeout")},n.timeout)}try{_=1;g.send(u,C)}catch(S){if(_<2){C(-1,S)}else{o.error(S)}}}return y},param:function(e,i){var n=[],s=function(e,t){t=o.isFunction(t)?t():t;n[n.length]=encodeURIComponent(e)+"="+encodeURIComponent(t);
};if(i===t){i=o.ajaxSettings.traditional}if(o.isArray(e)||e.jquery&&!o.isPlainObject(e)){o.each(e,function(){s(this.name,this.value)})}else{for(var r in e){nt(r,e[r],i,s)}}return n.join("&").replace(Ae,"+")}});function nt(e,t,i,n){if(o.isArray(t)){o.each(t,function(t,s){if(i||Ie.test(e)){n(e,s)}else{nt(e+"["+(typeof s==="object"||o.isArray(s)?t:"")+"]",s,i,n)}})}else if(!i&&t!=null&&typeof t==="object"){for(var s in t){nt(e+"["+s+"]",t[s],i,n)}}else{n(e,t)}}o.extend({active:0,lastModified:{},etag:{}});function st(e,i,n){var s=e.contents,o=e.dataTypes,r=e.responseFields,a,d,l,c;for(d in r){if(d in n){i[r[d]]=n[d]}}while(o[0]==="*"){o.shift();if(a===t){a=e.mimeType||i.getResponseHeader("content-type")}}if(a){for(d in s){if(s[d]&&s[d].test(a)){o.unshift(d);break}}}if(o[0]in n){l=o[0]}else{for(d in n){if(!o[0]||e.converters[d+" "+o[0]]){l=d;break}if(!c){c=d}}l=l||c}if(l){if(l!==o[0]){o.unshift(l)}return n[l]}}function ot(e,i){if(e.dataFilter){i=e.dataFilter(i,e.dataType)}var n=e.dataTypes,s={},r,a,d=n.length,l,c=n[0],u,h,f,p,g;
for(r=1;r<d;r++){if(r===1){for(a in e.converters){if(typeof a==="string"){s[a.toLowerCase()]=e.converters[a]}}}u=c;c=n[r];if(c==="*"){c=u}else if(u!=="*"&&u!==c){h=u+" "+c;f=s[h]||s["* "+c];if(!f){g=t;for(p in s){l=p.split(" ");if(l[0]===u||l[0]==="*"){g=s[l[1]+" "+c];if(g){p=s[p];if(p===true){f=g}else if(g===true){f=p}break}}}}if(!(f||g)){o.error("No conversion from "+h.replace(" "," to "))}if(f!==true){i=f?f(i):g(p(i))}}}return i}var rt=o.now(),at=/(\=)\?(&|$)|\?\?/i;o.ajaxSetup({jsonp:"callback",jsonpCallback:function(){return o.expando+"_"+rt++}});o.ajaxPrefilter("json jsonp",function(t,i,n){var s=t.contentType==="application/x-www-form-urlencoded"&&typeof t.data==="string";if(t.dataTypes[0]==="jsonp"||t.jsonp!==false&&(at.test(t.url)||s&&at.test(t.data))){var r,a=t.jsonpCallback=o.isFunction(t.jsonpCallback)?t.jsonpCallback():t.jsonpCallback,d=e[a],l=t.url,c=t.data,u="$1"+a+"$2";if(t.jsonp!==false){l=l.replace(at,u);if(t.url===l){if(s){c=c.replace(at,u)}if(t.data===c){l+=(/\?/.test(l)?"&":"?")+t.jsonp+"="+a;
}}}t.url=l;t.data=c;e[a]=function(e){r=[e]};n.always(function(){e[a]=d;if(r&&o.isFunction(d)){e[a](r[0])}});t.converters["script json"]=function(){if(!r){o.error(a+" was not called")}return r[0]};t.dataTypes[0]="json";return"script"}});o.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/javascript|ecmascript/},converters:{"text script":function(e){o.globalEval(e);return e}}});o.ajaxPrefilter("script",function(e){if(e.cache===t){e.cache=false}if(e.crossDomain){e.type="GET";e.global=false}});o.ajaxTransport("script",function(e){if(e.crossDomain){var n,s=i.head||i.getElementsByTagName("head")[0]||i.documentElement;return{send:function(o,r){n=i.createElement("script");n.async="async";if(e.scriptCharset){n.charset=e.scriptCharset}n.src=e.url;n.onload=n.onreadystatechange=function(e,i){if(i||!n.readyState||/loaded|complete/.test(n.readyState)){n.onload=n.onreadystatechange=null;if(s&&n.parentNode){s.removeChild(n);
}n=t;if(!i){r(200,"success")}}};s.insertBefore(n,s.firstChild)},abort:function(){if(n){n.onload(0,1)}}}}});var dt=e.ActiveXObject?function(){for(var e in ct){ct[e](0,1)}}:false,lt=0,ct;function ut(){try{return new e.XMLHttpRequest}catch(t){}}function ht(){try{return new e.ActiveXObject("Microsoft.XMLHTTP")}catch(t){}}o.ajaxSettings.xhr=e.ActiveXObject?function(){return!this.isLocal&&ut()||ht()}:ut;(function(e){o.extend(o.support,{ajax:!!e,cors:!!e&&"withCredentials"in e})})(o.ajaxSettings.xhr());if(o.support.ajax){o.ajaxTransport(function(i){if(!i.crossDomain||o.support.cors){var n;return{send:function(s,r){var a=i.xhr(),d,l;if(i.username){a.open(i.type,i.url,i.async,i.username,i.password)}else{a.open(i.type,i.url,i.async)}if(i.xhrFields){for(l in i.xhrFields){a[l]=i.xhrFields[l]}}if(i.mimeType&&a.overrideMimeType){a.overrideMimeType(i.mimeType)}if(!i.crossDomain&&!s["X-Requested-With"]){s["X-Requested-With"]="XMLHttpRequest"}try{for(l in s){a.setRequestHeader(l,s[l])}}catch(c){}a.send(i.hasContent&&i.data||null);
n=function(e,s){var l,c,u,h,f;try{if(n&&(s||a.readyState===4)){n=t;if(d){a.onreadystatechange=o.noop;if(dt){delete ct[d]}}if(s){if(a.readyState!==4){a.abort()}}else{l=a.status;u=a.getAllResponseHeaders();h={};f=a.responseXML;if(f&&f.documentElement){h.xml=f}h.text=a.responseText;try{c=a.statusText}catch(p){c=""}if(!l&&i.isLocal&&!i.crossDomain){l=h.text?200:404}else if(l===1223){l=204}}}}catch(g){if(!s){r(-1,g)}}if(h){r(l,c,h,u)}};if(!i.async||a.readyState===4){n()}else{d=++lt;if(dt){if(!ct){ct={};o(e).unload(dt)}ct[d]=n}a.onreadystatechange=n}},abort:function(){if(n){n(0,1)}}}}})}var ft={},pt,gt,mt=/^(?:toggle|show|hide)$/,vt=/^([+\-]=)?([\d+.\-]+)([a-z%]*)$/i,_t,wt=[["height","marginTop","marginBottom","paddingTop","paddingBottom"],["width","marginLeft","marginRight","paddingLeft","paddingRight"],["opacity"]],bt;o.fn.extend({show:function(e,t,i){var n,s;if(e||e===0){return this.animate(xt("show",3),e,t,i)}else{for(var r=0,a=this.length;r<a;r++){n=this[r];if(n.style){s=n.style.display;if(!o._data(n,"olddisplay")&&s==="none"){
s=n.style.display=""}if(s===""&&o.css(n,"display")==="none"){o._data(n,"olddisplay",kt(n.nodeName))}}}for(r=0;r<a;r++){n=this[r];if(n.style){s=n.style.display;if(s===""||s==="none"){n.style.display=o._data(n,"olddisplay")||""}}}return this}},hide:function(e,t,i){if(e||e===0){return this.animate(xt("hide",3),e,t,i)}else{var n,s,r=0,a=this.length;for(;r<a;r++){n=this[r];if(n.style){s=o.css(n,"display");if(s!=="none"&&!o._data(n,"olddisplay")){o._data(n,"olddisplay",s)}}}for(r=0;r<a;r++){if(this[r].style){this[r].style.display="none"}}return this}},_toggle:o.fn.toggle,toggle:function(e,t,i){var n=typeof e==="boolean";if(o.isFunction(e)&&o.isFunction(t)){this._toggle.apply(this,arguments)}else if(e==null||n){this.each(function(){var t=n?e:o(this).is(":hidden");o(this)[t?"show":"hide"]()})}else{this.animate(xt("toggle",3),e,t,i)}return this},fadeTo:function(e,t,i,n){return this.filter(":hidden").css("opacity",0).show().end().animate({opacity:t},e,i,n)},animate:function(e,t,i,n){var s=o.speed(t,i,n);
if(o.isEmptyObject(e)){return this.each(s.complete,[false])}e=o.extend({},e);function r(){if(s.queue===false){o._mark(this)}var t=o.extend({},s),i=this.nodeType===1,n=i&&o(this).is(":hidden"),r,a,d,l,c,u,h,f,p;t.animatedProperties={};for(d in e){r=o.camelCase(d);if(d!==r){e[r]=e[d];delete e[d]}a=e[r];if(o.isArray(a)){t.animatedProperties[r]=a[1];a=e[r]=a[0]}else{t.animatedProperties[r]=t.specialEasing&&t.specialEasing[r]||t.easing||"swing"}if(a==="hide"&&n||a==="show"&&!n){return t.complete.call(this)}if(i&&(r==="height"||r==="width")){t.overflow=[this.style.overflow,this.style.overflowX,this.style.overflowY];if(o.css(this,"display")==="inline"&&o.css(this,"float")==="none"){if(!o.support.inlineBlockNeedsLayout||kt(this.nodeName)==="inline"){this.style.display="inline-block"}else{this.style.zoom=1}}}}if(t.overflow!=null){this.style.overflow="hidden"}for(d in e){l=new o.fx(this,t,d);a=e[d];if(mt.test(a)){p=o._data(this,"toggle"+d)||(a==="toggle"?n?"show":"hide":0);if(p){o._data(this,"toggle"+d,p==="show"?"hide":"show");
l[p]()}else{l[a]()}}else{c=vt.exec(a);u=l.cur();if(c){h=parseFloat(c[2]);f=c[3]||(o.cssNumber[d]?"":"px");if(f!=="px"){o.style(this,d,(h||1)+f);u=(h||1)/l.cur()*u;o.style(this,d,u+f)}if(c[1]){h=(c[1]==="-="?-1:1)*h+u}l.custom(u,h,f)}else{l.custom(u,a,"")}}}return true}return s.queue===false?this.each(r):this.queue(s.queue,r)},stop:function(e,i,n){if(typeof e!=="string"){n=i;i=e;e=t}if(i&&e!==false){this.queue(e||"fx",[])}return this.each(function(){var t,i=false,s=o.timers,r=o._data(this);if(!n){o._unmark(true,this)}function a(e,t,i){var s=t[i];o.removeData(e,i,true);s.stop(n)}if(e==null){for(t in r){if(r[t].stop&&t.indexOf(".run")===t.length-4){a(this,r,t)}}}else if(r[t=e+".run"]&&r[t].stop){a(this,r,t)}for(t=s.length;t--;){if(s[t].elem===this&&(e==null||s[t].queue===e)){if(n){s[t](true)}else{s[t].saveState()}i=true;s.splice(t,1)}}if(!(n&&i)){o.dequeue(this,e)}})}});function yt(){setTimeout(Ct,0);return bt=o.now()}function Ct(){bt=t}function xt(e,t){var i={};o.each(wt.concat.apply([],wt.slice(0,t)),function(){
i[this]=e});return i}o.each({slideDown:xt("show",1),slideUp:xt("hide",1),slideToggle:xt("toggle",1),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(e,t){o.fn[e]=function(e,i,n){return this.animate(t,e,i,n)}});o.extend({speed:function(e,t,i){var n=e&&typeof e==="object"?o.extend({},e):{complete:i||!i&&t||o.isFunction(e)&&e,duration:e,easing:i&&t||t&&!o.isFunction(t)&&t};n.duration=o.fx.off?0:typeof n.duration==="number"?n.duration:n.duration in o.fx.speeds?o.fx.speeds[n.duration]:o.fx.speeds._default;if(n.queue==null||n.queue===true){n.queue="fx"}n.old=n.complete;n.complete=function(e){if(o.isFunction(n.old)){n.old.call(this)}if(n.queue){o.dequeue(this,n.queue)}else if(e!==false){o._unmark(this)}};return n},easing:{linear:function(e,t,i,n){return i+n*e},swing:function(e,t,i,n){return(-Math.cos(e*Math.PI)/2+.5)*n+i}},timers:[],fx:function(e,t,i){this.options=t;this.elem=e;this.prop=i;t.orig=t.orig||{}}});o.fx.prototype={update:function(){if(this.options.step){
this.options.step.call(this.elem,this.now,this)}(o.fx.step[this.prop]||o.fx.step._default)(this)},cur:function(){if(this.elem[this.prop]!=null&&(!this.elem.style||this.elem.style[this.prop]==null)){return this.elem[this.prop]}var e,t=o.css(this.elem,this.prop);return isNaN(e=parseFloat(t))?!t||t==="auto"?0:t:e},custom:function(e,i,n){var s=this,r=o.fx;this.startTime=bt||yt();this.end=i;this.now=this.start=e;this.pos=this.state=0;this.unit=n||this.unit||(o.cssNumber[this.prop]?"":"px");function a(e){return s.step(e)}a.queue=this.options.queue;a.elem=this.elem;a.saveState=function(){if(s.options.hide&&o._data(s.elem,"fxshow"+s.prop)===t){o._data(s.elem,"fxshow"+s.prop,s.start)}};if(a()&&o.timers.push(a)&&!_t){_t=setInterval(r.tick,r.interval)}},show:function(){var e=o._data(this.elem,"fxshow"+this.prop);this.options.orig[this.prop]=e||o.style(this.elem,this.prop);this.options.show=true;if(e!==t){this.custom(this.cur(),e)}else{this.custom(this.prop==="width"||this.prop==="height"?1:0,this.cur());
}o(this.elem).show()},hide:function(){this.options.orig[this.prop]=o._data(this.elem,"fxshow"+this.prop)||o.style(this.elem,this.prop);this.options.hide=true;this.custom(this.cur(),0)},step:function(e){var t,i,n,s=bt||yt(),r=true,a=this.elem,d=this.options;if(e||s>=d.duration+this.startTime){this.now=this.end;this.pos=this.state=1;this.update();d.animatedProperties[this.prop]=true;for(t in d.animatedProperties){if(d.animatedProperties[t]!==true){r=false}}if(r){if(d.overflow!=null&&!o.support.shrinkWrapBlocks){o.each(["","X","Y"],function(e,t){a.style["overflow"+t]=d.overflow[e]})}if(d.hide){o(a).hide()}if(d.hide||d.show){for(t in d.animatedProperties){o.style(a,t,d.orig[t]);o.removeData(a,"fxshow"+t,true);o.removeData(a,"toggle"+t,true)}}n=d.complete;if(n){d.complete=false;n.call(a)}}return false}else{if(d.duration==Infinity){this.now=s}else{i=s-this.startTime;this.state=i/d.duration;this.pos=o.easing[d.animatedProperties[this.prop]](this.state,i,0,1,d.duration);this.now=this.start+(this.end-this.start)*this.pos;
}this.update()}return true}};o.extend(o.fx,{tick:function(){var e,t=o.timers,i=0;for(;i<t.length;i++){e=t[i];if(!e()&&t[i]===e){t.splice(i--,1)}}if(!t.length){o.fx.stop()}},interval:13,stop:function(){clearInterval(_t);_t=null},speeds:{slow:600,fast:200,_default:400},step:{opacity:function(e){o.style(e.elem,"opacity",e.now)},_default:function(e){if(e.elem.style&&e.elem.style[e.prop]!=null){e.elem.style[e.prop]=e.now+e.unit}else{e.elem[e.prop]=e.now}}}});o.each(["width","height"],function(e,t){o.fx.step[t]=function(e){o.style(e.elem,t,Math.max(0,e.now))}});if(o.expr&&o.expr.filters){o.expr.filters.animated=function(e){return o.grep(o.timers,function(t){return e===t.elem}).length}}function kt(e){if(!ft[e]){var t=i.body,n=o("<"+e+">").appendTo(t),s=n.css("display");n.remove();if(s==="none"||s===""){if(!pt){pt=i.createElement("iframe");pt.frameBorder=pt.width=pt.height=0}t.appendChild(pt);if(!gt||!pt.createElement){gt=(pt.contentWindow||pt.contentDocument).document;gt.write((i.compatMode==="CSS1Compat"?"<!doctype html>":"")+"<html><body>");
gt.close()}n=gt.createElement(e);gt.body.appendChild(n);s=o.css(n,"display");t.removeChild(pt)}ft[e]=s}return ft[e]}var St=/^t(?:able|d|h)$/i,Et=/^(?:body|html)$/i;if("getBoundingClientRect"in i.documentElement){o.fn.offset=function(e){var t=this[0],i;if(e){return this.each(function(t){o.offset.setOffset(this,e,t)})}if(!t||!t.ownerDocument){return null}if(t===t.ownerDocument.body){return o.offset.bodyOffset(t)}try{i=t.getBoundingClientRect()}catch(n){}var s=t.ownerDocument,r=s.documentElement;if(!i||!o.contains(r,t)){return i?{top:i.top,left:i.left}:{top:0,left:0}}var a=s.body,d=Tt(s),l=r.clientTop||a.clientTop||0,c=r.clientLeft||a.clientLeft||0,u=d.pageYOffset||r.scrollTop||a.scrollTop,h=d.pageXOffset||r.scrollLeft||a.scrollLeft,f=i.top+u-l,p=i.left+h-c;return{top:f,left:p}}}else{o.fn.offset=function(e){var t=this[0];if(e){return this.each(function(t){o.offset.setOffset(this,e,t)})}if(!t||!t.ownerDocument){return null}if(t===t.ownerDocument.body){return o.offset.bodyOffset(t)}var i,n=t.offsetParent,s=t,r=t.ownerDocument,a=r.documentElement,d=r.body,l=r.defaultView,c=l?l.getComputedStyle(t,null):t.currentStyle,u=t.offsetTop,h=t.offsetLeft;
while((t=t.parentNode)&&t!==d&&t!==a){if(o.support.fixedPosition&&c.position==="fixed"){break}i=l?l.getComputedStyle(t,null):t.currentStyle;u-=t.scrollTop;h-=t.scrollLeft;if(t===n){u+=t.offsetTop;h+=t.offsetLeft;if(o.support.doesNotAddBorder&&!(o.support.doesAddBorderForTableAndCells&&St.test(t.nodeName))){u+=parseFloat(i.borderTopWidth)||0;h+=parseFloat(i.borderLeftWidth)||0}s=n;n=t.offsetParent}if(o.support.subtractsBorderForOverflowNotVisible&&i.overflow!=="visible"){u+=parseFloat(i.borderTopWidth)||0;h+=parseFloat(i.borderLeftWidth)||0}c=i}if(c.position==="relative"||c.position==="static"){u+=d.offsetTop;h+=d.offsetLeft}if(o.support.fixedPosition&&c.position==="fixed"){u+=Math.max(a.scrollTop,d.scrollTop);h+=Math.max(a.scrollLeft,d.scrollLeft)}return{top:u,left:h}}}o.offset={bodyOffset:function(e){var t=e.offsetTop,i=e.offsetLeft;if(o.support.doesNotIncludeMarginInBodyOffset){t+=parseFloat(o.css(e,"marginTop"))||0;i+=parseFloat(o.css(e,"marginLeft"))||0}return{top:t,left:i}},setOffset:function(e,t,i){
var n=o.css(e,"position");if(n==="static"){e.style.position="relative"}var s=o(e),r=s.offset(),a=o.css(e,"top"),d=o.css(e,"left"),l=(n==="absolute"||n==="fixed")&&o.inArray("auto",[a,d])>-1,c={},u={},h,f;if(l){u=s.position();h=u.top;f=u.left}else{h=parseFloat(a)||0;f=parseFloat(d)||0}if(o.isFunction(t)){t=t.call(e,i,r)}if(t.top!=null){c.top=t.top-r.top+h}if(t.left!=null){c.left=t.left-r.left+f}if("using"in t){t.using.call(e,c)}else{s.css(c)}}};o.fn.extend({position:function(){if(!this[0]){return null}var e=this[0],t=this.offsetParent(),i=this.offset(),n=Et.test(t[0].nodeName)?{top:0,left:0}:t.offset();i.top-=parseFloat(o.css(e,"marginTop"))||0;i.left-=parseFloat(o.css(e,"marginLeft"))||0;n.top+=parseFloat(o.css(t[0],"borderTopWidth"))||0;n.left+=parseFloat(o.css(t[0],"borderLeftWidth"))||0;return{top:i.top-n.top,left:i.left-n.left}},offsetParent:function(){return this.map(function(){var e=this.offsetParent||i.body;while(e&&(!Et.test(e.nodeName)&&o.css(e,"position")==="static")){e=e.offsetParent;
}return e})}});o.each(["Left","Top"],function(e,i){var n="scroll"+i;o.fn[n]=function(i){var s,r;if(i===t){s=this[0];if(!s){return null}r=Tt(s);return r?"pageXOffset"in r?r[e?"pageYOffset":"pageXOffset"]:r.document.documentElement[n]||r.document.body[n]:s[n]}return this.each(function(){r=Tt(this);if(r){r.scrollTo(!e?i:o(r).scrollLeft(),e?i:o(r).scrollTop())}else{this[n]=i}})}});function Tt(e){return o.isWindow(e)?e:e.nodeType===9?e.defaultView||e.parentWindow:false}o.each(["Height","Width"],function(e,i){var n=i.toLowerCase();o.fn["inner"+i]=function(){var e=this[0];return e?e.style?parseFloat(o.css(e,n,"padding")):this[n]():null};o.fn["outer"+i]=function(e){var t=this[0];return t?t.style?parseFloat(o.css(t,n,e?"margin":"border")):this[n]():null};o.fn[n]=function(e){var s=this[0];if(!s){return e==null?null:this}if(o.isFunction(e)){return this.each(function(t){var i=o(this);i[n](e.call(this,t,i[n]()))})}if(o.isWindow(s)){var r=s.document.documentElement["client"+i],a=s.document.body;return s.document.compatMode==="CSS1Compat"&&r||a&&a["client"+i]||r;
}else if(s.nodeType===9){return Math.max(s.documentElement["client"+i],s.body["scroll"+i],s.documentElement["scroll"+i],s.body["offset"+i],s.documentElement["offset"+i])}else if(e===t){var d=o.css(s,n),l=parseFloat(d);return o.isNumeric(l)?l:d}else{return this.css(n,typeof e==="string"?e:e+"px")}}});e.jQuery=e.$=o})(window);exports=e.exports=window.jQuery});define("shared/core/rpc",["shared/polyfills"],function a(require,exports,e){var t={};var i=[];exports.addMetadataCallback=function(e){i.push(e)};exports.flushMetadata=function(e){var n=e.cid;var s=n in t?t[n]:{};delete t[n];for(var o=0;o<i.length;o++){i[o](s,e)}return s};exports.addMetadata=function(e,i,n){if(!(e in t)){t[e]={}}t[e][i]=n}});define("shared/Class",["shared/polyfills"],function d(require,exports,e){var t=/xyz/.test(function(){xyz})?/\b_super\b/:/.*/,i=function(){},n={};function s(e,t){var s=i.prototype=e.prototype,r=new i,d;function l(){if(!d){e.call(n);o(r,t,s);d=true;t=null}if(this===n){return}var i=this.__init__;if(i){
i.apply(this,arguments)}}l.prototype=r;l.extend=a;r.constructor=l;return l}function o(e,t,i){for(var n in t){if(t.hasOwnProperty(n)){e[n]=i?r(n,t,i):t[n]}}}function r(e,i,n){var s=i[e],o=n[e];if(typeof s==="function"&&typeof o==="function"&&s!==o&&t.test(s)){return function(){var t=this._super;this._super=n[e];try{return s.apply(this,arguments)}finally{this._super=t}}}return s}function a(e){return s(this,e)}exports.Class=a.call(function(){},{});exports.testExtendSpeed=function(e){var t=e=e||1e4,i=+new Date,n=[];while(e-->0){n.push(exports.Class.extend({__init__:function(e){this.val=e},method:function(e){this.val+=e}}).extend({method:function(e){this._super(e);this.val+=e},foo:function(){},bar:function(){this.foo()}}).extend({__init__:function(){this._super.apply(this,arguments)},foo:function(){}}))}console.log(t,"class definitions took",new Date-i,"ms");n.length=0}});define("shared/w2.context",["shared/polyfills","shared/Class","shared/errors"],function l(require,exports,e){var t=require("shared/Class").Class,i=require("shared/errors");
var n=t.extend({__init__:function(e){this.value=e;this.handlers={}},bind:function(e,t){if(!this.handlers.hasOwnProperty(t)){this.handlers[t]=[]}this.handlers[t].push(e)},unbind:function(e){delete this.handlers[e]},trigger:function(){var e=Array.prototype.slice.call(arguments);for(var t in this.handlers){if(this.handlers.hasOwnProperty(t)){var i=this.handlers[t];for(var n=0;n<i.length;n++){i[n].apply(this,e)}}}},set:function(e){var t=this.value;this.value=e;this.trigger(t,e)},get:function(){return this.value}});var s=exports.Context=t.extend({__init__:function(){var e=this.initialProperties();if(!e){var t=["Override initialProperties() in your subclasses to define a list ","of properties that this Context should listen to."].join("");i.logJsError("w2.context",t);return}this.properties={};for(var s in e){this.properties[s]=new n(e[s])}},initialProperties:function(){},on:function(e,t,i){this.assertPropertyName(e);this.properties[e].bind(t,i)},off:function(e){for(var t in this.properties){this.properties[t].unbind(e);
}},set:function(e,t){this.assertPropertyName(e);this.properties[e].set(t)},get:function(e){this.assertPropertyName(e);return this.properties[e].get()},assertPropertyName:function(e){if(this.properties.hasOwnProperty(e)){return}var t=["Hey, you are trying to access a context property with an invalid ","property name. You can only retrieve property names that are defined ","in the Context initialProperties definition."].join("");i.logJsError("w2.context",t)}});var o=t.extend({__init__:function(e,t){this._context=e;this._cid=t},on:function(e,t){this._context.on(e,t,this._cid)},off:function(){this._context.off(this._cid)},get:function(e){return this._context.get(e)},set:function(e,t){this._context.set(e,t)}});var r=t.extend({__init__:function(e){this.component=e;var t=this.component.contextConstructor();this._context=t?new t(this.component):null;this._contextProxies=[]},get:function(e){for(var t=0;t<this._contextProxies.length;t++){if(this._contextProxies[t]._context instanceof e){return this._contextProxies[t];
}}var i=null;var n=this.component;while(n&&n.cid!="*ROOT*"){var s=n.contextManager._context;if(s instanceof e){i=s;break}var r=n.parent();if(n===r){throw new Error(n+"is its own parent()")}n=r}if(!i){return null}var a=new o(i,this.component.cid);this._contextProxies.push(a);return a},unload:function(){for(var e=0;e<this._contextProxies.length;e++){this._contextProxies[e].off()}}});exports.initComponent=function(e){var t=new r(e);e.contextManager=t;e.getContext=t.get.bind(t)};exports.unloadComponent=function(e){if(e.contextManager){e.contextManager.unload()}};exports.ActionBar=s.extend({initialProperties:function(){return{commentsElem:null,loadComments:false,showComments:false,featuredCommentExpanded:false,pageFeaturedCommentsLink:null,featuredCommentsPaged:false,updateSticky:false,toggleRAD:false}}});exports.UniversalPageFeedContext=s.extend({initialProperties:function(){return{feedStories:[],impressionLogger:null,readingTimeLogger:null}}});exports.CaptchaInput=s.extend({initialProperties:function(){
return{present:false,sync:null,isCaptchaFilled:true,captchaResponse:""}}});exports.StoryItemModal=s.extend({initialProperties:function(){return{disableModal:false}}});exports.HoverMenu=s.extend({initialProperties:function(){return{isShown:false,hidden:true}}});exports.FormFieldTopicSelector=s.extend({initialProperties:function(){return{tid:null,topicName:null}}})});define("shared/events/types",["shared/polyfills","shared/util"],function c(require,exports,e){var t=require("shared/util");exports.EventTypes=t.makeEnum(["ADS_MANAGER_TABLE_SORT","ACTIVATION_NEXT_STEP","ACTIVATION_PROGRESS_BAR_STEP","ANSWER_VOTE_STATE","ANSWER_READ_MORE","ANSWER_TOGGLE_EDITOR","CAROUSEL_CHECK_DISMISS_ALL","CAROUSEL_DISMISS_ALL","CREDENTIAL_DELETED","CREDENTIAL_ADD_FORM_VISIBILITY","CREDENTIAL_CHOSEN","FEED_IMPRESSIONS_DISABLED","FEED_NUM_PIN_TOPICS","FEED_CONTROL_UPDATE","FEED_PAGING_DONE","FILTER_NAV_LIST_UPDATE","INLINE_EDITOR_STATE","INTERACTION_MODE_BANNER_STATE","KNOWS_ABOUT_ADD_TOPIC","KNOWS_ABOUT_REMOVE_TOPIC","LIVENODE_LOADING_SPINNER","LOGIN_UPDATE_FIELDS","LOGIN_USER","LOGOUT_USER","LOOKUP_BAR_ASK_QUESTION","LOOKUP_BAR_QUESTION_DETAILS_STATE","LOOKUP_BAR_SET_ASKING_TARGET","MULTIFEED_BUNDLE_REMOVE","NOTIFS_MARK_ALL_READ","NUX_PROGRESS_BAR_STEP","NUX_DIALOG_CLOSE","NUX_DIALOG_NEXT_STEP","NUX_DIALOG_STANDALONE_DONE","NUX_DIALOG_SKIP_NEXT_STEP","NUX_DIALOG_FRIENDS_UPDATE","NETWORK_BETA_LOGIN_FORM_STATE","NETWORK_BETA_WAITLIST_FORM_STATE","NETWORK_INVITE_USER","NETWORK_JOIN_MODAL","PERF_POST_HTML","PMSG_SHOW","PROFILE_TOPICS_UPDATED","POST_DISCLAIMER","QTEXT_EXPANDABLE_STATE","QUESTION_SUBMIT","QUESTION_BIO_TOPIC_SELECT","QUESTION_CANT_ANSWER_STATE","QUESTION_DELETE_STATE_CHANGE","QUESTION_TOPIC_SELECTION_ADD","QUESTION_VOTE_STATE","QUESTION_EDITING_STATE","READING_LIST_VIEW_STATE","READING_LIST_ITEM_REMOVE","REORDERABLE_LIST_ITEM_UPDATE","REORDERABLE_LIST_TOGGLE_EDIT","REORDERABLE_LIST_ITEM_ACTIVE","SITE_HEADER_SEARCH_FOCUSED","TOPICS_GRID_ADD","TOPICS_GRID_REMOVE","TOPICS_GRID_UPDATE_SHOWN","TOPIC_LIST_REMOVE","TOPIC_FAQ_VIEW_MORE","TOPIC_FAQ_HIGHLIGHT_QUESTION","USER_LEADERBOARD_TOGGLE_EDIT","USER_STATS_UNSELECT_ITEMS","USER_STATS_UPDATE_GRAPHS","USER_STATS_UPDATE_ATTRIBUTES","USER_STATS_SHOW","UPLOAD_DIALOG_DROPZONE","UPLOAD_DIALOG_LOADING_STATE","WORDPRESS_CONNECT_SUCCESS","PILE_ON_REQUEST_MADE"]);
});define("shared/eventemitter",["shared/polyfills","shared/Class","shared/errors"],function u(require,exports,e){var t=require("shared/Class").Class,i=require("shared/errors");var n={on:function(e,t){this.__handlers=this.__handlers||{};this.__handlers[e]=this.__handlers[e]||[];this.__handlers[e].push(t)},off:function(e,t){if(!this.__handlers||!this.__handlers[e]){return}var i=this.__handlers[e].indexOf(t);if(i!=-1){this.__handlers[e].splice(i,1)}},once:function(e,t){this.__onceHandlers=this.__onceHandlers||{};this.__onceHandlers[e]=this.__onceHandlers[e]||[];this.__onceHandlers[e].push(t)},trigger:function(e,t){var n=this.__handlers&&this.__handlers[e]||[];for(var s=0;s<n.length;s++){try{n[s].apply(null,t||[])}catch(o){i.report(o)}}var r=this.__onceHandlers&&this.__onceHandlers[e]||[];while(r.length!==0){try{r.pop().apply(null,t||[])}catch(o){i.report(o)}}}};exports.Mixin=n;exports.EventEmitter=t.extend(n)});define("shared/events/hub",["shared/polyfills","shared/Class","shared/eventemitter","shared/errors","shared/events/types"],function h(require,exports,e){
var t=require("shared/Class").Class,i=require("shared/eventemitter").EventEmitter,n=require("shared/errors"),s=require("shared/events/types");var o=t.extend({__init__:function(){this.reset()},reset:function(){this._emitter=new i},_isValidType:function(e){if(!s.EventTypes[e]){n.logJsError("Hub","Unknown error type - "+e);return false}return true},_isValidEvent:function(e){var t=this._isValidType(e.type);var i=!!e.payload;var s=!!e.scope;if(!i){n.logJsError("Hub","Event object missing payload - "+e)}if(!s){n.logJsError("Hub","Event object missing scope - "+e)}return t&&i&&s},subscribe:function(e,t){if(!this._isValidType(e)){return}this._emitter.on(e,t)},unsubscribe:function(e,t){if(!this._isValidType(e)){return}this._emitter.off(e,t)},dispatch:function(e){if(!this._isValidEvent(e)){return}this._emitter.trigger(e.type,[e])}});exports.Hub=new o});define("shared/events/scope",["shared/polyfills","shared/Class","shared/core/component"],function f(require,exports,e){var t=require("shared/Class").Class,i=require("shared/core/component");
exports.GLOBAL={contains:function(){return true},toJSON:function(){return{type:"GlobalScope"}}};exports.ComponentScope=t.extend({__init__:function(e){this.source=e;this.rootParent=i.getRootParent(e)},contains:function(e){if(!i.isCid(e)){return false}return this.rootParent==i.getRootParent(e)},toJSON:function(){return{type:"ComponentScope",source:this.source,root:this.rootParent}}})});define("shared/events/proxy",["shared/polyfills","shared/Class","shared/events/hub","shared/events/scope"],function p(require,exports,e){var t=require("shared/Class").Class,i=require("shared/events/hub").Hub,n=require("shared/events/scope");var s=t.extend({__init__:function(){this._subscriptions={}},reset:function(){var e=Object.keys(this._subscriptions);for(var t=0;t<e.length;t++){this.unsubscribeAll(e[t])}},subscribe:function(e,t,n){var s=function(e){if(e.scope.contains(n)){t(e)}};this._subscriptions[n]=this._subscriptions[n]||[];this._subscriptions[n].push([e,s]);i.subscribe(e,s)},unsubscribeAll:function(e){
var t=this._subscriptions[e];if(!t){return}for(var n=0;n<t.length;n++){var s=t[n];var o=s[0];var r=s[1];i.unsubscribe(o,r)}delete this._subscriptions[e]},dispatch:function(e,t){if(!e.scope){e.scope=this.defaultScope(e.type,t)}i.dispatch(e)},defaultScope:function(e,t){return null}});var o=s.extend({defaultScope:function(e,t){return n.GLOBAL}});var r=s.extend({defaultScope:function(e,t){return new n.ComponentScope(t)}});exports.Global=new o;exports.Component=new r});define("shared/events/helpers",["shared/polyfills","shared/events/types","shared/events/scope"],function g(require,exports,e){var t=require("shared/events/types").EventTypes,i=require("shared/events/scope");exports.addAnswerUpvote=function(e){return{type:t.ANSWER_VOTE_STATE,payload:{aid:e,state:"upvoted"},scope:i.GLOBAL}};exports.addAnswerDownvote=function(e){return{type:t.ANSWER_VOTE_STATE,payload:{aid:e,state:"downvoted"},scope:i.GLOBAL}};exports.removeAnswerDownvote=exports.removeAnswerUpvote=function(e){return{type:t.ANSWER_VOTE_STATE,
payload:{aid:e,state:null},scope:i.GLOBAL}};exports.addQuestionDownvote=function(e){return{type:t.QUESTION_VOTE_STATE,payload:{qid:e,state:"downvoted"},scope:i.GLOBAL}};exports.removeQuestionDownvote=function(e){return{type:t.QUESTION_VOTE_STATE,payload:{qid:e,state:null},scope:i.GLOBAL}};exports.addQuestionCantAnswer=function(e){return{type:t.QUESTION_CANT_ANSWER_STATE,payload:{qid:e,state:"passed"},scope:i.GLOBAL}};exports.removeQuestionCantAnswer=function(e){return{type:t.QUESTION_CANT_ANSWER_STATE,payload:{qid:e,state:null},scope:i.GLOBAL}};exports.changeQuestionDeletionState=function(e){return{type:t.QUESTION_DELETE_STATE_CHANGE,payload:{qid:e},scope:i.GLOBAL}};exports.inlineEditorCancel=function(e,i){return{type:t.INLINE_EDITOR_STATE,payload:{oid:i,contentType:e,state:"cancel"}}};exports.inlineEditorEdit=function(e,i){return{type:t.INLINE_EDITOR_STATE,payload:{oid:i,contentType:e,state:"edit"}}};exports.inlineEditorLoad=function(e,i){return{type:t.INLINE_EDITOR_STATE,payload:{oid:i,
contentType:e,state:"load"}}};exports.inlineEditorSubmit=function(e,i){return{type:t.INLINE_EDITOR_STATE,payload:{oid:i,contentType:e,state:"submit"}}};exports.inlineEditorSubmitted=function(e,i){return{type:t.INLINE_EDITOR_STATE,payload:{oid:i,contentType:e,state:"submitted"}}};exports.inlineEditorDisclaimer=function(e,i){return{type:t.INLINE_EDITOR_STATE,payload:{oid:i,contentType:e,state:"disclaimer"}}};exports.inlineEditorToggle=function(e,i){return{type:t.INLINE_EDITOR_STATE,payload:{oid:i,contentType:e,state:"toggle"}}};exports.loginUser=function(e){return{type:t.LOGIN_USER,payload:{pmsg:e},scope:i.GLOBAL}};exports.logoutUser=function(){return{type:t.LOGOUT_USER,payload:{},scope:i.GLOBAL}}});define("shared/events/index",["shared/polyfills","shared/events/index","shared/events/types","shared/events/proxy","shared/events/scope","shared/events/helpers"],function m(require,exports,e){var t=require("shared/events/types");var i=require("shared/events/proxy");var n=require("shared/events/scope");
var s=require("shared/events/helpers");exports.Types=t.EventTypes;exports.GlobalProxy=i.Global;exports.ComponentProxy=i.Component;exports.scope=n;exports.helpers=s});define("third_party/browser",["shared/polyfills"],function v(require,exports,e){(function(t,i){if(typeof e!="undefined"&&e.exports)e.exports=i();else if(typeof define=="function"&&define.amd)define(t,i);else this[t]=i()})("bowser",function(){var e=true;function t(t){function i(e){var i=t.match(e);return i&&i.length>1&&i[1]||""}function n(e){var i=t.match(e);return i&&i.length>1&&i[2]||""}var s=i(/(ipod|iphone|ipad)/i).toLowerCase(),o=/like android/i.test(t),r=!o&&/android/i.test(t),a=/nexus\s*[0-6]\s*/i.test(t),d=!a&&/nexus\s*[0-9]+/i.test(t),l=/CrOS/.test(t),c=/silk/i.test(t),u=/sailfish/i.test(t),h=/tizen/i.test(t),f=/(web|hpw)os/i.test(t),p=/windows phone/i.test(t),g=/SamsungBrowser/i.test(t),m=!p&&/windows/i.test(t),v=!s&&!c&&/macintosh/i.test(t),_=!r&&!u&&!h&&!f&&/linux/i.test(t),w=i(/edge\/(\d+(\.\d+)?)/i),b=i(/version\/(\d+(\.\d+)?)/i),y=/tablet/i.test(t),C=!y&&/[^-]mobi/i.test(t),x=/xbox/i.test(t),k;
if(/opera/i.test(t)){k={name:"Opera",opera:e,version:b||i(/(?:opera|opr|opios)[\s\/](\d+(\.\d+)?)/i)}}else if(/opr|opios/i.test(t)){k={name:"Opera",opera:e,version:i(/(?:opr|opios)[\s\/](\d+(\.\d+)?)/i)||b}}else if(/SamsungBrowser/i.test(t)){k={name:"Samsung Internet for Android",samsungBrowser:e,version:b||i(/(?:SamsungBrowser)[\s\/](\d+(\.\d+)?)/i)}}else if(/coast/i.test(t)){k={name:"Opera Coast",coast:e,version:b||i(/(?:coast)[\s\/](\d+(\.\d+)?)/i)}}else if(/yabrowser/i.test(t)){k={name:"Yandex Browser",yandexbrowser:e,version:b||i(/(?:yabrowser)[\s\/](\d+(\.\d+)?)/i)}}else if(/ucbrowser/i.test(t)){k={name:"UC Browser",ucbrowser:e,version:i(/(?:ucbrowser)[\s\/](\d+(?:\.\d+)+)/i)}}else if(/mxios/i.test(t)){k={name:"Maxthon",maxthon:e,version:i(/(?:mxios)[\s\/](\d+(?:\.\d+)+)/i)}}else if(/epiphany/i.test(t)){k={name:"Epiphany",epiphany:e,version:i(/(?:epiphany)[\s\/](\d+(?:\.\d+)+)/i)}}else if(/puffin/i.test(t)){k={name:"Puffin",puffin:e,version:i(/(?:puffin)[\s\/](\d+(?:\.\d+)?)/i)}}else if(/sleipnir/i.test(t)){
k={name:"Sleipnir",sleipnir:e,version:i(/(?:sleipnir)[\s\/](\d+(?:\.\d+)+)/i)}}else if(/k-meleon/i.test(t)){k={name:"K-Meleon",kMeleon:e,version:i(/(?:k-meleon)[\s\/](\d+(?:\.\d+)+)/i)}}else if(p){k={name:"Windows Phone",windowsphone:e};if(w){k.msedge=e;k.version=w}else{k.msie=e;k.version=i(/iemobile\/(\d+(\.\d+)?)/i)}}else if(/msie|trident/i.test(t)){k={name:"Internet Explorer",msie:e,version:i(/(?:msie |rv:)(\d+(\.\d+)?)/i)}}else if(l){k={name:"Chrome",chromeos:e,chromeBook:e,chrome:e,version:i(/(?:chrome|crios|crmo)\/(\d+(\.\d+)?)/i)}}else if(/chrome.+? edge/i.test(t)){k={name:"Microsoft Edge",msedge:e,version:w}}else if(/vivaldi/i.test(t)){k={name:"Vivaldi",vivaldi:e,version:i(/vivaldi\/(\d+(\.\d+)?)/i)||b}}else if(u){k={name:"Sailfish",sailfish:e,version:i(/sailfish\s?browser\/(\d+(\.\d+)?)/i)}}else if(/seamonkey\//i.test(t)){k={name:"SeaMonkey",seamonkey:e,version:i(/seamonkey\/(\d+(\.\d+)?)/i)}}else if(/firefox|iceweasel|fxios/i.test(t)){k={name:"Firefox",firefox:e,version:i(/(?:firefox|iceweasel|fxios)[ \/](\d+(\.\d+)?)/i)
};if(/\((mobile|tablet);[^\)]*rv:[\d\.]+\)/i.test(t)){k.firefoxos=e}}else if(c){k={name:"Amazon Silk",silk:e,version:i(/silk\/(\d+(\.\d+)?)/i)}}else if(/phantom/i.test(t)){k={name:"PhantomJS",phantom:e,version:i(/phantomjs\/(\d+(\.\d+)?)/i)}}else if(/slimerjs/i.test(t)){k={name:"SlimerJS",slimer:e,version:i(/slimerjs\/(\d+(\.\d+)?)/i)}}else if(/blackberry|\bbb\d+/i.test(t)||/rim\stablet/i.test(t)){k={name:"BlackBerry",blackberry:e,version:b||i(/blackberry[\d]+\/(\d+(\.\d+)?)/i)}}else if(f){k={name:"WebOS",webos:e,version:b||i(/w(?:eb)?osbrowser\/(\d+(\.\d+)?)/i)};/touchpad\//i.test(t)&&(k.touchpad=e)}else if(/bada/i.test(t)){k={name:"Bada",bada:e,version:i(/dolfin\/(\d+(\.\d+)?)/i)}}else if(h){k={name:"Tizen",tizen:e,version:i(/(?:tizen\s?)?browser\/(\d+(\.\d+)?)/i)||b}}else if(/qupzilla/i.test(t)){k={name:"QupZilla",qupzilla:e,version:i(/(?:qupzilla)[\s\/](\d+(?:\.\d+)+)/i)||b}}else if(/chromium/i.test(t)){k={name:"Chromium",chromium:e,version:i(/(?:chromium)[\s\/](\d+(?:\.\d+)?)/i)||b
}}else if(/chrome|crios|crmo/i.test(t)){k={name:"Chrome",chrome:e,version:i(/(?:chrome|crios|crmo)\/(\d+(\.\d+)?)/i)}}else if(r){k={name:"Android",version:b}}else if(/safari|applewebkit/i.test(t)){k={name:"Safari",safari:e};if(b){k.version=b}}else if(s){k={name:s=="iphone"?"iPhone":s=="ipad"?"iPad":"iPod"};if(b){k.version=b}}else if(/googlebot/i.test(t)){k={name:"Googlebot",googlebot:e,version:i(/googlebot\/(\d+(\.\d+))/i)||b}}else{k={name:i(/^(.*)\/(.*) /),version:n(/^(.*)\/(.*) /)}}if(!k.msedge&&/(apple)?webkit/i.test(t)){if(/(apple)?webkit\/537\.36/i.test(t)){k.name=k.name||"Blink";k.blink=e}else{k.name=k.name||"Webkit";k.webkit=e}if(!k.version&&b){k.version=b}}else if(!k.opera&&/gecko\//i.test(t)){k.name=k.name||"Gecko";k.gecko=e;k.version=k.version||i(/gecko\/(\d+(\.\d+)?)/i)}if(!k.msedge&&(r||k.silk)){k.android=e}else if(s){k[s]=e;k.ios=e}else if(v){k.mac=e}else if(x){k.xbox=e}else if(m){k.windows=e}else if(_){k.linux=e}var S="";if(k.windowsphone){S=i(/windows phone (?:os)?\s?(\d+(\.\d+)*)/i);
}else if(s){S=i(/os (\d+([_\s]\d+)*) like mac os x/i);S=S.replace(/[_\s]/g,".")}else if(r){S=i(/android[ \/-](\d+(\.\d+)*)/i)}else if(k.webos){S=i(/(?:web|hpw)os\/(\d+(\.\d+)*)/i)}else if(k.blackberry){S=i(/rim\stablet\sos\s(\d+(\.\d+)*)/i)}else if(k.bada){S=i(/bada\/(\d+(\.\d+)*)/i)}else if(k.tizen){S=i(/tizen[\/\s](\d+(\.\d+)*)/i)}if(S){k.osversion=S}var E=S.split(".")[0];if(y||d||s=="ipad"||r&&(E==3||E>=4&&!C)||k.silk){k.tablet=e}else if(C||s=="iphone"||s=="ipod"||r||a||k.blackberry||k.webos||k.bada){k.mobile=e}if(k.msedge||k.msie&&k.version>=10||k.yandexbrowser&&k.version>=15||k.vivaldi&&k.version>=1||k.chrome&&k.version>=20||k.samsungBrowser&&k.version>=4||k.firefox&&k.version>=20||k.safari&&k.version>=6||k.opera&&k.version>=10||k.ios&&k.osversion&&k.osversion.split(".")[0]>=6||k.blackberry&&k.version>=10.1||k.chromium&&k.version>=20){k.a=e}else if(k.msie&&k.version<10||k.chrome&&k.version<20||k.firefox&&k.version<20||k.safari&&k.version<6||k.opera&&k.version<10||k.ios&&k.osversion&&k.osversion.split(".")[0]<6||k.chromium&&k.version<20){
k.c=e}else k.x=e;return k}var i=t(typeof navigator!=="undefined"?navigator.userAgent||"":"");i.test=function(e){for(var t=0;t<e.length;++t){var n=e[t];if(typeof n==="string"){if(n in i){return true}}}return false};function n(e){return e.split(".").length}function s(e,t){var i=[],n;if(Array.prototype.map){return Array.prototype.map.call(e,t)}for(n=0;n<e.length;n++){i.push(t(e[n]))}return i}function o(e){var t=Math.max(n(e[0]),n(e[1]));var i=s(e,function(e){var i=t-n(e);e=e+new Array(i+1).join(".0");return s(e.split("."),function(e){return new Array(20-e.length).join("0")+e}).reverse()});while(--t>=0){if(i[0][t]>i[1][t]){return 1}else if(i[0][t]===i[1][t]){if(t===0){return 0}}else{return-1}}}function r(e,n,s){var r=i;if(typeof n==="string"){s=n;n=void 0}if(n===void 0){n=false}if(s){r=t(s)}var a=""+r.version;for(var d in e){if(e.hasOwnProperty(d)){if(r[d]){return o([a,e[d]])<0}}}return n}function a(e,t,i){return!r(e,t,i)}i.isUnsupportedBrowser=r;i.compareVersions=o;i.check=a;i._detect=t;return i;
})});define("shared/browser",["shared/polyfills","shared/browser","third_party/browser"],function _(require,exports,e){var t=require("third_party/browser");t.version=parseFloat(t.version);e.exports=t});define("shared/client",["shared/polyfills","settings","shared/browser"],function w(require,exports,e){var t=require("settings"),i=require("shared/browser");var n=exports.DeviceType={ANDROID:0,IOS:1,WEB:2};var s=exports.getDeviceType=function(){var e=t.deviceName;if("iphone"==e){return n.IOS}if("android"==e){return n.ANDROID}return n.WEB};var o=exports.isIOSApp=function(){return s()==n.IOS};var r=exports.isAndroidApp=function(){return s()==n.ANDROID};exports.isNativeApp=function(){return o()||r()};var a=exports.isMobileWeb=function(){return s()==n.WEB};exports.isWKWebView=function(){return o()&&window.webkit&&window.webkit.messageHandlers&&window.webkit.messageHandlers.Q?true:false};exports.isUIWebView=function(){return o()&&!window.webkit};var d=exports.isAndroidMobileWeb=function(){return a()&&i.android;
};exports.isIOSMobileWeb=function(){return a()&&i.ios};exports.isAndroid=function(){return d()||r()}});define("unified_view/mobile_overlays",["shared/polyfills","shared/core/component","shared/client","interface/settings","shared/errors"],function b(require,exports,e){var t=require("shared/core/component").Component,i=require("shared/core/component"),n=require("shared/client"),s=require("interface/settings").pageIsMobile,o=require("shared/errors"),r,a;if(s){r=require("mobile_app2/client");a=require("mobile_app2/util")}var d;var l=false;exports.ActionViewOverlay=t.extend({onLoad:function(){var e=this;d=e;var t=e.$id("@close_button");t.on("click",function(){window.history.back()})},_clearPageAction:function(){this.hideRightButtons();this.setTitle("")},setTitle:function(e){this.$id("@title").text(e)},setRightTextButton:function(e){var t=this.$id("@navigation_button");t.removeClass("hidden");t.removeClass("has_badge");t.toggleClass("is_disabled",e.disabled);t.text(e.title);var i=this.$id("@header_action_buttons");
if(i){i.addClass("hidden")}var n=e.callback;t.on("click",function(){n()})},setRightIconButtons:function(e){this.hideRightButtons();var t=this.$id("@header_action_buttons");t.removeClass("hidden");for(var i=0;i<e.length;i++){var n=e[i];var s="@right_icon_button_"+i;var o=this.$id(s);o.removeClass("hidden");o.toggleClass("is_disabled",n.disabled);o.text(r.getIconChar(n.iconName));var a=n.callback;o.on("click",function(){a()})}},hideRightButtons:function(){var e=this.$id("@navigation_button");e.toggleClass("hidden",true);for(var t=0;t<2;t++){var i="@right_icon_button_"+t;this.$id(i).addClass("hidden")}},$getContainer:function(){return this.$id("@action_view_container")},$getContent:function(){return this.$id("@action_view_content")},setHeight:function(e){this._height=e;this._fixHeight()},setOnClose:function(e){this.onClose=e},show:function(e){window.history.pushState(null,null,window.location.pathname);this.modalBackground=document.createElement("div");this.modalBackground.className="modal_bg";
document.body.insertBefore(this.modalBackground,document.body.firstChild);a.safeClickHandler(this.modalBackground,function(){window.history.back()});this.$getContainer().toggleClass("hidden");this.$getContainer().addClass("action-view-slide-in");this.$getContent().scrollTop(0);this._fixHeight();if(n.isIOSMobileWeb()){this._lockScrollOnIOS()}else{document.body.style.overflowY="hidden"}var t=this;this._resizeListener=function(){t._fixHeight()};window.addEventListener("resize",this._resizeListener);this._closeListener=this.close.bind(this);window.addEventListener("popstate",this._closeListener,false)},close:function(){if(!l){return}l=false;this.$getContainer().toggleClass("hidden");window.removeEventListener("popstate",this._closeListener);window.removeEventListener("resize",this._resizeListener);if(n.isIOSMobileWeb()){var e=this.$getContent().get(0);e.removeEventListener("touchstart",this._handleTouchStart);e.removeEventListener("touchmove",this._handleTouchMove);window.removeEventListener("scroll",this._iOSScrollHack);
document.body.removeEventListener("touchmove",this._cancelTouch)}else{document.body.style.overflowY="scroll"}document.body.removeChild(this.modalBackground);if(this.onClose){this.onClose()}this._clearPageAction()},_fixHeight:function(){var e;if(!this._height||this._height>window.innerHeight){e=window.innerHeight}else{e=this._height}var t=this.$id("@action_view_header").height();this.$getContainer().height(e);this.$getContent().height(e-t);var i=window.scrollY+(window.innerHeight-e);this.$getContainer().css("top",i+"px")},_lockScrollOnIOS:function(){var e=this.$getContent().get(0);var t=this;t.startScroll=window.scrollY;this._handleTouchStart=function(e){t.allowUp=this.scrollTop>0;t.allowDown=this.scrollTop<this.scrollHeight-this.clientHeight;t.slideBeginY=e.pageY};e.addEventListener("touchstart",this._handleTouchStart);this._handleTouchMove=function(e){var i=e.pageY>t.slideBeginY;var n=e.pageY<t.slideBeginY;t.slideBeginY=e.pageY;if(i&&t.allowUp||n&&t.allowDown){e.stopPropagation()}else{
e.preventDefault()}};e.addEventListener("touchmove",this._handleTouchMove);this._cancelTouch=function(e){e.preventDefault()};document.body.addEventListener("touchmove",this._cancelTouch);this._iOSScrollHack=function(e){window.scrollTo(window.scrollX,t.startScroll)};window.addEventListener("scroll",this._iOSScrollHack)}});exports.getActionViewOverlay=function(){return d};exports.isOverlayShown=function(){console.log("returning: ",l);return l};var c=exports.setPageAction=function(e){h[f]=e;if(e.rightTextButton){d.setRightTextButton(e.rightTextButton)}if(e.rightIconButtons){d.setRightIconButtons(e.rightIconButtons)}if(e.title){console.log("setting title with: ",e.title);d.setTitle(e.title)}};var u=0;exports.moveElementToDiv=function(e,t){var i=document.createElement("div");var n="_movedElement_"+u++;i.id=n;if(e.parentElement){e.parentElement.replaceChild(i,e)}t.appendChild(e);e.setAttribute("_markerId",n)};exports.moveElementBack=function(e){var t=e.getAttribute("_markerId");var i=document.getElementById(t);
if(i){i.parentElement.replaceChild(e,i);e.setAttribute("_markerId",undefined)}else{e.parentElement.removeChild(e)}};var h={};var f=-1;var p={};exports.registerComponent=function(e,t){var i=p[e];if(i===undefined){i=[];p[e]=i}i.push(t)};exports.deregisterComponent=function(e,t){var i=p[e];if(i){var n=i.indexOf(t);if(n>-1){i.splice(n,1)}}};exports.executeOnLoadForPrefetchedContent=function(e){var t=p[e.cid];var n=e.getDvar("prefetchedContentRootCid");f=n;console.log("setting action view showing");if(l){return}l=true;if(t.length>0&&n){e.setDvar("prefetchedContentRootCid",undefined);try{i.onLoad(t,false)}catch(s){o.report(s)}p[e.cid]=[];e.setDvar("prefetchedContentRootCid",n)}else{var r=h[n];if(r){c(r)}}}});define("shared/siteuri",["shared/polyfills","settings","shared/Class"],function y(require,exports,e){var t=require("settings");function i(e){this.message=this.errorType+": "+e}i.prototype=new Error;i.prototype.errorType="SiteURIError";i.prototype.constructor="SiteURIError";exports.SiteURIError=i;
var n=function(e,i){var n;if(i){n="quora.com"}else{n=t.subdomain_suffix||"quora.com"}if(e){return e+"."+n}else{return"www."+n}};exports.netlocForSubdomainName=n;var s=function(e,t){return"http://"+n(e,t)+"/"};exports.baseUrlForSubdomainName=s;var o=/https?:\/\/(?:([^.\/]+)\.)?((?:[^.\/]+\.)*quora\.com(?::[0-9]*)?)(\/.*)?/;function r(e){if(e.substring(0,5)=="http:"){return"https:"+e.substring(5)}else{return e}}function a(e){var t=e.match(o);if(!t){return false}var i=t[1],s=t[2],r=n();if("www."+s!=r){if(i!="www"&&i&&"www."+i+"."+s==r){var a=e.replace("://","://www.").match(o);if(a){return a}}return false}return t}var d=function(e){return a(e)!==false};exports.isSiteAbsoluteUrl=d;var l=function(e){return e[0]=="/"};exports.isSiteRelativeUrl=l;var c=function(e){return d(e)||l(e)};exports.isSiteUrl=c;var u=function(e,t){return new h(e,t)};exports.URI=u;var h=require("shared/Class").Class.extend({__init__:function(e,n){if(e instanceof h){e=e.unicode()}var s=a(e),o=n&&n.subdomainName||null,r=n&&n.secure||false,d;
if(s){if(o){throw new i("subdomain context should not be set for absolute url, url = "+e+", subdomain = "+o)}o=s[1];if(o=="www"){o=null}d=s[3]||"";if(d===""){d="/"}if(e.substring(0,5)=="https"){r=true}}else{d=e}if(d[0]!="/"){throw new i("invalid site uri input "+e)}this.relativeUrl=d;this.subdomainName=o;if(!this.subdomainName){this.subdomainName=t.subdomain_of_network}this.isSecure=r;return this},unicode:function(e){if(t.force_use_absolute_links){return this.absolute(e)}var i=this.relativeUrl;if(this.subdomainName||t.subdomain_name){i=s(this.subdomainName,e)+i.substring(1);if(i.charAt(i.length-1)=="/"){i=i.substring(0,i.length-1)}}if(this.isSecure){i=r(i)}return i},absolute:function(e){var t=s(this.subdomainName,e),i=t+this.relativeUrl.substring(1);if(this.isSecure){i=r(i)}return i},secure:function(e){return r(this.absolute(e))}});exports.SiteURI=h});define("video",["shared/polyfills","interface/jquery"],function C(require,exports,e){var t=require("interface/jquery")._jQuery;exports.handleVideosBeforeSelectionHidden=function(e){
e.find(".qtext_embed").each(function(i,n){if(e.find("iframe")){t(n).parent().empty()}})};exports.stopAllVideos=function(e){e.find(".qtext_embed").each(function(e,i){t(i).find("iframe").each(function(e,i){var n=t(i).attr("src");if(n&&n.indexOf("autoplay=1")!==-1){n=n.replace("autoplay=1","autoplay=0")}t(i).attr("src",n)})})}});define("shared/qlocal_storage",["shared/polyfills","interface/settings","shared/client"],function x(require,exports,e){var t=require("interface/settings").pageIsMobile,i=require("shared/client"),n=null;if(t){n=require("mobile_app2/qlocalstorage")}function s(){try{if(window.localStorage){return true}}catch(e){return false}return false}exports.storageAvailable=function(){if(s()){return true}else if(n&&i.isNativeApp()){return true}return false};exports.setItem=function(e,t){if(s()){try{window.localStorage.setItem(e,t)}catch(o){if(o.name==="NS_ERROR_FILE_CORRUPTED"){return}throw o}}else if(n&&i.isNativeApp()){n.setItem(e,t)}};exports.getItem=function(e,t){if(s()){var o=window.localStorage.getItem(e);
t(o)}else if(n&&i.isNativeApp()){n.getItem(e,function(e){if(e.success){t(e.value)}})}}});define("shared/window_manager",["shared/polyfills","interface/jquery","shared/util"],function k(require,exports,e){var $=require("interface/jquery")._jQuery,t=require("shared/util");exports.catchRedirectCallback=null;var i=function(e){return/https?:\/\/[a-z.0-9_\.\-]*quora\.com/i.test(e)};var n=exports.getDomain=function(){return window.location.protocol+"//"+window.location.host+"/"};exports.getPathName=function(){return decodeURI(window.location.pathname)};var s=exports.getURL=function(){return decodeURI(window.location.href)};var o=exports.getHash=function(){return window.location.hash};var r=exports.replaceURL=function(e){if(window.history&&window.history.replaceState){window.history.replaceState(window.history.state,null,e)}};exports.isInHash=function(e){var t=o();if(t.substr(0,1)=="#"){t=t.replace("%23","-");var i=t.substring(1).split("-");for(var n=0;n<i.length;n++){if(i[n]==e){return true}}}
return false};var a=function(e){var t={};var i=e.split("&");for(var n in i){var s=i[n];var o=s.split("=");t[o[0]]=decodeURIComponent(o[1])}return t};exports.parseURLParamsMulti=function(e){if(!e){e=window.location.search.substring(1)}var t={};var i=e.split("&");for(var n in i){var s=i[n];var o=s.split("=");if(o[0].length>0){if(!(o[0]in t)){t[o[0]]=[]}t[o[0]].push(decodeURIComponent(o[1]))}}return t};var d=exports.parseURLParams=function(e){if(!e){e=window.location.search.substring(1)}if(e.length===0){return{}}return a(e)};exports.parseParams=function(e){var t={};if(e){var i=e.split("?");if(i.length==2){t=a(i[1])}}return t};exports.isParamInURL=function(e,t){return e in d(t)};exports.addParamToURL=function(e,t,i){var n=encodeURIComponent(t)+"="+encodeURIComponent(i);if(e.indexOf("?")==-1){n="?"+n}else{n="&"+n}var s=e.indexOf("#");if(s==-1){return e+n}else{return e.substring(0,s)+n+e.substring(s)}};exports.getURLParam=function(e){return d()[e]};var l=function(e,t,i,n,s){var o=[];if(i){for(var r in i){
if(i.hasOwnProperty(r)&&i[r]!==null){if(s===true&&$.isArray(i[r])){for(var a=0;a<i[r].length;a++){o.push(r+"="+encodeURIComponent(i[r][a]))}}else{o.push(r+"="+encodeURIComponent(i[r]))}}}}var d=o.join("&");var l=e+t;if(d.length>0){l+="?"+d}l+=n;return l};var c=exports.makeURL=function(e,t,i,n){return l(e,t,i,n,false)};var u=exports.makeURLMultiParams=function(e,t,i,n){return l(e,t,i,n,true)};var h=exports.makeUpdatedURL=function(e){return c(window.location.origin,window.location.pathname,t.extend(d(),e),window.location.hash)};exports.updateURLParams=function(e){var t=h(e);r(t);return t};exports.replaceURLParamsMulti=function(e){var t=u(window.location.origin,window.location.pathname,e,window.location.hash);r(t);return t};exports.removeURLParam=function(e){var t=d();t[e]=null;return exports.updateURLParams(t)};exports.getTitle=function(){return document.title};exports.setTitle=function(e){document.title=e};exports.reload=function(){window.location.reload()};var f=false;exports.isPendingNavigation=function(){
return f};var p=function(e){return e.indexOf("quora://")!==-1};exports.handleClick=function(e,t){if(t.which==2||t.metaKey){window.open(e)}else{m(e)}};exports.sameDomainURL=function(e){return e&&(e.charAt(0)=="/"||new RegExp("^https?://"+window.location.hostname+"/","i").test(n(e)))};var g=function(e){var t=document.createElement("div");t.innerHTML="<a></a>";t.firstChild.href=e;t.innerHTML=t.innerHTML;return t.firstChild.href};var m=exports.navigateTo=function(e){if(e===""||e==="#"){return}if(e==s()+"#"){return}e=g(e);if(!i(e)&&!p(e)){window.open(e)}else{var t=true;if(exports.catchRedirectCallback){t=exports.catchRedirectCallback(e)}if(t){f=true;window.location=e}}};exports.openCenteredPopupWindow=function(e,t,i){var n=window.screenX+window.innerWidth/2-t/2;var s=window.screenY+window.innerHeight/2-i/2;window.open(e,"_blank","width="+t+",height="+i+",left="+n+",top="+s)};exports.headerOffset=45;exports.actionBarHeight=52;exports.scrollContext=60;exports.scrollAndFocus=function(e,t){e-=exports.headerOffset;
e=Math.max(0,Math.min($(document).height()-$(window).height(),e));var i=Math.min(500,Math.abs(e-$(document).scrollTop())*.5),n=false;$("html,body").animate({scrollTop:e},i,"swing",function(){if(!n&&$(t).length){var e=window.scrollX,i=window.scrollY;$(t).focus();window.scrollTo(e,i);n=true}})};exports.scrollIntoView=function(e){var t=$(e).offset().top,i=t-$(document).scrollTop();if(i<exports.headerOffset||i>$(window).height()){exports.scrollAndFocus(t)}}});define("w2.dialog",["shared/polyfills","shared/core/component","interface/jquery","shared/Class","settings"],function S(require,exports,e){var t=require("shared/core/component"),$=require("interface/jquery")._jQuery,i=require("shared/Class").Class,n=require("settings").interface_strings;var s=exports.Dialog=i.extend({__init__:function(e,t){if(this.opener){this.opener(e)}s._dialogCounter+=1;this._dialogId=s._dialogCounter;this._dialogOuter="#__w2_dialog_outer_"+this._dialogId;this._dialogContainerId="#__w2_dialog_container_"+this._dialogId;
this._cid="*dialog*_"+this._dialogId;s._instance=this;this._title=null;this._buttons=[];this._ok=null;this._cancel=null;this.opts=$.extend({closeOnEscape:true,closeOnClickOut:false,sortButtons:true,focusOK:false,dialogClass:"",verticalOffset:150,showXButton:false,hideDialog:false},t);this._opened=false;this._containsComponent=false;this._content=null;if(this.opts.html){this._content=this.opts.html}},opt:function(e,t){this.opts[e]=t;return this},ok:function(e,t){if(typeof e=="string"){t=e;e=null}this._ok=e;if(t!==false){this.addButton(new r(this,t,null))}return this},cancel:function(e,t,i){if(typeof e=="string"){t=e;e=null}this._cancel=e;if(t!==false){if(i){this.addButton(new d(this,t,null))}else{this.addButton(new a(this,t,null))}}return this},button:function(e,t,i){return this.addButton(new o(this,t,e,i))},title:function(e){if(this._opened){throw new Error("Can't set the title for a dialog once it has been opened.")}this._title=e;return this},setTitle:function(e){if(e){$("#__w2_dialog_title_"+this._dialogId).text(e);
}},addButton:function(e){if(this._opened){throw new Error("Can't add a button to a dialog once it has been opened")}this._buttons.push(e);return this},opener:function(e){this._opener=e;return this},open_:function(){if(this._opened){return this}this._createDOMElements();var e=t._safeGetComponentByCID(this._cid);t._components[this._cid]=e;var i={};i[this._cid]="*ROOT*";t.addParents(i);var n=function(e){if(this.opts.closeOnEscape){if(e.keyCode==27){this.cancel_();e.stopPropagation()}}};$(document).bind("keydown.__w2_dialog_"+this._dialogId,n.bind(this));if(this.opts.closeOnClickOut){var s=this._dialogOuter;$(document).on("click",s,function(e){e.stopPropagation()});var o=function(e){this.cancel_();e.stopPropagation()};$(document).on("click",":not("+s+","+s+" *)",o.bind(this))}this._opened=true;if(typeof this._open=="function"){this._open.apply(this,arguments)}return this},cancel_:function(e){var t=true;if(typeof this._cancel=="function"){if(this._cancel(this._callbackArg(e))===false){t=false;
}}if(t){this.close_()}},_callbackArg:function(e){var i=t._safeGetComponentByCID(this._cid);var n={dialog:this,dialogWrapper:i,button:e};if(this._containsComponent){n.dialogComponent=i.child("__dialog__")}return n},ok_:function(e){var t=true;if(typeof this._ok=="function"){if(this._ok(this._callbackArg(e))===false){t=false}}if(t){this.close_()}return t},close_:function(){if(!this._opened){return this}$(document).unbind(".__w2_dialog_"+this._dialogId);$(this._dialogOuter).forgetContents();t.unloadComponent(this._cid);$(this._dialogOuter).remove();this._opened=false;if(typeof this._close=="function"){this._close.apply(this,arguments)}var e=this._dialogOuter;$(document).off("click",e);$(document).off("click",":not("+e+","+e+" *)");return this},open:function(e){this._open=e;return this},close:function(e){this._close=e;return this},html:function(e){this._content=e;return this.open_()},text:function(e){return this.html(e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"))},_createDOMElements:function(){
var e=this.opts.width||470;var t="dialog";if(this.opts.hideDialog){t=""}var i,n=$("<div />").attr("id","__w2_dialog_outer_"+this._dialogId).addClass(t).addClass("w4").addClass(this.opts.dialogClass);if(this._title){i=$("<div />").addClass("dialog_wrapper").append($("<h2 />").attr("id","__w2_dialog_title_"+this._dialogId).addClass("dialog_header").addClass("dialog_frame").text(this._title));if(this._content){i.append($("<div />").addClass("dialog_frame").addClass("dialog_contents").addClass("dialog_body").html(this._content))}}else{i=$("<div />").addClass("dialog_component").addClass("dialog_wrapper").addClass("dialog_body").html(this._content)}if(this.opts.showXButton){i.append($("<a />").attr("href","#").addClass("remove").click(this.cancel_.bind(this)).click(function(){return false}))}if(this._buttons.length){i.append($("<div />").addClass("dialog_frame").addClass("dialog_buttons").append(this._buttonsDOM()))}var s=$(window).width(),o=$(window).scrollTop(),r=e,a=s-r,d=a/2;o=this.opts.verticalOffset;
if($(window).height()<600){o=$(window).scrollTop();i.css("position","static")}i.css("width",e-10+"px");n.append(i).css("top",o+"px").css("left",this.opts.left||d-15+"px").css("width",e+10+"px").appendTo($(document.body));if(this.opts.focusOK){for(var l=this._buttons.length-1;l;l--){var c=this._buttons[l];if(c._type=="submit"){$("#__w2_dialog_button_"+this._dialogId+"_"+l).focus();break}}}return},checkDialogPosition:function(){var e=$(this._dialogOuter);var t=e.offset().top;var i=t+e.outerHeight(true);var n=$(window);var s=n.scrollTop()+n.height();if(i>s){var o=this.opts.verticalOffset;var r=n.scrollTop()+o+e.outerHeight(true);if(r>s){o=10}e.css("top",o+"px")}this._checkContentOverflow()},_checkContentOverflow:function(){var e=this;var t=$(window);var i=t.scrollTop()+t.height();var n=$(e._dialogContainerId);var s=n.offset().top;var o=n.outerHeight(true);var r=s+o;if(r>i){var a=r-i;var d=o-a;n.css({"overflow-y":"scroll",height:d})}},_buttonDOM:function(e,t){e._index=t;var i=$("<a />").addClass("dialog_button").text(e._text).click(e.click_.bind(e)).click(function(){
return false}).attr("href","#").attr("id","__w2_dialog_button_"+this._dialogId+"_"+t);switch(e._type){case"submit":i.addClass("submit_button");break;case"link":case"cancel":i.addClass("cancel");break;default:i.addClass("action_button");break}return i},_buttonsDOM:function(){var e=$("<div />");if(this.opts.sortButtons){this._buttons.sort(function(e,t){return e._priority-t._priority})}for(var t=this._buttons.length-1;t>=0;t--){var i=this._buttons[t];e.append(this._buttonDOM(i,t))}return e.addClass("dialog_buttons_contents")},_loadingHTML:function(){return'<div id="__w2_dialog_container_'+this._dialogId+'"></div>'},load:function(e,i){i=$.extend({args:[],kwargs:{},showImmediately:true,showOnLoad:true},i);this._content=this._loadingHTML();this.open_();var n=function(){this._opener.__dialog__=this;var e=t._safeGetComponentByCID(this._cid);e.__opener__=this._opener;e.__dialog__=this;e.setDvar("__dialog__",this._cid);t._children[this._cid].__dialog__=t._allChildren[this._cid][0];this._containsComponent=true;
this.checkDialogPosition()};var s=this._opener.serverCall(e);s.args.apply(s,this.opts.args).kwargs(i.kwargs).success(n.bind(this)).contentFor($(this._dialogContainerId),{parentCid:this._cid});if(this.opts.error){s.error.apply(this,this.opts.error)}if(this.opts.except){s.except.apply(this,this.opts.except)}s.send();return this}});s.openerFor=function(e){var i=e.getDvar("__dialog__");var n=t._safeGetComponentByCID(i);return n&&n.__opener__};s.dialogFor=function(e){var i=e.getDvar("__dialog__");var n=t._safeGetComponentByCID(i);return n&&n.__dialog__};if(!s._dialogCounter){s._dialogCounter=0}if(!s._instance){s._instance=null}var o=exports.Button=i.extend({__init__:function(e,t,i,n){this._dialog=e;this._text=t;this._callback=i;this._opts=n||{};this._priority=50;this._type="action"},text:function(e){this._text=e},callback:function(e){this._callback=e},click_:function(){var e=true;if(typeof this._callback=="function"){if(this._callback.call(this._dialog,this._dialog._callbackArg(this))===false){
e=false}}if(e){this._dialog.close_()}}});var r=o.extend({__init__:function(e,t,i,n){var s=this;n=$.extend({style:"ok_button"},n);this._super(e,t||"OK",function(){var e=true;if(typeof i=="function"){if(i.call(s,s._dialog._callbackArg(s))===false){e=false}}if(e){return s._dialog.ok_.call(s._dialog,s)}else{return e}},n);this._priority=75;this._type="submit"}});var a=o.extend({__init__:function(e,t,i,s){var o=this;s=$.extend({style:"cancel_button"},s);this._super(e,t||n.cancel,function(){var e=true;if(typeof i=="function"){if(i.call(o,o._dialog._callbackArg(o))===false){e=false}}if(e){o._dialog.cancel_.call(o._dialog,o)}},s);this._priority=25;this._type="link"}});var d=a.extend({__init__:function(e,t,i,n){this._super(e,t,i,n);this._type="action"}})});define("webnode2",["shared/polyfills","interface/jquery","shared/log","shared/errors","settings","shared/w2.context","shared/core/component","w2.rpc","w2.dialog","w2.modal"],function webnode2(require,exports,module){var $=require("interface/jquery")._jQuery,log=require("shared/log").log,errors=require("shared/errors"),settings=require("settings"),context=require("shared/w2.context"),coreComponent=require("shared/core/component"),_ServerCall=require("w2.rpc")._ServerCall,DialogBase=require("w2.dialog").Dialog,Dialog=DialogBase.extend(),Modal=require("w2.modal").ModalWithCallBacks;
var _liveDepInfo=exports._liveDepInfo={};exports._ignoreDomids={};exports._ignoreCids={};var _GROUP_RE=/%([0-9a-zA-Z_]+)/;exports.addLiveDepInfo=function(e){var t=Object.keys(e);var i=t.length;for(var n=0;n<i;++n){var s=t[n];_liveDepInfo[s]=e[s]}};exports.interactionMode=null;exports.windowId=null;exports.Error=null;var Component=exports.Component=coreComponent.Component.extend({$id:function(e){if(e[0]!="@"){throw new Error("Expect id to begin with @. Got: "+e)}e=e.replace(/@/g,this._my());return $("#"+e)},$:function(e){var t=this._my();if(typeof e==="string"){e=e.replace(/@/g,t);while(e.indexOf("%")!=-1){var i=_GROUP_RE.exec(e);if(i){var n=coreComponent._groups[i[1]];if(typeof n==="undefined"){return $([])}e=e.replace(i[0],"#"+n.join(",#"))}}}return $(e)},onInsertNode:function(e,t){return true},onDeleteNode:function(e,t){return true},onUpdate:function(e){return true},serverCall:function(e){var t=coreComponent.parseVcon(this);if(t){if(log.enabled){log.trace("webnode2.Component.serverCall",e,t);
}return new _ServerCall(t,e,this)}throw new coreComponent.ComponentError("No vcon info for Component <cid="+this.cid+">")},dialog:function(e){return new Dialog(this,e)},modal:function(e,t){var i=new Modal(this,t||{});i.load(e);return i}});var VirtualComponent=exports.VirtualComponent=Component.extend({__init__:function(e){this._super(e,null,{},{});this.isVirtual=true;context.initComponent(this)}});exports.makeVirtualComponent=function(e){return new VirtualComponent(e)};var setContentHTML=exports.setContentHTML=function(e,t){e.innerHTML=t.html;return e};var setContentJS=exports.setContentJS=function(node,content){eval(content.js);return node};exports.setContent=function(e,t){setContentHTML(e,t);setContentJS(e,t);return e};exports.assertUnloaded=function(e){if(e in coreComponent._unloaded){return}errors.logJsError("webnode2","Cid was not unloaded: "+e)};exports.fallbackToPostReloadMode=function(){settings.pageMode="post_reload"}});define("ajax",["shared/polyfills","jquery","shared/util","shared/Class"],function E(require,exports,e){
var $=require("jquery"),t=require("shared/util"),i=require("shared/Class").Class;var n=["async","beforeComplete","beforeError","beforeSend","beforeSuccess","cache","complete","contentType","data","dataFilter","dataType","error","global","ifModified","jsonp","password","processData","scriptCharset","success","timeout","type","url","username","xhr"];var s=function(){var e={__init__:function(e){this.__options={data:null};this.options(e);return this},options:function(e){var t=Object.keys(e||{});for(var i=0;i<t.length;i++){this[t[i]](e[t[i]])}return this},_options:function(){var e={};for(var t=0;t<n.length;t++){e[n[t]]=this["_"+n[t]]()}return e}};n.forEach(function(t){e[t]=function(e){this.__options[t]=e;return this};e["_"+t]=function(){return this.__options[t]}});return e};var o=exports.Ajax=i.extend(t.extend(s(),{send:function(e){return this._send(e)},_send:function(e){this.options(e);var t=this._options();var i=t.complete;var n=t.error;var s=t.success;t.complete=function(){try{if(t.beforeComplete){
t.beforeComplete.apply(this,arguments)}}finally{if(i){i.apply(this,arguments)}}};t.error=function(){try{if(t.beforeError){t.beforeError.apply(this,arguments)}}finally{if(n){n.apply(this,arguments)}}};t.success=function(){try{if(t.beforeSuccess){t.beforeSuccess.apply(this,arguments)}}finally{if(s){s.apply(this,arguments)}}};return $.ajax(t)}}));exports.create=function(e){return new o(e)}});define("w2.errors",["shared/polyfills","shared/log","webnode2","jquery","settings"],function T(require,exports,e){var t=2e3;var i=50;var n=require("shared/log").log,s=require("webnode2"),$=require("jquery"),o=require("settings"),r=0,a=0;function d(e,t,s,r,a){var d=e.status===0;if(d){setTimeout(function(){if(!u()){var e=o.interface_strings.connection_problem;l(e+" ")}},1e3);return}if(n.enabled){n("w2.errors.reportAjaxError","Error:",e.status,s,", XHR: ",e)}if(a!==undefined){var c=(new Date).getTime()-a;if(c>i){r=false}}if(r){l()}}function l(e){if(!s.Error){return}s.Error.show(e)}function c(e){r++;setTimeout(function(){
r--},e)}function u(){return r!==0}function h(e){a++;setTimeout(function(){a--},e)}function f(){return a!==0}$(window).on("unload.w2errors beforeunload.w2errors",function(){if(n.enabled){n("w2.errors.unload","window.beforeunload event is raised.")}c(t)});$(document).on("mouseup.w2errors mousedown.w2errors keyup.w2errors "+"keydown.w2errors keypress.w2errors",function(){h(i)});exports.reportAjaxError=d;exports.showError=l;exports.canBeRelatedToUserAction=f;exports.canBeRelatedToPageUnload=u;exports.beginCanBeRelatedToUserActionBlock=h});define("shared/perf",["shared/polyfills","shared/logging"],function L(require,exports,e){var t={},i=5e3,n=3e4;var s=function(e){delete e.id;require("shared/logging").log("perf/post_e2e",e)};var o=function(e){if(!e){throw new Error("This method expects an object describing the action.")}var i=e.method;if(i.startsWith("log_")||i.startsWith("record_")||i.startsWith("track_")){return null}e.startTime=Date.now();if(!e.id){var n=e.startTime*1e3+Math.floor(Math.random()*1e3);
e.id=n.toString(36)}t[e.id]=e;return e};var r=function(e){var i=t[e];if(!i){return}i.duration=Date.now()-i.startTime;delete i.startTime;delete t[e];s(i)};exports.startPOST=function(e){e.type="web";return o(e)};exports.startUserPerceived=function(e){e.type="user_perceived";return o(e)};exports.finishAction=function(e){if(e&&e.id){r(e.id)}};exports.cancelAction=function(e){if(e&&e.id){delete t[e.id]}};var a=function(){var e=Date.now();var i=Object.keys(t);for(var s=0;s<i.length;s++){var o=t[i[s]];if(e-o.startTime>=n){o.timeout=true;r(o.id)}}};setInterval(a,i)});define("shared/viewport",["shared/polyfills","interface/settings","interface/jquery"],function M(require,exports,e){var t=require("interface/settings").pageIsMobile,$=require("interface/jquery")._jQuery;var i=function(e){var t=e.getBoundingClientRect();var i=t.bottom==0&&t.right==0&&t.top==0&&t.left==0;return i};var n=function(e){if(i(e)){return false}var t=e.offsetTop;if(e.offsetParent){t+=e.offsetParent.offsetTop;if(e.offsetParent.offsetParent){
t+=e.offsetParent.offsetParent.offsetTop}}var n=window.innerHeight;var s=window.pageYOffset>=t+e.offsetHeight;var o=window.pageYOffset+n<=t;return!s&&!o};var s=function(e){if(i(e)){return false}var t=e.getBoundingClientRect();return t.bottom>=0&&t.right>=0&&t.top<=(window.innerHeight||document.documentElement.clientHeight)&&t.left<=(window.innerWidth||document.documentElement.clientWidth)};exports.isElementInViewport=function(e){if(!e){return false}if(t){return n(e)}else{return s(e)}};var o=null;exports.siteHeaderHeight=function(){if(o===null){o=$(".SiteHeader").height()}return o};exports.setPageScroll=function(e){var t=$("body"),i=$(".SiteHeader"),n=$.getScrollbarWidth();if(e){t.removeClass("modal_prevent_scroll");t.css("padding-right",0);i.css("padding-right",0)}else{t.addClass("modal_prevent_scroll");t.css("padding-right",n+"px");i.css("padding-right",n+"px")}}});define("tchannel_up",["shared/polyfills","interface/jquery","w2.livenode","gating"],function D(require,exports,e){var $=require("interface/jquery")._jQuery,t=require("w2.livenode"),i=require("gating").cchannel_websockets;
function n(e){new Function(e).call(window)}var s=false;exports.stop=function(){s=true};exports.start=function(e,o,r,a,d){var l=500,c=true,u,h=false,f=2e3,p=0;var g;if(!d){var m=".tch.";var v=i?"/ws_updates?":"/updates?";var _;if(i){_=window.location.protocol==="https:"?"wss:":"ws:"}else{_=window.location.protocol}var w="tch"+(Math.floor(Math.random()*1e6)+1)+m+a;g=_+"//"+w+"/up/"+r+v}else{g=window.location.protocol+"//"+d}function b(){return(+new Date).toString(16)+Math.random().toString(16).split(".").pop()}function y(e){var t=document.createElement("script"),i=e.callback="jsonp"+b(),n=r(S),s=setTimeout(n,7e4),o=document.body;function r(e,n){return function(o){if(n){window[i]=null;try{delete window[i]}catch(r){}}if(s!==-1){clearTimeout(s);s=-1;e(o);if(t.parentNode){t.parentNode.removeChild(t)}}}}window[i]=r(k,true);t.charset="utf-8";t.src=g+$.param(e);if(t.addEventListener){t.addEventListener("load",n,false);t.addEventListener("error",n,false)}else if(t.attachEvent){t.attachEvent("onreadystatechange",function a(){
if(/loaded|complete/.test(t.readyState)){n()}t.detachEvent("onreadystatechange",a)})}o.insertBefore(t,o.firstChild)}function C(t){clearTimeout(u);var n={min_seq:e,channel:o};if(f>0){n.timeout=f}u=setTimeout(function(){if(i){x(n)}else{y(n)}},t||10)}function x(e){var t=new window.WebSocket(g+$.param(e));t.onmessage=function(e){k(JSON.parse(e.data))};t.onclose=S}function k(e){if(!c){t.reportPageRegainedConnection();c=true}try{T(e)}catch(n){t.reportPageNeedsReload("tchannel_error");return}l=500;if(!i){C()}}function S(e){if(h){return}l=Math.min(l*2,30*1e3);if(l>=10*1e3){if(c){t.reportPageLostConnection();c=false}}C(l)}var E=function(){var e={},t=e;function i(){if(s){return}var t=e.next;if(t){if(window.log&&window.log.enabled){window.log("tchannel_up.enqueue","Evaluating:",t.js)}n(t.js);delete e.next;delete t.js;e=t}return t}function o(){setTimeout(function(){var e=+new Date;while(i()){if(new Date-e>100){return o()}}},10)}return function(i){t=t.next={js:i};if(e.next===t){o()}}}();function T(t){
if(window.log&&window.log.enabled){window.log("tchannel_up.newMessages","Response:",t)}if(t.error){throw t.error}var i=t.messages;if(!i){return}e=t.min_seq;for(var n=0;n<i.length;++n){E(i[n])}}$(window).bind("beforeunload",function(){h=true});$(window).bind("load",function(){setTimeout(function(){f=0},p);C(20)})}});define("fx",["shared/polyfills","jquery","shared/util"],function A(require,exports,e){var $=require("jquery"),t=require("shared/util");var i={duration:400,easing:""};var n=function(e,t){var i=false;e.one("webkitTransitionEnd transitionEnd",function(){i=true});var n=function(){if(!i){e.trigger("transitionEnd")}};setTimeout(n,t)};var s=function(e){e.each(function(){var e=this.offsetHeight})};var o=function(e,s,o){o=t.extend({},i,o);var r="all "+o.duration+"ms "+o.easing;s.webkitTransition=r;s.mozTransition=r;s.transition=r;var a=t.once(function(){e.dequeue();if(o.complete){o.complete.apply(e)}});e.queue(function(){e.one("webkitTransitionEnd transitionEnd",a);n(e);e.css(s)})};var r=exports.animate=function(e,t,n,r){
e=$(e);e.css(t);s(e);o(e,n,{duration:r||i.duration})};exports.highlight=function(e,t){r(e,{backgroundColor:"#ffff99"},{backgroundColor:"transparent"},t)};exports.fadeIn=function(e,t){r(e,{opacity:0},{opacity:1},t)}});define("w2.livenode",["shared/polyfills","jquery","ajax","webnode2","shared/events/index","shared/core/component","shared/log","shared/logging","shared/browser","settings","shared/errors","shared/viewport","tchannel_up","fx"],function I(require,exports,e){if(!window.console){window.console={}}if(!window.console.log){window.console.log=function(){}}var $=require("jquery"),t=require("ajax"),i=require("webnode2"),n=require("shared/events/index"),s=require("shared/core/component"),o=require("shared/log").log,r=require("shared/logging"),a=require("shared/browser"),d=require("settings"),l=require("shared/errors"),c=require("shared/viewport"),u=require("tchannel_up"),h=require("fx"),f=d.interface_strings;var p=null,g={interactionDelayedLivedepOperations:[],pendingMutationCount:0,optimisticUpdateMutationCount:0,
currentVersion:0,requiredVersion:0},m=1e3,v=false;function _(e){var t={},i;$("#"+e+" [w2cid]").each(function(e,n){i=n.getAttribute("w2cid");t[i]=n});return t}function w(e){var t={};$.each(e,function(e,i){if(i.domid in t){return}var n=_(i.domid);t[i.domid]=n});return t}function b(e){var t=i.interactionMode._changedComponents[e];return t&&t!=i.interactionMode._states.OFF}function y(e,t,n){var s=w(e);try{$.each(e,function(e,i){var n=s[i.domid];if(i.type=="update_data"||i.type=="insert_node"){return}$.each(n,function(e,s){if(b(e)){if(t){console.log("forcing override on live update conflict with cid="+e+" on optype = "+i.type)}else{console.log("throwing blocking_interaction_mode cid="+e+" on optype = "+i.type);console.log("affected node:");console.log(n[e]);throw new Error("blocking_interaction_mode")}}})})}catch(o){if(o.message=="blocking_interaction_mode"){console.log("Calling startBlocking from checkForConflicts");i.interactionMode.startBlocking();g.interactionDelayedLivedepOperations.push({
data:e,textStatus:n});return false}else{throw o}}return true}var C=function(e,t,n){n=n||false;if(e=="error"){console.log("LiveNode error");I("livenode_data_error");return}if(!i.interactionMode||i.interactionMode.isBlocking()){g.interactionDelayedLivedepOperations.push({data:e,textStatus:t});return false}if(!y(e,n,t)){return false}var r=!a.msie&&$(window).scrollTop()>0;if(r){$("div.feed_item_inner").each(function(){if(c.isElementInViewport(this)){$(this).anchor()}})}$.each(e,function(e,t){var n,a,d;if(window.log&&o.enabled){o("w2.livenode.onLivedepOperations","Applying",t)}$(document).trigger("livenode_op_start",t);switch(t.type){case"set_node":if(t.domid in i._ignoreDomids){break}var c=$("#"+t.domid);if(!c.length){I("set_node_missing",{hmac:s._hmacs[t.cid],op_domid:t.domid,op_cid:t.cid});return}var u=t.transition;d=s.getComponentFromElement(c.get(0));if(d&&d.force_transition){u=d.force_transition}if(!("cid"in t)){l.logJsError("w2.livenode","Expected cid in op got: "+JSON.stringify(t));return;
}s.unloadComponent(t.cid);c.setContent(t.content);switch(u.type){case"none":break;case"fade_in":h.fadeIn(c,2e3);break;default:break}break;case"insert_node":if(t.domid in i._ignoreDomids){break}n=document.getElementById(t.domid);if(!n){I("insert_node_missing",{parent_hmac:s._hmacs[t.parent_cid],op_domid:t.domid,op_parent_cid:t.parent_cid});return}var f=document.createElement("DIV");i.setContentHTML(f,t.content);if(f.childNodes.length!=1){console.log("error: append must give a single node");I("invalid_append");return}var p=f.childNodes[0];var g=p.id;p.style.display="none";if(n.childNodes.length==t.position){n.appendChild(p)}else{n.insertBefore(p,n.childNodes[t.position])}i.setContentJS(p,t.content);a=s._components[t.parent_cid];if(a&&a.onInsertNode){a.onInsertNode(t,g)}if(t.transition.type=="none"){break}else if(t.transition.type=="scroll"){p.style.display="";p.scrollIntoView(false);break}if(r||t.transition.type=="fade_in"){$("#"+g).fadeIn(500);break}p.style.display="none";$("#"+g).fadeIn(1e3);
break;case"delete_node":if(t.domid in i._ignoreDomids){break}n=document.getElementById(t.domid);if(!n){I("delete_node_missing",{op_domid:t.domid,op_parent_cid:t.parent_cid});return}if(!s._parents[t.parent_cid]){I("delete_node_missing_component",{op_parent_cid:t.parent_cid});return}var m=n.childNodes[t.position];if(m.id!=t.child_domid){I("delete_node_wrong_child",{parent_hmac:s._hmacs[t.parent_cid],node_id:m.id,op_child_domid:t.child_domid});return}a=s._components[t.parent_cid];if(a&&a.onDeleteNode){a.onDeleteNode(t,m.id)}s.unloadComponent(t.child_cid);$("#"+m.id).remove();break;case"update_data":if(t.cid in i._ignoreCids){break}if(!s._parents[t.cid]){I("update_data_missing_component",{op_cid:t.cid,op_parent_cid:t.parent_cid});return}d=s._components[t.cid];if(d&&d.onUpdate){d.onUpdate(t.data)}break;case"error":console.log("livedep error: "+t.error);I("livenode_error",{op_error:t.error});return;default:I("invalid_op_type",{op_type:t.type})}});$(document).trigger("livenode_finish_operations");
};function x(e,t,i){if(m<32e3){p=setTimeout(k,m);m*=2}else{clearTimeout(p);p=null;I("failed_sync_livedeps")}}function k(){if(p){clearTimeout(p);p=null}var e=[window.location.protocol,"//",window.location.host,"/check_livedeps/index?window_id=",i.windowId,"&random=",Math.random()].join("");t.create().url(e).type("GET").error(x).send()}var S={};function E(e){i.interactionMode.resumeUpdates();var t=Math.random(),n={};n._lm_transaction_id=t;n._lm_window_id=i.windowId;if(e===undefined){S[t]=1}else{S[t]={optimisticUpdate:e}}M();return{transactionId:t,data:n}}function T(e,t){delete S[e];g.requiredVersion=Math.max(t,g.requiredVersion);M()}function L(e){g.currentVersion=e;A()}function M(){var e=0,t=0,i;for(i in S){t++;if(S[i].optimisticUpdate){e++}}g.pendingMutationCount=t;g.optimisticUpdateMutationCount=e;A()}function D(){u.stop()}function A(){if(window.log&&o.enabled){o("w2.livenode.checkLoadingStatus","Pending mutation count:",g.pendingMutationCount,", current version",g.currentVersion,", required version",g.requiredVersion);
}var e=g.pendingMutationCount>g.optimisticUpdateMutationCount;var t=g.currentVersion<g.requiredVersion;n.GlobalProxy.dispatch({type:n.Types.LIVENODE_LOADING_SPINNER,payload:{show:e||t}})}function I(e,t){t=t||{};console.log("Page requires reload "+t);if(!v){var n={error:"reportPageNeedsReload",uid:d.uid,window_id:i.windowId,url:window.location.href,error_type:e,debug_info:t};var s=e!=="lost_group";r.log("livenode_error",n,{scribeOnly:true,sendImmediately:s});v=true}if(!d.isLoggedIn){return}if(i.Error){i.Error.hide()}i.fallbackToPostReloadMode();i.interactionMode.$("#@message").html("<a href='javascript:window"+".location.reload();'>"+f.please_refresh+"</a>");console.log("Calling startBlocking from reportPageNeedsReload");i.interactionMode.startBlocking()}exports.reportPageRegainedConnection=function(){i.Error.hide()};exports.reportPageLostConnection=function(){i.Error.show(f.trying_to_regain)};exports.syncLivedeps=k;exports.startMutation=E;exports.onLivedepOperations=C;exports.reportPageNeedsReload=I;
exports.setCurrentVersion=L;exports.mutationDoneAfterVersion=T;exports.stopLiveUpdates=D;exports.state=g});define("shared/loading",["shared/polyfills","shared/loading","shared/util"],function q(require,exports,e){var t=require("shared/util");var i={size:"regular"};exports.createLoadingDotsElement=function(e){var n=t.extend(i,e);var s=document.createElement("div");s.className="LoadingDots "+n.size;var o=document.createElement("div");o.className="dot first";var r=document.createElement("div");r.className="dot second";var a=document.createElement("div");a.className="dot third";s.appendChild(o);s.appendChild(r);s.appendChild(a);return s}});define("shared/debounce",["shared/polyfills"],function N(require,exports,e){var t=function(e){var t=typeof e;return!!e&&(t=="object"||t=="function")};exports.debounce=function(e,i,n){var s,o,r,a,d,l,c,u=0,h=false,f=true;if(typeof e!="function"){throw new Error("Only able to debounce functions.")}i=i<0?0:+i||0;var p;if(n===true){p=true;f=false}else if(t(n)){
p=!!n.leading;h="maxWait"in n&&Math.max(+n.maxWait||0,i);f="trailing"in n?!!n.trailing:f}function g(){if(l){clearTimeout(l)}if(o){clearTimeout(o)}u=0;o=l=c=undefined}function m(){return Date.now()}function v(t,i){if(i){clearTimeout(i)}o=l=c=undefined;if(t){u=m();r=e.apply(d,s);if(!l&&!o){s=d=undefined}}}function _(){var e=i-(m()-a);if(e<=0||e>i){v(c,o)}else{l=setTimeout(_,e)}}function w(){v(f,l)}function b(){var t,n;s=arguments;a=m();d=this;c=f&&(l||!p);if(h===false){t=p&&!l}else{if(!o&&!p){u=a}var g=h-(a-u);n=g<=0||g>h;if(n){if(o){o=clearTimeout(o)}u=a;r=e.apply(d,s)}else if(!o){o=setTimeout(w,g)}}if(n&&l){l=clearTimeout(l)}else if(!l&&i!==h){l=setTimeout(_,i)}if(t){n=true;r=e.apply(d,s)}if(n&&!l&&!o){s=d=undefined}return r}b.cancel=g;return b};exports.throttle=function(e,i,n){var s=true,o=true;if(typeof e!="function"){throw new Error("Only able to throttle functions.")}if(t(n)){s="leading"in n?!!n.leading:s;o="trailing"in n?!!n.trailing:o}return exports.debounce(e,i,{leading:s,maxWait:i,
trailing:o})}});define("shared/rpc_manager",["shared/polyfills","interface/rpc","interface/settings","shared/errors","shared/debounce","shared/Class"],function O(require,exports,e){var t=require("interface/rpc"),i=require("interface/settings"),n=require("shared/errors"),s=require("shared/debounce").debounce;var o=require("shared/Class").Class.extend({__init__:function(){this._urlToBatchedUrl={};this._pendingRequests={};this._makeBatchRequests={};this._debounceWait=10;this._registerUrlToBatchedUrl(i.serverCallUrl,i.batchedServerCallUrl);this._registerUrlToBatchedUrl("/api/rerender_component_POST","/api/batched_rerender_component_POST")},_registerUrlToBatchedUrl:function(e,t){this._urlToBatchedUrl[e]=t;this._pendingRequests[e]=[];this._makeBatchRequests[e]=this._getBatchRequestFunction(e)},_shouldBatchRequest:function(e){return e._url()in this._urlToBatchedUrl},enqueue:function(e){if(!this._shouldBatchRequest(e)){return e.send()}this._pendingRequests[e._url()].push({request:e,data:this._getDataObject(e),
success:this._getSuccessCallback(e),error:this._getErrorCallback(e)});this._makeBatchRequests[e._url()]()},_getDataObject:function(e){var t=e._data();delete t.formkey;delete t.window_id;delete t.referring_controller;delete t.referring_action;return t},_getSuccessCallback:function(e){if(i.pageIsMobile){return function(t){t={success:true,response:{value:t}};e._callback.call(e,t)}}else{return function(t){e._success().call(e,{value:t})}}},_getErrorCallback:function(e){if(i.pageIsMobile){return function(t){t=t||{success:false,response:{}};e._callback.call(e,t)}}else{return function(t){e._error().call(e,t)}}},_getBatchRequestFunction:function(e){var i=this;return s(function(){var s=i._pendingRequests[e];i._pendingRequests[e]=[];if(s.length===1){s[0].request.send();return}var o=s.map(function(e){return e.data});var r=function(e){s.forEach(function(t){t.error(e)})};var a=function(e){s.forEach(function(t,i){try{t.success(e[i])}catch(s){n.report(s)}})};t.rpc(i._urlToBatchedUrl[e]).kwargs({requestsData:o
}).success(a).error(r).send()},i._debounceWait)}});var r=new o;exports.enqueueRequest=function(e){r.enqueue(e)}});define("actions",["shared/polyfills","shared/util","shared/log","shared/logging"],function R(require,exports,e){var t=require("shared/util"),i=require("shared/log").log,n=require("shared/logging"),R={},s=0,o=100,r=1e3*60*10;function a(){if(s>=o){d();s=0}}function d(){if(i.enabled){i("e2e.gc","GC started.")}var e=(new Date).getTime();var t=[];for(var n in R){var s=R[n];if(e-s.startTime>r){t.push(s);delete R[n]}}if(i.enabled){i("e2e.gc","Collected actions:",t)}}function l(e){if(!e.mustReport){return}delete e.mustReport;if(i.enabled){var t=e.endTime-e.startTime,s=e.serverTime/1e3;i("e2e.reportActionData","Metric:",t,"Server time:",s,"Details:",e)}n.log("action_data",{data:e})}exports.startAction=function(e){if(e===null||typeof e==="undefined"){throw new Error("This method expects an object describing the action.")}e.startTime=(new Date).getTime();e.id=(e.startTime*1e3+Math.floor(Math.random()*1e3)).toString(36);
R[e.id]=e;if(i.enabled){i("e2e.startAction",e)}s++;a();return e};exports.startOrUpdateAction=function(e,t){if(!e||!R[e]){return exports.startAction(t)}else{return exports.updateAction(e,t)}};exports.getAction=function(e){return R[e]};exports.updateAction=function(e,i){if(i===undefined){throw new Error("This method expects an object describing the update.")}var n=R[e];if(n===undefined){return null}return t.extend(n,i)};exports.finishAction=function(e,n){var s=R[e];if(s===undefined){return null}if(n){t.extend(s,n)}s.endTime=(new Date).getTime();delete R[e];if(i.enabled){i("e2e.finishAction",s)}l(s);return s}});define("w2.rpc",["shared/polyfills","webnode2","ajax","shared/core/rpc","shared/core/component","w2.errors","shared/errors","shared/events/index","shared/perf","settings","w2.livenode","shared/w2.timing","shared/loading","shared/util","gating","shared/rpc_manager","shared/window_manager","interface/jquery","jquery","actions"],function P(require,exports,e){var t=require("webnode2"),i=require("ajax"),n=require("shared/core/rpc"),s=require("shared/core/component"),o=require("w2.errors"),r=require("shared/errors"),a=require("shared/events/index"),d=require("shared/perf"),l=require("settings"),c=require("w2.livenode"),u=require("shared/w2.timing"),h=require("shared/loading"),f=require("shared/util"),p=require("gating"),g=require("shared/rpc_manager"),m=require("shared/window_manager"),v=require("interface/jquery").isJQueryObj,$=require("jquery");
var _=false;exports.atLeastOneServerCallIsSent=function(){return _};var w=exports.RPC=i.Ajax.extend({__init__:function(e){this._super({type:"POST",dataType:"json"});this.options(e);this.__name=this.__options.url;this.__data={args:[],kwargs:{}};this.__success=null;this.beforeComplete(this._implicitCompleteHandler.bind(this));this.beforeError(this._implicitErrorHandler.bind(this));this.error(this._defaultErrorHandler.bind(this));this.__exceptionPatterns={state_expired:function(e){c.reportPageNeedsReload("livenode_state_expired")}};this.__exceptionCatchAll=null;this.__liveMutation=false;this.__optimisticUpdate=false;this.__contentFor=false;this.__creationTime=(new Date).getTime();this.__isRelatedToUserAction=o.canBeRelatedToUserAction()},_discardMutation:function(){if(this.__liveMutation){if(this.__liveMutationInfo){var e=this.__liveMutationInfo.transactionId;if(e){c.mutationDoneAfterVersion(e,0)}}this.__liveMutation=false}},liveMutate:function(e){this.__liveMutation=true;e=e||{};if(e.optimisticUpdate===undefined){
this.__optimisticUpdate=false}else{this.__optimisticUpdate=e.optimisticUpdate}return this},contentFor:function(e,t){if(v(e)){e=e.get(0)}this.__contentFor=true;var i=f.extend(t,{domNode:e});if(!i.useLoadingSpinner&&i.useLoadingSpinner!==false){i.useLoadingSpinner=true}if(!i.parentCid){throw new Error("must explicitly specify parentCid.")}this.__contentForOpts=i;return this},_send:function(){if(this.__liveMutation){this.__liveMutationInfo=c.startMutation(this.__optimisticUpdate)}if(this.__contentFor){this._contentForStartLoading()}this.__startTime=u.getTime();return this._super()},send:function(e){var t=e&&e.batched;if(!p.batched_server_calls||!t){return this._super()}g.enqueueRequest(this)},_contentForStartLoading:function(){if(this.__contentForOpts.useLoadingSpinner){this.__contentForLoadingTimeout=setTimeout(function(){$(this.__contentForOpts.domNode).forgetContents();var e=document.createElement("div");e.className="__contentfor_loading_dots";e.appendChild(h.createLoadingDotsElement());
this.__contentForOpts.domNode.appendChild(e)}.bind(this),150)}},_contentForDoneLoading:function(){clearTimeout(this.__contentForLoadingTimeout)},_implicitCompleteHandler:function(e,t){u.logRequestTime(this.__name,this.__startTime)},_implicitErrorHandler:function(e,t,i){this._discardMutation();o.reportAjaxError(e,t,i,this.__isRelatedToUserAction,this.__creationTime)},_defaultErrorHandler:function(){this._discardMutation();var e="Unhandled error response from server: "+JSON.stringify(arguments);e+="; Function name: "+this.__name;this._throwError(e)},except:function(e,t){switch(arguments.length){case 1:this.__exceptionCatchAll=e;break;case 2:if(typeof e=="string"){this.__exceptionPatterns[e]=t}else{$.each(e,function(e,i){this.__exceptionPatterns[i]=t}.bind(this))}break;default:this._throwError("The except method takes either (<pattern>, <callback>) or (<default-callback>) as arguments.")}return this},args:function(){var e=[],t;for(t=0;t<arguments.length;t++){e.push(arguments[t])}this.__data.args=e;
return this},kwargs:function(e){this.__data.kwargs=e;return this},data:function(){throw new Error("Don't use the .data() method with RPC; use .kwargs() or .args() instead.")},_data:function(){if(!l.formkey){throw new Error("require('settings').formkey not set -- can't send request securely.")}if(!t.windowId&&l.serverCallUrl.indexOf(this.__name)===0){if(console&&console.warn){console.warn("No W2.windowId set; any content coming back from the server may not be live updated correctly")}}var e;try{e=JSON.stringify(this.__data,function(e,t){if(t===undefined){return null}return t})}catch(i){r.logJsError("w2.rpc","Can't JSON encode arguments to server call.");e=JSON.stringify({error:"Can't JSON encode arguments to server call."})}var n={json:e,formkey:l.formkey,postkey:l.postkey,window_id:t.windowId,referring_controller:l.controller,referring_action:l.action};if(this.__liveMutation){f.extend(n,this.__liveMutationInfo.data)}if(this.__contentFor){n.parent_cid=this.__contentForOpts.parentCid;n.parent_domid=s.getLiveParent(n.parent_cid);
var o=this.__contentForOpts.domNode;var a=s.getLiveChildren(n.parent_cid);var d=a.filter(function(e){return o.contains(document.getElementById(e))});n.domids_to_remove=JSON.stringify(d)}return n},success:function(e){this.__success=e;return this},_successWrapper:function(e){if(e.pmsg){a.GlobalProxy.dispatch({type:a.Types.PMSG_SHOW,payload:{content:e.pmsg,fadeOut:true}})}if(this.__contentFor){this._contentForDoneLoading()}if(e.exception){return this._handleException(e)}else{if(this.__contentFor){var t=this.__contentForOpts.domNode;$(t).forgetContents();if(document.body.contains(t)){$(t).setContent(e.value)}$(document).trigger("rpc_content_for_done",{opts:this.__contentForOpts,value:e.value})}var i;if(typeof this.__success==="function"){i=this.__success(e.value)}if(this.__liveMutation&&l.pageMode=="post_reload"){m.reload()}else{if(e.post_perf_html){a.GlobalProxy.dispatch({type:a.Types.PERF_POST_HTML,payload:{html:e.post_perf_html,js:e.post_perf_js}})}}return i}},_success:function(e){return this._successWrapper.bind(this);
},_throwError:function(e){if(console&&console.error){console.error(e)}throw new Error(e)},_handleException:function(e){this._discardMutation();var t=this.__exceptionPatterns[e.exception.type];var i=true;if(t){i=this._invokeExceptionCallback(t,e)}else if(this.__exceptionCatchAll){i=this._invokeExceptionCallback(this.__exceptionCatchAll,e)}if(i){var n={response:e,rpc:this};$(document).trigger("w2rpcexception-"+e.exception.type,n);$(document).trigger("w2rpcexception",n)}},_invokeExceptionCallback:function(e,t){return e(t.exception,t,this)}});exports.rpcToURL=function(e){return(new w).url(e)};var b=w.extend({__init__:function(e,t){this._super();this.__vcon=e;this.__vcon_method=t;this.__name=this.__vcon+"."+this.__vcon_method;this.__first_server_call=false;var i=l.serverCallUrl;if(i){this.url(i)}else{throw new Error("require('settings').serverCallUrl not set")}},_data:function(){var e=this._super();if(this.__vcon){e.__vcon_json=JSON.stringify(this.__vcon);e.__vcon_method=this.__vcon_method}else{
throw new Error("vcon not set; can't call a view controller.")}var t=require("actions").startOrUpdateAction(e.__e2e_action_id,{url:this.__options.url,vcon:this.__vcon,method:this.__vcon_method,args:e.args,kwargs:e.kwargs});e.__e2e_action_id=t.id;if(this.__first_server_call){e.__first_server_call=true}return e},_send:function(){if(!_){this.__first_server_call=true;_=true}return this._super()}});exports._ServerCall=b.extend({__init__:function(e,t,i){this._super(e,t);this._component=i;this._makeOnlyOnce=false;this._sendJsData=true;this._action=null;this._disableDefaultUserPerceivedLogging=false;this._userPerceivedAction=null},sendJsData:function(e){this._sendJsData=!!e;return this},disableDefaultUserPerceivedLogging:function(){this._disableDefaultUserPerceivedLogging=true;return this},contentFor:function(e,t){t=t||{};if(!t.parentCid){t.parentCid=this._component.cid}var i=[e,t];return this._super.apply(this,i)},_data:function(){var e=this._super();if(this._sendJsData){e.js_init=JSON.stringify(this._component.__js_init);
}e.__metadata=JSON.stringify(n.flushMetadata(this._component));return e},_onlyOnce:function(){if(!this._component.activeServerCalls){this._component.activeServerCalls={}}this.__onlyOnce=true;return this},_send:function(){this._beforeSendHandler();if(this.__onlyOnce){if(this._isSimilarServerCallActive()){return this}this._component.activeServerCalls[this.__vcon_method]=1}return this._super.apply(this,arguments)},sendOnlyOnce:function(){this._onlyOnce();return this.send()},_beforeSendHandler:function(){this._action=d.startPOST({vcon:this.__vcon,method:this.__vcon_method});if(!this._disableDefaultUserPerceivedLogging){this._userPerceivedAction=d.startUserPerceived({vcon:this.__vcon,method:this.__vcon_method})}},_implicitCompleteHandler:function(e,t){if(this._action){d.finishAction(this._action);this._action=null}if(!this._disableDefaultUserPerceivedLogging&&this._userPerceivedAction){d.finishAction(this._userPerceivedAction);this._userPerceivedAction=null}if(this.__onlyOnce){this._markServerCallInactive();
}return this._super.apply(this,arguments)},_isSimilarServerCallActive:function(){if(!this._component.activeServerCalls){return false}return this.__vcon_method in this._component.activeServerCalls},_markServerCallInactive:function(){if(this._isSimilarServerCallActive()){delete this._component.activeServerCalls[this.__vcon_method]}}})});define("interface/rpc",["shared/polyfills","interface/settings","shared/Class","interface/helpers","w2.rpc"],function B(require,exports,e){var t=require("interface/settings"),i=require("shared/Class").Class,n=require("interface/helpers").wrap;var s=function(e){return e instanceof a._ServerCall};var o=function(e){return e instanceof a.RPC};var r=["_data","args","kwargs","contentFor","error","except","send","success","sendJsData","_url","sendOnlyOnce"];var a;if(t.pageIsMobile){a=require("mobile_app2/server_call");Array.prototype.push.apply(r,["_callback"])}else{a=require("w2.rpc");Array.prototype.push.apply(r,["_success","_error","url"])}var d=r;var l=r.concat(["liveMutate","disableDefaultUserPerceivedLogging"]);
exports.RPC=i.extend({__init__:function(e){var t=new a.RPC(e);n(this,t,d,o)},contentFor:function(e,t){if(!t.parentCid){throw new Error("must explicitly specify parentCid.")}return this._super(e,t)}});exports.rpc=function(e){if(t.pageIsMobile){return new exports.RPC(e)}else{return(new exports.RPC).url(e)}};exports.ServerCall=i.extend({__init__:function(e,t,i){var o=new a._ServerCall(e,t,i);n(this,o,l,s)}});exports.atLeastOneServerCallIsSent=function(){return a.atLeastOneServerCallIsSent()}});define("shared/logging",["shared/polyfills","shared/qlocal_storage","shared/window_manager","shared/util","interface/rpc"],function F(require,exports,e){require("shared/qlocal_storage");var t=require("shared/window_manager"),i=require("shared/util"),n=require("interface/rpc").rpc,s=false,o=50,r=1e3;exports.log=function(e,n,s){if(!s){s={}}var o={sampleRate:1,sendImmediately:false,scribeOnly:false};s=i.extend(o,s);if(s.sampleRate<0||s.sampleRate>1){s.sampleRate=1}var r=null;if(s.scribeOnly){n.scribe_category=e;
r={category:"scribe_only",data:n,time:Date.now()*1e3}}else{r={category:e,data:n,time:Date.now()*1e3}}if(s.sampleRate>0&&Math.random()<=s.sampleRate){a.push(r)}if(s.sendImmediately||t.isPendingNavigation()){c()}else{d()}};var a={msgBuffer:[],push:function(e){this.msgBuffer.push(e)},messages:function(){return this.msgBuffer},clear:function(){this.msgBuffer=[]},concat:function(e){this.msgBuffer=this.msgBuffer.concat(e)}};function d(){if(a.messages().length>=o){c()}else{l()}}function l(){if(!s){s=setTimeout(c,r)}}function c(){if(s){clearTimeout(s);s=false}if(a.messages().length===0){return}var e=a.messages();a.clear();n("/ajax/batched_log_POST").kwargs({messages:e}).success(u.bind(this,e)).error(h.bind(this,e)).send()}function u(){}function h(e){if(e){a.concat(e)}}});define("shared/scroll_animation_handler",["shared/polyfills"],function U(require,exports,e){exports.add=function(e,t){var i=false,n;var s=function(){n=e.scrollY;if(n===undefined){n=e.scrollTop}if(!i){requestAnimationFrame(function(){
i=false;t(n)})}i=true};e.addEventListener("scroll",s);s();return s}});define("shared/keyboard_event_handler",["shared/polyfills","interface/jquery"],function j(require,exports,e){var t=require("interface/jquery")._jQuery;var i=[];exports.push=function(e){i.push(e)};exports.remove=function(e){var t=i.indexOf(e);if(t>-1){i.splice(t,1)}};t(document).on("keydown",function(e){for(var t=i.length-1;t>=0;t--){var n=i[t](e);if(n==false||e.isDefaultPrevented()){return}}})});define("w2.modal",["shared/polyfills","shared/core/component","interface/jquery","shared/Class","video","shared/logging","shared/viewport","shared/scroll_animation_handler","shared/keyboard_event_handler"],function H(require,exports,e){var t=require("shared/core/component"),$=require("interface/jquery")._jQuery,i=require("shared/Class").Class,n=require("video"),s=require("shared/logging").log,o=require("shared/viewport"),r=require("shared/core/component").getAllDvars,a=require("shared/scroll_animation_handler"),d=require("shared/keyboard_event_handler");
var l=[];var c=function(e){l.push(e)};var u=function(e){var t=l.indexOf(e);if(t>-1){l.splice(t,1)}};var h=function(){return l[l.length-1]};var f=0;var p=function(){return f++};var g=1e3;var m=exports.ModalBase=i.extend({__init__:function(e,t){this.opener=e;this.opts=$.extend({args:[],kwargs:{},closeOnEscape:true,closeOnBackgroundClick:true,closeOnScroll:false,showFixedCloseButton:false,customOverlayClass:null,errorCallback:null},t);this._modalId=p();this._cid="*modal*_"+this._modalId;this.$container=$("#__w2_modal_container_");this._initModal();this._isFetched=false;this._fetchStartTime=0;this._isOpen=false;this._firstOpenTime=0},_initModal:function(){var e=document.createElement("div");e.id="#__w2_modal_overlay_"+this._modalId;e.className="modal_overlay hidden";if(this.opts.customOverlayClass){e.classList.add(this.opts.customOverlayClass)}this.$container.append(e);this.$overlay=$(e);var t=document.createElement("div");t.id="#__w2_modal_wrapper_"+this._modalId;t.className="modal_wrapper";
t.tabIndex=-1;e.appendChild(t);this.$contentWrapper=$(t);if(this.opts.showFixedCloseButton){var i=document.createElement("a");i.id="#__w2_modal_close_"+this._modalId;i.className="modal_fixed_close hidden";e.appendChild(i);this.$closeButton=$(i)}},_bindHandlers:function(){if(this.opts.closeOnEscape){this.bindKeyboardHotkeys()}if(this.opts.closeOnBackgroundClick){this.bindBackgroundClickDismissHandler()}if(this.opts.closeOnScroll){this.bindCloseOnScroll()}if(this.opts.showFixedCloseButton){this.bindCloseButton()}},_unbindHandlers:function(){if(this.opts.closeOnEscape){d.remove(this.escKeyHandler)}if(this.opts.closeOnBackgroundClick){this.$overlay.off("click.modalOverlay")}if(this.opts.closeOnScroll){this._disableScrollToDismiss()}if(this.opts.showFixedCloseButton){this.$closeButton.off()}},_open:function(){this._isOpen=true;c(this);this._bindHandlers();o.setPageScroll(false);this.$overlay.removeClass("hidden");if(this.opts.showFixedCloseButton){this.$closeButton.removeClass("hidden")}if(this.opts.closeOnScroll){
this.$contentWrapper.css("opacity",1)}this.$contentWrapper.focus()},fetch:function(e){if(this._isFetched){return}this._isFetched=true;this._fetchStartTime=Date.now();var i=this;var n=this.opener.serverCall(e);n.args.apply(n,i.opts.args).kwargs(i.opts.kwargs).error(function(){i._isFetched=false;t.unloadComponent(i._cid);i.close()}).success(function(){i.onFetchSuccess()}).contentFor(this.$contentWrapper,{parentCid:this._cid});if(this.opts.errorCallback){n.error(this.opts.errorCallback)}n.send()},onFetchSuccess:function(){this.opener.__modal__=this;var e=t._safeGetComponentByCID(this._cid);e.__opener__=this.opener;e.__modal__=this;t._components[this._cid]=e;var i={};i[this._cid]="*ROOT*";t.addParents(i);e.setDvar("__modal__",this._cid);var n=t._allChildren[this._cid][0];var o=t._safeGetComponentByCID(n);var a=r(this.opener);delete a["__modal__"];o.__dvars__=a;if(this.opts.customOverlayClass==="feed_desktop_modal"){s("web_modal_loading_time",{fetch_start_time:this._fetchStartTime,fetch_finish_time:Date.now(),
first_open_time:this._firstOpenTime},{sampleRate:.01})}if(this.$contentWrapper.height()>g){this.$contentWrapper.addClass("tall")}},load:function(e){this._open();if(!this._isFetched){this.fetch(e)}if(this._firstOpenTime===0){this._firstOpenTime=Date.now()}return this},_teardownContent:function(){},close:function(e,t){if(!this._isOpen){return}this._isOpen=false;u(this);n.stopAllVideos(this.$contentWrapper);if(this.opts.showFixedCloseButton){this.$closeButton.addClass("hidden")}var i=this;var s=function(){i.$overlay.addClass("hidden");if(!h()){if(t){setTimeout(function(){o.setPageScroll(true)},t)}else{o.setPageScroll(true)}}i._unbindHandlers();i._teardownContent()};if(e){s()}else{i.$overlay.addAnimationClass("closing",s)}},bindCloseButton:function(){var e=this;e.$closeButton.on("click",function(t){t.stopPropagation();if(e._isOpen){e.close()}})},bindCloseOnScroll:function(){var e=this,t;var i=function(i){var n=i+window.innerHeight,s=e.$contentWrapper.outerHeight(true);if(n>=s-1){t=setTimeout(function(){
e._enableScrollToDismiss()},1e3)}else{if(t){clearTimeout(t)}e._disableScrollToDismiss()}};a.add(e.$overlay.get(0),i);i(e.$overlay.scrollTop())},_enableScrollToDismiss:function(){var e=this.$contentWrapper,t=this.close.bind(this),i=1e3,n=0,s=false,o;var r=function(){if(!s){requestAnimationFrame(a)}s=true};var a=function(){s=false;if(n<0){n=0}if(n>i){n=0;t(true,500)}e.css("opacity",1-Math.sqrt(n)/Math.sqrt(i));clearTimeout(o);o=setTimeout(function(){e.fadeTo("fast",1);n=0},250)};this.$overlay.on("wheel.modalOverlay",function(e){n+=e.originalEvent.deltaY;r()})},_disableScrollToDismiss:function(){this.$contentWrapper.css("opacity",1);this.$overlay.off("wheel.modalOverlay")},bindKeyboardHotkeys:function(){var e=this;e.escKeyHandler=function(t){if(t.keyCode==27){if(e._isOpen&&e===h()){e.close()}}};d.push(e.escKeyHandler)},bindBackgroundClickDismissHandler:function(){var e=this;e.$overlay.on("click.modalOverlay",function(t){if(t.target==this&&!e._isScrollBarClicked(t)&&e._isOpen){t.stopPropagation();
e.close()}})},_isScrollBarClicked:function(e){var t=$.getScrollbarWidth();if(window.innerWidth-e.clientX<t){return true}else{return false}}});var v=exports.Modal=m.extend({_initModal:function(){this.$contentWrapper=$("#__w2_modal_wrapper_");this.$overlay=$("#__w2_modal_overlay_");this.$closeButton=$("#__w2_modal_close_")},_teardownContent:function(){this.$contentWrapper.forgetContents();t.unloadComponent(this._cid);this.$contentWrapper.html("");this.$overlay.off();if(this.opts.showFixedCloseButton){this.$closeButton.off()}}});exports.ModalWithCallBacks=v.extend({_onCloseCallBack:null,_onSubmitCallBack:null,onCloseCallBack:function(e){this._onCloseCallBack=e;return this},executeOnCloseCallBack:function(){if(this._onCloseCallBack){this._onCloseCallBack()}},onSubmitCallBack:function(e){this._onSubmitCallBack=e;return this},executeOnSubmitCallBack:function(){if(this._onSubmitCallBack){this._onSubmitCallBack.apply(null,arguments)}}});v.openerFor=function(e){var i=e.getDvar("__modal__");var n=t._safeGetComponentByCID(i);
return n&&n.__opener__};v.modalFor=function(e){var i=e.getDvar("__modal__");var n=t._safeGetComponentByCID(i);var s=n&&n.__modal__;if(!s){s=h()}return s}});define("interface/modal",["shared/polyfills","interface/settings","shared/core/component","shared/Class","shared/client","w2.modal"],function Q(require,exports,e){var t=require("interface/settings").pageIsMobile,i=require("shared/core/component"),n=require("shared/Class").Class;if(t){var s=require("mobile_app2/client");var o=require("mobile_app2/messages");var r=require("shared/client");var a=require("mobile_app2/util");var d=null;if(r.isMobileWeb()){var l=require("mobile_app2/web_app_shim/modal");d=require("mobile_app2/web_app_shim/hash_handler")}}else{var c=require("w2.modal")}var u="/modal?";var h={};var f=function(e){var i;if(!t){i=c.Modal.openerFor(e).cid}else if(r.isMobileWeb()){i=l.openerCid(e)}return h[i]};exports.handleClose=function(e){var n;if(!t||r.isMobileWeb()){n=f(e);n.handleClose()}if(!t){n.__modal.close()}else{i.unloadComponent(e.cid);
if(r.isNativeApp()){o.send("dismissModal");s.broadcastMessageToWebViews("handleModalClose")}else{l.dismissActiveModal()}}};exports.handleSubmit=function(e,i){if(!t||r.isMobileWeb()){var n=f(e);n.handleSubmit(i);return}s.broadcastMessageToWebViews("handleModalSubmit",i)};exports.createModal=function(e,t,i){return new p(e,t,i)};var p=n.extend({__init__:function(e,t,i){this.vcon=e;this.component=i;this.method=t;this.__kwargs={};this.__modal=null;this.__submitCallback=null;this.__closeCallback=null;this.__unloadCallback=null;h[this.component.cid]=this;this.initMobile();if(d){d.initComponent(this)}},initMobile:function(){if(!t||r.isMobileWeb()){return}var e=this.handleSubmit.bind(this);var i=this.handleClose.bind(this);s.registerOneTimeMessageHandler("handleModalSubmit",e);s.registerOneTimeMessageHandler("handleModalClose",i);this.onUnload(function(){s.removeOneTimeMessageHandler("handleModalSubmit",e);s.removeOneTimeMessageHandler("handleModalClose",i)})},onUnload:function(e){this.__unloadCallback=e;
},unload:function(){if(this.__unloadCallback){this.__unloadCallback()}h[this.component.cid]=null},kwargs:function(e){this.__kwargs=e;return this},show:function(){if(!t){this._showWeb()}else if(r.isNativeApp()){this._showNativeApp()}else{this._showMobileWeb()}return this},_showWeb:function(){this.__modal=new c.ModalWithCallBacks(this.component,{kwargs:this.__kwargs});this.__modal.load(this.method)},_showNativeApp:function(){var e=u;var t={method:this.method,vcon:JSON.stringify(this.vcon),kwargs:JSON.stringify(this.__kwargs)};e+=a.encodeMap({params:btoa(JSON.stringify(t))});var i={target:"modal",url:e};var n=["load_editor_modal","load_add_modal","load_edit_modal"];if(n.indexOf(this.method)>=0){if(r.isAndroidApp()&&s.buildNumber>=1115){i.forceXWalk=true}}o.send("openURL",i)},_showMobileWeb:function(){this.__modal=new l.Modal(this.component,{kwargs:this.__kwargs});this.__modal.load(this.method);this._addHashMobileWeb()},_addHashMobileWeb:function(){if(!d){return}var e=0,t=window.location.hash;
if(t){var i=t.split("-");if(i.length>1){var n=parseInt(i[1])||0;e=n+1}}t="mwebmodal-"+e;d.addHash(this,t,function(){l.dismissActiveModal()})},onSubmit:function(e){this.__submitCallback=e;return this},onClose:function(e){this.__closeCallback=e;return this},handleClose:function(){if(d){d.checkAndDeleteHash(this)}if(this.__closeCallback){this.__closeCallback()}this.unload()},handleSubmit:function(e){if(d){d.checkAndDeleteHash(this)}if(this.__submitCallback){this.__submitCallback(e)}}})});define("shared/core/component",["shared/polyfills","shared/Class","shared/w2.timing","interface/jquery","shared/w2.context","shared/util","interface/settings","shared/errors","shared/events/index","shared/log","shared/client","unified_view/mobile_overlays","interface/modal","interface/rpc","webnode2"],function W(require,exports,e){var t=require("shared/Class").Class,i=require("shared/w2.timing").timing,n=require("interface/jquery").jQuery,$=require("interface/jquery")._jQuery,s=require("shared/w2.context"),o=require("shared/util"),r=require("interface/settings").pageIsMobile,a=require("shared/errors"),d=require("shared/events/index"),l=require("shared/log").log,c=require("shared/client"),u;
var h=exports.parseVcon=function(e){var t=e.__vcon;if(t){if(t.length===1){return t}switch(t[0]){case"cls":case"hmac":return t;case"live":return t.slice(2)}}return null};var f={};var p={};var g={};var m={};var v={};var _={};var w={};var b={};var y={};var C=1;var x=2;var k={};var S={};var E={};var T={};var L={};exports._parents=f;exports._components=p;exports._allChildren=g;exports._children=m;exports._hmacs=v;exports._groups=_;exports._componentGroups=w;exports._domids=b;exports._domidToCid=E;exports._debugInfo=T;exports._onLoadStatus=y;exports._onLoadCallbacks=k;exports._onUnloadCallbacks=S;exports._unloaded=L;exports.ONLOAD_BEGUN=C;exports.ONLOAD_DONE=x;var M=exports.addParents=function(e){var t,i,n,s;t=Object.keys(e);for(s=0;s<t.length;s++){i=t[s];n=e[i];f[i]=n;if(!(n in g)){g[n]=[]}g[n].push(i);if(!(i in m)){m[i]={}}}};var D=function(e){var t,i,n;t=Object.keys(e);for(i=0;i<t.length;i++){n=t[i];v[n]=e[n]}};var A=function(e){var t,i,n,s,o,r;t=Object.keys(e);for(i=0;i<t.length;i++){n=t[i];
s=e[n];if(!(n in _)){_[n]=[]}for(r=0;r<s.length;r++){o=s[r];_[n].push(o);if(!(o in w)){w[o]=[]}w[o].push(n)}}};var I=function(e){var t=w[e],i,n,s,o;if(!t){return}for(s=0;s<t.length;s++){i=t[s];n=_[i];o=n.indexOf(e);if(o!=-1){n.splice(o,1)}}};var q=function(e){var t,i,n;t=Object.keys(e);for(i=0;i<t.length;i++){n=t[i];if(!(n in m)){m[n]={}}o.extend(m[n],e[n])}};var N=function(e){var t,i,n,s;t=Object.keys(e);for(i=0;i<t.length;i++){n=t[i];s=e[n];b[n]=s;E[s]=n}};var O=exports.addDebugInfo=function(e){var t,n,s;t=Object.keys(e);for(n=0;n<t.length;n++){s=t[n];T[s]=e[s];if(i._components){if(!(s in i._components)){i._components[s]={}}i._components[s].addDebugInfo=Date.now()}}};exports.addComponentMetadata=function(e){var t=e.parents;var i=e.children;var n=e.domids;var s=e.hmacs;M(t);D(s);q(i);N(n);if("groups"in e){A(e.groups)}if("debugInfo"in e){O(e.debugInfo)}if(!r){$(document).trigger("w2addcomponents",e)}};exports.registerComponents=function(e){e.forEach(function(e){p[e.cid]=e});return e};var R=exports._safeGetComponentByCID=function(e){
var t;if(e){t=p[e];if(!t){return exports.makeVirtualComponent(e)}else{return t}}else{return null}};exports.isCid=function(e){return e&&!!p[e]};exports.getLiveDomId=function(e){return b[e]};exports.getLiveDomElement=function(e){if(e in b){return document.getElementById(b[e])}};exports.getComponentFromElement=function(e){while(e&&!(e.id in E)){e=e.parentNode}return e&&R(E[e.id])};var P=exports.getLiveParent=function(e){if(e in b){return b[e]}else if(e in f){return P(f[e])}else{return""}};exports.getLiveParentDomElement=function(e){return document.getElementById(P(e))};exports.getLiveChildren=function(e){var t,i,n;t=g[e];i=[];if(t){for(n=0;n<t.length;n++){if(t[n]in b){i.push(b[t[n]])}}}return i};var B=function(e,t){if(y[e]==x){t();return}if(!k[e]){k[e]=[]}k[e].push(t)};var F=function(e,t){if(!S[e]){S[e]=[]}S[e].push(t)};var U=function(e){if(!k[e]){return}var t=k[e].reverse();k[e]=null;t.forEach(function(e){e()})};var j=function(e){if(!S[e]){return}var t=S[e].reverse();S[e]=null;t.forEach(function(e){
e()})};var H=exports.onLoadComponent=function(e,t){if(r){var n=e.getDvar("prefetchedContentRootCid");if(n){var s;if(c.isNativeApp()){s=require("mobile_app2/page_cloner")}else{s=require("unified_view/mobile_overlays")}s.registerComponent(n,e);e.whenUnloaded(function(){s.deregisterComponent(n,e)});if(n!=e.cid){return}}}var o=!!i.components,a=e.cid,d;if(o){d=Date.now()}y[a]=C;try{e.onLoad(t);if(r){u.registerComponentBroadcastListeners(e)}y[a]=x;U(a)}catch(l){a=e.cid;var f=h(e);if(f){l.message=l.message+" ("+a+" "+f+")"}require("shared/errors").report(l)}if(o){if(!i.components[a]){i.components[a]={}}i.components[a].l=Date.now()-d}};var Q=exports.removeComponentMetadata=function(e){if(!r){$(document).trigger("webnode_before_remove_component_metadata",e)}var t=p[e];var i=f[e];var n=t&&t.cname;if(i&&n){var s=m[i];if(s&&s[n]==e){delete s[n]}}if(i){var o=g[i];if(o){var a=o.indexOf(e);if(a>-1){o.splice(a,1)}}}I(e);delete g[e];delete m[e];delete w[e];delete p[e];delete T[e];delete E[b[e]];delete b[e];
delete k[e];delete y[e];delete f[e]};var W=exports.unloadComponent=function(e){try{l("core.component","unloadComponent(",e,")");var t=p[e];if(t){t.onUnload();j(e);s.unloadComponent(t)}var i=g[e]||[];i=i.slice();i.forEach(function(e){W(e)});Q(e);d.ComponentProxy.unsubscribeAll(e)}catch(n){a.report(n)}finally{L[e]=true}};var V=false;exports.isOnLoadRunning=function(){return V};exports.onLoad=function(e,t){V=true;if(r&&t&&window.preOnLoadHandler){window.preOnLoadHandler()}for(var i=0;i<e.length;i++){s.initComponent(e[i])}for(var n=0;n<e.length;n++){H(e[n],t)}if(!r&&window.clearHandlers){window.clearHandlers()}V=false;return e};exports.getRootParent=function(e){if(!p[e]){return null}var t=e;while(t&&!t.startsWith("*")){t=f[t]}return t};exports.getAllDvars=function(e){var t={};var i=e;var n={};var s;while(i){if(i.cid in n){var r="Broke parent loop";var d=h(i);if(d){r+=" ("+i.cid+" "+d+")"}a.logJsError("getAllDvars",r);break}s=o.extend({},i.__dvars__);t=o.extend(s,t);n[i.cid]=true;i=i.parent();
}return t};exports.newComponent=function(e,t,i,n,s,o){if(!e){throw z("JS class specified by js_init not found: "+t)}else{return new e(i,n,s,o)}};exports.Component=t.extend({__init__:function(e,t,i){this.cid=e;this.cname=t;this.__js_init=i;var n=v[this.cid];this.__vcon=n?n.split(":"):null;this.init(i)},init:function(e){if(!o.isPlainObject(e)){return}o.extend(this,e)},onLoad:function(e){},onUnload:function(){},contextConstructor:function(){},child:function(e){var t=m[this.cid];var i=t?t[e]:null;return R(i)},children:function(){var e=g[this.cid]||[];return e.map(function(e){return R(e)})},parent:function(){return R(f[this.cid])},setDvar:function(e,t){this.__dvars__=this.__dvars__||{};this.__dvars__[e]=t},getDvar:function(e){this.__dvars__=this.__dvars__||{};if(e in this.__dvars__){return this.__dvars__[e]}var t=this.cid;var i;while(t){t=f[t];i=p[t];if(i){return i.getDvar(e)}}return null},whenOnLoaded:function(e){B(this.cid,e)},whenUnloaded:function(e){F(this.cid,e)},_my:function(){return"__w2_"+this.cid+"_";
},ge:function(e){return document.getElementById(e.replace("@",this._my()))},createModal:function(e){var t=h(this);if(t){return require("interface/modal").createModal(t,e,this)}throw new Error("Invalid vcon for component: "+this.cid)},emitEvent:function(e){d.ComponentProxy.dispatch(e,this.cid)},handleEvent:function(e,t){d.ComponentProxy.subscribe(e,t,this.cid)},$id:function(e){if(e[0]!="@"){throw new Error("Expect id to begin with @. Got: "+e)}e=e.replace("@",this._my());return n("#"+e)},unsafe$id:function(e){if(e[0]!="@"){throw new Error("Expect id to begin with @. Got: "+e)}e=e.replace("@",this._my());return $("#"+e)},serverCall:function(e){var t=h(this);if(t){var i=require("interface/rpc").ServerCall;return new i(t,e,this)}}});var z=exports.ComponentError=function(e,t){this.message=this.errorType+": "+e;if(t){this.message+=" <cid="+t+">"}};z.prototype=new Error;z.prototype.errorType="ComponentError";z.prototype.constructor=z;if(r){u=require("mobile_app2/component")}else{u=require("webnode2");
}exports.makeVirtualComponent=function(){return u.makeVirtualComponent.apply(this,arguments)};exports.registerBroadcastDependencies=function(){return u.registerBroadcastDependencies.apply(this,arguments)}});define("shared/cookies",["shared/polyfills","shared/util","shared/w2.context","settings","shared/logging"],function V(require,exports,e){var t=require("shared/util"),i=require("shared/w2.context"),n=require("settings"),s=n.cookiePrefix,o=n.pageIsMobile,r=".quora.com",a;var d=function(){if(d.called){return}d.called=true;require("shared/logging").log.apply(this,arguments)};if(o){a=require("mobile_app2/messages")}var l=function(e){return t.extend({expires:365*5,path:"/",domain:r},e)};var c=exports.setCookie=function(e,t,i,n){i=l(i);if(!o){exports.setCookieOnDocument(e,t,i)}else{var s={name:e,options:i};if(t!=null){s.value=t}a.send("setCookie",s,n)}};exports.getCookie=function(e,t){if(!o){return exports.getCookieOnDocument(e)}else{a.send("retrieveCookie",{name:e},t)}};exports.setCookieOnDocument=function(e,t,i){
i=l(i);e=s+"-"+e;var n=i.document||document,o=i.path?"; path="+i.path:"",r=i.domain?"; domain="+i.domain:"",a=i.secure?"; secure":"",d="",c;if(t===null){t="";i.expires=-1}if(i.expires&&typeof i.expires=="number"){c=new Date;c.setTime(c.getTime()+i.expires*24*60*60*1e3);d="; expires="+c.toUTCString()}if(i.expires instanceof Date){d="; expires="+i.expires.toUTCString()}n.cookie=[e,"=",encodeURIComponent(t),d,o,r,a].join("")};exports.getCookieOnDocument=function(e){e=s+"-"+e;var t=document,i,n,o;if(t.cookie&&t.cookie!==""){i=t.cookie.split(";");for(o=0;o<i.length;o++){n=i[o].trim();if(n.startsWith(e+"=")){return decodeURIComponent(n.substring(e.length+1))}}}};var u=function(e){var t="="+encodeURIComponent(e),i='="'+encodeURIComponent(e)+'"',n,s;if(document.cookie){n=document.cookie.split(";");for(s=0;s<n.length;s++){if(n[s].endsWith(t)||n[s].endsWith(i)){return true}}}return false};var h=exports.setMessage=function(e,t,i,s){var r=document,a=r.cookie.length,h=r.cookie.split(";").length;s=l(s);
if(a>2400||h>50){var f={key:e,args:t,size:a,count:h,cookie:r.cookie};d("cookie_message_errors",f,{scribeOnly:true});return}var p=Math.floor(Math.random()*4294967296);var g=JSON.stringify({key:e,args:t});var m=["qm",p,n.nid].join("-");if(o){g=btoa(g)}if(u(g)){return}c(m,g,s,i)};exports.setQfeedLog=function(e,t){var n=e.getDvar("feed_story_hash"),s=e.getDvar("paged_list_hash"),r=e.getDvar("enable_feed_logging"),a=e.getDvar("feed_story_initial"),d=e.getDvar("feed_ty"),l=e.getDvar("feed_page"),c=e.getDvar("page_data"),u=e.getDvar("focus_ty"),f=e.getDvar("feed_story_inner_position"),p=e.getDvar("bundle_position"),g=e.getDvar("feed_story_position"),m;if(o&&!r){return}if(!n){return}if(d===null){d=0}if(!a){a=false}if(o&&g===null){var v=e.getContext(i.UniversalPageFeedContext);var _=v.get("impressionLogger");if(!_){return}g=_.getPositionFromPagedListHash(s)}g=g===null?0:g;f=f===null?0:f;m=[9,n,g,a,t,d,l,c,u,f,p];h("qfl",m)};exports.setTlog=function(e){if(!n.trail||!e){return}h("tlog",[n.trail,e]);
};exports.setQueryLog=function(e,t){var i=e.getDvar("query_id"),n=e.getDvar("index");if(i===null){return}if(n===null){n=0}h("qlch",[i,{type:t,index:n}])};exports.setScreenSizeCookie=function(){var e=window.screen.width;var t=window.screen.height;c("screen_size",e+"x"+t)}});define("shared/loadjs",["shared/polyfills","shared/util","shared/onload"],function z(require,exports,e){var t=require("shared/util"),i=require("shared/onload");exports.loadJS=function(e,i){var n=document.createElement("script");n.type="text/javascript";n.async=true;n.src=e;if(i){n.onload=n.onreadystatechange=t.once(i)}var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(n,s)};var n=exports.prefetchJS=function(e){var t=document.createElement("object");t.data=e;t.type="application/javascript";t.width=0;t.height=0;document.body.appendChild(t)};exports.lazyPrefetchJS=function(e){i.execAfterLoadDelayed(function(){n(e)})}});define("shared/facebook",["shared/polyfills","shared/loadjs","shared/util","shared/onload","shared/client","settings"],function G(require,exports,e){
var t=require("shared/loadjs").loadJS,i=require("shared/util"),n=require("shared/onload"),s=require("shared/client"),o=require("settings"),r=false,a=[];var d=i.once(function(){if(o.pageIsMobile&&s.isNativeApp()){return}var e=o.fbLanguageCode;var i="//connect.facebook.net/"+e+"/sdk.js";var n=o.fbAppId;window.fbAsyncInit=function(){FB.init({appId:n,oauth:true,xfbml:false,version:"v2.4"});r=true;while(a.length){a.pop().call()}};t(i)});var l=exports.onInit=function(e){if(r){e()}else{n.execAfterLoadDelayed(d);a.push(e)}};exports.isLoaded=function(){return r};exports.load=function(){l(function(){})}});define("shared/resource_timing",["shared/polyfills"],function K(require,exports,e){var t=["name","initiatorType","connectStart","connectEnd","domainLookupStart","domainLookupEnd","duration","fetchStart","redirectEnd","redirectStart","requestStart","responseEnd","responseStart","secureConnectionStart","startTime","workerStart","transferSize","encodedBodySize","decodedBodySize"];exports.getResourceTimingInformation=function(){
var e=[];var i=window.performance;if(i&&i.getEntriesByType){var n=i.getEntriesByType("resource");for(var s=0;s<n.length;s++){var o=n[s];var r={};for(var a=0;a<t.length;a++){var d=t[a];if(d in o){r[d]=o[d]}}e.push(r)}}return e}});define("third_party/timing",["shared/polyfills"],function J(require,exports,e){(function(e){"use strict";e.timing=e.timing||{getTimes:function(t){var i=e.performance||e.webkitPerformance||e.msPerformance||e.mozPerformance;if(i===undefined){return false}var n=i.timing;var s={};t=t||{};if(n){if(t&&!t.simple){for(var o in n){if(n.hasOwnProperty(o)){s[o]=n[o]}}}if(s.firstPaint===undefined){var r=0;if(e.chrome&&e.chrome.loadTimes){r=e.chrome.loadTimes().firstPaintTime*1e3;s.firstPaintTime=r-e.chrome.loadTimes().startLoadTime*1e3}else if(typeof e.performance.timing.msFirstPaint==="number"){r=e.performance.timing.msFirstPaint;s.firstPaintTime=r-e.performance.timing.navigationStart}if(t&&!t.simple){s.firstPaint=r}}s.loadTime=n.loadEventEnd-n.fetchStart;s.domReadyTime=n.domComplete-n.domInteractive;
s.readyStart=n.fetchStart-n.navigationStart;s.redirectTime=n.redirectEnd-n.redirectStart;s.appcacheTime=n.domainLookupStart-n.fetchStart;s.unloadEventTime=n.unloadEventEnd-n.unloadEventStart;s.lookupDomainTime=n.domainLookupEnd-n.domainLookupStart;s.connectTime=n.connectEnd-n.connectStart;s.requestTime=n.responseEnd-n.requestStart;s.initDomTreeTime=n.domInteractive-n.responseEnd;s.loadEventTime=n.loadEventEnd-n.loadEventStart}return s},printTable:function(e){var t={};var i=this.getTimes(e)||{};Object.keys(i).sort().forEach(function(e){t[e]={ms:i[e],s:+(i[e]/1e3).toFixed(2)}});console.table(t)},printSimpleTable:function(){this.printTable({simple:true})}}})(this)});define("shared/paint_timing",["shared/polyfills","third_party/timing"],function X(require,exports,e){require("third_party/timing");exports.getPaintTimingInformation=function(){return window.timing.getTimes()}});define("shared/e2e",["shared/polyfills","shared/util","shared/log","shared/logging","settings","shared/w2.timing","shared/resource_timing","shared/client","shared/paint_timing"],function Y(require,exports,e){
var t=require("shared/util"),i=require("shared/log").log,n=require("shared/logging"),s=require("settings"),o=require("shared/w2.timing"),r=s.pageIsMobile,a=require,d=require("shared/resource_timing"),l=require("shared/client"),c=require("shared/paint_timing");var u=false;var h=false;var f=null;var p=null;var g=null;var m="desktop";exports.NATIVE_PERF_SAMPLE_RATE=.01;var v=false;exports.maybeReportPrefetchedData=function(){v=true;if(window.performance.timing.loadEventEnd>0){x()}};if(r){m="mobile";f=require("mobile_app2/client");f.registerMessageHandler("networkStatusLog",function(e){n.log("mobile_app2_client_perf",e,{scribeOnly:true})});f.registerMessageHandler("logPerformanceData",function(e){if(e.measurement=="web_view_page_ready"&&e.error===undefined){y({native_e2e:e.duration})}})}exports.reportPageData=function(e){if(e===null){return}if(!e.mustReport){return}delete e.mustReport;var i=o.timing;var n={};for(var r in i){if(r==="components"||r==="_components"){continue}n[r]=i[r]}p=t.extend(e,{
win_perf:{path:window.location.pathname,revision:s.revision,request_id:s.request_id,controller:s.controller,action:s.action,server_time:i.server_time,window_id:i.window_id,is_css_inlined:i.is_css_inlined,is_early_js_inlined:i.is_early_js_inlined,experiments:i.experiments},w2_timing:n,paint_timing:c.getPaintTimingInformation()});w()};var _=function(){return window.performance&&window.performance.timing};var w=function(){if(_()&&window.performance.timing.loadEventEnd===0){setTimeout(w,250);return}else{b()}};var b=function(){if(_()){var e={},t=o.timing;for(var i in window.performance.timing){var n=window.performance.timing[i];if(typeof n==="number"){e[i]=n}}p.win_perf.timing=e;if(s.componentInspector){var r=a("w2.inspector");if(r.isRequestTimeSlowerThanStandard()){p.slow_load={platform:m,user_agent:window.navigator.userAgent,path:window.location.pathname,controller:s.controller,action:s.action,window_id:t.window_id,page_time:t.page,request_time:t.request,load_time:e.loadEventStart-e.navigationStart
}}}}else{p.win_perf.timing={}}o.stop();u=true;C()};var y=function(e){g=e;C()};var C=function(){if(r){x()}else{k()}};var x=function(){var e=false;if(l.isMobileWeb()&&u){e=true}if(!_()&&g){e=true}if(u&&p&&g){e=true}if(l.isNativeApp()&&(s.isPagePrefetched&&!v)){e=false}if(e){k()}};var k=function(){if(h){return}h=true;var e=t.extend(p||{},g||{});setTimeout(function(){e["resource_timing"]=d.getResourceTimingInformation();if(!r&&i.enabled){var t=p.win_perf.timing,s=t.loadEventStart-t.navigationStart,o=e.win_perf.server_time;i("e2e.reportPageData","Metric:",s,"Server time:",o,"Details:",p)}n.log("perf/get_e2e",e)},100);if(!s.componentInspector){delete o.timing.components;delete o.timing._components}}});define("shared/fastclick",["shared/polyfills"],function Z(require,exports,e){function t(e){"use strict";var i,n=this;this.trackingClick=false;this.trackingClickStart=0;this.targetElement=null;this.touchStartX=0;this.touchStartY=0;this.lastTouchIdentifier=0;this.touchBoundary=10;this.layer=e;if(!e||!e.nodeType){
throw new TypeError("Layer must be a document node")}this.onClick=function(){return t.prototype.onClick.apply(n,arguments)};this.onMouse=function(){return t.prototype.onMouse.apply(n,arguments)};this.onTouchStart=function(){return t.prototype.onTouchStart.apply(n,arguments)};this.onTouchMove=function(){return t.prototype.onTouchMove.apply(n,arguments)};this.onTouchEnd=function(){return t.prototype.onTouchEnd.apply(n,arguments)};this.onTouchCancel=function(){return t.prototype.onTouchCancel.apply(n,arguments)};if(t.notNeeded(e)){return}if(this.deviceIsAndroid){e.addEventListener("mouseover",this.onMouse,true);e.addEventListener("mousedown",this.onMouse,true);e.addEventListener("mouseup",this.onMouse,true)}e.addEventListener("click",this.onClick,true);e.addEventListener("touchstart",this.onTouchStart,false);e.addEventListener("touchmove",this.onTouchMove,false);e.addEventListener("touchend",this.onTouchEnd,false);e.addEventListener("touchcancel",this.onTouchCancel,false);if(!Event.prototype.stopImmediatePropagation){
e.removeEventListener=function(t,i,n){var s=Node.prototype.removeEventListener;if(t==="click"){s.call(e,t,i.hijacked||i,n)}else{s.call(e,t,i,n)}};e.addEventListener=function(t,i,n){var s=Node.prototype.addEventListener;if(t==="click"){s.call(e,t,i.hijacked||(i.hijacked=function(e){if(!e.propagationStopped){i(e)}}),n)}else{s.call(e,t,i,n)}}}if(typeof e.onclick==="function"){i=e.onclick;e.addEventListener("click",function(e){i(e)},false);e.onclick=null}}t.prototype.deviceIsAndroid=window.navigator.userAgent.indexOf("Android")>0;t.prototype.deviceIsIOS=/iP(ad|hone|od)/.test(window.navigator.userAgent);t.prototype.deviceIsIOS4=t.prototype.deviceIsIOS&&/OS 4_\d(_\d)?/.test(window.navigator.userAgent);t.prototype.deviceIsIOSWithBadTarget=t.prototype.deviceIsIOS&&/OS ([6-9]|\d{2})_\d/.test(window.navigator.userAgent);t.prototype.needsClick=function(e){"use strict";switch(e.nodeName.toLowerCase()){case"button":case"select":case"textarea":if(e.disabled){return true}break;case"input":if(this.deviceIsIOS&&e.type==="file"||e.disabled){
return true}break;case"label":case"video":return true}return/\bneedsclick\b/.test(e.className)};t.prototype.needsFocus=function(e){"use strict";switch(e.nodeName.toLowerCase()){case"textarea":return true;case"select":return!this.deviceIsAndroid;case"input":switch(e.type){case"button":case"checkbox":case"file":case"image":case"radio":case"submit":return false}return!e.disabled&&!e.readOnly;default:return/\bneedsfocus\b/.test(e.className)}};t.prototype.sendClick=function(e,t){"use strict";var i,n;if(document.activeElement&&document.activeElement!==e){document.activeElement.blur()}n=t.changedTouches[0];i=document.createEvent("MouseEvents");i.initMouseEvent(this.determineEventType(e),true,true,window,1,n.screenX,n.screenY,n.clientX,n.clientY,false,false,false,false,0,null);i.forwardedTouchEvent=true;e.dispatchEvent(i)};t.prototype.determineEventType=function(e){"use strict";if(this.deviceIsAndroid&&e.tagName.toLowerCase()==="select"){return"mousedown"}return"click"};t.prototype.focus=function(e){
"use strict";var t;if(this.deviceIsIOS&&e.setSelectionRange&&e.type.indexOf("date")!==0&&e.type!=="time"){t=e.value.length;e.setSelectionRange(t,t)}else{e.focus()}};t.prototype.updateScrollParent=function(e){"use strict";var t,i;t=e.fastClickScrollParent;if(!t||!t.contains(e)){i=e;do{if(i.scrollHeight>i.offsetHeight){t=i;e.fastClickScrollParent=i;break}i=i.parentElement}while(i)}if(t){t.fastClickLastScrollTop=t.scrollTop}};t.prototype.getTargetElementFromEventTarget=function(e){"use strict";if(e.nodeType===Node.TEXT_NODE){return e.parentNode}return e};t.prototype.onTouchStart=function(e){"use strict";var t,i,n;if(e.targetTouches.length>1){return true}t=this.getTargetElementFromEventTarget(e.target);i=e.targetTouches[0];if(this.deviceIsIOS){n=window.getSelection();if(n.rangeCount&&!n.isCollapsed){return true}if(!this.deviceIsIOS4){if(i.identifier===this.lastTouchIdentifier){e.preventDefault();return false}this.lastTouchIdentifier=i.identifier;this.updateScrollParent(t)}}this.trackingClick=true;
this.trackingClickStart=e.timeStamp;this.targetElement=t;this.touchStartX=i.pageX;this.touchStartY=i.pageY;if(e.timeStamp-this.lastClickTime<200){e.preventDefault()}return true};t.prototype.touchHasMoved=function(e){"use strict";var t=e.changedTouches[0],i=this.touchBoundary;if(Math.abs(t.pageX-this.touchStartX)>i||Math.abs(t.pageY-this.touchStartY)>i){return true}return false};t.prototype.onTouchMove=function(e){"use strict";if(!this.trackingClick){return true}if(this.targetElement!==this.getTargetElementFromEventTarget(e.target)||this.touchHasMoved(e)){this.trackingClick=false;this.targetElement=null}return true};t.prototype.findControl=function(e){"use strict";if(e.control!==undefined){return e.control}if(e.htmlFor){return document.getElementById(e.htmlFor)}return e.querySelector("button, input:not([type=hidden]), keygen, meter, output, progress, select, textarea")};t.prototype.onTouchEnd=function(e){"use strict";var t,i,n,s,o,r=this.targetElement;if(!this.trackingClick){return true}
if(e.timeStamp-this.lastClickTime<200){this.cancelNextClick=true;return true}var a=e.timeStamp-this.trackingClickStart;if(a>100){return false}this.cancelNextClick=false;this.lastClickTime=e.timeStamp;i=this.trackingClickStart;this.trackingClick=false;this.trackingClickStart=0;if(this.deviceIsIOSWithBadTarget){o=e.changedTouches[0];r=document.elementFromPoint(o.pageX-window.pageXOffset,o.pageY-window.pageYOffset)||r;r.fastClickScrollParent=this.targetElement.fastClickScrollParent}n=r.tagName.toLowerCase();if(n==="label"){t=this.findControl(r);if(t){this.focus(r);if(this.deviceIsAndroid){return false}r=t}}else if(this.needsFocus(r)){if(e.timeStamp-i>100||this.deviceIsIOS&&window.top!==window&&n==="input"){this.targetElement=null;return false}this.focus(r);if(!this.deviceIsIOS4||n!=="select"){this.targetElement=null;e.preventDefault()}return false}if(this.deviceIsIOS&&!this.deviceIsIOS4){s=r.fastClickScrollParent;if(s&&s.fastClickLastScrollTop!==s.scrollTop){return true}}if(!this.needsClick(r)){
e.preventDefault();this.sendClick(r,e)}return false};t.prototype.onTouchCancel=function(){"use strict";this.trackingClick=false;this.targetElement=null};t.prototype.onMouse=function(e){"use strict";if(!this.targetElement){return true}if(e.forwardedTouchEvent){return true}if(!e.cancelable){return true}if(!this.needsClick(this.targetElement)||this.cancelNextClick){if(e.stopImmediatePropagation){e.stopImmediatePropagation()}else{e.propagationStopped=true}e.stopPropagation();e.preventDefault();return false}return true};t.prototype.onClick=function(e){"use strict";var t;if(this.trackingClick){this.targetElement=null;this.trackingClick=false;return true}if(e.target.type==="submit"&&e.detail===0){return true}t=this.onMouse(e);if(!t){this.targetElement=null}return t};t.prototype.destroy=function(){"use strict";var e=this.layer;if(this.deviceIsAndroid){e.removeEventListener("mouseover",this.onMouse,true);e.removeEventListener("mousedown",this.onMouse,true);e.removeEventListener("mouseup",this.onMouse,true);
}e.removeEventListener("click",this.onClick,true);e.removeEventListener("touchstart",this.onTouchStart,false);e.removeEventListener("touchmove",this.onTouchMove,false);e.removeEventListener("touchend",this.onTouchEnd,false);e.removeEventListener("touchcancel",this.onTouchCancel,false)};t.notNeeded=function(e){"use strict";var i;var n;if(typeof window.ontouchstart==="undefined"){return true}n=+(/Chrome\/([0-9]+)/.exec(window.navigator.userAgent)||[,0])[1];if(n){if(t.prototype.deviceIsAndroid){i=document.querySelector("meta[name=viewport]");if(i){if(i.content.indexOf("user-scalable=no")!==-1){return true}if(n>31&&window.innerWidth<=window.screen.width){return true}}}else{return true}}if(e.style.msTouchAction==="none"){return true}return false};t.attach=function(e){"use strict";return new t(e)};if(typeof define!=="undefined"&&define.amd){define(function(){"use strict";return t})}else if(typeof e!=="undefined"&&e.exports){e.exports=t.attach;e.exports.FastClick=t}else{window.FastClick=t}});define("interface/jquery",["shared/polyfills","interface/settings","interface/helpers","jquery"],function ee(require,exports,e){
var t=require("interface/settings"),i=require("interface/helpers").wrap,n=require("interface/helpers").notImplemented,s,o;if(t.pageIsMobile){require("mobile_app2/zepto");s=window.Zepto;window.$=undefined;o=function(e){return s.zepto.isZ(e)}}else{s=require("jquery");o=function(e){return e instanceof s}}var r=["get","on","trigger","off","text","hasClass","addClass","removeClass","toggleClass","val","attr","prop","removeAttr","focus","html","is","map","css","length","height","width","scrollTop","scrollLeft","append","empty","offset"];function a(e,i,s,o){if(typeof s!=="string"){throw new TypeError("events must be a string. event/handler maps not supported.")}if(t.pageIsMobile){var r=s.split(" ");var a=r.reduce(function(e,t){return e||t=="click"},false);if(a){if(!e){n("removing click events on mobile")}var d=require("mobile_app2/util");d.safeClickHandlerForElements(i,o)}return r.filter(function(e){return e!=="click"}).join(" ")}return s}if(t.pageIsMobile){s.fn.originalOn=s.fn.on;s.fn.originalOff=s.fn.off;
s.fn.on=function(e,t){e=a(true,this.get(),e,t);return this.originalOn(e,t)};s.fn.off=function(e,t){e=a(false,this.get(),e,t);return this.originalOff(e,t)}}var d=function(){var e={on:function(e,t){e=a(true,this.get(),e,t);return e?this._super.call(this,e,t):this},off:function(e,t){e=a(false,this.get(),e,t);return e?this._super.call(this,e,t):this},_isJQuery:true};var t=s.apply(this,arguments);return i(e,t,r,o)};exports._jQuery=s;exports.jQuery=d;exports.isJQueryObj=function(e){var i=t.pageIsMobile?s.zepto.Z:s;return e instanceof i||!!e._isJQuery}});define("shared/beforeunload",["shared/polyfills","interface/jquery"],function te(require,exports,e){var t=require("interface/jquery")._jQuery;var i=[];exports.registerHandler=function(e){i.push(e)};var n=function(e){e=e||window.event;var t;for(var n=0;n<i.length;n++){var s=i[n].call(i,e);if(s){t=s;break}}if(e){e.returnValue=t}return t};t(window).on("beforeunload",n)});define("third_party/jquery.migrate",["shared/polyfills","jquery","shared/errors"],function ie(require,exports,e){
var t=require("jquery"),i=require("shared/errors");(function(e,t,n){e.migrateVersion="1.4.1";var s={};e.migrateWarnings=[];if(t.console&&t.console.log){t.console.log("JQMIGRATE: Migrate is installed"+(e.migrateMute?"":" with logging active")+", version "+e.migrateVersion)}if(e.migrateTrace===n){e.migrateTrace=true}e.migrateReset=function(){s={};e.migrateWarnings.length=0};function o(n){var o=t.console;if(!s[n]){s[n]=true;e.migrateWarnings.push(n);if(o&&o.warn&&!e.migrateMute){i.logJQueryError("JQMIGRATE",n)}}}function r(t,i,n,s){if(Object.defineProperty){try{Object.defineProperty(t,i,{configurable:true,enumerable:true,get:function(){o(s);return n},set:function(e){o(s);n=e}});return}catch(r){}}e._definePropertyBroken=true;t[i]=n}if(document.compatMode==="BackCompat"){o("jQuery is not compatible with Quirks Mode")}var a=e("<input/>",{size:1}).attr("size")&&e.attrFn,d=e.attr,l=e.attrHooks.value&&e.attrHooks.value.get||function(){return null},c=e.attrHooks.value&&e.attrHooks.value.set||function(){
return n},u=/^(?:input|button)$/i,h=/^[238]$/,f=/^(?:autofocus|autoplay|async|checked|controls|defer|disabled|hidden|loop|multiple|open|readonly|required|scoped|selected)$/i,p=/^(?:checked|selected)$/i;r(e,"attrFn",a||{},"jQuery.attrFn is deprecated");e.attr=function(t,i,s,r){var l=i.toLowerCase(),c=t&&t.nodeType;if(r){if(d.length<4){o("jQuery.fn.attr( props, pass ) is deprecated")}if(t&&!h.test(c)&&(a?i in a:e.isFunction(e.fn[i]))){return e(t)[i](s)}}if(i==="type"&&s!==n&&u.test(t.nodeName)&&t.parentNode){o("Can't change the 'type' of an input or button in IE 6/7/8")}if(!e.attrHooks[l]&&f.test(l)){e.attrHooks[l]={get:function(t,i){var s,o=e.prop(t,i);return o===true||typeof o!=="boolean"&&(s=t.getAttributeNode(i))&&s.nodeValue!==false?i.toLowerCase():n},set:function(t,i,n){var s;if(i===false){e.removeAttr(t,n)}else{s=e.propFix[n]||n;if(s in t){t[s]=true}t.setAttribute(n,n.toLowerCase())}return n}};if(p.test(l)){o("jQuery.fn.attr('"+l+"') might use property instead of attribute")}}return d.call(e,t,i,s);
};e.attrHooks.value={get:function(e,t){var i=(e.nodeName||"").toLowerCase();if(i==="button"){return l.apply(this,arguments)}if(i!=="input"&&i!=="option"){o("jQuery.fn.attr('value') no longer gets properties")}return t in e?e.value:null},set:function(e,t){var i=(e.nodeName||"").toLowerCase();if(i==="button"){return c.apply(this,arguments)}if(i!=="input"&&i!=="option"){o("jQuery.fn.attr('value', val) no longer sets properties")}e.value=t}};var g,m,v=e.fn.init,_=e.find,w=e.parseJSON,b=/^\s*</,y=/\[(\s*[-\w]+\s*)([~|^$*]?=)\s*([-\w#]*?#[-\w#]*)\s*\]/,C=/\[(\s*[-\w]+\s*)([~|^$*]?=)\s*([-\w#]*?#[-\w#]*)\s*\]/g,x=/^([^<]*)(<[\w\W]+>)([^>]*)$/;e.fn.init=function(t,i,s){var r,a;if(t&&typeof t==="string"){if(!e.isPlainObject(i)&&(r=x.exec(e.trim(t)))&&r[0]){if(!b.test(t)){o("$(html) HTML strings must start with '<' character")}if(r[3]){o("$(html) HTML text after last tag is ignored")}if(r[0].charAt(0)==="#"){o("HTML string cannot start with a '#' character");e.error("JQMIGRATE: Invalid selector string (XSS)");
}if(i&&i.context&&i.context.nodeType){i=i.context}if(e.parseHTML){return v.call(this,e.parseHTML(r[2],i&&i.ownerDocument||i||document,true),i,s)}}}a=v.apply(this,arguments);if(t&&t.selector!==n){a.selector=t.selector;a.context=t.context}else{a.selector=typeof t==="string"?t:"";if(t){a.context=t.nodeType?t:i||document}}return a};e.fn.init.prototype=e.fn;e.find=function(e){var t=Array.prototype.slice.call(arguments);if(typeof e==="string"&&y.test(e)){try{document.querySelector(e)}catch(i){e=e.replace(C,function(e,t,i,n){return"["+t+i+'"'+n+'"]'});try{document.querySelector(e);o("Attribute selector with '#' must be quoted: "+t[0]);t[0]=e}catch(n){o("Attribute selector with '#' was not fixed: "+t[0])}}}return _.apply(this,t)};var k;for(k in _){if(Object.prototype.hasOwnProperty.call(_,k)){e.find[k]=_[k]}}e.parseJSON=function(e){if(!e){o("jQuery.parseJSON requires a valid JSON string");return null}return w.apply(this,arguments)};e.uaMatch=function(e){e=e.toLowerCase();var t=/(chrome)[ \/]([\w.]+)/.exec(e)||/(webkit)[ \/]([\w.]+)/.exec(e)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(e)||/(msie) ([\w.]+)/.exec(e)||e.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(e)||[];
return{browser:t[1]||"",version:t[2]||"0"}};if(!e.browser){g=e.uaMatch(navigator.userAgent);m={};if(g.browser){m[g.browser]=true;m.version=g.version}if(m.chrome){m.webkit=true}else if(m.webkit){m.safari=true}e.browser=m}r(e,"browser",e.browser,"jQuery.browser is deprecated");e.boxModel=e.support.boxModel=document.compatMode==="CSS1Compat";r(e,"boxModel",e.boxModel,"jQuery.boxModel is deprecated");r(e.support,"boxModel",e.support.boxModel,"jQuery.support.boxModel is deprecated");e.sub=function(){function t(e,i){return new t.fn.init(e,i)}e.extend(true,t,this);t.superclass=this;t.fn=t.prototype=this();t.fn.constructor=t;t.sub=this.sub;t.fn.init=function n(s,o){var r=e.fn.init.call(this,s,o,i);return r instanceof t?r:t(r)};t.fn.init.prototype=t.fn;var i=t(document);o("jQuery.sub() is deprecated");return t};e.fn.size=function(){o("jQuery.fn.size() is deprecated; use the .length property");return this.length};var S=false;if(e.swap){e.each(["height","width","reliableMarginRight"],function(t,i){
var n=e.cssHooks[i]&&e.cssHooks[i].get;if(n){e.cssHooks[i].get=function(){var e;S=true;e=n.apply(this,arguments);S=false;return e}}})}e.swap=function(e,t,i,n){var s,r,a={};if(!S){o("jQuery.swap() is undocumented and deprecated")}for(r in t){a[r]=e.style[r];e.style[r]=t[r]}s=i.apply(e,n||[]);for(r in t){e.style[r]=a[r]}return s};e.ajaxSetup({converters:{"text json":e.parseJSON}});var E=e.fn.data;e.fn.data=function(t){var i,s,r=this[0];if(r&&t==="events"&&arguments.length===1){i=e.data(r,t);s=e._data(r,t);if((i===n||i===s)&&s!==n){o("Use of jQuery.fn.data('events') is deprecated");return s}}return E.apply(this,arguments)};var T=/\/(java|ecma)script/i;if(!e.clean){e.clean=function(t,i,n,s){i=i||document;i=!i.nodeType&&i[0]||i;i=i.ownerDocument||i;o("jQuery.clean() is deprecated");var r,a,d,l,c=[];e.merge(c,e.buildFragment(t,i).childNodes);if(n){d=function(e){if(!e.type||T.test(e.type)){return s?s.push(e.parentNode?e.parentNode.removeChild(e):e):n.appendChild(e)}};for(r=0;(a=c[r])!=null;r++){
if(!(e.nodeName(a,"script")&&d(a))){n.appendChild(a);if(typeof a.getElementsByTagName!=="undefined"){l=e.grep(e.merge([],a.getElementsByTagName("script")),d);c.splice.apply(c,[r+1,0].concat(l));r+=l.length}}}}return c}}var L=e.event.add,M=e.event.remove,D=e.event.trigger,A=e.fn.toggle,I=e.fn.live,q=e.fn.die,N=e.fn.load,O="ajaxStart|ajaxStop|ajaxSend|ajaxComplete|ajaxError|ajaxSuccess",R=new RegExp("\\b(?:"+O+")\\b"),P=/(?:^|\s)hover(\.\S+|)\b/,B=function(t){if(typeof t!=="string"||e.event.special.hover){return t}if(P.test(t)){o("'hover' pseudo-event is deprecated, use 'mouseenter mouseleave'")}return t&&t.replace(P,"mouseenter$1 mouseleave$1")};if(e.event.props&&e.event.props[0]!=="attrChange"){e.event.props.unshift("attrChange","attrName","relatedNode","srcElement")}if(e.event.dispatch){r(e.event,"handle",e.event.dispatch,"jQuery.event.handle is undocumented and deprecated")}e.event.add=function(e,t,i,n,s){if(e!==document&&R.test(t)){o("AJAX events should be attached to document: "+t)}
L.call(this,e,B(t||""),i,n,s)};e.event.remove=function(e,t,i,n,s){M.call(this,e,B(t)||"",i,n,s)};e.each(["load","unload","error"],function(t,i){e.fn[i]=function(){var e=Array.prototype.slice.call(arguments,0);if(i==="load"&&typeof e[0]==="string"){return N.apply(this,e)}o("jQuery.fn."+i+"() is deprecated");e.splice(0,0,i);if(arguments.length){return this.bind.apply(this,e)}this.triggerHandler.apply(this,e);return this}});e.fn.toggle=function(t,i){if(!e.isFunction(t)||!e.isFunction(i)){return A.apply(this,arguments)}o("jQuery.fn.toggle(handler, handler...) is deprecated");var n=arguments,s=t.guid||e.guid++,r=0,a=function(i){var s=(e._data(this,"lastToggle"+t.guid)||0)%r;e._data(this,"lastToggle"+t.guid,s+1);i.preventDefault();return n[s].apply(this,arguments)||false};a.guid=s;while(r<n.length){n[r++].guid=s}return this.click(a)};e.fn.live=function(t,i,n){o("jQuery.fn.live() is deprecated");if(I){return I.apply(this,arguments)}e(this.context).on(t,this.selector,i,n);return this};e.fn.die=function(t,i){
o("jQuery.fn.die() is deprecated");if(q){return q.apply(this,arguments)}e(this.context).off(t,this.selector||"**",i);return this};e.event.trigger=function(e,t,i,n){if(!i&&!R.test(e)){o("Global events are undocumented and deprecated")}return D.call(this,e,t,i||document,n)};e.each(O.split("|"),function(t,i){e.event.special[i]={setup:function(){var t=this;if(t!==document){e.event.add(document,i+"."+e.guid,function(){e.event.trigger(i,Array.prototype.slice.call(arguments,1),t,true)});e._data(this,i,e.guid++)}return false},teardown:function(){if(this!==document){e.event.remove(document,i+"."+e._data(this,i))}return false}}});e.event.special.ready={setup:function(){if(this===document){o("'ready' event is deprecated")}}};var F=e.fn.andSelf||e.fn.addBack,U=e.fn.find;e.fn.andSelf=function(){o("jQuery.fn.andSelf() replaced by jQuery.fn.addBack()");return F.apply(this,arguments)};e.fn.find=function(e){var t=U.apply(this,arguments);t.context=this.context;t.selector=this.selector?this.selector+" "+e:e;
return t};if(e.Callbacks){var j=e.Deferred,H=[["resolve","done",e.Callbacks("once memory"),e.Callbacks("once memory"),"resolved"],["reject","fail",e.Callbacks("once memory"),e.Callbacks("once memory"),"rejected"],["notify","progress",e.Callbacks("memory"),e.Callbacks("memory")]];e.Deferred=function(t){var i=j(),n=i.promise();i.pipe=n.pipe=function(){var t=arguments;o("deferred.pipe() is deprecated");return e.Deferred(function(s){e.each(H,function(o,r){var a=e.isFunction(t[o])&&t[o];i[r[1]](function(){var t=a&&a.apply(this,arguments);if(t&&e.isFunction(t.promise)){t.promise().done(s.resolve).fail(s.reject).progress(s.notify)}else{s[r[0]+"With"](this===n?s.promise():this,a?[t]:arguments)}})});t=null}).promise()};i.isResolved=function(){o("deferred.isResolved is deprecated");return i.state()==="resolved"};i.isRejected=function(){o("deferred.isRejected is deprecated");return i.state()==="rejected"};if(t){t.call(i,i)}return i}}})(t,window)});define("datepicker",["shared/polyfills","jquery"],function ne(require,exports,e){
var t=require("jquery");(function($){var e=function(e,i){this.element=$(e);this.format=t.parseFormat(i.format||this.element.data("date-format")||"mm/dd/yyyy");this.picker=$(t.template).appendTo("body").on({click:$.proxy(this.click,this)});this.isInput=this.element.is("input");this.component=this.element.is(".date")?this.element.find(".add-on"):false;if(this.isInput){this.element.on({focus:$.proxy(this.show,this),keyup:$.proxy(this.update,this)})}else{if(this.component){this.component.on("click",$.proxy(this.show,this))}else{this.element.on("click",$.proxy(this.show,this))}}this.minViewMode=i.minViewMode||this.element.data("date-minviewmode")||0;if(typeof this.minViewMode==="string"){switch(this.minViewMode){case"months":this.minViewMode=1;break;case"years":this.minViewMode=2;break;default:this.minViewMode=0;break}}this.viewMode=i.viewMode||this.element.data("date-viewmode")||0;if(typeof this.viewMode==="string"){switch(this.viewMode){case"months":this.viewMode=1;break;case"years":this.viewMode=2;
break;default:this.viewMode=0;break}}this.startViewMode=this.viewMode;this.weekStart=i.weekStart||this.element.data("date-weekstart")||0;this.weekEnd=this.weekStart===0?6:this.weekStart-1;this.onRender=i.onRender;this.fillDow();this.fillMonths();this.update();this.showMode()};e.prototype={constructor:e,show:function(e){this.picker.show();this.height=this.component?this.component.outerHeight():this.element.outerHeight();this.place();$(window).on("resize",$.proxy(this.place,this));if(e){e.stopPropagation();e.preventDefault()}var t=this;$(document).on("mousedown",function(e){if($(e.target).closest(".datepicker").length==0){t.hide()}});this.element.trigger({type:"show",date:this.date})},hide:function(){this.picker.hide();$(window).off("resize",this.place);this.viewMode=this.startViewMode;this.showMode();if(!this.isInput){$(document).off("mousedown",this.hide)}this.element.trigger({type:"hide",date:this.date})},set:function(){var e=t.formatDate(this.date,this.format);if(!this.isInput){if(this.component){
this.element.find("input").prop("value",e)}this.element.data("date",e)}else{this.element.prop("value",e)}},setValue:function(e){if(typeof e==="string"){this.date=t.parseDate(e,this.format)}else{this.date=new Date(e)}this.set();this.viewDate=new Date(this.date.getFullYear(),this.date.getMonth(),1,0,0,0,0);this.fill()},place:function(){var e=this.component?this.component.offset():this.element.offset();this.picker.css({top:e.top+this.height-262,left:e.left})},update:function(e){this.date=t.parseDate(typeof e==="string"?e:this.isInput?this.element.prop("value"):this.element.data("date"),this.format);this.viewDate=new Date(this.date.getFullYear(),this.date.getMonth(),1,0,0,0,0);this.fill()},fillDow:function(){var e=this.weekStart;var i="<tr>";while(e<this.weekStart+7){i+='<th class="dow">'+t.dates.daysMin[e++%7]+"</th>"}i+="</tr>";this.picker.find(".datepicker-days thead").append(i)},fillMonths:function(){var e="";var i=0;while(i<12){e+='<span class="month">'+t.dates.monthsShort[i++]+"</span>";
}this.picker.find(".datepicker-months td").append(e)},fill:function(){var e=new Date(this.viewDate),i=e.getFullYear(),n=e.getMonth(),s=this.date.valueOf();this.picker.find(".datepicker-days th:eq(1)").text(t.dates.months[n]+" "+i);var o=new Date(i,n-1,28,0,0,0,0),r=t.getDaysInMonth(o.getFullYear(),o.getMonth());o.setDate(r);o.setDate(r-(o.getDay()-this.weekStart+7)%7);var a=new Date(o);a.setDate(a.getDate()+42);a=a.valueOf();var d=[];var l,c,u;while(o.valueOf()<a){if(o.getDay()===this.weekStart){d.push("<tr>")}l=this.onRender(o);c=o.getFullYear();u=o.getMonth();if(u<n&&c===i||c<i){l+=" old"}else if(u>n&&c===i||c>i){l+=" new"}if(o.valueOf()===s){l+=" active"}d.push('<td class="day '+l+'">'+o.getDate()+"</td>");if(o.getDay()===this.weekEnd){d.push("</tr>")}o.setDate(o.getDate()+1)}this.picker.find(".datepicker-days tbody").empty().append(d.join(""));var h=this.date.getFullYear();var f=this.picker.find(".datepicker-months").find("th:eq(1)").text(i).end().find("span").removeClass("active");if(h===i){
f.eq(this.date.getMonth()).addClass("active")}d="";i=parseInt(i/10,10)*10;var p=this.picker.find(".datepicker-years").find("th:eq(1)").text(i+"-"+(i+9)).end().find("td");i-=1;for(var g=-1;g<11;g++){d+='<span class="year'+(g===-1||g===10?" old":"")+(h===i?" active":"")+'">'+i+"</span>";i+=1}p.html(d)},click:function(e){e.stopPropagation();e.preventDefault();var i=$(e.target).closest("span, td, th");if(i.length===1){switch(i[0].nodeName.toLowerCase()){case"th":switch(i[0].className){case"switch":this.showMode(1);break;case"prev":case"next":this.viewDate["set"+t.modes[this.viewMode].navFnc].call(this.viewDate,this.viewDate["get"+t.modes[this.viewMode].navFnc].call(this.viewDate)+t.modes[this.viewMode].navStep*(i[0].className==="prev"?-1:1));this.fill();this.set();break}break;case"span":if(i.is(".month")){var n=i.parent().find("span").index(i);this.viewDate.setMonth(n)}else{var s=parseInt(i.text(),10)||0;this.viewDate.setFullYear(s)}if(this.viewMode!==0){this.date=new Date(this.viewDate);this.element.trigger({
type:"changeDate",date:this.date,viewMode:t.modes[this.viewMode].clsName})}this.showMode(-1);this.fill();this.set();break;case"td":if(i.is(".day")&&!i.is(".disabled")){var o=parseInt(i.text(),10)||1;var n=this.viewDate.getMonth();if(i.is(".old")){n-=1}else if(i.is(".new")){n+=1}var s=this.viewDate.getFullYear();this.date=new Date(s,n,o,0,0,0,0);this.viewDate=new Date(s,n,Math.min(28,o),0,0,0,0);this.fill();this.set();this.element.trigger({type:"changeDate",date:this.date,viewMode:t.modes[this.viewMode].clsName})}break}}},mousedown:function(e){e.stopPropagation();e.preventDefault()},showMode:function(e){if(e){this.viewMode=Math.max(this.minViewMode,Math.min(2,this.viewMode+e))}this.picker.find(">div").hide().filter(".datepicker-"+t.modes[this.viewMode].clsName).show()}};$.fn.datepicker=function(t,i){return this.each(function(){var n=$(this),s=n.data("datepicker"),o=typeof t==="object"&&t;if(!s){n.data("datepicker",s=new e(this,$.extend({},$.fn.datepicker.defaults,o)))}if(typeof t==="string")s[t](i);
})};$.fn.datepicker.defaults={onRender:function(e){return""}};$.fn.datepicker.Constructor=e;var t={modes:[{clsName:"days",navFnc:"Month",navStep:1},{clsName:"months",navFnc:"FullYear",navStep:1},{clsName:"years",navFnc:"FullYear",navStep:10}],dates:{days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],daysShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sun"],daysMin:["Su","Mo","Tu","We","Th","Fr","Sa","Su"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],monthsShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]},isLeapYear:function(e){return e%4===0&&e%100!==0||e%400===0},getDaysInMonth:function(e,i){return[31,t.isLeapYear(e)?29:28,31,30,31,30,31,31,30,31,30,31][i]},parseFormat:function(e){var t=e.match(/[.\/\-\s].*?/),i=e.split(/\W+/);if(!t||!i||i.length===0){throw new Error("Invalid date format.")}return{separator:t,parts:i}},parseDate:function(e,t){var i=e.split(t.separator),e=new Date,n;
e.setHours(0);e.setMinutes(0);e.setSeconds(0);e.setMilliseconds(0);if(i.length===t.parts.length){var s=e.getFullYear(),o=e.getDate(),r=e.getMonth();for(var a=0,d=t.parts.length;a<d;a++){n=parseInt(i[a],10)||1;switch(t.parts[a]){case"dd":case"d":o=n;e.setDate(n);break;case"mm":case"m":r=n-1;e.setMonth(n-1);break;case"yy":s=2e3+n;e.setFullYear(2e3+n);break;case"yyyy":s=n;e.setFullYear(n);break}}e=new Date(s,r,o,0,0,0)}return e},formatDate:function(e,t){var i={d:e.getDate(),m:e.getMonth()+1,yy:e.getFullYear().toString().substring(2),yyyy:e.getFullYear()};i.dd=(i.d<10?"0":"")+i.d;i.mm=(i.m<10?"0":"")+i.m;var e=[];for(var n=0,s=t.parts.length;n<s;n++){e.push(i[t.parts[n]])}return e.join(t.separator)},headTemplate:"<thead>"+"<tr>"+'<th class="prev">&laquo;</th>'+'<th colspan="5" class="quora-switch"></th>'+'<th class="next">&raquo;</th>'+"</tr>"+"</thead>",contTemplate:'<tbody><tr><td colspan="7"></td></tr></tbody>'};t.template='<div class="datepicker dropdown-menu quora-datepicker">'+'<div class="datepicker-days">'+'<table class=" table-condensed">'+t.headTemplate+"<tbody></tbody>"+"</table>"+"</div>"+'<div class="datepicker-months">'+'<table class="table-condensed">'+t.headTemplate+t.contTemplate+"</table>"+"</div>"+'<div class="datepicker-years">'+'<table class="table-condensed">'+t.headTemplate+t.contTemplate+"</table>"+"</div>"+"</div>";
})(t)});define("jquery.webnode2",["shared/polyfills","shared/browser","webnode2","shared/core/component","jquery","w2.livenode"],function jquery_webnode2(require,exports,module){var browser=require("shared/browser"),W2=require("webnode2"),coreComponent=require("shared/core/component"),jQuery=require("jquery");(function($){$.fn.forgetContents=function(){this.find("*").map(function(){var e=coreComponent._domidToCid[this.id];if(!e){return}W2._ignoreDomids[this.id]=1;W2._ignoreCids[e]=1});return this};$.getScrollbarWidth=function(){var e=document.createElement("p");e.style.width="100%";e.style.height="200px";var t=document.createElement("div");t.style.position="absolute";t.style.top="0px";t.style.left="0px";t.style.visibility="hidden";t.style.width="200px";t.style.height="150px";t.style.overflow="hidden";t.appendChild(e);document.body.appendChild(t);var i=e.offsetWidth;t.style.overflow="scroll";var n=e.offsetWidth;if(i==n){n=t.clientWidth}document.body.removeChild(t);return i-n};$.fn.addAnimationClass=function(e,t){
var i=this;if(browser.msie&&browser.version<=9){t();return this}var n="W2_css_animation";var s=["-webkit-animation-name","-moz-animation-name","-o-animation-name","-ms-animation-name"];this.addClass(e);this.bind("oanimationend animationend webkitAnimationEnd MSAnimationEnd",function(e){i.trigger(r(e))});function o(){for(var e=0;e<s.length;e++){var t=i.css(s[e]);if(t){return t}}}function r(e){if(!e){return false}var t=e.originalEvent.animationName;return t+n}var a=o()+n;this.on(a,function(){i.unbind(a);i.removeClass(e);t()});return this};$.fn.setContent=function(e){if(typeof e=="string"){this.html(e)}else{this.setContentHTML(e);this.setContentJS(e)}return this};$.fn.setContentHTML=function(e){return this.html(e.html)};$.fn.setContentJS=function(content){var W2=require("webnode2");var LiveNode=require("w2.livenode");eval(content.js)};var guid=(+new Date).toString(16);function inDom(e){if(!e||!e.parentNode){return false}var t=e.getAttribute("id"),i;e.setAttribute("id",guid);i=!!document.getElementById(guid);
if(t){e.setAttribute("id",t)}else{e.removeAttribute("id")}return i}var anchoring=false;$.fn.anchor=function(e){if(anchoring||this.length<1){return this}anchoring=true;var t=[],i=$(window).scrollTop(),n=$(window).scrollLeft();t.length=this.length;for(var s=0;this[s];++s){t[s]=[this[s],$(this[s]).offset().top-i]}function o(){var e={},i,s=0,o,r,a=[,-1];while(o=t[s++]){if(!inDom(o[0])){continue}i=$(o[0]).offset().top-o[1];r=e[i]=(e[i]||0)+1;if(a[1]<r){a=[i,r]}}if(a[1]!=-1){window.scrollTo(n,Math.round(a[0],0))}anchoring=false}if(e){return o}setTimeout(o,10);return this}})(jQuery)});define("shared/frame_busting",["shared/polyfills","interface/settings","shared/log"],function se(require,exports,e){var t=require("interface/settings"),i=require("shared/log");exports.check=function(){if(t.enableFrameBusting){var e=false;try{e=!/\.quora\.com$/i.test(window.top.location.host)}catch(n){e=true}if(e){if(""+window.top.location!=""+window.location){window.top.location=window.location;if(i&&i.enabled){i("frame_busting","Updating window.location.");
}}}}}});define("visibility",["shared/polyfills"],function oe(require,exports,e){function t(){try{var e=window.frameElement;e.getAttribute("className");return e}catch(t){return null}}exports.getFrameElement=t;function i(e,t){return(" "+(e.className||"")+" ").indexOf(" "+t+" ")!=-1}function n(e,t){if(!i(e,t)){e.className=(e.className||"")+" "+t}}function s(e){var t=/^\s+/,i=/\s+$/;return e.trim?e.trim():e.replace(t,"").replace(i,"")}function o(e,t){e.className=s((" "+(e.className||"")+" ").replace(" "+t+" "," "))}exports.setVisible=function(e){var i=t();if(e){window.focus();if(i){n(i,"maximized")}else{o(document.body,"minimized")}}else{if(i){o(i,"maximized")}else{n(document.body,"minimized")}}};exports.isVisible=function(){var e=t();if(e){return i(e,"maximized")}else{return!i(document.body,"minimized")}};exports.addClass=n;exports.hasClass=i;exports.removeClass=o});define("tooltip",["shared/polyfills","shared/Class","shared/util","jquery"],function re(require,exports,e){var t=require("shared/Class").Class,i=require("shared/util"),$=require("jquery");
exports.attach=function(e,t,i){var s=new n(e,t,i);s.bindHover()};var n=t.extend({__init__:function(e,t,n){this.$elem=$(e);this.text=t;this.options=i.extend({delay:75,direction:"top",align:"center",container_class:"document",vertical_offset:0,attach_to_body:false},n)},updateText:function(e){this.text=e},closeAll:function(){clearTimeout(this.timer);this.timer=null;this.$tooltip=null;$(".tooltip_parent").removeClass("tooltip_parent");$(".tooltip").remove()},render:function(){this.closeAll();this._renderTooltipElem();this._positionTooltip();var e=this;this.timer=setTimeout(function(){e.$tooltip.show()},this.options.delay)},bindHover:function(){this.$elem.on("mouseenter",this.render.bind(this));this.$elem.on("mouseleave",this.closeAll.bind(this))},_shouldRenderTooltipBelow:function(){var e=this.$elem.offset();var t=50;if(this.options.container_class=="document"){return e.top<t||this.options.direction=="bottom"}else{var i=$("."+this.options.container_class).offset();return e.top-i.top<t||this.options.direction=="bottom";
}},_renderTooltipElem:function(){var e=$("<span>").text(this.text);var t=$("<div>").addClass("tooltip_contents");var i=$("<div>").addClass("tooltip");t.addClass(this._shouldRenderTooltipBelow()?"nub_top":"nub_bottom");t.append(e);i.append(t);this.$tooltip=i},_positionTooltip:function(){this.$tooltip.appendTo(this.options.attach_to_body?$("body"):this.$elem);this.$elem.addClass("tooltip_parent");this.$tooltip.css("display","block");var e=this.$tooltip.find(".tooltip_contents").outerWidth();this.$tooltip.css("display","none");var t=this.$tooltip.height()+5;var i=this.$elem.offset();var n=this.$elem.height();var s=this.$elem.outerWidth();var o=this._shouldRenderTooltipBelow();var r=parseInt(this.$elem.css("line-height"),10);var a=this.$elem.is("a")&&this.$elem.text()&&n-5>r;if(this.options.attach_to_body&&o){this.$tooltip.css("top",i.top+t+"px")}else if(this.options.attach_to_body){this.$tooltip.css("top",i.top-t+"px")}else if(o){this.$tooltip.css("top",n+5+this.options.vertical_offset+"px");
}else{this.$tooltip.css("top",t*-1-this.options.vertical_offset+"px")}var d=a?"left":this.options.align;if(this.options.attach_to_body){if(d=="center"){var l=i.left+(s-e)/2;this.$tooltip.css("left",l+"px")}else if(d=="right"){this.$tooltip.css("left",i.left+s-e+"px")}else{this.$tooltip.css("left",i.left+"px")}}else{if(d=="center"){this.$tooltip.css("left",(s-e)/2+"px")}else if(d=="right"){this.$tooltip.css("right","0")}else{this.$tooltip.css("left","-16px")}}}})});define("qtext",["shared/polyfills","jquery","tooltip"],function ae(require,exports,e){var $=require("jquery"),t=require("tooltip");exports.init=function(){$(document).on("mouseover","a[data-qt-tooltip]",function(e){var i=$(this);if(i.attr("data-tooltip")){return false}i.attr("data-tooltip","attached");t.attach(i,i.attr("data-qt-tooltip"));setTimeout(function(){i.trigger("mouseenter")},10);return false})}});define("init",["shared/polyfills","shared/frame_busting","shared/log","shared/cookies","shared/onload","visibility","qtext","jquery"],function de(require,exports,e){
var t=require("shared/frame_busting"),i=require("shared/log").log,n=require("shared/cookies"),s=require("shared/onload"),o=require("visibility"),r=require("qtext"),$=require("jquery");t.check();window.console=window.console||i.console;var a=function(){var e=o.getFrameElement();if(e&&e.getAttribute("autoresize")==="true"){var t=$(document),i=t.width(),n=t.height();$(e).width(i).height(n)}};window.addEventListener("resize",a);$(document).ready(a);n.setCookie("tz",(new Date).getTimezoneOffset(),{path:"/"});r.init();s.execAfterLoadDelayed(function(){window.require.prefetchAll()})});define("facebook",["shared/polyfills","settings","shared/facebook","webnode2","interface/jquery","shared/cookies","shared/onload","shared/window_manager"],function le(require,exports,e){var t=require("settings"),i=require("shared/facebook"),n=require("webnode2").Component,$=require("interface/jquery")._jQuery,s=require("shared/cookies"),o=require("shared/onload"),r=require("shared/window_manager"),a=null;window.loginInProgress=false;
function d(e,t){for(var i=0;i<e.length;i++){if(e[i].permission==t){return e[i].status=="granted"}}return false}var l=n.extend({onLoad:function(){i.onInit(function(){})}});function c(e){i.onInit(function(){FB.getLoginStatus(function(t){e(t)})})}exports.getLoginStatus=c;exports.getAuthResponse=function(){return i.isLoaded()?FB.getAuthResponse():null};exports.getAccessToken=function(){var e=exports.getAuthResponse();return e?e.accessToken:null};exports.getExpiresIn=function(){var e=exports.getAuthResponse();return e?e.expiresIn:null};exports.getFbUid=function(){var e=exports.getAuthResponse();return e?e.userID:null};exports.FacebookAccessTokenRefresher=n.extend({onLoad:function(){var e=this;c(function(i){if(i.status=="connected"){if(window.loginInProgress===true){return}window.loginInProgress=true;var n=i.authResponse;e.serverCall("update_access_token").kwargs({fb_uid:n.userID,access_token:n.accessToken,expires:n.expiresIn}).success(function(e){if(e&&t.pageMode=="post_reload"){r.reload()}window.loginInProgress=false;
}).error(function(){window.loginInProgress=false}).except(function(){window.loginInProgress=false}).send()}})}});function u(e){if(a===null||e){c(function(e){if(e.status=="connected"){h()}})}}function h(e){FB.api("/me/permissions",function(t){if(t.data&&t.data.length>0){a=t.data;if(e){e(true,a)}}else{a=null;if(e){e(false)}}})}exports.asyncUpdatePermissions=u;exports.updatePermissions=h;function f(e){return a&&a[e]==1}exports.hasPermission=f;function p(e,t){for(var i=0;i<e.length;++i){if(!t(e[i])){return false}}return true}exports.requestPermissions=function(e,t){if(!p(e.split(","),f)){FB.login(function(i){if(i.status==="connected"){h(function(i,n){t(i&&p(e.split(","),f))})}else{t(false)}},{scope:e})}else{t(true)}};exports.FacebookConnectedToDifferentAccount=l.extend({onLoad:function(){this._super.apply(this,arguments);this.$id("@fb_logout").on("click",this.onClickFbLogout.bind(this));this.$id("@settings").on("click",this.onClickSettings.bind(this))},show:function(){var e=this;FB.api("/me",function(t){
if(t.name){e.$id("@fb_unknown_login").hide();e.$id("@fb_logged_in_name").text(t.name);e.$id("@fb_logged_in_link").show();e.$id("@fb_logged_in_link").attr("href",t.link)}});this.$id("@fb_different_account").show()},onClickFbLogout:function(){var e=this;FB.logout(function(t){e.$id("@fb_different_account").hide()});return false},onClickSettings:function(){this.$id("@fb_different_account").hide()}});function g(e,t,n){if(!i.isLoaded()){u();return false}var s=null;if(FB.getAuthResponse()){s=FB.getAuthResponse().userID}if(s&&e){if(s==e){if(f("publish_actions")){t()}else{m(e,t)}}else{n(s)}}else{m(e,t,n)}return false}exports.maybePromptToPublish=g;function m(e,t,i){FB.login(function(n){if(n.status=="connected"){var s=n.authResponse;if(!e||s.userID==e){t(s.userID,s.accessToken,s.expiresIn)}else{i(s.userID)}}},{scope:"publish_actions"})}exports._disconnect=function(){FB.getLoginStatus(function(e){if(e.authReponse){FB.api({method:"auth.revokeAuthorization"},function(e){if(e){console.log("Successfully disconnected");
}else{console.error("Disconnection failed")}},console.error)}else{console.warn("Already not connected")}})};exports.FacebookNetworkShare=l.extend({onLoad:function(){this._super.apply(this,arguments);this.$id("@share").on("click",this.onClick.bind(this))},onClick:function(){var e=this;if(e.is_debugging_mode){console.log(e.share_url);console.log(e.target)}FB.ui({method:"feed",display:"popup",link:e.share_url},function(t){if(t&&t.post_id){s.setQfeedLog(e,"ShareFacebook");s.setTlog({type:"ShareFacebook"});e.serverCall("record_facebook_share").send()}else{}});return false}});var v=l.extend({onLoad:function(){this._super.apply(this,arguments);this.$id("@facebook_connect_button").on("click",this.onClickFacebookConnectButton.bind(this))},connect:function(){var e=this;FB.login(function(t){if(t&&t.status=="connected"){e.onLogin(t.authResponse)}else{e.onLoginFailed()}},{scope:this.perms})},onClick:function(){},onLogin:function(e){},onLoginFailed:function(){},onClickFacebookConnectButton:function(){
if(i.isLoaded()){this.connect();this.onClick()}return false}});exports.FacebookConnectButton=v.extend({onLogin:function(e){this._onLogin(e)},_onLogin:function(e){this.serverCall("connect_facebook").kwargs({fb_access_token:e.accessToken,fb_uid:e.userID,expires:e.expiresIn}).liveMutate().send()}});exports.FacebookAccountConnectedTo=l.extend({onLoad:function(){this._super.apply(this,arguments);this.$id("@facebook_disconnect_button").on("click",this.onClickFacebookDisconnectButton.bind(this))},onClickFacebookDisconnectButton:function(){this.serverCall("disconnect_facebook").liveMutate().success(function(){FB.getLoginStatus(function(){},true)}).send();return false}});exports.FacebookOptionLink=l.extend({onLoad:function(){this._super.apply(this,arguments);this.$id("@enable").on("click",this.onClickEnable.bind(this));this.$id("@disable").on("click",this.onClickDisable.bind(this));this.$id("@hide").on("click",this.onClickHide.bind(this))},onClickEnable:function(){this.serverCall("toggle_option").kwargs({
enabled:true}).liveMutate().send();return false},onClickDisable:function(){this.serverCall("toggle_option").kwargs({enabled:false}).liveMutate().send();return false},onClickHide:function(){this.serverCall("hide").liveMutate().send();return false}});exports.FacebookToggleTimelineLink=l.extend({onLoad:function(){this._super.apply(this,arguments);this.$id("@enable").on("click",this.onClickEnable.bind(this));this.$id("@disable").on("click",this.onClickDisable.bind(this))},onEnable:function(e){this.serverCall("enable_timeline").kwargs({fb_access_token:e.accessToken,fb_uid:e.userID,expires:e.expiresIn}).liveMutate().send()},onDisable:function(){this.serverCall("disable_timeline").liveMutate().send()},onLoginFailed:function(){this.$id("@option").prop("checked",false)},onClickEnable:function(){var e=this;FB.login(function(t){if(t&&t.status=="connected"){var i=t.authResponse;h(function(t,n){if(t&&d(n,"publish_actions")){e.onEnable(i)}else{e.onLoginFailed()}})}else{e.onLoginFailed()}},{scope:"publish_actions"
});return false},onClickDisable:function(){this.onDisable();return false}});o.execAfterLoadDelayed(function(){$(document).bind("fire_facebook_conversion_pixel",function(e,t){var i=new Image(1,1);i.src="https://www.facebook.com/offsite_event.php?id="+t+"&amp;value=0.01&amp;currency=USD"})})});define("oauth",["shared/polyfills","interface/jquery"],function ce(require,exports,e){var $=require("interface/jquery")._jQuery;exports.generateOAuthConnectFunction=function t(e,i,n,s){n=n||400;s=s||800;return function(t,o){var r=null;$(document).one(e+"."+Math.random(),function(e,i){var n=i.accessToken,s=i.userData;if(r){clearInterval(r);r=null}t(n,s)});var a=window.screen.width/2-s/2;var d=window.screen.height/2-n/2;var l="width="+s+", height="+n+"location=no,toolbar=no,status=no,top="+d+",left="+a;var c=window.open(i,"_BLANK",l);if(o){r=setInterval(function(){if(r&&c.closed){clearInterval(r);o()}},200)}}}});define("shared/twitter",["shared/polyfills","shared/onload","shared/util","shared/loadjs"],function ue(require,exports,e){
var t=require("shared/onload"),i=require("shared/util"),n=require("shared/loadjs").loadJS,s=false,o=[];var r=i.once(function(){var e=window.twttr={_events:[],ready:function(t){e._events.push(t)}};n("//platform.twitter.com/widgets.js",function(){window.twttr.ready(function(e){s=true;while(o.length){o.pop().call()}})})});exports.onInit=function(e){if(s){e()}else{o.push(e);t.execAfterLoadDelayed(r)}}});define("twitter",["shared/polyfills","webnode2","oauth","shared/cookies","shared/twitter"],function he(require,exports,e){var t=require("webnode2").Component,i=require("oauth").generateOAuthConnectFunction,n=require("shared/cookies"),s=require("shared/twitter").onInit;var o=i("twitter_oauth_approved","/twitter/oauth_window",400,800);exports.connectToTwitter=o;var r=t.extend({isTweeted:function(e){var t=this;var i=String(e.target.id);var n=String(t.cid);return i.indexOf(n)>-1}});exports.TwitterNetworkShare=r.extend({onLoad:function(){var e=this;s(function(){window.twttr.events.bind("tweet",function(t){
if(e.isTweeted(t)){n.setQfeedLog(e,"ShareTwitter");n.setTlog({type:"ShareTwitter"});e.serverCall("record_tweet").send()}})})}});exports.TwitterConnectCallbackPage=t.extend({onLoad:function(){n.setCookie("twitter_oauth_access_key",this.access_token.key,{path:"/twitter/"});if(window.opener&&window.opener.document){window.opener.$(window.opener.document).trigger("twitter_oauth_approved",{accessToken:this.access_token,userData:this.user_data});window.close()}else{if(typeof localStorage!=="undefined"){localStorage.setItem("twloginresult",JSON.stringify({accessToken:this.access_token,userData:this.user_data}))}window.close()}}})});define("shared/mathjax",["shared/polyfills","shared/onload","interface/settings"],function fe(require,exports,e){var t=require("shared/onload"),i=require("interface/settings");var n=exports.processClass="render_latex";var s=exports.ignoreClass="ignore_latex";function o(e){var t=function(){var e="https://cdn.mathjax.org/mathjax/2.6-latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML,Safe";
var t=i();var n=document.createElement("script");n.type="text/javascript";n.appendChild(document.createTextNode(t));var s=document.createElement("script");s.type="text/javascript";s.async=true;s.src=e;var o=document.getElementsByTagName("script")[0];o.parentNode.insertBefore(n,o);o.parentNode.insertBefore(s,o)};var i=function(){var e={showMathMenu:false,messageStyle:"none",errorSettings:o(),"HTML-CSS":r(),tex2jax:a(),TeX:d(),"fast-preview":{disabled:true}};return"window.MathJax = "+JSON.stringify(e)+";"};var o=function(){return{style:{color:"#000000","font-style":"normal"}}};var r=function(){return{linebreaks:{automatic:true,width:"container"},EqnChunk:e?10:150,EqnChunkDelay:e?100:20}};var a=function(){return{inlineMath:[["[math]","[/math]"]],displayMath:[],ignoreClass:"edit_latex|qtext_editor_content|"+s,processClass:n,preview:"none"}};var d=function(){return{noUndefined:{attributes:{mathcolor:"red"}},Macros:{C:"{\\mathbb{C}}",N:"{\\mathbb{N}}",O:"{\\emptyset}",Q:"{\\mathbb{Q}}",R:"{\\mathbb{R}}",
Z:"{\\mathbb{Z}}"}}};t()}t.execAfterLoad(function(){if(window.MathJax&&MathJax.Hub){return}o(i.pageIsMobile)})});define("shared/recaptcha",["shared/polyfills","settings","shared/util","shared/loadjs","shared/onload"],function pe(require,exports,e){var t=require("settings"),i=require("shared/util"),n=require("shared/loadjs").loadJS,s=require("shared/onload"),o=false,r=[];var a=i.once(function(){var e=["https://www.google.com/recaptcha/api.js?","hl="+t.interfaceLanguage,"&onload=onCaptchaLoadedCallback","&render=explicit"].join("");window.onCaptchaLoadedCallback=function(){o=true;while(r.length){r.pop().call()}};n(e)});exports.onInit=function(e){if(o){e()}else{r.push(e);s.execAfterLoadDelayed(a)}}});define("shared/action_log",["shared/polyfills","settings","interface/jquery","interface/settings","shared/viewport","shared/cookies","shared/logging","shared/debounce","shared/core/component"],function ge(require,exports,e){var t=require("settings"),$=require("interface/jquery")._jQuery,i=require("interface/settings").pageIsMobile,n=require("shared/viewport"),s=require("shared/cookies"),o=require("shared/logging"),r=require("shared/debounce").debounce,a=require("shared/core/component").Component,d={},l=500,c=null,u=false,h=0,f,p;
if(i){f=require("mobile_app2/client");p=require("mobile_app2/util")}function g(e){o.log("action_log",e)}function m(e){if(!d[e.cid]){return}if(e.impression_target){g(e.impression_target)}delete d[e.cid]}function v(e,t,i,n){s.setMessage("alog",[e,t,i,n])}function _(e,t){if(!t){return}v(e,t,null,null)}exports.logPrimaryAction=_;function w(e,i){var n=t.actionTrail;if(!n){return}v(e,null,i,n)}exports.logSecondaryAction=w;function b(e){d[e.cid]=e;if(!i){if(!u){document.addEventListener("scroll",x);u=true}C()}}function y(e){delete d[e.cid]}function C(){if(c){clearTimeout(c)}c=setTimeout(x,l)}var x=r(function(){for(var e in d){var t=d[e];if(n.isElementInViewport(t.$id("@actionable").get(0))){m(t)}}},l);exports.ActionableComponent=a.extend({onLoad:function(){b(this);if(i){this._handleOnLoadMobile()}else{this._handleOnLoadDesktop()}},_handleOnLoadMobile:function(){var e=this,t=e.ge("@actionable"),i=t&&t.getElementsByTagName("a"),n,s,o=function(t){return function(i){var n=t.getAttribute("action_mousedown")||t.getAttribute("action_click");
if(!i.stopActionLogging){e.processAction(n)}if(t.getAttribute("action_stop_propagation")){i.stopActionLogging=true}}};e.setDvar("impression_target",e.impression_target);if(i){for(s=0;s<i.length;++s){n=i[s];p.safeClickHandler(n,o(n))}}},_handleOnLoadDesktop:function(){var e=this;this.$id("@actionable").on("mousedown",function(t){var i=t.originalEvent||t;if(!i.stopActionLogging){e.processAction($(t.currentTarget).attr("action_mousedown"),$(t.currentTarget).attr("action_target"))}if($(t.currentTarget).attr("action_stop_propagation")){i.stopActionLogging=true}});this.$id("@actionable").on("click",function(t){var i=t.originalEvent||t;if(!i.stopActionLogging){e.processAction($(t.currentTarget).attr("action_click"),$(t.currentTarget).attr("action_target"))}if($(t.currentTarget).attr("action_stop_propagation")){i.stopActionLogging=true}})},sendActions:function(){if(!i){this.serverCall("send_actions").send()}},processAction:function(e){var t=this;if(!e){return}m(t);_(e,t.impression_target);t.actionCallback(e);
},actionCallback:function(e){},onUnload:function(){if(!i){y(this)}}});function k(e,t){if(!e){return}w(e,t)}exports.registerActionLogClickHandlers=function(){if(i){p.safeClickHandler(document,function(e){var t=f.touchableTarget(e.target);if(!t||t===document){return true}var i=t.getAttribute("action_mousedown")||t.getAttribute("action_click");if(!i){return true}var n=t.getAttribute("action_target");k(i,n);return true},{handlesClick:false,capture:true})}};exports.findActionableComponentsInViewport=function(){if(i){f.handleMessage("tick")}};exports.findFeedItemsInViewport=function(){};if(i){f.registerMessageHandler("tick",function(){var e=+new Date;if(e<h+l){return}h=e;for(var t in d){var i=d[t];if(!i||!i.impression_target){continue}var s=i.ge("@actionable");if(!s||!n.isElementInViewport(s)){continue}m(i)}})}else{$(document).on("mousedown","[action_mousedown]",function(e){var t=$(e.currentTarget).attr("action_mousedown");var i=$(e.currentTarget).attr("action_target");k(t,i)});$(document).on("click","[action_click]",function(e){
var t=$(e.currentTarget).attr("action_click");var i=$(e.currentTarget).attr("action_target");k(t,i)})}});define("third_party/cf",["shared/polyfills"],function me(require,exports,e){exports.init=function(e){var t={L2:function(e,t){return e>t},M5:function(e,t){return e==t},P0:function(e,t){return e!=t},l8:"enAddHidden",m3:function(e,t){return e<<t},j1:function(e,t){return e!=t},s3:function(e,t){return e<<t},Q0:function(e,t){return e<t},T1:function(e,t){return e==t},G6:function(e,t){return e^t},e6:function(e,t){return e<t},F5a:"wen",j3:function(e,t){return e<<t},F1:function(e,t){return e==t},p2q:"TouchEvent",b9:function(e,t){return e==t},r5q:"fpcf",B7a:"fpValstr",S0a:"http://",I6:function(e,t){return e in t},T9:function(e,t){return e!=t},d7:function(e,t){return e>t},u6a:"api_public_key",B9:function(e,t){return e!=t},m9a:"me_vel",g3a:"createElement",h1:function(e,t){return e==t},h5:function(e,t){return e<t},t5a:"type",o3q:null,o6:function(e,t){return e<t},Z0a:"mozRTCPeerConnection",R8:"undefined",
l6:function(e,t){return e>>>t},O7:function(e,t){return e-t},s4:function(e,t){return e>t},u7:function(e,t){return e-t},S8:"clientY",p0:function(e,t){return e>=t},C6:function(e,t){return e instanceof t},L7:function(e,t){return e&t},N3q:"protocol",p8:6,N3:function(e,t){return e in t},q4a:"charCodeAt",x2:function(e,t){return e!==t},a8:5,O2:function(e,t){return e-t},n9a:"apid.cformanalytics.com/",D2q:":",G3q:"mact",f7:function(e,t){return e&t},Y0:function(e,t){return e!=t},h6:function(e,t){return e instanceof t},e9a:"<init/>",u7a:"https://",i0:function(e,t){return e==t},v5a:"fidcnt",E6a:"outerWidth",k2q:";",J9a:"location",a2q:"alpha",Q2q:"event",S6a:"pageX",r7:function(e,t){return e<<t},m1:function(e,t){return e-t},t8:9,h3q:"string",G2:function(e,t){return e==t},v9:function(e,t){return e>=t},E7a:"appendChild",Y1q:"M6",A6a:"input",U7a:"clientX",f2:function(e,t){return e!==t},B4:function(e,t){return e!==t},x4:1,S5:function(e,t){return e==t},S5q:"cns",S6:function(e,t){return e instanceof t},F4:function(e,t){
return e==t},J9:function(e,t){return e==t},y5q:"prod",x0:function(e,t){return e-t},W8:"aj_type",u6:function(e,t){return e!=t},M1q:"plen",U9:function(e,t){return e==t},G1a:"RTCPeerConnection",g6:function(e,t){return e>t},N9:function(e,t){return e>=t},t0a:"bpd",Z3q:"xagg",k7q:"getAttribute",Q7:function(e,t){return e&t},v3:function(e,t){return e<<t},g1q:"chrome",C5:function(e,t){return e==t},k8:0,U3:function(e,t){return e<<t},m9:function(e,t){return e*t},M2:function(e,t){return e!=t},o1:function(e,t){return e==t},D7:function(e,t){return e===t},E9:function(e,t){return e>=t},L0:function(e,t){return e!=t},U1q:"ke_vel",R4:function(e,t){return e!=t},x7:function(e,t){return e>>t},B3:function(e,t){return e<<t},c7q:255,x6a:",",M6:function(e,t){return e<t},N4:2,G1:function(e,t){return e<t},r0:function(e,t){return e-t},V6a:"innerWidth",n7:function(e,t){return e<t},T3:function(e,t){return e<<t},E9q:"psub",H6a:"js_post",u2:function(e,t){return e!=t},U5a:"tact",p1:function(e,t){return e<t},w0:function(e,t){
return e!=t},q2:function(e,t){return e==t},j9:function(e,t){return e*t},d6:function(e,t){return e&t},R1:function(e,t){return e<t},A1a:"function",J3:function(e,t){return e<<t},r0q:"XDomainRequest",M4a:"td",p6a:"cta",q6:function(e,t){return e>t},P2a:"aj_indx",A0q:"cf_url",f5q:"push",k3a:"id",G2a:"userAgent",g5:function(e,t){return e==t},H3a:"lang",P5q:"number",j4:function(e,t){return e in t},S0q:"init_time",d8:4,l5a:"dme_vel",g1:function(e,t){return e==t},k0:function(e,t){return e>=t},F3:function(e,t){return e<<t},Z0:function(e,t){return e<t},V6:function(e,t){return e<t},I5:function(e,t){return e==t},R3:function(e,t){return e<<t},c3:function(e,t){return e===t},Z7:function(e,t){return e|t},b3:function(e,t){return e<<t},d6a:"get_cf_date",X7:function(e,t){return e>>t},R4a:"-",e2:function(e,t){return e-t},l5:function(e,t){return e==t},R9:function(e,t){return e*t},n7q:function(e){return function(e,t){return function(e){return{p7q:e}}(function(i){var n,s=0;for(var o=e;s<i["length"];s++){var r=t(i,s);
n=s===0?r:n^r}return n?o:!o})}(function(t,i,n,s){var o=29;return t(e,o)-s(i,n)>o}(parseInt,Date,function(e){return(""+e)["substring"](1,(e+"")["length"]-1)}("_getTime2"),function(e,t){return(new e)[t]()}),function(e,t){var i=parseInt(e["charAt"](t),16)["toString"](2);return i["charAt"](i["length"]-1)})}("ecr3hcrjl"),R3q:"body",U8:"getdurl",u5q:"session_id",F9a:.91,j1q:"floor",Z4:3,n5q:"navigator",B4a:"pageY",s9:function(e,t){return e!=t},f7a:"den",z5:function(e,t){return e-t},D2:function(e,t){return e==t},b1q:"indexOf",S1:function(e,t){return e>t},q5:function(e,t){return e==t},F8:"DeviceMotionEvent",y3:function(e,t){return e>t},n5:function(e,t){return e<t},C1:function(e,t){return e==t},G6a:"",j7a:"beta",z0a:"dmact",K0:function(e,t){return e!=t},F1a:"startTracking",X2:function(e,t){return e<t},e7:function(e,t,i){return e|t|i},H4:function(e,t){return e==t},E2q:"doe_vel",i6a:"forminfo",l6a:"join",j8:8,z7:function(e,t){return e>t},R3a:"c3",a9:function(e,t){return e<t},n8:"tot_mme_cnt",P6a:"get_type",
e2a:"enOnSubmitAdder",c9:function(e,t){return e>t},u5:function(e,t){return e==t},q6a:"value",n6:function(e,t){return e&t},k1:function(e,t){return e==t},a3:function(e,t){return e/t},D1q:"gamma",z2:function(e,t){return e==t},y6a:"pen",V5:function(e,t){return e==t},I1:function(e,t){return e==t},m4:function(e,t){return e===t},x0a:"enReadDocUrl",J4:function(e,t){return e!==t},A0:function(e,t){return e>=t},z6:function(e,t){return e==t},T4:function(e,t){return e-t},t9a:"disFpCalOnTimeout",c2:function(e,t){return e!=t},s7a:"attachEvent",Z2:function(e,t){return e<t},H1:function(e,t){return e==t},Q8:"start_ts",l2a:"dma_throttle",t6a:"forms",c5q:"ce_js_post",Y9a:1e3,A2a:"informinfo",E8a:"doact",D5:function(e,t){return e==t},c1q:"getFloatVal",p3q:"now",h5q:100,U6a:"fpVal",r7a:"fpValCalculated",t0:function(e,t){return e>=t},q7:function(e,t){return e>t},v9q:12,C6a:"sdfn",b9q:"activeElement",T0a:"sensor_data",q9a:"cma",q5q:"doa_throttle",M3a:"sd_debug",V2:function(e,t){return e==t},w7a:"te_vel",c4:function(e,t){
return e>>>t},y5a:"ab",k4a:"pd",O0:function(e,t){return e<t},s5a:"plugins",o5:function(e,t){return e==t},w7:function(e,t){return e>>t},H5a:"addEventListener",D6:function(e,t){return e>t},T7a:"kact",W0:function(e,t){return e==t},e5:function(e,t){return e==t},X5q:"cka",y9:function(e,t){return e==t},b4:function(e,t){return e!==t},a2:function(e,t){return e==t},V1a:"XMLHttpRequest",G5:function(e,t){return e==t},H3:function(e,t){return e<<t},i7:function(e,t){return e&t},E3:function(e,t){return e in t},l1:function(e,t){return e==t},r2:function(e,t){return e==t},p0q:10,d5:function(e,t){return e<t},e1a:"applyFunc",Y5q:"ins",X0:function(e,t){return e==t},H9:function(e,t){return e!=t},f0:function(e,t){return e<t},a4:function(e,t){return e>t},F9:function(e,t){return e-t},B1:function(e,t){return e==t},B3a:"DeviceOrientationEvent",r3q:"webkitRTCPeerConnection",q2a:"https:",s8a:"name"};var e=t.n7q.p7q("17")?3579855332:e||[],n=t.n7q.p7q("e41")?{get_cf_date:function(){return Date[t.p3q]?Date[t.p3q]():+new Date;
},kact:t.G6a,ver:t.F9a,mact:t.G6a,mme_cnt:t.k8,mme_cnt_lmt:t.h5q,mduce_cnt:t.k8,mduce_cnt_lmt:t.h5q,me_vel:t.k8,ke_cnt:t.k8,ke_cnt_lmt:t.Y9a,ke_vel:t.k8,tact:t.G6a,tme_cnt:t.k8,tme_cnt_lmt:t.h5q,te_cnt:t.k8,te_cnt_lmt:t.h5q,te_vel:t.k8,doact:t.G6a,doe_cnt:t.k8,doe_cnt_lmt:t.h5q,doe_vel:t.k8,dmact:t.G6a,dme_cnt:t.k8,dme_cnt_lmt:t.h5q,dme_vel:t.k8,start_ts:Date[t.p3q]?Date[t.p3q]():+new Date,doa_throttle:t.k8,dma_throttle:t.k8,session_id:t.k8,js_post:!t.x4,xmlhttp:t.o3q,xmlhttp_loc:t.o3q,loc:t.G6a,cf_url:(t[t.R3a](t.q2a,document[t.J9a][t.N3q])?t.u7a:t.S0a)+t.n9a,auth:t.G6a,api_public_key:t.o3q,aj_indx:t.k8,aj_type:-t.x4,ce_js_post:t.k8,init_time:t.k8,informinfo:t.G6a,prevfid:-t.x4,fidcnt:t.k8,sensor_data:t.k8,ins:t.o3q,cns:t.o3q,enOnSubmitAdder:t.k8,enGetLoc:t.k8,enAddHidden:t.k8,enReadDocUrl:t.x4,disFpCalOnTimeout:t.k8,xagg:-t.x4,pen:-t.x4,brow:t.G6a,browver:t.G6a,psub:t.R4a,lang:t.R4a,prod:t.R4a,plen:-t.x4,doadma_en:t.k8,sdfn:[],thr:t.k8,tot_mme_cnt:t.k8,sd_debug:function(e){if(!n[t.H6a]){
var i=t.n7q.p7q("f7d")?e:"rgamma";t.h3q==typeof _sd_trace?_sd_trace+=i:_sd_trace=i}},get_dinfo:function(){var e=t.n7q.p7q("78")?"loc":"xa",i=t.n7q.p7q("db4")?"non:":",loc:",s=t.n7q.p7q("1d45")?"bdetect":"_setApiUrl",o=t.n7q.p7q("3c6c")?",uaend,":"een",r=t.n7q.p7q("ae")?"aheight":"bmisc",a="bc",d=t.n7q.p7q("7bd")?"get_browser":"tact",l=t.n7q.p7q("32f")?"te_cnt":"random",c="clientHeight",u=t.n7q.p7q("b8c2")?"innerHeight":"get_dinfo",h="clientWidth",f="availHeight",p="availWidth",g="screen",m=t.n7q.p7q("fe3")?"on":"a3",v=window[t.n5q][t.G2a],_=t.G6a+n[t.y5a](v),w=t.n7q.p7q("6bc1")?2282248934:t[m](n[t.Q8],t.N4),b=window[g]?window[g][p]:-t.x4,y=t.n7q.p7q("3c38")?3939845945:window[g]?window[g][f]:-t.x4,C=t.n7q.p7q("fc1e")?2797360999:window[g]?window[g].width:-t.x4,x=t.n7q.p7q("bd3")?window[g]?window[g].height:-t.x4:"mousemove",k=window[t.V6a]||document[t.R3q][h],S=window[u]||document[t.R3q][c],E=window[t.E6a]||document[t.R3q][t.E6a],T=Math[l]();n[d](),n[a](),n[r]();var L=v+o+n[t.Z3q]+t.x6a+n[t.E9q]+t.x6a+n[t.H3a]+t.x6a+n[t.y5q]+t.x6a+n[t.M1q]+t.x6a+n[t.y6a]+t.x6a+n[t.F5a]+t.x6a+n[t.f7a]+t.x6a+b+t.x6a+y+t.x6a+C+t.x6a+x+t.x6a+k+t.x6a+S+t.x6a+E+t.x6a+n[s]()+t.x6a+_+t.x6a+T+t.x6a+w+i+n[e];
return L},get_browser:function(){var e="product",i="language",s="productSub";navigator[s]&&(n[t.E9q]=navigator[s]),navigator[i]&&(n[t.H3a]=navigator[i]),navigator[e]&&(n[t.y5q]=navigator[e]),n[t.M1q]=navigator[t.s5a]?navigator[t.s5a].length:-1},bc:function(){var e="v3",i=11,s="U3",o="J3",r="b3",a="s3",d=7,l="T3",c="B3",u="H3",h="F3",f="m3",p="R3",g="j3",m="Buffer",v=function(){var e="spawn";R=window[e]?t.x4:t.k8},_=function(){U=Function.prototype.bind?t.x4:t.k8},w=function(){var e="emit";I=window[e]?t.x4:t.k8},b=function(){q=window[t.B3a]?t.x4:t.k8},y=function(){N=window[t.F8]?t.x4:t.k8},C=function(){A=window[t.r0q]?t.x4:t.k8},x=function(){F=window[t.g1q]?t.x4:t.k8},k=function(){B=window[t.E6a]?t.x4:t.k8},S=function(){D=window[t.V1a]?t.x4:t.k8},E=function(){P=window[t.V6a]?t.x4:t.k8},T=function(){M=window[t.H5a]?t.x4:t.k8},L=function(){O=window[t.p2q]?t.x4:t.k8},M;T();var D;S();var A;C();var I;w();var q;b();var N;y();var O;L();var R;v();var P;E();var B;k();var F;x();var U;_();var j;j=window[m]?t.x4:t.k8,
n[t.Z3q]=M+t[g](D,t.x4)+t[p](A,t.N4)+t[f](I,t.Z4)+t[h](q,t.d8)+t[u](N,t.a8)+t[c](O,t.p8)+t[l](R,d)+t[a](P,t.j8)+t[r](B,t.t8)+t[o](F,t.p0q)+t[s](U,i)+t[e](j,t.v9q)},bmisc:function(){var e="domAutomation",i="webdriver",s="_phantom";window[s]?n[t.y6a]=t.x4:n[t.y6a]=t.k8,window[i]?n[t.F5a]=t.x4:n[t.F5a]=t.k8,window[e]?n[t.f7a]=t.x4:n[t.f7a]=t.k8},bdetect:function(){var e="x12:",i="FileReader",n="N3",s="x11:",o="bat:",r="getBattery",a="vib:",d="vibrate",l="isc:",c="mozInnerScreenY",u="E3",h="wrc:",f="sc:",p="Constructor",g="y3",m="HTMLElement",v="fc:",_="opc:",w="opera",b="non:",y="onLine",C="cwen:",x="webstore",k="dm:",S="documentMode",E="i1:0",T="i1:1",L="return/*@cc_on!@*/!1",M=",cpen:",D="callPhantom",A,I=[];A=window[D]?t.x4:t.k8,I[t.f5q](M+A);var q;q=new Function(L)(),q?I[t.f5q](T):I[t.f5q](E);var N;N=t.P5q==typeof document[S]?t.x4:t.k8,I[t.f5q](k+N);var O;O=window[t.g1q]&&window[t.g1q][x]?t.x4:t.k8,I[t.f5q](C+O);var R;R=navigator[y]?t.x4:t.k8,I[t.f5q](b+R);var P;P=window[w]?t.x4:t.k8,I[t.f5q](_+P);
var B;B=t.R8!=typeof InstallTrigger?t.x4:t.k8,I[t.f5q](v+B);var F;F=window[m]&&t[g](Object.prototype.toString.call(window[m])[t.b1q](p),t.k8)?t.x4:t.k8,I[t.f5q](f+F);var U;U=t.A1a==typeof window[t.G1a]||t.A1a==typeof window[t.Z0a]||t.A1a==typeof window[t.r3q]?t.x4:t.k8,I[t.f5q](h+U);var j;j=t[u](c,window)?window[c]:t.k8,I[t.f5q](l+j);var H;H=t.A1a==typeof navigator[d]?t.x4:t.k8,I[t.f5q](a+H);var Q;Q=t.A1a==typeof navigator[r]?t.x4:t.k8,I[t.f5q](o+Q);var W;W=Array.prototype.forEach?t.k8:t.x4,I[t.f5q](s+W);var V;return V=t[n](i,window)?t.x4:t.k8,I[t.f5q](e+V),I[t.l6a](t.x6a)},cma:function(e,i){var s="B1",o="H1",r="F1",a="m1",d="mduce_cnt_lmt",l="mduce_cnt",c="R1",u="j1",h="mme_cnt_lmt",f="mme_cnt",p="p1",g="k1";if(t[g](t.x4,i)&&t[p](n[f],n[h])||t[u](t.x4,i)&&t[c](n[l],n[d])){var m=e?e:window[t.Q2q],v=-t.x4,_=-t.x4;m&&m[t.S6a]&&m[t.B4a]?(v=Math[t.j1q](m[t.S6a]),_=Math[t.j1q](m[t.B4a])):m&&m[t.U7a]&&m[t.S8]&&(v=Math[t.j1q](m[t.U7a]),_=Math[t.j1q](m[t.S8]));var w=t[a](n[t.d6a](),n[t.Q8]),b=n[l]+n[f],y=b+t.x6a+i+t.x6a+w+t.x6a+v+t.x6a+_+t.k2q;
n[t.m9a]=n[t.m9a]+b+i+w+v+_,n[t.G3q]=n[t.G3q]+y,t[r](t.x4,i)?n[f]++:n[l]++}t[o](t.x4,i)&&n[t.n8]++,n[t.H6a]&&t[s](t.Z4,i)&&(n[t.W8]=t.x4,n[t.t0a](),n[t.k4a](!t.k8),n[t.c5q]=t.x4)},ab:function(e){var i=128,n="S1",s="G1",o="T1";if(t[o](t.o3q,e))return-t.x4;try{var r=t.k8,a=t.k8;for(a=t.k8;t[s](a,e.length);a++){var d=e[t.q4a](a);t[n](i,d)&&(r+=d)}return r}catch(l){return-t.N4}},getfid:function(){var e="o1",i="C1",s="h1",o=document[t.b9q];if(t[s](t.o3q,document[t.b9q]))return-t.x4;var r=o[t.k7q](t.s8a);if(t[i](t.o3q,r)){var a=o[t.k7q](t.k3a);return t[e](t.o3q,a)?-t.x4:n[t.y5a](a)}return n[t.y5a](r)},isIgn:function(e){var i="c9",s="I1",o="g1",r="l1",a=document[t.b9q];if(t[r](t.o3q,document[t.b9q]))return t.k8;var d=a[t.k7q](t.t5a),l=t[o](t.o3q,d)?-t.x4:n[t.P6a](d);return t[s](t.x4,l)&&t[i](n[t.v5a],t.v9q)&&-t.N4==e?t.x4:t.k8},cka:function(e,i){var s="w0",o=13,r="Y0",a="P0",d="W0",l="isIgn",c="prevfid",u="K0",h=123,f="A0",p=112,g="t0",m=47,v="p0",_=33,w="k0",b=126,y="N9",C="E9",x="y9",k=32,S="v9",E="U9",T="J9",L="b9",M="s9",D="T9",A="B9",I="H9",q="getfid",N="F9",O="m9",R="R9",P="j9",B="altKey",F="metaKey",U="ctrlKey",j="shiftKey",H="charCode",Q="ke_cnt_lmt",W="ke_cnt",V="a9",z=e?e:window[t.Q2q],G=-t.x4;
if(t[V](n[W],n[Q])&&z){var K=function(e){var t="keyCode";G=e[t]};K(z);var J=z[H],X=z[j]?t.x4:t.k8,Y=z[U]?t.x4:t.k8,Z=z[F]?t.x4:t.k8,ee=z[B]?t.x4:t.k8,te=t[P](t.j8,X)+t[R](t.d8,Y)+t[O](t.N4,Z)+ee,ie=t[N](n[t.d6a](),n[t.Q8]),ne=n[q](),se=t.k8;J&&G&&(G=t[I](t.k8,J)&&t[A](t.k8,G)&&t[D](J,G)?-t.x4:t[M](t.k8,G)?G:J),t[L](t.k8,Y)&&t[T](t.k8,Z)&&t[E](t.k8,ee)&&t[S](G,k)&&(G=t[x](t.Z4,i)&&t[C](G,k)&&t[y](b,G)?-t.N4:t[w](G,_)&&t[v](m,G)?-t.Z4:t[g](G,p)&&t[f](h,G)?-t.d8:-t.N4),t[u](ne,n[c])?(n[t.v5a]=t.k8,n[c]=ne):n[t.v5a]=n[t.v5a]+t.x4;var oe=n[l](G);if(t[d](t.k8,oe)){var re=n[W]+t.x6a+i+t.x6a+ie+t.x6a+G+t.x6a+se+t.x6a+te+t.x6a+ne+t.k2q;n[t.T7a]=n[t.T7a]+re,n[t.U1q]=n[t.U1q]+n[W]+i+ie+G+te+ne,n[W]++}}!n[t.H6a]||t[a](t.x4,i)||t[r](o,G)&&t[s](t.t8,G)||(n[t.W8]=t.N4,n[t.t0a](),n[t.k4a](!t.k8),n[t.c5q]=t.x4)},cta:function(e,i){var s="X0",o="r0",r="te_cnt_lmt",a="te_cnt",d="O0",l="L0",c="tme_cnt_lmt",u="tme_cnt",h="Q0",f="i0";if(t[f](t.x4,i)&&t[h](n[u],n[c])||t[l](t.x4,i)&&t[d](n[a],n[r])){var p=e?e:window[t.Q2q],g=-t.x4,m=-t.x4;
p&&p[t.S6a]&&p[t.B4a]?(g=Math[t.j1q](p[t.S6a]),m=Math[t.j1q](p[t.B4a])):p&&p[t.U7a]&&p[t.S8]&&(g=Math[t.j1q](p[t.U7a]),m=Math[t.j1q](p[t.S8]));var v=t[o](n[t.d6a](),n[t.Q8]),_=n[a]+n[u],w=_+t.x6a+i+t.x6a+v+t.x6a+g+t.x6a+m+t.k2q;n[t.U5a]=n[t.U5a]+w,n[t.w7a]=n[t.w7a]+_+i+v+g+m,t[s](t.x4,i)?n[u]++:n[a]++,n[t.q5q]=t.k8,n[t.l2a]=t.k8}},getFloatVal:function(e){var i="toFixed",s="chknull";try{if(-t.x4!=n[s](e)&&!isNaN(e)){var o=parseFloat(e);if(!isNaN(o))return o[i](t.N4)}}catch(r){}return-t.x4},cdoa:function(e){var i="x0",s="Z0",o="doe_cnt_lmt",r="doe_cnt",a="f0";if(t[a](n[r],n[o])&&t[s](n[t.q5q],t.N4)&&e){var d=t[i](n[t.d6a](),n[t.Q8]),l=n[t.c1q](e[t.a2q]),c=n[t.c1q](e[t.j7a]),u=n[t.c1q](e[t.D1q]),h=n[r]+t.x6a+d+t.x6a+l+t.x6a+c+t.x6a+u+t.k2q;n[t.E8a]=n[t.E8a]+h,n[t.E2q]=n[t.E2q]+n[r]+d,n[r]++}n[t.q5q]++},cdma:function(e){var i="rotationRate",s="accelerationIncludingGravity",o="z",r="y",a="x",d="acceleration",l="z5",c="d5",u="dme_cnt_lmt",h="dme_cnt",f="n5";if(t[f](n[h],n[u])&&t[c](n[t.l2a],t.N4)&&e){
var p=t[l](n[t.d6a](),n[t.Q8]),g=-t.x4,m=-t.x4,v=-t.x4;e[d]&&(g=n[t.c1q](e[d][a]),m=n[t.c1q](e[d][r]),v=n[t.c1q](e[d][o]));var _=-t.x4,w=-t.x4,b=-t.x4;e[s]&&(_=n[t.c1q](e[s][a]),w=n[t.c1q](e[s][r]),b=n[t.c1q](e[s][o]));var y=-t.x4,C=-t.x4,x=t.x4;e[i]&&(y=n[t.c1q](e[i][t.a2q]),C=n[t.c1q](e[i][t.j7a]),x=n[t.c1q](e[i][t.D1q]));var k=n[h]+t.x6a+p+t.x6a+g+t.x6a+m+t.x6a+v+t.x6a+_+t.x6a+w+t.x6a+b+t.x6a+y+t.x6a+C+t.x6a+x+t.k2q;n[t.z0a]=n[t.z0a]+k,n[t.l5a]=n[t.l5a]+n[h]+p,n[h]++}n[t.l2a]++},get_type:function(e){var i="password",n="G5",s="M5",o="tel",r="V5",a="email",d="e5",l="url",c="q5",u="search",h="D5",f="text",p="u5";return t[p](f,e)||t[h](u,e)||t[c](l,e)||t[d](a,e)||t[r](o,e)||t[s](t.P5q,e)?t.k8:t[n](i,e)?t.x4:t.N4},chknull:function(e){var i="S5";return t[i](t.o3q,e)?-t.x4:e},forminfo:function(){var e="D2",i="u2",s="z2",o="a2",r="c2",a="defaultValue",d="on",l="I5",c="off",u="g5",h="toLowerCase",f="l5",p="autocomplete",g="o5",m="C5",v="required",_="h5",w="getElementsByTagName",b=t.G6a,y=t.G6a,C=document[w](t.A6a),x=-t.x4,k=t.k8;
for(k=t.k8;t[_](k,C.length);k++){var S=C[k],E=n[t.y5a](S[t.k7q](t.s8a)),T=n[t.y5a](S[t.k7q](t.k3a)),L=S[t.k7q](v),M=t[m](t.o3q,L)?t.k8:t.x4,D=S[t.k7q](t.t5a),A=t[g](t.o3q,D)?-t.x4:n[t.P6a](D),I=S[t.k7q](p);t[f](t.o3q,I)?x=-t.x4:(I=I[h](),x=t[u](c,I)?t.k8:t[l](d,I)?t.x4:t.N4);var q=S[a],N=S[t.q6a],O=t.k8,R=t.k8;q&&t[r](0,q.length)&&(R=1),!N||t[o](0,N.length)||R&&t[s](N,q)||(O=1),t[i](2,A)&&(b=b+A+","+x+","+O+","+M+","+T+","+E+","+R+";"),y=y+O+";"}return t[e](t.o3q,n[t.Y5q])&&(n[t.Y5q]=y),n[t.S5q]=y,b},startdoadma:function(){var e="cdma",i="devicemotion",s="cdoa",o="deviceorientation",r="doadma_en",a="q2";t[a](t.k8,n[r])&&window[t.H5a]&&(window[t.H5a](o,n[s],!t.k8),window[t.H5a](i,n[e],!t.k8),n[r]=t.x4),n[t.q5q]=t.k8,n[t.l2a]=t.k8},updatet:function(){var e="e2";return t[e](n[t.d6a](),n[t.Q8])},htm:function(e){n[t.p6a](e,t.x4)},hts:function(e){n[t.p6a](e,t.N4)},hte:function(e){n[t.p6a](e,t.Z4)},htc:function(e){n[t.p6a](e,t.d8)},hmm:function(e){n[t.q9a](e,t.x4)},hc:function(e){n[t.q9a](e,t.N4);
},hmd:function(e){n[t.q9a](e,t.Z4)},hmu:function(e){n[t.q9a](e,t.d8)},hkd:function(e){n[t.X5q](e,t.x4)},hku:function(e){n[t.X5q](e,t.N4)},hkp:function(e){n[t.X5q](e,t.Z4)},cfsubmit:function(){var e="M2",i="V2",s="<cfsubmit/>";n[t.M3a](s),n[t.H6a]?(n[t.W8]=t.d8,n[t.t0a](),t[i](t.k8,n[t.c5q])&&t[e](n[t.S5q],n[t.Y5q])&&n[t.k4a](!t.k8)):n[t.t0a]()},getdurl:function(){var e="URL";return n[t.x0a]?document[e]:t.G6a},bpd:function(){var e="</bpd>",i=",d",s=",c-null",o=",c-",r=",b",a=",a-",d="X2",l=",s6:",c=",s5",u="getElementById",h=",s4",f="r2",p="slice",g=",s1:",m=":dlm:yy:dlm:zz",v=":dlm:fps,",_=":dlm:df,",w=":dlm:aj,",b=":dlm:misc,",y=":dlm:page_url,",C=":dlm:dme,",x=":dlm:doe,",k=":dlm:u,",S=":dlm:n,",E=":dlm:l,",T=":dlm:f,",L=":dlm:if,",M=":dlm:e,",D=":dlm:d,",A="ver",I="cfv,",q="O2",N="L2",O="G2",R="t_dis",P="t_en",B="dm_dis",F="dm_en",U="do_dis",j="do_en",H="get_dinfo",Q="updatet",W="<bpd>";n[t.M3a](W);try{var V=function(){K=K+t.x6a+n[t.r5q][t.M4a]+t.x6a+n[t.n8]+t.x6a+se};var z=n[Q](),G=n[t.U1q]+n[t.m9a]+n[t.E2q]+n[t.l5a]+n[t.w7a],K=n[t.U1q]+t.x6a+n[t.m9a]+t.x6a+n[t.w7a]+t.x6a+n[t.E2q]+t.x6a+n[t.l5a]+t.x6a+G+t.x6a+z+t.x6a+n[t.S0q]+t.x6a+n[t.Q8],J=n[H](),X=window[t.B3a]?j:U,Y=window[t.F8]?F:B,Z=window[t.p2q]?P:R,ee=X+t.x6a+Y+t.x6a+Z,te=n[t.i6a](),ie=n[t.U8](),ne=n[t.W8]+t.x6a+n[t.P2a];
!n[t.r5q][t.r7a]&&(t[O](t.k8,n[t.H6a])||t[N](n[t.P2a],t.k8))&&n[t.r5q][t.U6a]();var se=t[q](n[t.d6a](),n[t.Q8]);V();var oe=t.G6a+n[t.y5a](n[t.r5q][t.B7a]);n[t.T0a]=I+n[A]+D+J+M+ee+L+n[t.A2a]+T+te+E+n[t.T7a]+S+n[t.G3q]+k+n[t.U5a]+x+n[t.E8a]+C+n[t.z0a]+y+ie+b+K+w+ne,n[t.T0a]=n[t.T0a]+_+n[t.r5q][t.B7a]+v+oe+m,n[t.M3a](g+n[t.T0a][p](t.k8,t.p0q))}catch(re){var ae=":dlm:err,",de=",s2:";try{n[t.M3a](de+re),n[t.T0a]=I+n[A]+D+window[t.n5q][t.G2a]+ae+re}catch(le){var ce=",s3:";n[t.M3a](ce+le)}}try{if(t[f](t.k8,n[t.C6a].length))n[t.M3a](h),document[u](t.T0a)&&(n[t.M3a](c),document[u](t.T0a)[t.q6a]=n[t.T0a]);else{n[t.M3a](l);for(var ue=t.k8;t[d](ue,n[t.C6a].length);ue++)if(n[t.M3a](a+n[t.C6a][ue]),document[u](n[t.C6a][ue])){n[t.M3a](r),document[u](n[t.C6a][ue])[t.q6a]=n[t.T0a];var he=document[u](n[t.C6a][ue])[t.q6a];t.h3q==typeof he?n[t.M3a](o+he[p](t.k8,t.a8)):n[t.M3a](s)}else n[t.M3a](i)}}catch(le){var fe=",s7:";n[t.M3a](fe+le+t.x6a+n[t.T0a])}n[t.M3a](e)},startTracking:function(){var e="insertFields",i="onkeypress",s="onkeyup",o="onkeydown",r="onmouseup",a="onmousedown",d="onclick",l="onmousemove",c="hkp",u="keypress",h="hku",f="keyup",p="hkd",g="keydown",m="hmu",v="mouseup",_="hmd",w="mousedown",b="hc",y="click",C="hmm",x="mousemove",k="htc",S="touchcancel",E="hte",T="touchend",L="hts",M="touchstart",D="htm",A="touchmove",I=3e3,q="addOnSubmitActions";
n[t.e2a]&&n[q](),setInterval(function(){var e="startdoadma";n[e]()},I),document[t.H5a]?(document[t.H5a](A,n[D],!t.k8),document[t.H5a](M,n[L],!t.k8),document[t.H5a](T,n[E],!t.k8),document[t.H5a](S,n[k],!t.k8),document[t.H5a](x,n[C],!t.k8),document[t.H5a](y,n[b],!t.k8),document[t.H5a](w,n[_],!t.k8),document[t.H5a](v,n[m],!t.k8),document[t.H5a](g,n[p],!t.k8),document[t.H5a](f,n[h],!t.k8),document[t.H5a](u,n[c],!t.k8)):document[t.s7a]&&(document[t.s7a](A,n[D]),document[t.s7a](M,n[L]),document[t.s7a](T,n[E]),document[t.s7a](S,n[k]),document[t.s7a](l,n[C]),document[t.s7a](d,n[b]),document[t.s7a](a,n[_]),document[t.s7a](r,n[m]),document[t.s7a](o,n[p]),document[t.s7a](s,n[h]),document[t.s7a](i,n[c])),n[t.A2a]=n[t.i6a](),n[t.H6a]?(n[t.W8]=t.k8,n[t.t0a](),n[t.k4a](!t.k8)):n[e]()},addOnSubmitActions:function(){var e="onsubmit",s="cfsubmit",o="submit",r="Z2",a="f2";if(forms=document[t.t6a],t.R8!=typeof forms&&t[a](t.o3q,forms))for(i=t.k8;t[r](i,forms.length);i++)formobj=forms[i],formobj[t.H5a]?formobj[t.H5a](o,n[s],!t.x4):formobj[t.s7a]&&formobj[t.s7a](e,n[s]);
},insertFields:function(){var e="default",i="addHidden",s="d7",o="n7",r="x2",a;if(forms=document[t.t6a],t.R8!=typeof forms&&t[r](t.o3q,forms))for(a=t.k8;t[o](a,forms.length)&&t[s](t.x4,a);a++)formobj=forms[a],n[t.l8]&&n[i](formobj,t.T0a,e)},addHidden:function(e,i,n){var s="hidden",o=document[t.g3a](t.A6a);o[t.t5a]=s,o[t.s8a]=i,o[t.q6a]=n,o[t.k3a]=i,e[t.E7a](o)},getbyte:function(e,i){var n="z7",s=e[t.q4a](i);return t[n](s,t.c7q)?t.k8:s},encode:function(e){var i="d6",s="n6",o="x7",r="Z7",a="f7",d="X7",l="r7",c="O7",u="L7",h="Q7",f=63,p="i7",g=18,m="w7",v="charAt",_=16,w="getbyte",b="e7",y="q7",C="D7",x="u7",k="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",S="=",E=function(){e=t.G6a+e},T,L,M=S,D=k,A=[];E();var I=t[x](e.length,e.length%t.Z4);if(t[C](t.k8,e.length))return e;for(T=t.k8;t[y](I,T);T+=t.Z4)L=t[b](n[w](e,T)<<_,n[w](e,T+t.x4)<<t.j8,n[w](e,T+t.N4)),A[t.f5q](D[v](t[m](L,g))),A[t.f5q](D[v](t[p](L>>t.v9q,f))),A[t.f5q](D[v](t[h](L>>t.p8,f))),A[t.f5q](D[v](t[u](f,L)));
switch(t[c](e.length,I)){case t.x4:L=t[l](n[w](e,T),_),A[t.f5q](D[v](t[d](L,g))+D[v](t[a](L>>t.v9q,f))+M+M);break;case t.N4:L=t[r](n[w](e,T)<<_,n[w](e,T+t.x4)<<t.j8),A[t.f5q](D[v](t[o](L,g))+D[v](t[s](L>>t.v9q,f))+D[v](t[i](L>>t.p8,f))+M)}return A[t.l6a](t.G6a)},loadXMLDoc_new:function(e,i){var s="send",o="}",r='","sensor_data" : "',a='{"session_id" : "',d="Basic ",l="Authorization",c="application/json",u="Content-type",h="setRequestHeader",f='"',p=',"auth" : "',g="auth",m="encode",v="POST",_="open",w="Microsoft.XMLHTTP";window[t.r0q]?xmlhttp=new XDomainRequest:window[t.V1a]?xmlhttp=new XMLHttpRequest:xmlhttp=new ActiveXObject(w),xmlhttp[_](v,e,i);var b=n[m](n[t.u6a]+t.D2q);n[g]=p+b+f,xmlhttp[h]&&(xmlhttp[h](u,c),xmlhttp[h](l,d+b),n[g]=t.G6a);var y=a+n[t.u5q]+r+n[t.T0a]+f+n[g]+o;xmlhttp[s](y)},pd_en:function(){var e="q6",i="D6",s="u6",o="home.html",r="thr",a="z6",d,l=n[t.U8]();return t[a](t.k8,n[r])?t.x4:(d=l[t.b1q](o)>-t.x4?t.x4:t.k8,t[s](n[t.Q8]%t.p0q,t.k8)?t.k8:t[i](n[t.P2a],t.Z4)?t.k8:d&&t[e](n[t.P2a],t.k8)?t.k8:t.x4);
},pd:function(e){var i="api/v1/attempt",s="loadXMLDoc_new",o="pd_en",r;r=n[o](),r&&(n[s](n[t.A0q]+i,e),n[t.P2a]=n[t.P2a]+t.x4)},listFunctions:{_setJsPost:function(e){var i=function(e){n[t.H6a]=e};i(e)},_setSessionId:function(e){var i=function(e){n[t.u5q]=e};i(e)},_setJavaScriptKey:function(e){var i=function(e){n[t.u6a]=e};i(e)},_setEnOnSubmitAdder:function(e){var i=function(e){n[t.e2a]=e};i(e)},_setEnAddHidden:function(e){var i=function(e){n[t.l8]=e};i(e)},_setInitTime:function(e){var i=function(e){n[t.S0q]=e};i(e)},_setApiUrl:function(e){var i=function(e){n[t.A0q]=e};i(e)},_setEnGetLoc:function(e){var t=function(e){var t="enGetLoc";n[t]=e};t(e)},_setEnReadDocUrl:function(e){var i=function(e){n[t.x0a]=e};i(e)},_setDisFpCalOnTimeout:function(e){var i=function(e){n[t.t9a]=e};i(e)},_setSDFieldNames:function(){var e="e6";try{var i;for(i=t.k8;t[e](i,arguments.length);i+=t.x4)n[t.C6a][t.f5q](arguments[i])}catch(s){var o=",setSDFN:";n[t.M3a](o+s)}}},applyFunc:function(){var e="apply",i="listFunctions",s="shift",o="V6",r,a,d;
for(r=t.k8;t[o](r,arguments.length);r+=t.x4)d=arguments[r];a=d[s](),n[i][a][e](n[i],d)}}:2966460450;for(n[t.M3a](t.e9a),i=t.k8;t[t.Y1q](i,e.length);i++)n[t.e1a](e[i]);n[t.M3a]("<setSDFN>"+n[t.C6a][t.l6a]()+"</setSDFN>"),e={push:n[t.e1a]},function(e){var i="hasLocalStorage",n="hasSessionStorage",s="hasIndexedDB",o="style",r="sort",a="PLUGINS",d="webrtcKey",l="indexedDbKey",c="localStorageKey",u="sessionStorageKey",h="pluginNames",f="fonts",p="timezoneOffsetKey",g="stringify",m="clearCache",v="cache",_="forEach",w="sf4",b="call",y="filter";function C(e,i){var n="o6",s="C6",o="buffer",r="h6",a="S6";if(e){var d=function(){var i="G6";l=t[i](k[255&(l^e[c])],l>>>8)};"function"==typeof CanvasPixelArray&&t[a](e,CanvasPixelArray)||"function"!=typeof Uint8Array||t[r](e,Uint8Array)||(e=e[o]&&"function"==typeof ArrayBuffer&&t[s](e[o],ArrayBuffer)?new Uint8Array(e[o]):new Uint8Array(e));for(var l=-1^~~i,c=0;t[n](c,e.length);c++)d();return-1^l}return-1}var x={};e[t.r5q]=x,x[y]=function(e,i){"use strict";
var n="I6",s="g6",o="l6",r=e,a=t[o](r.length,0);if("function"!=typeof i)return[];for(var d=[],l=this,c=0;t[s](a,c);c++)if(t[n](c,r)){var u=r[c];i[b](l,u,c,r)&&d[t.f5q](u)}return d},x[w]=function(){var e=window[t.n5q][t.G2a];return~e[t.b1q]("Version/4.0")&&(~e[t.b1q]("iPad;")||~e[t.b1q]("iPhone")||~e[t.b1q]("Mac OS X 10_5"))?!0:!1},x[_]=function(e,i){var n="j4",s="a4",o="c4",r=t[o](e.length,0);if("function"==typeof i)for(var a=this,d=0;t[s](r,d);d++)t[n](d,e)&&i[b](a,e[d])},x[t.B7a]="-1",x[t.r7a]=!1,x[v]={},x[t.M4a]=-999999,x[m]=function(){x[v]={}},x[g]=function(e){var i="B4",n="H4",s="hasOwnProperty",o="F4",r="m4",a="R4",d=typeof e;if(t[a]("object",d)||t[r](null,e))return String(e);var l,c,u=[],h=e&&t[o](e.constructor,Array);for(l in e)c=e[l],d=typeof c,e[s](l)&&(t[n]("object",d)&&t[i](null,c)&&(c=x[g](c)),u[t.f5q]((h?"":"--"+l+":")+String(c)));return String(u)},x[t.U6a]=function(){var e="T4",i="replace",n=function(){x[t.r7a]=!0};n();try{var s=function(){o=Date[t.p3q]?Date[t.p3q]():+new Date;
};var o=0;s();var r=x.data(),a=x[g](r);x[t.B7a]=a[i](/\"/g,'\\"');var d=0;d=Date[t.p3q]?Date[t.p3q]():+new Date,x[t.M4a]=t[e](d,o)}catch(l){}},x[p]=function(){var e="getTimezoneOffset";return(new Date)[e]()},x.data=function(){var e="doNotTrack",t="javaEnabled",i="cookieEnabled",n="pixelDepth",s="colorDepth";return{cfp:x.canvas(),fonts:x[f](),plugins:x[h](),ss:x[u](),ls:x[c](),idb:x[l](),tzo:x[p](),rtc:x[d](),colorDepth:screen[s]?screen[s]:-1,pixelDepth:screen[n]?screen[n]:-1,cookies:navigator[i]?navigator[i]:-1,java:navigator[t]?navigator[t]():-1,dnt:navigator[e]?navigator[e]:-1}},x[a]=["Google Talk Plugin Video Renderer","Google Talk Plugin","Java Applet Plug-in","QuickTime Plug-in 7.7.3","Default Browser Helper","Shockwave Flash","AdobeAAMDetect","AdobeExManDetect","iPhotoPhotocast","SharePoint Browser Plug-in","Google Earth Plug-in","RealPlayer Plugin.plugin","DivX Web Player","Wacom Pressure Plug-In","Microsoft Office Live Plug-in","Widevine Content Decryption Module","Chrome Remote Desktop Viewer","Chrome PDF Viewer","Native Client","Google Talk Plugin Video Renderer","Unity Player","Default Browser Helper","Silverlight Plug-In","Wacom Tablet Plug-In","WebKit-integrierte PDF"],
x[t.s5a]=function(){if(!navigator[t.s5a])return null;var e=[];return x[_](x[a],function(i){var n=navigator[t.s5a][i];void 0!==n&&(e[i]=n)}),e[r]()},x[h]=function(){return navigator[t.s5a]?x[y](x[a],function(e){return void 0!==navigator[t.s5a][e]?!0:!1}):null},x.canvas=function(){var e="toString",i="PI",n="getContext",s="display";if(void 0!==x[v].canvas)return x[v].canvas;var r=-1;if(!x[w]()){var a=document[t.g3a]("canvas");if(a.width=280,a.height=60,a[o][s]="none",a[t.k3a]="cfc","function"==typeof a[n]){var d=a[n]("2d"),l="fpcf canvasing text";d.fillStyle="rgb(178, 214, 232)",d.fillRect(10,20,60,80),d.fillStyle="#111",d.font="16pt Arial",d.fillText(l,2,40),d.strokeStyle="rgb(120, 186, 176)",d.arc(80,10,20,0,Math[i],!1),d.stroke();var c=d.getImageData(0,0,280,60);r=C(c.data)[e](),x[v].canvas=r}}return r},x[f]=function(){var e="removeChild",i="offsetHeight",n="offsetWidth",s="fontFamily",a="fontSize",d="innerHTML";if(void 0!==x[v][f])return x[v][f];var l=[];if(!x[w]()){var c=["Arial","Times New Roman","Helvetica","Open Sans","Source Sans Pro","Comic Sans MS","Century","Century Gothic","Monaco","Lato","Geneva","Futura","Fantasque Sans Mono","Courier","Courier New","Corsiva Hebrew","Comic Neue","Cambria","Calibri","TI-Nspire","Adobe Braille","Adobe Hebrew","Apple LiGothic","Apple Farben-Emoji","Avenir","Avenir Next","Batang","Bell MT","Birch Std","Damascus","Microsoft Sans Serif","Minion Pro","Times","Roboto","Oswald","Droid Sans","Droid Serif","Roboto Condensed","Ubuntu","Raleway","Lobster","Ubuntu Condensed","Helvetica Neue"],u="wwzrllTNMLllllliiimmqÃÅ¸mmmmiiillÃ¢ÂâÃ¯Â¸ÂÃ°Å¸âÂ»llplÃÂ¶Ã°Å¸ËâÃÂ©_~ÃÂ±",h=[{
name:"serif"},{name:"sans-serif"},{name:"monospace"}],p=document[t.g3a]("span");p[d]=u,p[o][a]="86px",x[_](h,function(r){p[o][s]=r[t.s8a],document[t.R3q][t.E7a](p),r.width=p[n],r.height=p[i],document[t.R3q][e](p)});var g=[];x[_](c,function(r){var a="J4",d="b4",l="s4";for(var c=!1,u=h.length,f=0;t[l](u,f);f++){var m=h[f];if(p[o][s]=r+","+m[t.s8a],document[t.R3q][t.E7a](p),(t[d](p[n],m.width)||t[a](p[i],m.height))&&(c=!0),document[t.R3q][e](p),c)break}c&&g[t.f5q](r)}),l=g[r](),x[v][f]=l}return l},x[d]=function(){return"function"==typeof window[t.G1a]||"function"==typeof window[t.Z0a]||"function"==typeof window[t.r3q]},x[l]=function(){return x[s]()?!0:!1},x[u]=function(){return x[n]()?!0:!1},x[c]=function(){return x[i]()?!0:!1},x[n]=function(){var e="sessionStorage";try{return!!window[e]}catch(t){return!1}},x[i]=function(){var e="localStorage";try{return!!window[e]}catch(t){return!1}},x[s]=function(){var e="indexedDB";return!!window[e]};var k=[0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918e3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117];
}(n);try{n[t.F1a](),n[t.t9a]||setTimeout(n[t.r5q][t.U6a],t.h5q)}catch(s){}return n}});define("shared/cf",["shared/polyfills","third_party/cf"],function ve(require,exports,e){var t=require("third_party/cf"),i=null;exports.init=function(e,n){var s=[];s.push(["_setJavaScriptKey",n]);s.push(["_setSDFieldNames",e]);s.push(["_setEnReadDocUrl",false]);s.push(["_setInitTime",Date.now()]);i=t.init(s)};exports.submit=function(){if(i!==null){i.cfsubmit()}}});define("unified_view/signup/_signup",["shared/polyfills","shared/core/component","interface/jquery","shared/w2.context","shared/events/index","shared/recaptcha","settings","shared/window_manager","interface/settings","shared/action_log","shared/cf","shared/siteuri","shared/client","shared/cookies"],function _e(require,exports,e){var t=require("shared/core/component").Component,$=require("interface/jquery")._jQuery,i=require("shared/w2.context"),n=require("shared/events/index"),s=require("shared/recaptcha"),o=i.CaptchaInput,r=require("settings").interface_strings,a=require("shared/window_manager"),d=null,l=require("interface/settings").pageIsMobile,c=require("shared/action_log").ActionableComponent,u=require("shared/action_log").logSecondaryAction,h=require("shared/cf"),f=require("shared/siteuri");
if(l){var p=require("mobile_app2/client");var g=require("mobile_app2/app/view/common");var m=require("shared/client");var v=require("mobile_app2/messages");var _=require("shared/cookies");var w=require("mobile_app2/app/view/login");var b=w.leaked_password_handler}exports.SignupActionableComponent=c;var y=exports.SignupContext=i.Context.extend({initialProperties:function(){return{googleOauthData:null,facebookOauthData:null,emailSignupData:null,captchaResponse:"",requiresCaptcha:false,validators:{},emailSubmitButton:null,loginData:null,showEmailSignup:false,facebookSignupFlowData:null}}});var C=exports.BaseSignupForm=c.extend({contextConstructor:function(){return y},onLoad:function(){this._super.apply(this,arguments);this.signupContext=this.getContext(y);this.signupContext.on("googleOauthData",this.onGoogleAccountConnected.bind(this));this.signupContext.on("facebookOauthData",this.onFacebookAccountConnected.bind(this));this.signupContext.on("emailSignupData",this.onEmailSignupFormFilled.bind(this));
this.loginInProgress=false},showLoading:function(){if(l){v.send("showLoadingView")}else{this.emitEvent({type:n.Types.LIVENODE_LOADING_SPINNER,payload:{show:true}})}},hideLoading:function(){if(l){v.send("hideLoadingView")}else{this.emitEvent({type:n.Types.LIVENODE_LOADING_SPINNER,payload:{show:false}})}},setRedirectCookie:function(e){if(e.indexOf("#")>0){e=e.substring(0,e.indexOf("#"))}if(e.indexOf("?")>0){var t=e.split("?");var i=t[1].split("&");var n=["success","access_token","provider","force_dialog"];i=i.filter(function(e){var t=e.split("=")[0];return!n.includes(t)});e=t[0]+"?"+i.join("&")}_.setCookie("login_redirect_url",e,{expires:1})},clearRedirectCookie:function(){_.setCookie("login_redirect_url")},handleServerCallResponse:function(e){this.hideLoading();this.loginInProgress=false;if(e.success){if(e.next_action=="oauth_redirect"){window.location=e.next_url;return}if(l){this.maybeSwitchNativeSilo(e);if(e.login_redirect_url){this.setRedirectCookie(e.login_redirect_url)}v.send("loginStateChanged",{
isLoggedIn:true})}else{switch(e.next_action){case"redirect":a.navigateTo(e.next_url);break;case"refresh":a.reload();break}}}else{if(e.isMissingFbInfo){this.signupContext.set("facebookSignupFlowData",e.facebookOauthData)}if(e.next_url){v.send("openURL",{url:e.next_url})}if(e.error_message&&l){g.showAlert({title:e.error_message})}}},maybeSwitchNativeSilo:function(e){if(e.subdomain&&e.language){p.updateConfig(e.subdomain,e.language)}else if(this.subdomain&&this.language){p.updateConfig(this.subdomain,this.language)}},logSignupSuccessAction:function(e){u(e,this.impression_target)},onGoogleAccountConnected:function(e,t){if(t){if(this.loginInProgress){return}this.loginInProgress=true;var i={google_access_token:t.access_token,use_test_signup:t.use_test_signup||false,cfResponse:this.cf_enabled?this.getCFResponse():null};var n=function(e){this.handleServerCallResponse(e);if(l&&e.success&&e.next_url){v.send("openURL",{url:e.next_url,target:"nondismissable_modal"})}else if(!e.success){this.loginInProgress=false;
if(t.onFailure){t.onFailure(e)}}};this.serverCall("on_google_account_connected").kwargs(i).success(n.bind(this)).error(function(){this.loginInProgress=false}.bind(this)).send();this.showLoading()}},onFacebookAccountConnected:function(e,t){if(t){if(this.loginInProgress){return}this.loginInProgress=true;var i={fb_uid:t.userID,fb_access_token:t.accessToken||t.access_token,expires:t.expiresIn,use_test_signup:t.use_test_signup||false,cfResponse:this.cf_enabled?this.getCFResponse():null};var n=function(e){this.handleServerCallResponse(e);if(l&&e.success&&e.next_url){v.send("openURL",{url:e.next_url,target:"nondismissable_modal"})}else if(!e.success){this.loginInProgress=false;if(t.onFailure){t.onFailure(e)}}};this.serverCall("on_facebook_account_connected").kwargs(i).success(n.bind(this)).error(function(){this.loginInProgress=false}.bind(this)).send();this.showLoading()}},onEmailSignupFormFilled:function(e,t){if(this.loginInProgress){return}if(!l){this.unsafe$id("@email_password_leak_error").hide();
}this.loginInProgress=true;var i=t.name;var n=t.email;var o=t.password;var r=this.signupContext.get("captchaResponse");function a(e){this.handleServerCallResponse(e);if(!e.success){this.loginInProgress=false;if(t.onFailure){t.onFailure()}if(this.signupContext.get("requiresCaptcha")){s.onInit(function(){grecaptcha.reset()})}}}var d=this.cf_enabled?this.getCFResponse():null;this.serverCall("on_try_email_signup").kwargs({name:i,email:n,password:o,"g-recaptcha-response":r,cfResponse:d}).success(a.bind(this)).except("password_leaked",this.passwordLeakHandler.bind(this,n)).error(function(){this.loginInProgress=false}.bind(this)).send();this.showLoading()},passwordLeakHandler:function(e){this.loginInProgress=false;if(l){b(this.translated_leaked_password_message,this.translated_leaked_password_submit_button_text,e)}else{this.hideLoading();var t=this;this.serverCall("load_password_leaked_dialog").kwargs({email:e}).contentFor(this.$id("@email_password_leak_error")).success(function(){t.$id("@email_password_leak_error").show();
}).send()}},getCFResponse:function(){h.submit();return $("#atomicMindlessHop").val()}});exports.HomePageSignupForm=C.extend({onLoad:function(){this._super.apply(this,arguments);if(l){v.send("loginStateChanged",{isLoggedIn:false});this.clearRedirectCookie()}else{var e=this;this.$id("@continue_with_email").on("click",function(){e.toggleSignupColumn(true)});this.$id("@cancel").on("click",function(){e.toggleSignupColumn(false)});this.signupContext.set("emailSubmitButton",this.$id("@submit"));this.signupContext.on("loginData",function(e,t){if(t){this.serverCall("record_no_account_found_link").send();this.toggleSignupColumn(true)}}.bind(this));this.signupContext.on("facebookSignupFlowData",function(){this.toggleSignupColumn(true)}.bind(this))}},toggleSignupColumn:function(e){if(e){this.$id("@toggled_signup_column").removeClass("hidden");this.$id("@initial_signup_column").addClass("hidden")}else{this.$id("@toggled_signup_column").addClass("hidden");this.$id("@initial_signup_column").removeClass("hidden");
}}});exports.DialogSignupFormMobile=C.extend({onLoad:function(){this._super.apply(this,arguments);this.$id("@login .normal_login .inline_login_form").removeClass("hidden");if(this.dismissible){var e=d.hideSignupWall.bind(d);this.$id("@dismiss_button").on("click",e);var t="@outer_modal".replace("@",this._my());this.$id("@outer_modal").on("click",function(i){if(i.target.id===t){e()}})}if(l){this.setRedirectCookie(a.getURL())}}});exports.DialogSignupFormWeb=C.extend({onLoad:function(){this._super.apply(this,arguments);this.signupContext.set("emailSubmitButton",this.$id("@submit"));this.$id("@login .normal_login .inline_login_form").removeClass("hidden");this.$id("@bottom_section .login_link").on("click",this.toggleToState.bind(this,"login_state"));this.$id("@bottom_section .email_signup_link").on("click",this.toggleToState.bind(this,"email_signup_state"));this.$id("@bottom_section .social_connect_link").on("click",this.toggleToState.bind(this,"social_signup_state"));if(this.dismissible){var e=d.hideSignupWall.bind(d);
this.$id("@bottom_section .dismiss_link").on("click",e);this.$id("@close_x").on("click",e);this.$id("@outer_form").on("click",function(t){var i="@outer_form".replace("@",this._my());if(t.target.id===i){e()}}.bind(this))}this.signupContext.on("loginData",function(e,t){if(t){this.serverCall("record_no_account_found_link").send();this.toggleToState("email_signup_state")}}.bind(this));this.signupContext.on("facebookSignupFlowData",function(){this.toggleToState("email_signup_state")}.bind(this))},toggleToState:function(e){if(e!==this.current_state){var t=this.state_toggle_id_map[e];var i=this.state_toggle_id_map[this.current_state];i.forEach(function(e){this.$id(e).addClass("hidden")}.bind(this));t.forEach(function(e){this.$id(e).removeClass("hidden")}.bind(this));this.current_state=e}}});exports.SignupCaptcha=t.extend({contextConstructor:function(){return o},onLoad:function(){this.signupContext=this.getContext(y);this.captchaContext=this.getContext(o);this.captchaContext.on("captchaResponse",this.onCaptchaResponseChanged.bind(this));
this.signupContext.set("requiresCaptcha",true)},onCaptchaResponseChanged:function(e,t){this.signupContext.set("captchaResponse",t)}});exports.EmailSignupFormWeb=t.extend({onLoad:function(){this.signupContext=this.getContext(y);this.registerFormChecks();this.signupContext.get("emailSubmitButton").on("click",this.onSubmitClicked.bind(this));this.signupContext.on("loginData",this.onLoginDataReceived.bind(this));this.signupContext.on("facebookSignupFlowData",function(e,t){this.intermediate_facebook_data=t;if(t.name){this.$id("@name").val(t.name)}if(t.email){this.$id("@email").val(t.email)}}.bind(this));if(this.initial_name){this.$id("@name").val(this.initial_name)}},onLoginDataReceived:function(e,t){if(t){this.$id("@email").val(t.email);this.$id("@password").val(t.password)}},registerFormChecks:function(){var e=this.maybeChangeEmailSubmitButton.bind(this);this.signupContext.on("captchaResponse",e);this.$id("@email").on("keyup",e);this.$id("@name").on("keyup",e);this.$id("@password").on("keyup",e);
},shouldEnableEmailSubmitButton:function(){var e=this.$id("@first_name").val();return this.signupContext.get("captchaResponse")!==""&&this.$id("@email").val()&&e&&this.validatePasswordInJs()},maybeChangeEmailSubmitButton:function(){var e=this.signupContext.get("emailSubmitButton");if(this.shouldEnableEmailSubmitButton()){e.removeAttr("disabled");e.removeClass("submit_button_disabled")}else{e.attr("disabled","disabled");e.addClass("submit_button_disabled")}},getValidator:function(e){return this.signupContext.get("validators")[e]},validateEmailSignupFields:function(){this.getValidator("@first_name").validate();this.getValidator("@email").validate();this.getValidator("@password").validate()},validatePasswordInJs:function(){var e=this.$id("@password").val();if(e.length<this.minimum_password_length||e.length>this.maximum_password_length){return false}if(e.toLowerCase()==="password"){return false}return true},onSubmitClicked:function(){this.validateEmailSignupFields();this.maybeChangeEmailSubmitButton();
if(this.shouldEnableEmailSubmitButton()){var e=this.$id("@first_name").val()+" "+this.$id("@last_name").val();this.signupContext.set("emailSignupData",{name:e,email:this.$id("@email").val(),password:this.$id("@password").val()})}}});exports.EmailSignupFormMobile=t.extend({onLoad:function(){var e=this;this.signupContext=this.getContext(y);this.enableDoneButton();p.registerMessageHandler("modalDoneButtonTapped",this.trySignup.bind(this));this.signupContext.on("requiresCaptcha",function(t,i){if(!t&&i){e.disableDoneButton()}});this.signupContext.on("captchaResponse",function(t,i){if(i!==""){e.enableDoneButton()}else{e.disableDoneButton()}});p.registerOneTimeMessageHandler("pageReadyComplete",function(){this.focusForm();if(m.isAndroidApp()){v.send("showKeyboard")}}.bind(this));if(this.initial_name){this.$id("@name").val(this.initial_name)}},setDoneButton:function(e){v.send("setPageAction",{rightTextButton:{title:r.done,callback:this.trySignup.bind(this),disabled:e}})},disableDoneButton:function(){
this.setDoneButton(true)},enableDoneButton:function(){this.setDoneButton(false)},focusForm:function(){this.$id("@name").focus()},onSignupFailure:function(){this.enableDoneButton();v.send("hideLoadingView",{});if(this.signupContext.get("requiresCaptcha")){this.disableDoneButton()}if(this.previousActiveElement){this.previousActiveElement.focus()}else{this.$id("@password").focus()}},trySignup:function(){this.disableDoneButton();v.send("showLoadingView",{});this.previousActiveElement=document.activeElement;document.activeElement.blur();var e=this.$id("@first_name").val()+" "+this.$id("@last_name").val();this.signupContext.set("emailSignupData",{name:e,email:this.$id("@email").val(),password:this.$id("@password").val(),onFailure:this.onSignupFailure.bind(this)})}});exports.DialogSignupFormWrapper=t.extend({onLoad:function(){d=this;this.signupWallLoaded=!this.dismissible;if(!this.dismissible){this.scrollToTopAndDisableScroll()}if(!l){$(document).bind("login_required_new_signup",this.loadSignupWall.bind(this));
}else{document.addEventListener("w2rpcexception-login_required",this.loadSignupWall.bind(this));if(!require("settings").isLoggedIn&&m.isNativeApp()){v.send("setPageAction",{rightTextButton:{title:this.sign_in_text,callback:this.loadSignupWall.bind(this)}})}}},scrollToTopAndDisableScroll:function(){document.body.classList.add("signup_wall_prevent_scroll");if(document.body&&document.body.scrollTop){document.body.scrollTop=0}if(document.documentElement&&document.documentElement.scrollTop){document.documentElement.scrollTop=0}},loadSignupWall:function(){if(!f.isSiteAbsoluteUrl(window.top.location.href)){return}if(require("settings").isLoggedIn){this.serverCall("record_attempt_to_load_signup_wall_logged_in").send();return}if(this.signupWallLoaded){this.scrollToTopAndDisableScroll();this.$id("@signup_wall_wrapper").removeClass("hidden")}else{this.signupWallLoaded=true;this.serverCall("load_signup_wall").contentFor(this.$id("@signup_wall_wrapper")).success(this.scrollToTopAndDisableScroll).send();
}},hideSignupWall:function(){this.$id("@signup_wall_wrapper").addClass("hidden");document.body.classList.remove("signup_wall_prevent_scroll")}});exports.loadSignupWall=function(){d.loadSignupWall()}});define("shared/twitter_oembed",["shared/polyfills","interface/rpc"],function we(require,exports,e){var t=require("interface/rpc").rpc;var i={};function n(e,t){var i=r(e);if(i){t(i,false)}else{s(e,function(i){if(i){var n=document.createElement("div");n.className="content";n.qtextSpanContent=true;n.innerHTML=i.html;t(n,true);o(e,n)}else{t(null)}})}}function s(e,i){t("/twitter/get_twitter_oembed_json_POST").kwargs({url:e}).success(function(e){if("error"in e){i(null)}else{i(e)}}).error(function(){i(null)}).send()}exports.getTweetData=n;exports.loadEmbeds=function(){if(window.twttr&&window.twttr.widgets){window.twttr.widgets.load()}};function o(e,t){var n=i[e];if(n){n.push(t)}else{i[e]=[t]}}function r(e){var t=i[e]||[];for(var n=0;n<t.length;n++){var s=t[n];var o=s.getElementsByTagName("twitterwidget");
if(!s.isConnected&&o.length>0){return s}}return null}});define("view/modal",["shared/polyfills","webnode2","shared/errors","shared/debounce","shared/util","shared/viewport","w2.modal","shared/twitter_oembed"],function be(require,exports,e){var t=require("webnode2").Component,i=require("shared/errors"),n=require("shared/debounce").debounce,s=require("shared/util"),o=require("shared/viewport"),r=require("w2.modal"),a=require("shared/twitter_oembed").loadEmbeds;var d=exports.Base=t.extend({onLoad:function(){var e=this;e.close_button=this.$id("@close_button");e.cancel_button=this.$id("@cancel_button");e.submit_button=this.$id("@submit_button");e.close_button.on("click",function(t){e.onClose();t.preventDefault()});e.cancel_button.on("click",function(t){e.onCancel();t.preventDefault()});e.submit_button.on("click",function(t){e.onSubmit();t.preventDefault()});a()},_closeModal:function(){r.Modal.modalFor(this).close()},onClose:function(){this._closeModal()},onCancel:function(){this._closeModal();
},onSubmit:function(){if(this.submitDisabled){return}this._closeModal()},disableSubmit:function(){this.submitDisabled=true;this.submit_button.addClass("action_disabled")},enableSubmit:function(){this.submitDisabled=false;this.submit_button.removeClass("action_disabled")}});exports.MultiStep=d.extend({onLoad:function(){this.stepCallbacks=this.getCallBacks();this.onLoadInit();this._super.apply(this,arguments);this._bindEventHandlers();if(!this.key){i.logJsError("modal.MultiStep","Please set a data key in python js_data");return}if(!this.stepCallbacks){var e=["Sub classes should override getCallBacks() and have it return a ","list of methods supported by each modal steps."].join("");i.logJsError("modal.MultiStep",e);return}if(!this.data_cache){i.logJsError("modal.MultiStep","Please define a data storage variable in python");return}},onLoadInit:function(){var e=this.m("init");if(typeof e==="function"){e()}},getCallBacks:function(){},_bindEventHandlers:function(){var e=this.m("eventHandlers");
if(typeof e==="function"){e()}var t=this;this.$id("@back_button").on("click",function(){t.onBack()})},m:function(e){return this.stepCallbacks[this.key][e]},onSubmit:function(){var e=this.m("onSubmit");if(typeof e==="function"){e();return}if(this.submitDisabled){return}this._loadNext()},onBack:function(){var e=this.m("onBack");if(typeof e==="function"){e();return}this.loadPrev()},isLastStep:function(){var e=this.m("isLastStep");if(e){return e}return false},_loadNext:function(){var e=this;if(e.isLastStep()){e.serverCall("last_step").kwargs({data_set:{data_cache:this.persistData()}}).success(function(t){e._closeModal()}).send()}else{e.modal("load_next_modal",{kwargs:{data_set:{data_cache:this.persistData()}}}).onCloseCallBack(function(){e._closeModal()})}},loadPrev:function(){var e=this;this.modal("load_previous_modal",{kwargs:{data_set:{data_cache:this.persistData()}}}).onCloseCallBack(function(){e._closeModal()})},_getStepData:function(){var e=this.m("getStepData");if(typeof e==="function"){
var t=e();if(!t){var n=["Hey! we noticed that you defined a getStepData() method in ","your code but its not returning any value that is to be ","persisted for this modal step. To fix this error, either ","delete getStepData() definition or return a data that you ","want to be persisted for: "+this.key].join("");i.logJsError("modal.MultiStep",n);return}var o=this.data_cache[this.key];return s.extend(o,t)}return null},persistData:function(){this.data_cache[this.key]=this._getStepData();return this.data_cache},_closeModal:function(){r.Modal.modalFor(this).executeOnCloseCallBack();this._super.apply(this,arguments)}});exports.ToggleModal=d.extend({onLoad:function(){if(this.is_modal){this._super.apply(this,arguments);this.onLoadModal()}else{this.onLoadInline()}},onLoadModal:function(){},onLoadInline:function(){this.$inlineElem=this.$id(this.inline_wrapper);this.initModal();if(this.should_prefetch){this.fetched=false;this.bindInViewPort(this.$inlineElem,this.fetchModal.bind(this))}var e=this;e.$inlineElem.on("click",function(t){
if(!e._shouldIgnoreClick(t)){e.handleClick(t)}})},initModal:function(){this._modal=new r.ModalBase(this,{kwargs:{serialized_args:this.serialized_args}})},showModal:function(){this._modal.load("load_modal")},fetchModal:function(){if(!this.fetched){this.fetched=true;this._modal.fetch("load_modal")}},isModalOpen:function(){if(this._modal){return this._modal._isOpen}return false},bindInViewPort:function(e,t){if(o.isElementInViewport(e.get(0))){t()}else{var i={leading:true};var s=n(function(){if(o.isElementInViewport(e.get(0))){t();window.removeEventListener("scroll",s)}},50,i);window.addEventListener("scroll",s)}},_shouldIgnoreClick:function(e){var t=e.target,i=this.$inlineElem.get(0);while(t&&t!==i){if(t.tagName=="A"&&!t.classList.contains("more_link")){return true}if(t.getAttribute("contenteditable")||t.classList.contains("editor_toolbar")){return true}if(t.classList.contains("RequestAnswersDrawer","is_active")){return true}if(t.classList.contains("action_bar_comments","threaded_comments")){
return true}t=t.parentNode}return false},handleClick:function(e){e.preventDefault();this.showModal()}})});define("login",["shared/polyfills","jquery","shared/errors","shared/events/index","webnode2","shared/window_manager","shared/siteuri","settings","unified_view/signup/_signup","facebook","shared/cf","view/modal"],function ye(require,exports,e){var $=require("jquery"),t=require("shared/errors"),i=require("shared/events/index"),n=require("webnode2").Component,s=require("shared/window_manager"),o=require("shared/siteuri").URI,r=require("settings"),a=require("unified_view/signup/_signup").SignupContext,d=require("facebook"),l=require("shared/cf"),c=require("view/modal").Base;$(document).bind("w2rpcexception-login_required.default",function(e,t){$(document).trigger("login_required_new_signup")});i.GlobalProxy.subscribe(i.Types.LOGOUT_USER,function(){s.reload()});exports.LoginButton=n.extend({onLoad:function(){this.$id("@login_link").click(function(e){var t=o("/?next="+encodeURIComponent(s.getURL()));
s.navigateTo(t.unicode());return false})}});var u=exports.InlineLogin=n.extend({onLoad:function(){var e=this;e.checkingPassword=false;e.hasLoggedIn=false;var t=function(t){var i=t.keyCode||t.which;if(i==13){e.$id("@submit_button").click()}};var n=t.bind(e);e.$id("@password").keydown(n);e.$id("@email").keydown(n);e.$id("@resend_confirmation").click(function(t){e.serverCall("resend_confirmation_link").kwargs({email:e._email()}).success(function(){e.hideAllErrors()}).send();return false});e.$id("@reset_password_link").click(e.resetPasswordHandler.bind(this));e.$id("@forgot_password_link").click(e.resetPasswordHandler.bind(this));e.$id("@email").on("input",function(){setTimeout(function(){e.updatePreview()},10)});e.$id("@submit_button").click(function(){e.checkPassword();return false});e.$id("@submit_button").bind("touchend",function(){e.checkPassword();return false});e.$id("@login_link").click(function(){e.$id("@associated").addClass("hidden");e.$id("@alt_login_row").addClass("hidden");e.$id("@login_form").removeClass("hidden");
e.$id("@email").focus();return false});this.handleEvent(i.Types.LOGIN_UPDATE_FIELDS,function(t){e.$id("@email").val(t.payload.email);e.$id("@allow_passwordless").removeAttr("checked");e.updatePreview();e.$id("@password").focus()});var s=this.getContext(a);if(s){this.$id("@email_not_found_error a").click(function(){var e={email:this.$id("@email").val(),password:this.$id("@password").val()};s.set("loginData",e);return false}.bind(this))}$(document).ready(function(){e.updatePreview()})},resetPasswordHandler:function(){var e=this;e.serverCall("reset_password").kwargs({email:e._email()}).success(function(){e.hideAllErrors()}).send();return false},updatePreview:function(){this._updatePreviewMemCache=this._updatePreviewMemCache||{};var e=this,t=e._email(),i=e._updatePreviewMemCache,n=function(n){i[t]=n;if(e.customSuccessUpdatePreviewCallback){e.customSuccessUpdatePreviewCallback(n);e.removeButtonDisabled()}else{e.$(".usercard_big").fadeTo(1,1);e.$id("@preview").hide();var s=false,o=n.name.split(" ")[0];
e.$("%passwordless_users").find(".name_span:visible").each(function(e){if($(this).text()!=o){$(this).parents(".usercard_big").fadeTo(1,.3)}else{s=true}});if(!s){e.$id("@associated").addClass("hidden");e.$id("@alt_login_row").addClass("hidden");e.$id("@login_form").removeClass("hidden");e.$id("@password").focus();e.$id("@name").text(n.name);e.$id("@pic").attr("src",n.photo_url);e.$id("@preview").show();e.removeButtonDisabled()}e.hideAllErrors()}};if(i[t]){n(i[t]);return}e.serverCall("preview_info").kwargs({email:t}).success(n).except("email_not_found",function(t){e.$id("@preview").fadeOut(120);e.hideAllErrors();e.showErrorOnComponent("#@email_not_found_error","#@email");e.addButtonDisabled();return false}).except("no_email",function(t){e.$id("@preview").fadeOut(120);e.hideAllErrors();e.addButtonDisabled()}).except("email_unconfirmed",function(t){e.$id("@preview").fadeOut(120);e.hideAllErrors();e.showErrorOnComponent("#@email_not_confirmed_error","#@email");e.removeButtonDisabled()}).except("refused",function(t){
e.$id("@preview").fadeOut(120);e.hideAllErrors();e.removeButtonDisabled()}).send()},removeButtonDisabled:function(){this.$id("@submit_button").removeClass("submit_button_disabled")},addButtonDisabled:function(){this.$id("@submit_button").addClass("submit_button_disabled")},loginKwargs:function(){var e=this.$id("@email").val();var t=this.$id("@password").val();var i=+this.$id("@allow_passwordless").is(":checked");var n=this.cf_enabled?this.getCFResponse():null;return{email:e,password:t,passwordless:i,cfResponse:n}},getCFResponse:function(){l.submit();return $("#atomicMindlessHop").val()},loginSuccessCallback:function(e){if(this.customSuccessLoginCallback){this.customSuccessLoginCallback(e)}else{var t=e;this.hideAllErrors();if(r.uid==t||r.pageMode=="post_reload"){this.emitEvent(i.helpers.loginUser())}}var n=this;n.addButtonDisabled()},checkPassword:function(){this.hideAllErrors();var e=this;if(e.hasLoggedIn){return}if(e.checkingPassword){return}e.checkingPassword=true;e.serverCall("do_login").kwargs(e.loginKwargs()).success(function(t){
e.hasLoggedIn=true;e.checkingPassword=false;e.loginSuccessCallback(t)}).except("email_not_found",function(){e.checkingPassword=false;e.hideAllErrors();e.showErrorOnComponent("#@email_not_found_error","#@email")}).except("incorrect_password",function(){e.checkingPassword=false;e.hideAllErrors();e.showErrorOnComponent("#@incorrect_password_error","#@password")}).except("email_unconfirmed",function(){e.checkingPassword=false;e.hideAllErrors();e.showErrorOnComponent("#@email_not_confirmed_error","#@email")}).except("banned_user",function(){e.checkingPassword=false;e.hideAllErrors();e.serverCall("login_user_is_banned").kwargs(e.loginKwargs()).send()}).except("too_many_attempts",function(){e.checkingPassword=false;e.hideAllErrors();e.serverCall("login_user_rate_limited").kwargs(e.loginKwargs()).send()}).except("password_leaked",function(){e.checkingPassword=false;e.serverCall("load_password_leaked_dialog").kwargs({email:e._email()}).contentFor(e.$id("@email_password_leak_error")).success(function(){
e.hideAllErrors();e.$("%@login_options").hide();e.$id("@email_password_leak_error").show()}).send()}).except("two_factor_authentication",function(){e.checkingPassword=false;e.hideAllErrors();e.modal("login_user_two_factor_authentication",{kwargs:{email:e._email()}})}).liveMutate().sendOnlyOnce()},_email:function(){return this.$id("@email").val()},hideAllErrors:function(){this.$id("@email_not_found_error").hide();this.$id("@email_not_confirmed_error").hide();this.$id("@incorrect_password_error").hide();this.$id("@email_password_leak_error").hide();this.$id("@email").removeClass("input_validation_error");this.$id("@password").removeClass("input_validation_error")},showErrorOnComponent:function(e,t){this.$(e).show();this.$(t+"_menu").show();this.$(t).addClass("input_validation_error")}});exports.VerifyUser2FAModal=c.extend({onLoad:function(){this._super.apply(this,arguments)},onSubmit:function(){var e=this;e._closeModal()}});exports.FacebookConnectInlineLogin=u.extend({loginKwargs:function(){
var e=this._super.apply(this,arguments);e.fb_uid=d.getFbUid();e.fb_access_token=d.getAccessToken();e.fb_expires=d.getExpiresIn();return e},loginSuccessCallback:function(e){var t=e[0],n=e[1];this.hideAllErrors();if(r.uid==t||r.pageMode=="post_reload"){this.emitEvent(i.helpers.loginUser(n))}}});var h=exports.InlineLoginProfile=n.extend({loginKwargs:function(){return{cfResponse:this.cf_enabled?this.getCFResponse():null}},getCFResponse:function(){l.submit();return $("#atomicMindlessHop").val()},loginSuccessCallback:function(e){if(r.pageMode=="post_reload"||r.enableAccessToken){this.emitEvent(i.helpers.loginUser())}},onLoad:function(){var e=this;e.hasLoggedIn=false;e.$id("@container").click(function(){if(r.isLoggedIn){e.emitEvent(i.helpers.loginUser());return false}else if(e.passwordless){if(e.hasLoggedIn){return false}e.serverCall("do_login").kwargs(e.loginKwargs()).success(function(t){e.hasLoggedIn=true;e.loginSuccessCallback(t)}).liveMutate().sendOnlyOnce()}else{e.emitEvent({type:i.Types.LOGIN_UPDATE_FIELDS,
payload:{email:e.email,passwordless:false}})}return false});e.$id("@x_person").click(function(){e.serverCall("x_person").liveMutate().send();return false})}});exports.FacebookConnectInlineLoginProfile=h.extend({loginKwargs:function(){return{fb_uid:d.getFbUid(),fb_access_token:d.getAccessToken(),fb_expires:d.getExpiresIn(),cfResponse:this.cf_enabled?this.getCFResponse():null}},loginSuccessCallback:function(e){var t=e[1];if(r.pageMode=="post_reload"||r.enableAccessToken){this.emitEvent(i.helpers.loginUser(t))}}});exports.LoginSignal=n.extend({onLoad:function(e){if(!e){var n=this.uid;if(r.isLoggedIn){t.logJsError("Got a login signal for logged in user: "+n)}if(n){this.emitEvent(i.helpers.loginUser())}else{this.emitEvent(i.helpers.logoutUser())}}}});var f=exports.LoggedOutHomeHeaderInlineLogin=u.extend({onLoad:function(){this._super.apply(this,arguments);this.$id("@email").focus();this.$id("@cancel_link").on("click",this.toggleLoginOptions.bind(this))},hideAllErrors:function(){this._super.apply(this,arguments);
this.$("%@login_options").show()},showErrorOnComponent:function(e,t){this._super.apply(this,arguments);this.$("%@login_options").hide()},toggleLoginOptions:function(){this.$id("@login_form").hide();return true}});exports.OAuthLogin=f.extend({customSuccessLoginCallback:function(e){this.hideAllErrors();this.serverCall("get_permissions_page_response").success(function(e){window.location=e.next_url}).send()}});exports.LoginPageLoginListener=n.extend({init:function(){this._super.apply(this,arguments);this._enabled=true},onLoad:function(){var e=this;this.handleEvent(i.Types.LOGIN_USER,function(t){var i={};if(t.payload.pmsg){i.__pmsg__=t.payload.pmsg}if(e._enabled){var n=e.next,o=[],r;for(r in i){o.push(r+"="+encodeURIComponent(i[r]))}if(o.length>0){n+=n.indexOf("?")==-1?"?":"&";n+=o.join("&")}s.navigateTo(n)}})}});exports.LeakedPasswordMessage=n.extend({onLoad:function(){var e=this;this.$id("@reset_password_link").click(function(){e.serverCall("reset_password").kwargs({email:e.email}).send()});
}})});define("network",["shared/polyfills","jquery"],function Ce(require,exports,e){var $=require("jquery");$(document).bind("w2rpcexception-network_membership_required.default",function(){window.location="/join"})});define("view/captcha",["shared/polyfills","jquery","shared/recaptcha","webnode2","view/modal","w2.livenode"],function xe(require,exports,e){var $=require("jquery"),t=require("shared/recaptcha"),i=require("webnode2").Component,n=require("view/modal").Base,s=require("w2.livenode"),o;$(document).bind("w2rpcexception-captcha_required",function(e,t){if(t.rpc.__liveMutation){s.mutationDoneAfterVersion(t.rpc.__liveMutationInfo.transactionId,0)}o.load_captcha()});exports.Captcha=i.extend({init:function(){this._super.apply(this,arguments);o=this},load_captcha:function(){var e=this;e.modal("load_captcha_modal");return false}});exports.CaptchaModal=n.extend({onLoad:function(){this._super.apply(this,arguments);var e=this;var i=function(){e.serverCall("on_captcha_verified").liveMutate().success(function(){
e._closeModal()}).send()};t.onInit(function(){grecaptcha.render(e.$id("@captcha")[0],{sitekey:e.recaptcha_key,theme:"light",callback:i})})}})});define("view/reauth",["shared/polyfills","jquery","webnode2","view/modal","w2.livenode"],function ke(require,exports,e){var $=require("jquery"),t=require("webnode2").Component,i=require("view/modal").Base,n=require("w2.livenode"),s,o;$(document).bind("w2rpcexception-reauth_required",function(e,t){if(t.rpc.__liveMutation){n.mutationDoneAfterVersion(t.rpc.__liveMutationInfo.transactionId,0)}o=t.rpc;if(t.response.exception.args[1]===true){o=o.liveMutate()}s.load_reauth()});exports.ReauthWrapper=t.extend({init:function(){this._super.apply(this,arguments);s=this},load_reauth:function(){this.modal("load_reauth_modal");return false}});exports.ReauthModal=i.extend({onSubmit:function(){if(this.submit_disabled){return}var e=this;var t=function(t){if(t.login_success){e.previous_call.send();e._closeModal()}else{e.$id("@password").val("")}};var i=function(){
e.serverCall("load_password_leaked_dialog").contentFor(e.$id("@email_password_leak_error")).success(function(){e.$id("@normal_subtitle").hide();e.$id("@email_password_leak_error").show();e.submit_disabled=true}).send()};var n={password:this.$id("@password").val()};this.serverCall("verify").kwargs(n).success(t).except("password_leaked",i).send()},onLoad:function(){this._super.apply(this,arguments);this.previous_call=o;var e=this;this.$id("@password").focus();this.$id("@password").keypress(function(t){if(t.keyCode==13){e.$id("@submit_button").click()}});$(".forgot_password").on("click",function(t){t.preventDefault();e.serverCall("send_reset_password_email").send()})}})});define("unified_view/insertion_query",["shared/polyfills"],function Se(require,exports,e){exports.insertionQ=function(){"use strict";var e=100,t=false,i="animationName",n="",s="Webkit Moz O ms Khtml".split(" "),o="",r=document.createElement("div"),a={strictlyNew:true,timeout:20};if(r.style.animationName){t=true}if(t===false){
for(var d=0;d<s.length;d++){if(r.style[s[d]+"AnimationName"]!==undefined){o=s[d];i=o+"AnimationName";n="-"+o.toLowerCase()+"-";t=true;break}}}function l(t,s){var o,r="insQ_"+e++;var d=function(e){if(e.animationName===r||e[i]===r){if(!u(e.target)){s(e.target)}}};o=document.createElement("style");o.innerHTML="@"+n+"keyframes "+r+" {  from {  outline: 1px solid transparent  } to {  outline: 0px solid transparent }  }"+"\n"+t+" { animation-duration: 0.001s; animation-name: "+r+"; "+n+"animation-duration: 0.001s; "+n+"animation-name: "+r+"; "+" } ";document.head.appendChild(o);var l=setTimeout(function(){document.addEventListener("animationstart",d,false);document.addEventListener("MSAnimationStart",d,false);document.addEventListener("webkitAnimationStart",d,false)},a.timeout);return{destroy:function(){clearTimeout(l);if(o){document.head.removeChild(o);o=null}document.removeEventListener("animationstart",d);document.removeEventListener("MSAnimationStart",d);document.removeEventListener("webkitAnimationStart",d);
}}}function c(e){e.QinsQ=true}function u(e){return a.strictlyNew&&e.QinsQ===true}function h(e){if(u(e.parentNode)){return e}else{return h(e.parentNode)}}function f(e){c(e);e=e.firstChild;for(;e;e=e.nextSibling){if(e!==undefined&&e.nodeType===1){f(e)}}}function p(e,t){var i=[];var n=function(){var e;return function(){clearTimeout(e);e=setTimeout(function(){i.forEach(f);t(i);i=[]},10)}}();return l(e,function(e){if(u(e)){return}c(e);var t=h(e);if(i.indexOf(t)<0){i.push(t)}n()})}var exports=function(e){if(t&&e.match(/[^{}]/)){if(a.strictlyNew){f(document.body)}return{every:function(t){return l(e,t)},summary:function(t){return p(e,t)}}}else{return false}};exports.config=function(e){for(var t in e){if(e.hasOwnProperty(t)){a[t]=e[t]}}};return exports}()});define("unified_view/lazy_load_images",["shared/polyfills","unified_view/insertion_query","shared/onload"],function Ee(require,exports,e){var t=require("unified_view/insertion_query"),i=require("shared/onload"),n=2e3;function s(e){if(e.getAttribute("data-src")){
e.setAttribute("src",e.getAttribute("data-src"));e.removeAttribute("data-src");e.addEventListener("load",function(){e.style.opacity=1;var t=e.previousElementSibling;if(t&&t.classList.contains("qtext_image_placeholder")){setTimeout(function(){t.style.visibility="hidden"},1e3)}})}}function o(){var e=document.querySelectorAll("img[data-src]");for(var t=0;t<e.length;t++){s(e[t])}}function r(){o();t.insertionQ("img").every(function(e){s(e)});setInterval(o,n)}function a(e){if(e.getAttribute("data-src")){var t=new Image;t.src=e.getAttribute("data-src");var i=e.getAttribute("width");var n=e.getAttribute("height");var s=e.getContext("2d");t.addEventListener("load",function(){s.drawImage(t,0,0,i,n)},false)}}function d(){var e=document.querySelectorAll("canvas[data-src]");t.insertionQ("canvas[data-src]").every(function(e){a(e)});[].forEach.call(e,a)}d();i.execAfterLoad(r)});define("shared/links_logger",["shared/polyfills","shared/links","shared/logging","shared/siteuri"],function Te(require,exports,e){
var t=require("shared/links"),i=require("shared/logging"),n=require("shared/siteuri");var s=function(e){if(!n.isSiteUrl(e)){i.log("link_click",{url:e,current_url:window.location.href})}};t.onLinkClick(s)});define("shared/service_worker_init",["shared/polyfills","gating","shared/window_manager","settings","shared/log","shared/onload"],function $e(require,exports,e){var t=require("gating"),i=require("shared/window_manager"),n=require("settings"),s=require("shared/log").log,o=require("shared/onload");var r=i.getDomain()+"static/shared/sw.js";s=s.bind(s,"serviceWorker");var a=function(){if(!n.isLoggedIn){return}window.navigator.serviceWorker.ready.then(function(e){e.pushManager.subscribe({userVisibleOnly:true}).then(function(e){var t=e.endpoint.split("/");var i=t[t.length-1];var n="/desktop_push/register?token="+i;fetch(n,{credentials:"include"});s("Device token: ",i)}).catch(function(e){s("Unable to subscribe push notifs...",e)})})};var d=function(){if("serviceWorker"in window.navigator){s("Service Worker is supported");
if(t.use_service_worker||t.desktop_push_notifs){window.navigator.serviceWorker.register(r,{scope:"/"}).then(function(e){s("Successfully registered!",e);if(t.desktop_push_notifs){a()}}).catch(function(e){s("Unsuccessfully registered...",e)})}else{s("Not enabled, removing.");if(window.navigator.serviceWorker.getRegistrations){window.navigator.serviceWorker.getRegistrations().then(function(e){for(var t=0;t<e.length;++t){e[t].unregister()}},function(){})}}}};o.execAfterLoad(d)});define("shared/client_tracker",["shared/polyfills","shared/client_tracker","shared/Class","shared/w2.context","shared/core/rpc","shared/cookies","shared/util","shared/window_manager","shared/core/component","interface/jquery","interface/settings","shared/logging"],function Le(require,exports,e){var t=require("shared/Class").Class,i=require("shared/w2.context"),n=require("shared/core/rpc"),s=require("shared/cookies"),o=require("shared/util"),r=require("shared/window_manager"),a=require("shared/core/component"),$=require("interface/jquery")._jQuery,d=require("interface/settings"),l=d.pageIsMobile,c=d.enableClientTracker,u;
if(l){u=require("mobile_app2/click_handlers")}var h=t.extend({__init__:function(){this.trail=d.clientTrackerTrail;this.started=false},start:function(){if(!c){return}if(this.started){return}this.started=true;if(l){u.safeClickHandler(document,this.setFeedTrail.bind(this),{handlesClick:false,capture:true})}else{$(document).on("mousedown",this.setFeedTrail.bind(this))}n.addMetadataCallback(this.addFeedMetadata.bind(this))},track:function(e,t,i){if(!c){return}t=o.extend({},t);this.addFeedMetadata(t,i);t["action"]=e;require("shared/logging").log("ctrkr",t)},addFeedMetadata:function(e,t){var i=this.feedDataFromComponent(t);if(i){e["qfl2"]=i}if(this.trail&&this.trail.qfl2){e["qfl2-t"]=this.trail.qfl2}},feedDataFromComponent:function(e){if(a.isOnLoadRunning()){return}var t=e.getDvar("enable_feed_logging");if(l&&!t){return}var n=e.getDvar("feed_story_hash");if(!n){return}var s=e.getDvar("feed_ty");s=s!==null?s:0;var o=e.getDvar("paged_list_hash");var r=e.getDvar("feed_story_position");if(l&&r===null){
var d=e.getContext(i.UniversalPageFeedContext);var c=d.get("impressionLogger");if(!c){return}r=c.getPositionFromPagedListHash(o)}r=r===null?0:r;var u=e.getDvar("feed_story_initial")||false;var h=e.getDvar("feed_page");var f=e.getDvar("page_data");var p=e.getDvar("focus_ty");var g=e.getDvar("feed_story_inner_position");g=g===null?0:g;var m=e.getDvar("bundle_position");return[9,n,r,u,"_ctkr",s,h,f,p,g,m]},setFeedTrail:function(e){var t=e.target;var i=r.getDomain();while(t){if(t.tagName=="A"){var n=t.getAttribute("href");if(n&&n.startsWith("/")){break}if(n&&n.startsWith(i)){n=n.slice(i.length-1);break}}t=t.parentElement}if(!t){return}var o=a.getComponentFromElement(t);if(!o){return}var d=this.feedDataFromComponent(o);if(!d){return}var l={path:n,expires:1};s.setMessage("ctrkr",{qfl2:d},null,l)}});var f;var p=exports.init=function(){f=new h;f.start()};exports.track=function(){if(!f){p()}f.track.apply(f,arguments)}});define("shared/activity_metrics",["shared/polyfills","shared/logging","shared/debounce"],function Me(require,exports,e){
var t=require("shared/logging"),i=require("shared/debounce").throttle,n=60*1e3;function s(e){var i={eventType:e,time:Date.now()*1e3,path:window.location.href};t.log("activity_metrics",i)}function o(e){var t=s.bind(null,e);window.addEventListener(e,i(t,n,{trailing:false}),true)}exports.init=function(){o("scroll");o("click");o("keyup")}});define("app/view/activation/endorsement",["shared/polyfills","webnode2"],function De(require,exports,e){var t=require("webnode2").Component;exports.EndorsementListItem=t.extend({onLoad:function(){this.$id("@remove_endorsement").click(this.remove.bind(this))},remove:function(e){e.preventDefault();this.serverCall("remove_endorsement").liveMutate().sendOnlyOnce()}});exports.AcceptEndorsementTopicButton=t.extend({onLoad:function(){this.$id("@accept").click(this.accept.bind(this))},accept:function(e){e.preventDefault();this.serverCall("accept").liveMutate().sendOnlyOnce()}});exports.DeclineEndorsementTopicButton=t.extend({onLoad:function(){this.$id("@decline").click(this.decline.bind(this));
},decline:function(e){e.preventDefault();this.serverCall("decline").liveMutate().sendOnlyOnce()}})});define("app/view/activation/endorsement/endorse_by_topic",["shared/polyfills","webnode2","shared/events/index"],function Ae(require,exports,e){var t=require("webnode2").Component,i=require("shared/events/index");var n=0;exports.EndorseByTopicSidebarNextButton=t.extend({onLoad:function(){this.$id("@sidebar-header-button").click(this.next.bind(this))},next:function(e){e.preventDefault();this.emitEvent({type:i.Types.ACTIVATION_NEXT_STEP,payload:{}})}});exports.EndorsementPeopleSelectorContainer=t.extend({setTo:function(e){if(isNaN(parseInt(e))){return}this.addEndorsement(e)},addEndorsement:function(e){this.serverCall("add_endorsement").kwargs({to_uid:e}).send()}});exports.EndorseByTopicSidebarContent=t.extend({onLoad:function(){if(this.topicShown){this.serverCall("track_impression").sendOnlyOnce();n++;if(n>1){this.$id("@activation_sidebar_content").find(".question_box").focus()}}this.handleEvent(i.Types.ACTIVATION_NEXT_STEP,this.nextTopic.bind(this));
},nextTopic:function(){this.serverCall("next_topic").liveMutate().sendOnlyOnce()}})});define("app/view/activation/endorsement/endorse_by_user",["shared/polyfills","webnode2","shared/events/index"],function Ie(require,exports,e){var t=require("webnode2").Component,i=require("shared/events/index");var n=0;exports.EndorseByUserSidebarNextButton=t.extend({onLoad:function(){this.$id("@sidebar-header-button").click(this.next.bind(this))},next:function(e){e.preventDefault();this.emitEvent({type:i.Types.ACTIVATION_NEXT_STEP,payload:{}})}});exports.EndorseByUserSidebarContent=t.extend({onLoad:function(){if(this.userShown){this.serverCall("track_impression").sendOnlyOnce();n++;if(n>1){this.$id("@activation_sidebar_content").find(".question_box").focus()}}this.handleEvent(i.Types.ACTIVATION_NEXT_STEP,this.nextUser.bind(this))},nextUser:function(){this.serverCall("next_user").liveMutate().sendOnlyOnce()}})});define("app/view/activation/endorsement/modal",["shared/polyfills","webnode2"],function qe(require,exports,e){
var t=require("webnode2").Component;exports.EndorsedTopicsModalLink=t.extend({onLoad:function(){var e=this;this.$id("@create_modal_link").click(function(t){t.preventDefault();e.modal("load_inner")})}});exports.UserTopicEndorsementsLink=t.extend({onLoad:function(){var e=this;this.$id("@create_modal_link").click(function(t){t.preventDefault();e.modal("load_inner")});this.$id("@endorse_link").click(function(t){t.preventDefault();e.serverCall("endorse_user").liveMutate().send()});this.$id("@unendorse_link").click(function(t){t.preventDefault();e.serverCall("unendorse_user").liveMutate().send()})}})});define("app/view/activation/facebook",["shared/polyfills","webnode2","shared/onload","shared/facebook"],function Ne(require,exports,e){var t=require("webnode2").Component,i=require("shared/onload"),n=require("shared/facebook");exports.FacebookPageLikeButton=t.extend({onLoad:function(){var e=this;i.execAfterLoadDelayed(function(){n.onInit(function(){window.FB.XFBML.parse(e.$id("@button").get(0));
window.FB.Event.subscribe("edge.create",function(){e.serverCall("page_liked").liveMutate().send()});window.FB.Event.subscribe("edge.remove",function(){e.serverCall("page_unliked").liveMutate().send()})})})}});exports.FacebookPageLikePrompt=t.extend({hide:function(){this.$id("@fb_page_like_prompt").addClass("hidden")}});exports.FacebookPageLikePromptDismiss=t.extend({onLoad:function(){this.$id("@dismiss").click(this.dismiss.bind(this))},dismiss:function(e){e.preventDefault();this.parent().hide();this.serverCall("dismiss").liveMutate().send();return false}})});define("app/view/activation/profile_topics",["shared/polyfills","webnode2","shared/events/index"],function Oe(require,exports,e){var t=0;var i=require("webnode2").Component,n=require("shared/events/index");exports.CompleteProfileSidebarNextButton=i.extend({onLoad:function(){this.$id("@sidebar-header-button").click(this.next.bind(this))},next:function(e){e.preventDefault();this.emitEvent({type:n.Types.ACTIVATION_NEXT_STEP,payload:{}});
}});exports.CompleteProfileContents=i.extend({onLoad:function(){this.serverCall("track_impression").send();this.handleEvent(n.Types.ACTIVATION_NEXT_STEP,this.completeStep.bind(this))},completeStep:function(){this.serverCall("complete_topic_step").liveMutate().sendOnlyOnce()}});exports.CompleteProfileTopicSelectorContainer=i.extend({onLoad:function(){t++;if(t>1){this.$id("@topic_selector_container").find(".question_box").focus()}}});exports.TopicStepListItem=i.extend({onLoad:function(){this.$id("@remove_button").click(this.remove.bind(this))},remove:function(e){e.preventDefault();this.serverCall("remove_topic").liveMutate().send()}})});define("app/view/activation/progress",["shared/polyfills","webnode2","shared/events/index"],function Re(require,exports,e){var t=require("webnode2").Component,i=require("shared/events/index");exports.ProgressBar=t.extend({onLoad:function(){var e=this;if(e.getMaxWidth()===0){setTimeout(function(){e.initialize()},1)}else{e.initialize()}this.handleEvent(i.Types.ACTIVATION_PROGRESS_BAR_STEP,function(t){
if(t.payload.step){e.update(t.payload.step)}})},getMaxWidth:function(){return this.$id("@progress_bar_wrapper").width()},initialize:function(){this.$id("@progress_bar").css({width:this.getWidth()})},getWidth:function(){var e=this.getMaxWidth();var t=this.curr/this.total*e;return Math.min(e,t)},update:function(e){this.curr=e;this.$id("@progress_bar").animate({width:this.getWidth()})}});exports.ProgressBarBeacon=t.extend({onLoad:function(){this.emitEvent({type:i.Types.ACTIVATION_PROGRESS_BAR_STEP,payload:{step:this.curr}})}})});define("app/view/share/connect",["shared/polyfills","webnode2","interface/jquery","shared/siteuri"],function Pe(require,exports,e){var t=require("webnode2").Component,$=require("interface/jquery")._jQuery,i=require("shared/siteuri").URI;var n=exports.socialConnectorBase={connectLinkedin:function(e){var t=this;$(document).one("linkedin_oauth_approved."+t.cid,function(i,n){t.serverCall("connect_linkedin").kwargs({li_uid:n}).liveMutate().send();if(e){e()}});var n=i("/linkedin_/oauth_window");
window.open(n.unicode(),"_BLANK","height=365,width=600")},connectTwitter:function(e){var t=this;$(document).one("twitter_oauth_approved."+t.cid,function(i,n){var s=n.accessToken,o=n.userData;t.serverCall("connect_twitter").kwargs({access_token_key:s.key,screen_name:o.twitter_screen_name,tw_uid:o.twitter_uid,"protected":o["protected"]}).liveMutate().send();if(e){e()}});var n=i("/twitter/oauth_window");window.open(n.unicode(),"_BLANK","height=558,width=800")},connectTumblr:function(e){var t=this;$(document).one("tumblr_oauth_approved."+t.cid,function(i,n){t.serverCall("connect_tumblr").kwargs({url:n}).liveMutate().success(function(i){if(i!="OK"){alert(t.tumlbr_failure_message)}else if(e){e()}}).send()});window.open("/tumblr_/oauth_window","_BLANK","height=500,width=600")}};exports.SocialConnector=t.extend(n)});define("app/view/activation/twitter",["shared/polyfills","app/view/share/connect","interface/jquery","webnode2"],function Be(require,exports,e){var t=require("app/view/share/connect").SocialConnector,$=require("interface/jquery")._jQuery,i=require("webnode2").Component;
exports.TwitterConnect=i.extend({onLoad:function(){var e=this;this.$id("@twitter_disconnect_button").click(function(){e.serverCall("twitter_disconnect").liveMutate().send();return false});this.$id("@dismiss").click(function(){e.serverCall("dismiss_twitter_connect").liveMutate().success(function(){e.$id("@twitter_connect").fadeOut(300)}).send();return false});this.$id("@modal_link").click(function(){e.modal("load_inner");return false})}});var n={};exports.onTwitterConnect=function(){$(n).trigger("connect")};exports.TwitterConnectButton=t.extend({onLoad:function(){var e=this;this.$id("@twitter_connect_button").click(function(){e.serverCall("on_connect_button_press").send();e.connectTwitter()});$(n).bind("connect",this.connectTwitter.bind(this))}})});define("view/inline_editor",["shared/polyfills","webnode2","interface/jquery","w2.modal","shared/core/component","shared/events/index","shared/cookies","shared/debounce","settings","view/modal","shared/beforeunload","gating","w2.rpc","shared/action_log"],function Fe(require,exports,e){
var t=require("webnode2").Component,$=require("interface/jquery")._jQuery,i=require("webnode2"),n=require("w2.modal"),s=require("shared/core/component"),o=require("shared/events/index"),r=require("shared/cookies"),a=require("shared/debounce").debounce,d=require("settings"),l=require("view/modal").Base,c=require("shared/beforeunload"),u=require("gating"),h=require("w2.rpc").rpcToURL,f=d.interface_strings,p=require("shared/action_log").logSecondaryAction;exports.InlineEditor=t.extend({onLoad:function(){var e=this;e.editor=e.child("editor");e.input_obj=e.$id("@"+e.input);e.input_button="inline_editor_submit";e.input_button_obj=e.$id("@"+e.input_button);e.editorShown=e.show_editor;e.should_toggle_on_submit=true;if(e.draft_space){e.draft_button="inline_editor_save_draft";e.draft_button_obj=e.$id("@"+e.draft_button)}e.toggle_callback=null;e.locked=false;e.$id("@inline_editor_link").click(function(){e.onEditLinkClick();return false});e.$id("@inline_editor_cancel").click(function(){if(e.content_type){
e.emitEvent(o.helpers.inlineEditorCancel(e.content_type,e.id))}else{e.cancelEditor()}return false});e.registerEditorCallbacks();e.$id("@inline_editor_create_link").click(function(){if(e.content_type){e.emitEvent(o.helpers.inlineEditorEdit(e.content_type,e.id))}else{e.toggle_editor()}return false});e.submitHandler();e.initDraftHandlers();if(e.focus_onload){e.focusInput()}if(e.typing_area){e.editor.setTypingStateCallback(function(t){e.serverCall("typing").kwargs({area:e.typing_area,state:t}).send();e.input_button_obj.text(e.submit_text)})}if(e.input_obj.is("[maxlength]")){e.input_obj.on("keyup",function(){var e=$(this).attr("maxlength");var t=$(this).val();if(t.length>e){$(this).val(t.slice(0,e))}})}if(e.content_type){e.whenOnLoaded(function(){e.emitEvent(o.helpers.inlineEditorLoad(e.content_type,e.id))})}},registerEditorCallbacks:function(){var e=this;this.handleEvent(o.Types.INLINE_EDITOR_STATE,function(t){if(t.payload.contentType!=e.content_type){return}if(t.payload.oid!=e.id){return}if(t.payload.state=="cancel"){
e.cancelEditor()}else if(t.payload.state=="edit"){e.onEditLinkClick()}else if(t.payload.state=="diclaimer"){e.updateDisclaimer()}})},onEditLinkClick:function(){if(!this.editorShown){this.toggle_editor()}},updateDisclaimer:function(){var e=this.child("metadata");var t=e&&e.child("disclaimer");if(this.disclaimer_update===""||this.disclaimer_update==="remove"){this.disclaimer_update="attach";t.$id("@item").removeClass("hidden")}else{this.disclaimer_update="remove";t.$id("@item").addClass("hidden")}},initDraftHandlers:function(){if(this.draft_space){this.initEditorFocusCallback();this.initDraftButtonClickCallback();this.initMeaningfulChangeCallback();if(u.qtext2_unsaved_nav){this.initBeforeUnloadCallback();this._latestSavedState=null}}},initBeforeUnloadCallback:function(){c.registerHandler(this.beforeUnload.bind(this))},beforeUnload:function(){if(this.hasUnsavedContent()){return this.unsaved_content_msg}},initSavedState:function(){if(!this._latestSavedState){this._latestSavedState=this.get_value();
}},updateSavedState:function(e){this._latestSavedState=e},hasUnsavedContent:function(){if(this.cid in s._unloaded){return false}if(!this._latestSavedState){return false}if(this.editor.isOnlyWhiteSpace()&&this._latestSavedState.sections.length===0){return false}return this.editor.hasChanged(this._latestSavedState)},initEditorFocusCallback:function(){var e=this;this.editor.setFocusCallback(function(){e.initSavedState();e.$id("@inline_editor_save_draft").removeClass("hidden")})},initDraftButtonClickCallback:function(){var e=this;this.draft_button_obj.click(function(t){t.preventDefault();e.save_draft(true)})},initMeaningfulChangeCallback:function(){var e=a(this.save_draft.bind(this,false),750,{maxWait:1e4,leading:true});this.editor.setMeaningfulChangeCallback(e)},cancelEditor:function(){if(this.typing_area){this.editor.stopTyping()}if(this.editorShown){this.toggle_editor()}},isEditorEmpty:function(){var e=this.getEditor();if(e){return e.isOnlyWhiteSpace()}return false},getEditor:function(){
return this.editor},submitHandler:function(){var e=this;this.input_button_obj.click(function(){e.trigger_request();return false})},get_value:function(){if(this.is_qtext){return this.editor.serialize()}else{return this.input_obj.val()}},save_draft:function(e){var t=this,n=this.getSaveDraftMethod(e),s=this.getSaveDraftKwargs(),o=this.serverCall(n).kwargs(s);if(e){o.liveMutate();if(i.interactionMode.isBlocking()){i.fallbackToPostReloadMode()}}this.logSaveDraft();o.success(function(){t.updateSavedState(s.content)});o.send()},logSaveDraft:function(){return},getSaveDraftMethod:function(e){return e?"save_draft":"save_draft_auto"},getSaveDraftKwargs:function(){return{content:this.get_value(),window_id:i.windowId,draft_space:this.draft_space}},server_call_method:"edit",_get_kwargs:function(){return{id:this.id,input:this.get_value()}},trigger_request:function(){if(this.typing_area){this.editor.stopTyping()}if(this.locked){return false}this.locked=true;if(!this.require_comment){if(this.okToSubmitRequest()){
this.invokeEditServerCall(this._get_kwargs())}else{this.editor.focus();this.locked=false}}else{this.showConfirmationDialog()}},trigger_cancel:function(){this.$id("@inline_editor_cancel").click()},okToSubmitRequest:function(){return!this.require_value||this.require_value&&!this.editor.isOnlyWhiteSpace()},invokeEditServerCall:function(e){var t=this;var i=function(){t.locked=false};$(document).bind("login_cancelled",i);if(this.content_type){this.emitEvent(o.helpers.inlineEditorSubmit(this.content_type,this.id))}r.setTlog(t.tlog_data());var n=t.getLoggedAction();if(n){p(n,null)}t.input_button_obj.addClass("disabled");var s=function(){t.locked=false;t.input_button_obj.removeClass("disabled");$(document).unbind("login_cancelled",i)};var a=t.serverCall(t.server_call_method).kwargs(e).success(function(i){t.updateSavedState(e.input);t.ajax_callback(i);s()}).error(s).except(s).liveMutate();a.send()},tlog_data:function(){return null},getLoggedAction:function(){return null},ajax_callback:function(e){
if(this.content_type){this.emitEvent(o.helpers.inlineEditorSubmitted(this.content_type,this.id))}if(this.should_toggle_on_submit){this.toggle_editor()}},focusInput:function(){var e=this;if(e.is_qtext){e.editor.focus()}else{e.input_obj.focus()}},setToggleCallback:function(e){if(!this.toggle_callback){this.toggle_callback=e}else{var t=this.toggle_callback;this.toggle_callback=function(){t();e()}}},toggle_editor:function(){this.editorShown=!this.editorShown;this.$id("@inline_editor_content").find(".qtext_embed").each(function(e,t){$(t).addClass("thumbnail").empty()});this.$id("@inline_editor_content").toggleClass("hidden");this.$id("@inline_editor_form").toggleClass("hidden");if(this.is_qtext&&this.$id("@inline_editor_form").is(":visible")){var e=this.child("editor");if(e){e.focus()}}if(this.toggle_callback){this.toggle_callback()}},showConfirmationDialog:function(){var e=this;var t=this.input_button_obj.text();this._dialog=this.dialog().title(this.confirm_text).cancel(function(){e.locked=false;
},f.cancel).ok(function(){var t=arguments[0].dialogComponent;var i=t.child("editor");if(!i.isOnlyWhiteSpace()){var n=e._get_kwargs();n.comment=i.serialize();e.invokeEditServerCall(n);e._dialog.close_()}else{return false}},t).load("comment_dialog")}});exports.InlineEditCommentDialog=t.extend({onLoad:function(){this.child("editor").focus()}});exports.DraftStatus=t.extend({onLoad:function(){var e=this;e.$id("@draft_status_clear").click(function(){e.modal("load_clear_draft_confirmation").onSubmitCallBack(e.clearDraftCallback.bind(e));return false})},clearDraftCallback:function(){}});exports.ClearDraftConfirmationModal=l.extend({onSubmit:function(){var e=this;h("/ajax/ajax_clear_draft_POST").kwargs({draft_space:e.draft_space}).liveMutate().success(function(){n.Modal.modalFor(e).executeOnSubmitCallBack();e._closeModal()}).send()}});exports.BoardDraftStatus=exports.DraftStatus.extend({clearDraftCallback:function(){window.location.reload()}})});define("view/dialog",["shared/polyfills","webnode2","interface/jquery","tooltip","w2.dialog"],function Ue(require,exports,e){
var t=require("webnode2").Component,$=require("interface/jquery")._jQuery,i=require("tooltip"),n=require("w2.dialog").Dialog;exports.Dialog=t.extend({onLoad:function(){var e=this;this.successCallback=null;this.ok2Submit=true;this.submitted=false;this.$id("@submit").click(function(t){e.submit();t.preventDefault()});this.$id("@cancel").click(function(t){e.close();t.preventDefault()})},submit:function(){this.request()},request:function(){var e=this.getPars();if(this.submitted||!e||!this.ok2Submit){return}this.submitted=true;this.submitServerCall(e)},getPars:function(){return{}},setSetup:function(e){var t=this;e.each(function(e,i){t.options[e]=i})},setSuccessCallback:function(e){this.successCallback=e},close:function(){if($("#generic_dialog").length){$("#generic_dialog").remove()}else{n.dialogFor(this).close_()}},submitServerCall:function(e){var t=this;this.serverCall("dialog_submit_controller").liveMutate().kwargs(e).success(function(e){if(t.successCallback){t.successCallback(e)}t.close()}).send();
}});exports.AddCommentDialog=exports.Dialog.extend({onLoad:function(){this._super.apply(this,arguments);this.editor=this.child("editor");this.editor.focus()},getPars:function(){if(this.comment_required&&this.editor.isOnlyWhiteSpace()){return false}return{comment:this.editor.serialize()}}});exports.DialogLink=t.extend({onLoad:function(){var e=this;if(this.tooltip){i.attach(this.$id("@link"),this.tooltip)}this.$id("@link").click(function(t){e.click();t.preventDefault()})},containsNonLatinCodepoints:function(e){return/[^\u0000-\u00ff]/.test(e)},addOption:function(e,t){if(t&&this.containsNonLatinCodepoints(JSON.stringify(t))){t=window.unescape(encodeURIComponent(t))}this.options[e]=t},click:function(){this.dialog().load("get_dialog",{kwargs:{ty:this.type,object_id:this.object_id,options:this.options}})},triggerClick:function(e){$.each(e,this.addOption.bind(this));this.click()}})});define("shared/keystrokes",["shared/polyfills"],function je(require,exports,e){var t=[];document.addEventListener("keydown",function(e){
if(e.target&&!e.target.getAttribute("contenteditable")&&e.target.nodeName!=="INPUT"){i(e.keyCode||e.charCode,e)}});function i(e,i){for(var n=0,s=t.length;n<s;++n){t[n].trigger(e,i)}}var n=function(e,t){this.codes=e;this.matchHandler=t;this.position=0};n.prototype.trigger=function(e,t){if(e===this.codes[this.position]){this.position+=1}else{this.position=0}if(this.position===this.codes.length){this.matchHandler(t);this.position=0}};exports.on=function(e,i){if(typeof e==="number"){e=[e]}else{e=e.slice(0)}t.push(new n(e,i))}});define("app/view/admin",["shared/polyfills","webnode2","interface/jquery","tooltip","view/inline_editor","view/modal","view/dialog","shared/window_manager","shared/keystrokes","settings"],function He(require,exports,e){var t=require("webnode2").Component,$=require("interface/jquery")._jQuery,i=require("tooltip"),n=require("view/inline_editor").InlineEditor,s=require("view/modal").Base,o=require("view/dialog"),r=require("shared/window_manager"),a=require("shared/keystrokes"),d=require("settings").interface_strings;
exports.AdminLogItemView=t.extend({onLoad:function(){var e=this;this.$id("@view").click(function(t){e.$id("@details").toggleClass("hidden");t.preventDefault()});this.$id("@item").hover(function(){e.$id("@item").addClass("hover");e.$id("@buttons").removeClass("hidden")},function(){e.$id("@item").removeClass("hover");e.$id("@buttons").addClass("hidden")});i.attach(this.$id("@remove"),this.hide_title);this.$id("@remove").click(function(t){e.dialog().title(e.hide_title).cancel(null,d.cancel).ok(function(){e.serverCall("hide_log_item").send()},e.hide_title).html(e.hide_message);t.preventDefault()})}});exports.AdminMode=t.extend({toggle:function(){this.serverCall("toggle").liveMutate().send()},onLoad:function(){var e=this;function t(t){e.toggle();t.preventDefault()}e.$id("@toggle").click(t);if(e.listen){a.on([81,49,81,49],t)}}});exports.AdminModeListener=t.extend({toggle:function(){this.serverCall("toggle").liveMutate().send()},onLoad:function(e){var t=this;function i(){t.toggle();e.preventDefault();
}a.on([81,49,81,49],i)}});exports.NicknameInlineEditor=n.extend({onLoad:function(){this._super.apply(this,arguments);if(r.getHash().substr(0,9)=="#editname"){this.toggle_editor()}}});exports.RemoveInboxMessagesLink=t.extend({onLoad:function(){var e=this;this.$id("@delete").click(function(t){e.dialog().title(e.delete_messages_title).cancel(null,d.cancel).ok(function(){e.serverCall("delete_messages").liveMutate().send()},e.delete_messages_title).html(e.delete_messages_message);t.preventDefault()})}});exports.AdminRemoveUserPhoto=t.extend({onLoad:function(e){var t=this;this.$id("@remove_photo_link").click(function(e){t.dialog().title(t.remove_profile_photo).cancel().ok(function(e){var i=e.dialogComponent.child("editor").serialize();t.serverCall("remove_photo").kwargs({comment:i}).liveMutate().send()},t.remove_photo).load("remove_photo_dialog");$("#admin_remove_profile_photo_comment").focus();e.preventDefault()})}});exports.FlagNameLink=t.extend({onLoad:function(){var e=this;this.$id("@show_flag_name_modal").click(function(t){
e.modal("flag_modal");t.preventDefault()})}});exports.ResolveNameLink=t.extend({onLoad:function(){var e=this;this.$id("@show_resolve_name_modal").click(function(t){e.modal("verify_modal");t.preventDefault()})}});exports.ResolveNameModal=s.extend({onSubmit:function(){var e=this;this.serverCall("resolve_name").liveMutate().success(function(){e._closeModal()}).send()}});exports.FlagNameModal=s.extend({onSubmit:function(){var e=this;this.serverCall("flag_name").liveMutate().success(function(){e._closeModal()}).send()}});exports.BanRemoveLink=t.extend({onLoad:function(){var e=this;e.$id("@ban_remove_link").click(function(t){e.modal("ban_remove_modal");t.preventDefault()})}});exports.BanRemoveModal=s.extend({onLoad:function(){this._super.apply(this,arguments);this.child("editor").focus()},onSubmit:function(){var e=this;var t=e.child("editor");if(t.isOnlyWhiteSpace()){e.$id("@required_comment_warning").removeClass("hidden");t.focus();return}else{var i=t.serialize();var n=this.$id("@revert_edits").is(":checked");
var s=this.$id("@mark_as_verified_spammer").is(":checked");var o=this.$id("@remove_votes").is(":checked");var r=function(t){return e.$id("@"+t).prop("checked")};e.serverCall("ban_remove_all_users").kwargs({comment:i,revert_edits:n,mark_as_verified_spammer:s,remove_votes:o,uids_to_ban_remove:e.uids_to_ban_remove.filter(r)}).liveMutate().success(function(){e._closeModal()}).send();return false}}});exports.SendMessageLinkBase=t.extend({onLoad:function(){var e=this;this.$id("@modal_link").on("click",function(t){e.modal("load_inner");t.preventDefault()})}});exports.SendMessageModalBase=s.extend({onSubmit:function(){var e=this;var t=e.child("editor").serialize();e.serverCall("submit").kwargs({msg:t}).liveMutate().success(function(){e._closeModal()}).send()}});exports.BanUserDialog=o.AddCommentDialog.extend({getPars:function(){var e=this._super.apply(this,arguments);if(e){e.removeMessages=this.$id("@checkbox").prop("checked")}return e}});exports.AdminMessageDialog=o.Dialog.extend({onLoad:function(){
this._super.apply(this,arguments);this.editor=this.child("editor");this.editor.focus()},getPars:function(){if(this.editor.isOnlyWhiteSpace()){return false}return{msg:this.editor.serialize()}}})});define("unified_view/modal",["shared/polyfills","shared/core/component","interface/modal","interface/settings","shared/util","shared/client","w2.modal"],function Qe(require,exports,e){var t=require("shared/core/component").Component,i=require("interface/modal"),n=require("interface/settings").pageIsMobile,s=require("shared/util"),o=require("shared/client"),r,a,d;if(n){a=require("mobile_app2/client");d=require("mobile_app2/messages")}else{r=require("w2.modal")}exports.ModalBase=t.extend({onLoad:function(){var e=this;this.$id("@close").on("click",function(t){t.preventDefault();e.onClose()});this.$id("@cancel").on("click",function(t){t.preventDefault();e.onClose()});this.$id("@submit").on("click",function(t){t.preventDefault();e.onSubmit()});if(n){this.onLoadMobile()}else{this.onLoadWeb()}},onLoadWeb:function(){
var e=r.Modal.modalFor(this);this._originalClose=e.close.bind(e);var t=this;e.close=s.once(function(){if(!e._isOpen){return}t.onClose()})},onLoadMobile:function(){this._initMobileDoneButton(false);this._initMobileCancelButton()},_initMobileDoneButton:function(e){if(!this.mobile_done_button){return}if(o.isNativeApp()){this.nativeSetPageAction(e)}else{this.$nav=this.$id("@nav");this.$nav.text(this.done_text);this.$nav.addClass("is_done");this.$nav.removeClass("hidden");this.$nav.on("click",this._mobileOnSubmit.bind(this))}this.setMobileDoneButtonDisabled(e)},_initMobileCancelButton:function(){if(!o.isNativeApp()){return}a.registerOneTimeMessageHandler("closeNavigationButtonPressed",this.onClose.bind(this))},_mobileOnSubmit:function(){if(this._mobileDisabled){return}this.onSubmit()},setMobileDoneButtonDisabled:function(e){this._mobileDisabled=e;if(o.isNativeApp()){this.nativeSetPageAction(e)}else{this.$nav.toggleClass("is_disabled",e)}},nativeSetPageAction:function(e){if(!o.isNativeApp()){
return}if(!d){return}d.send("setPageAction",{rightTextButton:{title:this.done_text,disabled:e,callback:this._mobileOnSubmit.bind(this)}})},close:function(){if(this._originalClose){this._originalClose()}i.handleClose(this)},onClose:function(){this.close()},submit:function(e){i.handleSubmit(this,e)},onSubmit:function(e){this.submit(e);this.close()}});exports.FormModal=exports.ModalBase.extend({onLoad:function(){var e=this;e._super.apply(e,arguments);e.child("form").registerOnSubmitSuccess(function(){e.submit();e.close()})},onSubmit:function(){this.child("form").submitForm()}})});define("simscroll",["shared/polyfills"],function We(require,exports,e){var t,i=50,n=document.documentElement;function s(e,t,i,n,s){return[e,!!t,!!i,!!n,!!s].join(" ")}var o=s(38),r=s(40),a=s(33),d=s(32,true),l=s(32),c=s(34);function u(e){var u=e.keyCode||e.charCode,h=Math.round(n.clientHeight-100);switch(s(u,e.shiftKey,e.ctrlKey,e.altKey,e.metaKey)){case o:window.scrollBy(0,-i);break;case r:window.scrollBy(0,i);break;
case a:case d:window.scrollBy(0,-h);break;case l:case c:window.scrollBy(0,h);break;default:return false}t=true;return true}if(document.addEventListener){document.addEventListener("keypress",function(e){var i=e.originalTarget||e.target;if(!t&&(i===n||i===document.body)&&u(e)){e.preventDefault();e.stopPropagation()}t=false},false)}exports.maybeSimulateScroll=u;exports.cancelSimulatedScroll=function(){t=true}});define("third_party/autosize",["shared/polyfills"],function Ve(require,exports,e){(function(t,i){if(typeof define==="function"&&define.amd){define(["exports","module"],i)}else if(typeof exports!=="undefined"&&typeof e!=="undefined"){i(exports,e)}else{var n={exports:{}};i(n.exports,n);t.autosize=n.exports}})(this,function(exports,e){"use strict";var t=typeof Set==="function"?new Set:function(){var e=[];return{has:function t(i){return Boolean(e.indexOf(i)>-1)},add:function i(t){e.push(t)},"delete":function n(t){e.splice(e.indexOf(t),1)}}}();function i(e){var i=arguments[1]===undefined?{}:arguments[1];
var n=i.setOverflowX;var s=n===undefined?true:n;var o=i.setOverflowY;var r=o===undefined?true:o;if(!e||!e.nodeName||e.nodeName!=="TEXTAREA"||t.has(e))return;var a=null;var d=null;var l=e.clientWidth;function c(){var t=window.getComputedStyle(e,null);d=t.overflowY;if(t.resize==="vertical"){e.style.resize="none"}else if(t.resize==="both"){e.style.resize="horizontal"}if(t.boxSizing==="content-box"){a=-(parseFloat(t.paddingTop)+parseFloat(t.paddingBottom))}else{a=parseFloat(t.borderTopWidth)+parseFloat(t.borderBottomWidth)}if(isNaN(a)){a=0}f()}function u(t){{var i=e.style.width;e.style.width="0px";e.offsetWidth;e.style.width=i}d=t;if(r){e.style.overflowY=t}h()}function h(){var t=window.pageYOffset;var i=document.body.scrollTop;var n=e.style.height;e.style.height="auto";var s=e.scrollHeight+a;if(e.scrollHeight===0){e.style.height=n;return}e.style.height=s+"px";l=e.clientWidth;document.documentElement.scrollTop=t;document.body.scrollTop=i}function f(){var t=e.style.height;h();var i=window.getComputedStyle(e,null);
if(i.height!==e.style.height){}else{if(d!=="hidden"){u("hidden")}}if(t!==e.style.height){var n=document.createEvent("Event");n.initEvent("autosize:resized",true,false);e.dispatchEvent(n)}}var p=function m(){if(e.clientWidth!==l){f()}};var g=function(i){window.removeEventListener("resize",p);e.removeEventListener("input",f);e.removeEventListener("keyup",f);e.removeEventListener("autosize:destroy",g);t["delete"](e);Object.keys(i).forEach(function(t){e.style[t]=i[t]})}.bind(e,{height:e.style.height,resize:e.style.resize,overflowY:e.style.overflowY,overflowX:e.style.overflowX,wordWrap:e.style.wordWrap});e.addEventListener("autosize:destroy",g);if("onpropertychange"in e&&"oninput"in e){e.addEventListener("keyup",f)}window.addEventListener("resize",p);e.addEventListener("input",f);e.addEventListener("autosize:update",f);t.add(e);if(s){e.style.overflowX="hidden";e.style.wordWrap="break-word"}c()}function n(e){if(!(e&&e.nodeName&&e.nodeName==="TEXTAREA"))return;var t=document.createEvent("Event");
t.initEvent("autosize:destroy",true,false);e.dispatchEvent(t)}function s(e){if(!(e&&e.nodeName&&e.nodeName==="TEXTAREA"))return;var t=document.createEvent("Event");t.initEvent("autosize:update",true,false);e.dispatchEvent(t)}var o=null;if(typeof window==="undefined"||typeof window.getComputedStyle!=="function"){o=function(e){return e};o.destroy=function(e){return e};o.update=function(e){return e}}else{o=function(e,t){if(e){Array.prototype.forEach.call(e.length?e:[e],function(e){return i(e,t)})}return e};o.destroy=function(e){if(e){Array.prototype.forEach.call(e.length?e:[e],n)}return e};o.update=function(e){if(e){Array.prototype.forEach.call(e.length?e:[e],s)}return e}}e.exports=o})});define("view/selector",["shared/polyfills","webnode2","interface/jquery","simscroll","shared/window_manager","third_party/autosize","shared/logging","shared/core/component"],function ze(require,exports,e){var t=require("webnode2").Component,$=require("interface/jquery")._jQuery,i=require("simscroll"),n=require("shared/window_manager"),s=require("third_party/autosize"),o=require("shared/logging"),r=require("shared/core/component");
exports.Selector=t.extend({onLoad:function(){var e=this;e._busy=false;e._resultsLastUpdated=Date.now();e.$input=e.$id("@input");e.$results_container=e.$id("@results_container");e.$results=e.$id("@results");e.$empty_input_prompt=e.$id("@empty_input_prompt");e.$spinner=e.$id("@spinner");e.$wrapper=e.$id("@wrapper");e.shouldSimScroll=false;e.query=e.$input.val();e.has_updated_result=false;if(e.is_textarea){s(e.$input)}function t(t){if(t.type==="keydown"){var i=e.child("results");if(i){var n=i.getSelectedResult();if(n===null&&e.allow_no_selection){e.submit()}else if(n){e.onResultSelected(n,false,i.$selectedItemElem)}}else{e.submit()}}}function n(n){if(e.shouldSimScroll&&n.type=="keydown"){if(!e.query&&i.maybeSimulateScroll(n)){return false}if(!e.query&&n.which==39){e.$input.blur();return}}switch(n.which){case 13:n.preventDefault();t(n);break;case 27:e.selectorFocusOutHandler();break;case 38:e.handleUpDownArrowKey(n,-1);break;case 40:e.handleUpDownArrowKey(n,1);break;default:var s=e.$input.val();
if(s!==e.query){e._setQuery(s)}}}e.$input.change(n).keydown(n).keyup(n).focus(e.inputFocusHandler.bind(e)).blur(e.inputBlurHandler.bind(e));e.$wrapper.focusout(function(){e.wrapperFocusoutHandler()});if(!e.show_results_for_empty_query){e.$wrapper.focusin(function(){e.wrapperFocusinHandler()})}},handleUpDownArrowKey:function(e,t){e.preventDefault();if(e.type==="keydown"){var i=this.child("results");if(i){i.moveSelection(t)}}},inputFocusHandler:function(){if(!this.has_updated_result){this.has_updated_result=true;this.updateResults()}this.showResults(true);if(this.length_limit){this.child("counter").show()}},inputBlurHandler:function(){if(this.length_limit){this.child("counter").hide()}},selectorFocusOutHandler:function(){this.showResults(false);this.$input.blur()},wrapperFocusoutHandler:function(){this.showResults(false)},wrapperFocusinHandler:function(){this.focus()},setQuery:function(e){var t=this.$input[0].selectionStart,i=this.$input[0].selectionEnd;this.$input.val(e);this.$input[0].setSelectionRange(t,i);
this._setQuery(e)},queryDidChange:function(){},resultsDidChange:function(){},onResultSelected:function(e,t,i){if(this.beforeSelectResultCallback){this.beforeSelectResultCallback(e,t,i)}this.resultWasSelected(e,t,i);if(this.afterResultWasSelectedCallback){this.afterResultWasSelectedCallback(e,t,i)}},resultWasSelected:function(e,t,i){},submit:function(){},shouldShowEmptyInputPrompt:function(){return!this.show_results_for_empty_query&&(!this.query||this.query.trim().length===0)},adjustResultContainerContent:function(){if(this.shouldShowEmptyInputPrompt()){this.$results.addClass("hidden");this.$empty_input_prompt.removeClass("hidden")}else{this.$results.removeClass("hidden");this.$empty_input_prompt.addClass("hidden")}this.preventOverflow()},showResults:function(e){if(e){this.$results_container.removeClass("hidden");this.adjustResultContainerContent()}else{this.$results_container.addClass("hidden")}},preventOverflow:function(){this.$results_container.removeClass("inverted");this.$results_container.css({
"overflow-y":"auto",height:"auto"});var e=this.$results_container.offset().top;var t=this.$results_container.outerHeight(true);var i=e+t;var s=$(window).scrollTop()+n.headerOffset;var o=$(window).scrollTop()+$(window).height();var r=o-e;var a=e-s;var d;if(a>500&&r<200){this.$results_container.addClass("inverted");d=s-this.$results_container.offset().top}else{d=i-o}if(d>0){this.$results_container.css({"overflow-y":"scroll",height:t-d})}},getExtraKwargs:function(){return{}},updateResults:function(){var e=this;if(e.isBusy()||e.shouldShowEmptyInputPrompt()){e.adjustResultContainerContent();return}var t=Date.now();var i={query:e.query,parent_cid:e.cid,parent_domid:r.getLiveParent(e.cid)};var n=e.$results.get(0);var s=r.getLiveChildren(e.cid);var o=s.filter(function(e){return n.contains(document.getElementById(e))});i["domids_to_remove"]=JSON.stringify(o);var a=e.getExtraKwargs();for(var d in a){if(a.hasOwnProperty(d)){i[d]=a[d]}}e.setBusy(true);e.serverCall("results_content_for").kwargs(i).success(function(i){
e.maybeUpdateResults(i,t);e.resultsServerCallHandler.call(e)}).except(e.resultsServerCallHandler.bind(e)).error(e.resultsServerCallHandler.bind(e)).send()},maybeUpdateResults:function(e,t){if(t>this._resultsLastUpdated){this._resultsLastUpdated=t;var i=this.$results.get(0);$(i).forgetContents();$(i).setContent(e)}},resultsServerCallHandler:function(){this.setBusy(false);if(this.$input.is(":focus")&&this.$input.val()!==""){this.showResults(true)}if(this.child("results").query!==this.$input.val()){this.updateResults()}},isBusy:function(){return this._busy},setBusy:function(e){var t=this;t._busy=e;t._lastBusyUpdate=Date.now();function i(){return!t._busy&&t._spinner}if(t._busy&&!t._spinner){t.$spinner.removeClass("hidden");t._spinner=true;var n=t._lastBusyUpdate;setTimeout(function(){if(t._busy&&t._lastBusyUpdate===n){t.resultsServerCallHandler.call(t)}},5e3)}else if(i()){setTimeout(function(){if(i()){t.$spinner.addClass("hidden");t._spinner=null}},100)}},focus:function(){this.$id("@input").focus();
},blur:function(){this.$id("@input").blur()},_setQuery:function(e){this.query=e;if(this.length_limit){this.child("counter").updateCounter(e.length)}this.queryDidChange();this.updateResults()}});exports.MultiSelector=exports.Selector.extend({onLoad:function(){this._super.apply(this,arguments);this.saved_results=this.saved_results||[]},getExtraKwargs:function(){return{saved_results:this.saved_results}},resultWasSelected:function(e,t,i){this.saved_results.push(e);this.showResults(false);this.setQuery("");this.updateDisplayedResults();this.onSavedResultsChanged()},onSavedResultsChanged:function(){},remove:function(e){this.saved_results.splice(e,1);this.updateDisplayedResults();this.onSavedResultsChanged()},updateDisplayedResults:function(){var e=this;e.serverCall("saved_results_content_for").contentFor(e.$id("@saved_results"),{parentCid:e.cid,useLoadingSpinner:false}).args(e.saved_results).send()}});exports.MultiSelectorSavedResultList=t.extend({onLoad:function(){for(var e=0;e<this.num_results;e++){
this.attachRemoveClickHandler(e)}},attachRemoveClickHandler:function(e){var t=this;t.$id("@remove"+e).click(function(){t.parent().remove(e);return false})}});exports.NavigateToResultUrlSelectorMixin={resultWasSelected:function(e,t){this._super.apply(this,arguments);if(e.data&&e.data.url){if(t){window.open(e.data.url)}else{n.navigateTo(e.data.url)}}}};exports.SelectorWithTypeaheadLogMixin={shouldTypeaheadLog:function(e){return true},resultWasSelected:function(e,t){var i=this.child("results");if(this.shouldTypeaheadLog(e)){var n={data:i.typeahead_log_data,click_index:i.selectedIndex};if(parseInt(n.click_index)===n.click_index&&n.click_index>=0&&typeof n.data!=="undefined"){o.log("typeahead",{message:n})}}this._super.apply(this,arguments)}};exports.SelectorResults=t.extend({onLoad:function(){var e=this;if(!e.allow_no_selection){e.setSelection(0)}else{e.setSelection(-1)}e.$(".@result").hover(function(t){var i=e.getIndexFromResultElementID(this.id);e.setSelection(i)}).mousedown(function(e){e.preventDefault();
}).click(function(t){var i=e.getIndexFromResultElementID(this.id);e.setSelection(i);var n=e.getSelectedResult();var s=t.metaKey||t.ctrlKey;e.parent().onResultSelected(n,s,e.$selectedItemElem)});if(e.allow_no_selection){e.$id("@wrapper").mouseleave(function(t){e.setSelection(-1)})}if(e.parent().resultsDidChange!=undefined){e.parent().resultsDidChange()}},getSelectedResult:function(){if(this.selectedIndex===-1){return null}if(!this.numResults&&this.allow_no_selection){return null}return this.results[this.selectedIndex]},setSelection:function(e){if(!this.numResults){return}if(!isNaN(parseInt(e))){if(this.selectedIndex!==-1&&!isNaN(parseInt(this.selectedIndex))){this.$id("@result_"+this.selectedIndex).removeClass("selector_highlighted")}if(this.allow_no_selection&&e<-1||!this.allow_no_selection&&e<0){e=this.numResults-1}if(e>this.numResults-1){e=this.allow_no_selection?-1:0}if(e===-1){this.selectedIndex=e;this.$selectedItemElem=null}else{var t=this.$id("@result_"+e);if(t){this.$selectedItemElem=t;
this.$selectedItemElem.addClass("selector_highlighted");this.selectedIndex=e}}}},moveSelection:function(e){var t=this.selectedIndex+e;this.setSelection(t)},getIndexFromResultElementID:function(e){var t=e.split("_");return parseInt(t[t.length-1])}});exports.WithServerCallMessageMixin=exports.Selector.extend({onLoad:function(){var e=this;e._super.apply(e,arguments);e.$serverMessage=e.$id("@server_message");e.pendingServerCallRequest=null;e.serverCallBusy=false},queryDidChange:function(){this._super.apply(this,arguments);this.showServerMessage(false)},makeServerCall:function(e){this.pendingServerCallRequest=e;if(!this.isBusy()){this.doServerCall()}},hasPendingServerCall:function(){return this.pendingServerCallRequest!==null||this.serverCallBusy},resultsServerCallHandler:function(){var e=this;if(e.pendingServerCallRequest!==null){e.doServerCall()}else{e._super.apply(e,arguments);e.showServerMessage(false)}},doServerCall:function(){var e=this;e.setBusy(true);e.serverCallBusy=true;e.showServerMessage(false);
var t=function(t,i){if(e.updateServerMessage(t,i)){e.showServerMessage(true)}e.serverCallBusy=false;e.setBusy(false)};e.pendingServerCallRequest.success(function(e){t(true,e)}).except(function(e){t(false,e)}).error(function(){t(false)}).send();e.pendingServerCallRequest=null},updateServerMessage:function(e,t){return false},showServerMessage:function(e){if(e){this.$serverMessage.removeClass("hidden")}else{this.$serverMessage.addClass("hidden")}}})});define("third_party/blockadblock",["shared/polyfills"],function Ge(require,exports,e){(function(e){var t=function(t){this._options={checkOnLoad:false,resetOnEnd:false,loopCheckTime:50,loopMaxNumber:5,baitClass:"pub_300x250 pub_300x250m pub_728x90 text-ad textAd text_ad text_ads text-ads text-ad-links",baitStyle:"width: 1px !important; height: 1px !important; position: absolute !important; left: -10000px !important; top: -1000px !important;",debug:false};this._var={version:"3.2.1",bait:null,checking:false,loop:null,loopNumber:0,event:{detected:[],
notDetected:[]}};if(t!==undefined){this.setOption(t)}var i=this;var n=function(){setTimeout(function(){if(i._options.checkOnLoad===true){if(i._options.debug===true){i._log("onload->eventCallback","A check loading is launched")}if(i._var.bait===null){i._creatBait()}setTimeout(function(){i.check()},1)}},1)};if(e.addEventListener!==undefined){e.addEventListener("load",n,false)}else{e.attachEvent("onload",n)}};t.prototype._options=null;t.prototype._var=null;t.prototype._bait=null;t.prototype._log=function(e,t){console.log("[BlockAdBlock]["+e+"] "+t)};t.prototype.setOption=function(e,t){if(t!==undefined){var i=e;e={};e[i]=t}for(var n in e){this._options[n]=e[n];if(this._options.debug===true){this._log("setOption",'The option "'+n+'" he was assigned to "'+e[n]+'"')}}return this};t.prototype._creatBait=function(){var t=document.createElement("div");t.setAttribute("class",this._options.baitClass);t.setAttribute("style",this._options.baitStyle);this._var.bait=e.document.body.appendChild(t);this._var.bait.offsetParent;
this._var.bait.offsetHeight;this._var.bait.offsetLeft;this._var.bait.offsetTop;this._var.bait.offsetWidth;this._var.bait.clientHeight;this._var.bait.clientWidth;if(this._options.debug===true){this._log("_creatBait","Bait has been created")}};t.prototype._destroyBait=function(){e.document.body.removeChild(this._var.bait);this._var.bait=null;if(this._options.debug===true){this._log("_destroyBait","Bait has been removed")}};t.prototype.check=function(e){if(e===undefined){e=true}if(this._options.debug===true){this._log("check","An audit was requested "+(e===true?"with a":"without")+" loop")}if(this._var.checking===true){if(this._options.debug===true){this._log("check","A check was canceled because there is already an ongoing")}return false}this._var.checking=true;if(this._var.bait===null){this._creatBait()}var t=this;this._var.loopNumber=0;if(e===true){this._var.loop=setInterval(function(){t._checkBait(e)},this._options.loopCheckTime)}setTimeout(function(){t._checkBait(e)},1);if(this._options.debug===true){
this._log("check","A check is in progress ...")}return true};t.prototype._checkBait=function(t){var i=false;if(this._var.bait===null){this._creatBait()}if(e.document.body.getAttribute("abp")!==null||this._var.bait.offsetParent===null||this._var.bait.offsetHeight==0||this._var.bait.offsetLeft==0||this._var.bait.offsetTop==0||this._var.bait.offsetWidth==0||this._var.bait.clientHeight==0||this._var.bait.clientWidth==0){i=true}if(e.getComputedStyle!==undefined){var n=e.getComputedStyle(this._var.bait,null);if(n&&(n.getPropertyValue("display")=="none"||n.getPropertyValue("visibility")=="hidden")){i=true}}if(this._options.debug===true){this._log("_checkBait","A check ("+(this._var.loopNumber+1)+"/"+this._options.loopMaxNumber+" ~"+(1+this._var.loopNumber*this._options.loopCheckTime)+"ms) was conducted and detection is "+(i===true?"positive":"negative"))}if(t===true){this._var.loopNumber++;if(this._var.loopNumber>=this._options.loopMaxNumber){this._stopLoop()}}if(i===true){this._stopLoop();this._destroyBait();
this.emitEvent(true);if(t===true){this._var.checking=false}}else if(this._var.loop===null||t===false){this._destroyBait();this.emitEvent(false);if(t===true){this._var.checking=false}}};t.prototype._stopLoop=function(e){clearInterval(this._var.loop);this._var.loop=null;this._var.loopNumber=0;if(this._options.debug===true){this._log("_stopLoop","A loop has been stopped")}};t.prototype.emitEvent=function(e){if(this._options.debug===true){this._log("emitEvent","An event with a "+(e===true?"positive":"negative")+" detection was called")}var t=this._var.event[e===true?"detected":"notDetected"];for(var i in t){if(this._options.debug===true){this._log("emitEvent","Call function "+(parseInt(i)+1)+"/"+t.length)}if(t.hasOwnProperty(i)){t[i]()}}if(this._options.resetOnEnd===true){this.clearEvent()}return this};t.prototype.clearEvent=function(){this._var.event.detected=[];this._var.event.notDetected=[];if(this._options.debug===true){this._log("clearEvent","The event list has been cleared")}};t.prototype.on=function(e,t){
this._var.event[e===true?"detected":"notDetected"].push(t);if(this._options.debug===true){this._log("on",'A type of event "'+(e===true?"detected":"notDetected")+'" was added')}return this};t.prototype.onDetected=function(e){return this.on(true,e)};t.prototype.onNotDetected=function(e){return this.on(false,e)};e.BlockAdBlock=t;if(e.blockAdBlock===undefined){e.blockAdBlock=new t({checkOnLoad:true,resetOnEnd:true})}})(window)});define("shared/blockadblock",["shared/polyfills","third_party/blockadblock"],function Ke(require,exports,e){require("third_party/blockadblock");if(window.BlockAdBlock!==undefined){exports.BlockAdBlock=window.BlockAdBlock;window.BlockAdBlock=null;window.blockAdBlock=null}});define("app/view/ads",["shared/polyfills","shared/action_log","interface/jquery","webnode2","view/modal","unified_view/modal","view/selector","shared/w2.context","shared/blockadblock","shared/events/index","shared/onload"],function Je(require,exports,e){var t=require("shared/action_log").ActionableComponent,$=require("interface/jquery")._jQuery,i=require("webnode2").Component,n=require("view/modal"),s=require("unified_view/modal").ModalBase,o=require("view/selector").Selector,r=require("view/selector").MultiSelector,a=require("shared/w2.context"),d=require("shared/blockadblock").BlockAdBlock,l=require("shared/events/index"),c=require("shared/onload");
exports.AdsManagerAdBlockerCheck=i.extend({onLoad:function(){var e=this;c.execAfterLoadDelayed(function(){setTimeout(e.checkForAdBlocker.bind(e),e.delay)})},checkForAdBlocker:function(){var e=this;var t=new d({checkOnLoad:false});t.onDetected(function(){e.serverCall("should_show_ad_blocker_warning").success(function(){e.createModal("load_ad_blocker_detected_modal").show()}).except("warning_limit",function(){}).send()});t.onNotDetected(function(){e.serverCall("clear_ad_blocker_warning_shown").send()});t.check()}});exports.TextAd=t.extend({onLoad:function(){this._super.apply(this,arguments);var e=this;$(document).ready(function(){setTimeout(function(){if(e.$id("@wrapper").width()===0||e.$id("@wrapper").height()===0){e.serverCall("log_blocked_impression").send()}},100)})},actionCallback:function(){this._super.apply(this,arguments);this.serverCall("flush_action_log").send()}});exports.AdLink=i.extend({onLoad:function(){var e=this;e._super.apply(this,arguments);var t=e.$id("@link");t.on("mousedown",function(){
t.attr("href",e.redirect_url)})}});exports.DatePickers=i.extend({onLoad:function(){var e=this.$id("@start_date");var t=this.$id("@end_date");var i=this.$id("@show_end_date");var n=this.$id("@end_date_wrapper");this.$id("@show_end_date").click(function(e){e.preventDefault();n.removeClass("hidden");i.addClass("hidden")});var s=new Date;var o=new Date(s.getFullYear(),s.getMonth(),s.getDate(),0,0,0,0);var r=e.datepicker({onRender:function(e){return e.valueOf()<o.valueOf()?"disabled":""}}).on("changeDate",function(){r.hide()}).data("datepicker");r.hide();var a=t.datepicker({onRender:function(e){return e.valueOf()<o.valueOf()?"disabled":""}}).on("changeDate",function(){a.hide()}).data("datepicker");a.hide()}});exports.ExportTableData=i.extend({onLoad:function(){var e=this;e.adContext=e.getContext(u);e.$id("@download_link").on("click",function(t){t.preventDefault();e.downloadTable()})},downloadTable:function(){var e=new Date;var t="";var i=this.adContext.get("numDays");if(i==null){t="billing"}else if(i<1){
t="all time"}else{t=i+" days"}var n=this.filename+" - "+t+" - "+e.toISOString().slice(0,10);var s=document.createElement("a");s.setAttribute("href","data:text/csv;charset=utf-8,"+encodeURIComponent(this.adContext.get("csv")));s.setAttribute("download",n+".csv");s.click()}});var u=a.Context.extend({initialProperties:function(){return{graphName:null,numDays:null,endDate:"today",sortColumn:5,sortDirection:"desc",csv:""}}});var h=a.Context.extend({initialProperties:function(){return{suggestedBidDollar:35e3,shouldUpdateSuggestedBid:null,shouldUpdateInventory:null,inventoryEstimate:0,cpc:null,topicCount:0,locationCount:0,desktopChecked:false,mobileChecked:false}}});exports.AdManager=i.extend({contextConstructor:function(){return u},onLoad:function(){var e=this;var t=this.$id("@name");var i=this.$id("@name_error");var n=this.$id("@submit_success");var s=this.$id("@submit_error");var o=this.$id("@daily_budget");var r=this.$id("@daily_budget_error");var a=this.$id("@total_budget");var d=this.$id("@total_budget_error");
var l=this.$id("@budget_error");var c=false;var h=this.$id("@ad_table");var p=this.$id("@immediate");var g=this.$id("@datepicker");var m=this.child("date_selector");var v=this.$id("@lifetime_budget_wrapper");var _=this.$id("@show_lifetime_budget");e.context=this.getContext(u);if(e.forceSortDirection){e.context.set("sortDirection",e.forceSortDirection)}e.context.on("numDays",function(t,i){e.serverCall("load_table").args(i,e.context.get("endDate")).contentFor(h).send()});this.$id("@set_date").click(function(){g.removeClass("hidden")});this.$id("@immediate").click(function(){g.addClass("hidden")});$("body").addClass("ad_manager");$(".ContentWrapper").addClass("ad_manager_wrapper");this.$id("@show_lifetime_budget").click(function(e){e.preventDefault();_.addClass("hidden");v.removeClass("hidden")});$(window).scroll(function(){var e=$(this).scrollTop();if(e>0){$(".AdsSubNav").addClass("nav_shadow")}else{$(".AdsSubNav").removeClass("nav_shadow")}});var w=function(e,t){if(e.val()!=""&&!$.isNumeric(e.val().replace(/\$|,/g,""))){
e.addClass("error");t.removeClass("hidden")}else{e.removeClass("error");t.addClass("hidden");if(e.val()!==""){var i=parseFloat(e.val().replace(/\$|,/g,""));e.val("$"+i.toFixed(2))}}};o.blur(function(){w(o,r)});a.blur(function(){w(a,d)});this.$id("@submit_campaign").click(function(u){u.preventDefault();c=false;t.removeClass("error");o.removeClass("error");a.removeClass("error");i.addClass("hidden");l.addClass("hidden");r.addClass("hidden");d.addClass("hidden");if(t.val().trim()==""){t.addClass("error");i.removeClass("hidden");c=true}if(o.val()!=""&&!$.isNumeric(o.val().replace(/\$|,/g,""))){o.addClass("error");r.removeClass("hidden");c=true}if(a.val()!=""&&!$.isNumeric(a.val().replace(/\$|,/g,""))){a.addClass("error");d.removeClass("hidden");c=true}if(a.val()==""&&o.val()==""){a.addClass("error");o.addClass("error");l.removeClass("hidden");c=true}if(!c){var h,f,g,v;if(p.is(":checked")){h="now";f="never"}else{h=m.$id("@start_date").val();g=m.$id("@start_time").val();f=m.$id("@end_date").val();
v=m.$id("@end_time").val();h=e.getDateFormat(h,g);f=e.getDateFormat(f,v)}e.serverCall("submit_campaign").kwargs({campaign_name:t.val(),daily_budget_dollar_str:o.val().replace(/\$|,/g,""),total_budget_dollar_str:a.val().replace(/\$|,/g,""),start_time:h,end_time:f}).success(function(t){if(t){window.location="/ads/create_ad_set?id="+t}else{window.location="/ads/campaign_performance?id="+e.campaign_id}n.removeClass("hidden");s.addClass("hidden")}).error(function(){s.removeClass("hidden");n.addClass("hidden")}).send()}});this.$id("@edit_campaign").click(function(){var e=$(".campaign_checkbox:checked").attr("cid");window.location="/ads/edit_campaign?id="+e});this.$id("@delete").click(function(){e.deleteSelected()});this.$id("@edit").click(function(){var e=$(".child_table_checkbox:checked").attr("ad_id");window.location="/ads/edit_ad?id="+e});this.$id("@filter_time").on("change",function(){var t=parseInt($(this).val());var i=$(this).find("option:selected").text();e.context.set("numDays",t);f(e,i);
});this.$id("@cancel").click(function(t){t.preventDefault();e.createModal("cancel_modal").show()});this.$id("@confirm_ads").click(function(t){t.preventDefault();e.serverCall("start_campaign").success(function(){alert("Campaign started!");window.location="/ads/account?id="+e.account_id}).send()})},getDateFormat:function(e,t){var i=e.split("/");var n=new Date;n.setUTCHours(t);n.setUTCMinutes(0);n.setUTCSeconds(0);n.setUTCMilliseconds(0);n.setUTCMonth(i[0]-1);n.setUTCDate(i[1]);n.setUTCFullYear(i[2]);return n.getTime()*1e3},deleteSelected:function(){var e=this;var t=[];$(".table_checkbox:checked").each(function(e,i){t.push(parseInt($(i).attr("cid")))});e.createModal("delete_children_modal").kwargs({children_oids:t}).show()}});var f=function(e,t){e.$id("@filter_time").removeClass("small_option medium_option large_option");if(t.length<=8){e.$id("@filter_time").addClass("small_option")}else if(t.length>8&&t.length<=10){e.$id("@filter_time").addClass("medium_option")}else{e.$id("@filter_time").addClass("large_option");
}};exports.AdsCancelModal=s.extend({onSubmit:function(){this.serverCall("get_navigate_url").kwargs({url:window.location.href}).success(function(e){if(e!==null){window.location=e}else{window.history.back();window.history.back()}}).send()}});exports.EnableBudgetLink=i.extend({onLoad:function(){var e=this;this.$id("@enable_budget").on("click",function(){e.createModal("enable_budget").show()})}});exports.EnableBudgetModal=s.extend({onSubmit:function(){this.close()}});exports.AdSetSummarySidebar=i.extend({onLoad:function(){var e=this.$id("@topic_span"),t=this.$id("@location_span"),i=this.$id("@platform_span"),n=this.$id("@cpc_span"),s=this.$id("@summary_sidebar"),o=this.$id("@impression_span"),r=this.getContext(h);var a=s.offset().top-135;$(window).scroll(function(){var e=$(window).scrollTop();if(a<e){s.addClass("fixed_rail")}else{s.removeClass("fixed_rail")}});r.on("inventoryEstimate",function(e,t){o.text(t)});r.on("topicCount",function(t,i){e.text(i)});r.on("locationCount",function(e,i){t.text(i);
});r.on("cpc",function(e,t){var i=isNaN(t);var s=parseFloat(parseFloat(t).toFixed(2));i=i||isNaN(s)||s>m;var o="Invalid";if(!i){o="$"+s.toFixed(2)}n.text(o)});var d=function(e){var t=e.get("desktopChecked");var n=e.get("mobileChecked");if(t&&n){i.text("All")}else if(t){i.text("Desktop")}else if(n){i.text("Mobile")}else{i.text("None")}};r.on("desktopChecked",function(e,t){d(r)});r.on("mobileChecked",function(e,t){d(r)})}});var p=null;var g=null;var m=1e6;exports.AdCreateSet=i.extend({contextConstructor:function(){return h},onLoad:function(){var e=this,t=this.$id("@new_set"),i=this.$id("@existing_set"),n=this.$id("@ad_set_name"),s=this.$id("@ad_set_name_error"),o=this.child("topic_selector"),r=this.$id("@topic_selector_no_topics_error"),a=this.child("geo_selector"),d=this.child("geo_exclude_selector"),l=this.child("qid_exclude_selector"),c=this.$id("@cpc"),u=this.$id("@cpc_error"),f=this.$id("@cpc_num_error"),m=this.$id("@mobile"),v=this.$id("@desktop"),_=this.$id("@platform_error"),w=this.$id("@show_excluded_options"),b=this.$id("@excluded_options_wrapper"),y=this.$id("@create_new_radio"),C=this.$id("@import_existing_radio"),x=this.$id("@import_ad_set"),k=this.$id("@import_ad_set_wrapper"),S=this.$id("@submit_success"),E=this.$id("@submit_error"),T=this.$id("@cpc_value"),L=false,M=this.getContext(h);
this.updateDisplayedSuggestedBid();M.set("mobileChecked",m.is(":checked"));M.set("desktopChecked",v.is(":checked"));c.on("input",function(){M.set("cpc",$(this).val())});m.on("change",function(){M.set("shouldUpdateSuggestedBid",true);M.set("shouldUpdateInventory",true);if(this.checked){M.set("mobileChecked",true)}else{M.set("mobileChecked",false)}});v.on("change",function(){M.set("shouldUpdateSuggestedBid",true);M.set("shouldUpdateInventory",true);if(this.checked){M.set("desktopChecked",true)}else{M.set("desktopChecked",false)}});M.on("shouldUpdateSuggestedBid",function(t,i){if(i){e.updateDisplayedSuggestedBid()}});M.on("shouldUpdateInventory",function(t,i){if(i){e.updateInventoryEstimate()}});M.on("suggestedBidDollar",function(t,i){var n=i.toFixed(2);var s="$"+n+" USD";T.text(n);e.$id("@cpc_link").text(s)});this.$id("@import_ad_set_btn").click(function(t){t.preventDefault();p.saved_results=[];g.saved_results=[];e.serverCall("get_tids_of_ad_set").kwargs({ad_set_id:x.val()}).success(function(e){
var t=[];$.each(e,function(e,i){t.push({data:{ty:"topic",tid:i}})});p.addSelectedTopics(t)}).send();e.serverCall("get_geos_of_ad_set").kwargs({ad_set_id:x.val()}).success(function(e){g.addSelectedGeos(e)}).send()});p=o;g=a;$("body").addClass("ad_manager");$(".ContentWrapper").addClass("ad_manager_wrapper");$(window).scroll(function(){var e=$(this).scrollTop();if(e>0){$(".AdsSubNav").addClass("nav_shadow")}else{$(".AdsSubNav").removeClass("nav_shadow")}});this.$id("@cpc_link").click(function(e){e.preventDefault();c.val(T.text());M.set("cpc",T.text())});this.$id("@show_excluded_options").click(function(e){e.preventDefault();w.addClass("hidden");b.removeClass("hidden")});this.$id("@create_new_radio").change(function(e){e.preventDefault();if(y.is(":checked")){k.addClass("hidden")}});this.$id("@import_existing_radio").change(function(e){e.preventDefault();if(C.is(":checked")){k.removeClass("hidden")}});this.$id("@ad_new").click(function(){t.removeClass("hidden");i.addClass("hidden")});this.$id("@ad_existing").click(function(){
i.removeClass("hidden");t.addClass("hidden")});this.$id("@cancel").click(function(t){t.preventDefault();e.createModal("cancel_modal").show()});this.$id("@update_ad_set").click(function(t){t.preventDefault();L=false;var i=e.getSelectedTopics();var h=[];a.saved_results.map(function(e){h.push({geo_target:e.data.id,geo_level:e.ty})});var p=[];d.saved_results.map(function(e){p.push({geo_target:e.data.id,geo_level:e.ty})});var g=[];l.saved_results.map(function(e){g.push(e.data.qid)});var w=[];var b=m.is(":checked");var y=v.is(":checked");if(b){w.push("app_ios","mobile_web_ios","app_android","mobile_web_android","mobile_web_unknown","unknown")}if(y){w.push("desktop_pc","desktop_mac","desktop_unknown")}if(n.val().trim()==""){n.addClass("error");s.removeClass("hidden");L=true}if(o.$wrapper.find(".saved_topics_list").text()==""){o.$wrapper.addClass("error");r.removeClass("hidden");L=true}if(w.length==0){v.addClass("error");m.addClass("error");_.removeClass("hidden");L=true}if(c.val().trim()==""){
c.addClass("error");f.addClass("hidden");u.removeClass("hidden");L=true}else if(!$.isNumeric(c.val().replace(/\$|,/g,""))){c.addClass("error");u.addClass("hidden");f.removeClass("hidden");L=true}if(!L){e.serverCall("submit_ad_set").kwargs({ad_set_name:n.val(),tids:i,platforms:w,cpc_dollar_str:c.val().replace(/\$|,/g,""),cpc_suggested_dollar:M.get("suggestedBidDollar"),geos:h,excluded_geos:p,excluded_qids:g}).success(function(t){if(t){window.location="/ads/create_ad?id="+t}else{S.removeClass("hidden");E.addClass("hidden");window.location="/ads/adset_performance?id="+e.ad_set_id}}).error(function(){E.removeClass("hidden");S.addClass("hidden")}).liveMutate().send()}})},getSelectedTopics:function(){var e=this.child("topic_selector");var t=[];if(e.saved_results){e.saved_results.map(function(e){t.push(e.data.tid)})}return t},getIsMobileForSuggestedBid:function(){var e=this.$id("@mobile");var t=this.$id("@desktop");var i=e.is(":checked");var n=t.is(":checked");return!n&&i},getCountryCodeListForSuggestedBid:function(){
var e=this.child("geo_selector");var t=[];var i;var n;if(e.saved_results){e.saved_results.map(function(e){i=e.data.id;n=i.slice(i.length-2);t.push(n)})}if(!t){t=null}return t},updateDisplayedSuggestedBid:function(){var e=this.getContext(h);var t=this.getSelectedTopics();var i=this.getCountryCodeListForSuggestedBid();var n=this.getIsMobileForSuggestedBid();this.$id("@impression_span").text(Math.random());this.serverCall("get_suggested_bid_dollar").kwargs({tids:t,is_mobile:n,country_codes:i}).success(function(t){e.set("suggestedBidDollar",t)}).send()},updateInventoryEstimate:function(){var e=this.getContext(h);var t=this.getSelectedTopics();var i=this.child("geo_selector");var n=this.child("geo_exclude_selector");var s=this.child("qid_exclude_selector");var o=[];i.saved_results.map(function(e){o.push({geo_target:e.data.id,geo_level:e.ty})});var r=[];n.saved_results.map(function(e){r.push({geo_target:e.data.id,geo_level:e.ty})});var a=[];s.saved_results.map(function(e){a.push(e.data.qid)});
var d=[];var l=this.$id("@mobile").is(":checked");var c=this.$id("@desktop").is(":checked");if(l){d.push("app_ios","mobile_web_ios","app_android","mobile_web_android","mobile_web_unknown","unknown")}if(c){d.push("desktop_pc","desktop_mac","desktop_unknown")}this.serverCall("get_inventory_estimation_translated").kwargs({geos:o,exclude_geos:r,tids:t,platforms:d,ignore_qids:a}).success(function(t){e.set("inventoryEstimate",t)}).except("too_many_requests",function(){}).send()}});exports.AdsTopicMultiSelector=r.extend({onLoad:function(){var e=this;e._super.apply(this,arguments);e.adCreateContext=e.getContext(h)},wrapperFocusinHandler:function(){return},resultWasSelected:function(e,t,i){if(this.saved_results.length>=this.limit){this.toggleTooManyTopicsError(true);return}this.toggleTooManyTopicsError(false);this._super.apply(this,arguments);this.adCreateContext.set("topicCount",this.saved_results.length)},addSelectedTopics:function(e){var t=this;var i=e.length+t.saved_results.length;var n={};var s;
var o;if(i>t.limit){t.serverCall("show_too_many_target_topics_pmsg").kwargs({total:i,saved_results_length:t.saved_results.length}).send();return false}for(s=0;s<t.saved_results.length;s++){o=t.saved_results[s].data.tid;n[o]=true}for(s=0;s<e.length;s++){o=e[s].data.tid;if(!n[o]){n[o]=true;t.saved_results.push(e[s])}}t.showResults(false);t.setQuery("");if(e){t.updateDisplayedResults();t.onSavedResultsChanged();t.adCreateContext.set("topicCount",t.saved_results.length)}return true},remove:function(e){this._super.apply(this,arguments);this.adCreateContext.set("topicCount",this.saved_results.length)},onSavedResultsChanged:function(){this._super.apply(this,arguments);this.adCreateContext.set("shouldUpdateInventory",true);this.adCreateContext.set("shouldUpdateSuggestedBid",true);this.toggleTooManyTopicsError(false)},toggleTooManyTopicsError:function(e){var t=this.parent().$id("@topic_selector_too_many_topics_error");var i=this.parent().child("topic_selector");if(e){i.$wrapper.addClass("error");
t.removeClass("hidden")}else{i.$wrapper.removeClass("error");t.addClass("hidden")}}});exports.GeolocationSelector=r.extend({onLoad:function(){var e=this;e._super.apply(this,arguments);e.adCreateContext=e.getContext(h)},wrapperFocusinHandler:function(){return},resultWasSelected:function(e,t,i){if(this.saved_results.length>=this.limit){this.toggleTooManyLocationsError(true);return}this.toggleTooManyLocationsError(false);this._super.apply(this,arguments);this.adCreateContext.set("locationCount",this.saved_results.length)},remove:function(e){this._super.apply(this,arguments);this.adCreateContext.set("locationCount",this.saved_results.length)},onSavedResultsChanged:function(){this._super.apply(this,arguments);this.adCreateContext.set("shouldUpdateSuggestedBid",true);this.adCreateContext.set("shouldUpdateInventory",true);this.toggleTooManyLocationsError(false)},toggleTooManyLocationsError:function(e){var t=this.parent().$id("@geo_selector_too_many_locations_error");var i=this.parent().child("geo_selector");
if(e){i.$wrapper.addClass("error");t.removeClass("hidden")}else{i.$wrapper.removeClass("error");t.addClass("hidden")}},addSelectedGeos:function(e){var t=this;var i;for(i=0;i<e.length;i++){t.saved_results.push(e[i])}t.showResults(false);t.setQuery("");if(e){t.updateDisplayedResults();t.onSavedResultsChanged();t.adCreateContext.set("locationCount",t.saved_results.length)}return true}});exports.AdsQuestionMultiSelector=r.extend({onLoad:function(){var e=this;e._super.apply(this,arguments);e.adCreateContext=e.getContext(h)},onSavedResultsChanged:function(){this._super.apply(this,arguments);this.adCreateContext.set("shouldUpdateInventory",true)}});exports.AdUnitCreation=i.extend({onLoad:function(){var e=this;var t=this.child("ad_preview");e.adName=t.$id("@ad_name");e.adBusinessName=t.$id("@business_name");e.adHeadline=t.$id("@headline");e.headlinePeriodError=t.$id("@headline_period_error");e.headlineQuoraError=t.$id("@headline_quora_error");e.headlineCapitalError=t.$id("@headline_capital_error");
e.adSummary=t.$id("@summary");e.summaryPeriodError=t.$id("@summary_period_error");e.summaryQuoraError=t.$id("@summary_quora_error");e.summaryCapitalError=t.$id("@summary_capital_error");e.adUrl=t.$id("@url");e.adUrlError=t.$id("@url_error");e.adCta=t.$id("@cta");e.adDomainName=t.$id("@domain_name");e.submitSuccess=this.$id("@submit_success");e.submitError=this.$id("@submit_error");var i=false;$("body").addClass("ad_manager");$(".ContentWrapper").addClass("ad_manager_wrapper");e.validateOnFocusOut(e.adName);e.validateOnFocusOut(e.adBusinessName);e.validateOnFocusOut(e.adHeadline);e.validateOnFocusOut(e.adSummary);this.$id("@cancel").click(function(t){t.preventDefault();e.createModal("cancel_modal").show()});this.$id("@create_ad").click(function(t){t.preventDefault();var n=e.usesWordQuora(e.adHeadline,e.headlineQuoraError)||e.usesWordQuora(e.adSummary,e.summaryQuoraError);var s=e.checkCapitalWords(e.adHeadline,e.headlineCapitalError)||e.checkCapitalWords(e.adSummary,e.summaryCapitalError);
var o=e.validateEndsInPeriod(e.adHeadline,e.headlinePeriodError)||e.validateEndsInPeriod(e.adSummary,e.summaryPeriodError);var r=e.checkUppercaseWords(e.adHeadline,e.headlineCapitalError)||e.checkUppercaseWords(e.adSummary,e.summaryCapitalError);var a=n||s||o||r;i=e.validateInput();if(!i&&!a){e.submitAd()}else if(!i&&a){e.createModal("confirm_warning_modal").kwargs({warnings:{uses_word_quora:n,uses_capital_words:s,needs_period:o,all_uppercase:r}}).onSubmit(function(){e.submitAd()}).show()}})},submitAd:function(){var e=this;var t=e.adCta.find("option:selected").text();t=t.replace(/\s+/g,"_").toLowerCase();e.serverCall("create_ad").kwargs({name:e.adName.val(),business_name:e.adBusinessName.val(),title:e.adHeadline.val(),content_text:e.adSummary.val(),url:e.adUrl.val(),cta:t,domain_name:e.adDomainName.val()}).success(function(t){e.submitSuccess.removeClass("hidden");e.submitError.addClass("hidden");if(t){window.location="/ads/review_ads?id="+t}else{window.location="/ads/ad_performance?id="+e.ad_id;
}}).error(function(){e.submitError.removeClass("hidden");e.submitSuccess.addClass("hidden")}).send()},validateInput:function(){var e=this;var t=false;var i=false;var n=false;var s=false;i=e.checkIfEmpty(e.adName)||i;i=e.checkIfEmpty(e.adHeadline)||i;i=e.checkIfEmpty(e.adSummary)||i;i=e.checkIfEmpty(e.adUrl)||i;n=e.checkInvalidURL();i=e.checkIfEmpty(e.adDomainName)||i;s=e.checkInvalidDomain(e.adDomainName);i=e.checkIfEmpty(e.adBusinessName)||i;t=e.checkInvalidBusinessName(e.adBusinessName);return i||n||s||t},validateEndsInPeriod:function(e,t){var i=new RegExp(/\.\s*$/,"i");if(i.test(e.val())){e.removeClass("error");t.addClass("hidden");return false}e.addClass("error");t.removeClass("hidden");return true},usesWordQuora:function(e,t){var i=new RegExp(/quora/,"i");if(i.test(e.val())){e.addClass("error");t.removeClass("hidden");return true}e.removeClass("error");t.addClass("hidden");return false},checkCapitalWords:function(e,t){var i=new RegExp(/[A-Z][a-zA-Z]*\s*/,"g");var n=new RegExp(/[^\s]+/,"ig");
var s=e.val().match(i);var o=e.val().match(n);if(s&&o&&s.length/o.length>.5){e.addClass("error");t.removeClass("hidden");return true}e.removeClass("error");t.addClass("hidden");return false},checkUppercaseWords:function(e,t){var i=new RegExp(/(?!HTML|ASAP|RSVP|DSLR)\b[A-Z]{4,}\b/,"g");if(i.test(e.val())){e.addClass("error");t.removeClass("hidden");return true}e.removeClass("error");t.addClass("hidden");return false},checkIfEmpty:function(e){if(e.val().trim()==""){e.addClass("error");return true}return false},checkInvalidBusinessName:function(e){if(e.val().length>=0&&e.val().length<=this.businessNameMaxLength){return false}e.addClass("error");return true},checkInvalidURL:function(){var e=this.adUrl;var t=this.adUrlError;var i=new RegExp("(http|https)://[\\w-]+(\\.[\\w-]+)+([\\w.,@?^=%&amp;:/~+#-]*[\\w@?^=%&amp;/~+#-])?","ig");if(e.val().length<2083&&i.test(e.val())){e.removeClass("error");t.addClass("hidden");return false}e.addClass("error");t.removeClass("hidden");return true},checkInvalidDomain:function(e){
var t=new RegExp("[\\w-]+\\.[\\w-]+","ig");if(t.test(e.val())){e.removeClass("error");return false}e.addClass("error");return true},validateOnFocusOut:function(e){e.focusout(function(){if($(this).val().trim()==""){$(this).addClass("error")}else{$(this).removeClass("error")}})}});exports.AdSetTotalBudget=i.extend({onLoad:function(){this.$id("@update").click(this.updateBudget.bind(this));this.$id("@edit").click(this.toggleEditor.bind(this));this.$id("@cancel").click(this.toggleEditor.bind(this))},toggleEditor:function(){this.$id("@initial").toggleClass("hidden");this.$id("@editor").toggleClass("hidden");return false},updateBudget:function(){var e=this.$id("@budget").val();this.serverCall("update_budget").kwargs({budget_str:e}).success(this.toggleEditor.bind(this)).liveMutate().send();return false}});exports.KeywordModalLink=i.extend({onLoad:function(){var e=this;this.$id("@create_modal_link").on("click",function(t){e.modal("load_inner",{closeOnBackgroundClick:true});t.preventDefault()})}});
exports._KeywordImportModal=n.MultiStep.extend({getCallBacks:function(){var e=this;return{KeywordImportModalKeywordEntry:{init:function(){e.$id("@submit_button").addClass("disabled");e.$id("@keyword_textarea").bind("input propertychange",function(){if(this.value.length){e.$id("@submit_button").removeClass("disabled")}else{e.$id("@submit_button").addClass("disabled")}})},getStepData:function(){return{keywords:e.$id("@keyword_textarea").val()}},onSubmit:function(){e._loadNext()}},KeywordImportModalResults:{isLastStep:true,init:function(){var t=e.$id("@keyword_results").find(".topic_checkbox:checked").length;e.$id("@submit_button").text("Import "+t+" Topics");$('input[type="checkbox"]').change(function(){var t=e.$id("@keyword_results").find(".topic_checkbox:checked").length;e.$id("@submit_button").text("Import "+t+" Topics")})},onSubmit:function(){var t=[];var i=e.$id("@keyword_results");i.find(".topic_checkbox:checked").each(function(e,i){t.push({data:{ty:"topic",tid:parseInt(i.getAttribute("cid"))
}})});if(p.addSelectedTopics(t)){e._closeModal()}}}}}});exports.KeywordModalGlobalActions=i.extend({onLoad:function(){var e=this;this.$id("@select_all").on("click",function(){$(".topic_checkbox").prop("checked",true);e.updateSubmitButton($(".topic_checkbox").length)});this.$id("@select_none").on("click",function(){$(".topic_checkbox").prop("checked",false);e.updateSubmitButton("0")})},updateSubmitButton:function(e){$(".KeywordImportModalResults .submit_button").text("Import "+e+" Topics")}});exports.AdPreview=i.extend({onLoad:function(){var e=this;e.url=e.$id("@url");e.business_name=e.$id("@ad_business_name");e.headline=e.$id("@ad_headline");e.summary=e.$id("@ad_summary");e.cta=e.$id("@ad_cta");e.ctaField=e.$id("@cta");e.domainNameField=e.$id("@domain_name");var t=e.$id("@create_new_radio");var i=e.$id("@import_existing_radio");var n=e.$id("@import_ad");var s=e.$id("@import_ad_wrapper");e.$id("@url").on("input",function(){if(e.domainNameChangeable){var t=$(this).val().match(/^https?\:\/\/(?:www\.)?([^\/:?#]+)(?:[\/:?#]|$)/i);
if(t&&t.length>1){e.domainNameField.val(t[1])}else{e.domainNameField.val("")}}e.updateCta()});e.$id("@business_name").on("input",function(){e.business_name.text($(this).val());e.updateBusinessNameCount()});e.$id("@headline").on("input",function(){e.headline.text($(this).val());e.updateHeadlineCount()});e.$id("@summary").on("input",function(){e.summary.text($(this).val());e.updateSummaryCount()});e.$id("@domain_name").on("input",function(){e.domainNameField.text($(this).val());e.updateDisplayUrlCount()});e.ctaField.on("change",function(){e.updateCta()});e.domainNameField.on("input",function(){e.domainNameChangeable=false;e.updateCta()});this.$id("@create_new_radio").change(function(e){e.preventDefault();if(t.is(":checked")){s.addClass("hidden")}});this.$id("@import_existing_radio").change(function(e){e.preventDefault();if(i.is(":checked")){s.removeClass("hidden")}});this.$id("@import_ad_btn").click(function(t){t.preventDefault();e.serverCall("get_ad_data").kwargs({ad_id:parseInt(n.val())
}).success(function(t){e.$id("@business_name").val(t.business_name);e.business_name.text(t.business_name);e.$id("@headline").val(t.headline);e.headline.text(t.headline);e.$id("@summary").val(t.summary);e.summary.text(t.summary);e.$id("@domain_name").val(t.domain_name);e.domainNameField.text(t.domain_name);e.$id("@url").val(t.url);e.ctaField.find("option:eq("+t.cta+")").prop("selected",true);e.updateCta();e.updateBusinessNameCount();e.updateHeadlineCount();e.updateSummaryCount();e.updateDisplayUrlCount()}).send()});e.updateBusinessNameCount();e.updateHeadlineCount();e.updateSummaryCount();e.updateDisplayUrlCount()},updateCta:function(){var e=this;var t=e.ctaField.find(":selected").text();if(e.domainNameField.val()){t=e.ctaField.val().replace("{text_domain_name}",e.domainNameField.val())}e.cta.text(t)},updateBusinessNameCount:function(){var e=this;var t=e.businessNameMaxLength-e.$id("@business_name").val().length;e.$(".business_name_limit").text(t+" characters remaining")},updateHeadlineCount:function(){
var e=this;var t=65-e.$id("@headline").val().length;e.$(".headline_limit").text(t+" characters remaining")},updateSummaryCount:function(){var e=this;var t=105-e.$id("@summary").val().length;e.$(".summary_limit").text(t+" characters remaining")},updateDisplayUrlCount:function(){var e=this;var t=30-e.$id("@domain_name").val().length;e.$(".display_url_limit").text(t+" characters remaining")}});exports.AddNewUserButton=i.extend({onLoad:function(){var e=this;this.$id("@add_user").on("click",function(){e.createModal("add_new_user").show()})}});exports.AdminCard=i.extend({onLoad:function(){var e=this;this.$id("@remove_admin").click(function(t){t.preventDefault();e.createModal("confirm_remove_modal").show()})}});exports.RemoveAdminModal=s.extend({onSubmit:function(){this.serverCall("remove_admin").liveMutate().send();this.close()}});exports.DeleteChildrenModal=s.extend({onSubmit:function(){this.serverCall("delete_children").send();this.close()}});exports.AddNewUserModal=s.extend({onLoad:function(){
this._super.apply(this,arguments);var e=this;this.$id("@change_person").on("click",function(t){e.change();t.preventDefault()});this.child("people_selector").onResultWasSelected(function(t){e.resultWasSelected(t)});this.disableSubmit()},change:function(){this.child("people_selector").setQuery("");this.$id("@pick_people").removeClass("hidden");this.$id("@picked_person").addClass("hidden");this.$id("@add_name").html("");this.child("people_selector").focus();this.disableSubmit()},disableSubmit:function(){this.$id("@submit").addClass("action_disabled")},enableSubmit:function(){this.$id("@submit").removeClass("action_disabled")},onSubmit:function(){this.serverCall("set_admin").kwargs({admin_uid:this._selectedUid}).liveMutate().send();this.close()},resultWasSelected:function(e){if(isNaN(parseInt(e))){return}this._selectedUid=e;this.$id("@pick_people").addClass("hidden");this.$id("@picked_person").removeClass("hidden");this.getName(e);this.enableSubmit()},getName:function(e){this.serverCall("get_usercard").kwargs({
to_uid:e}).contentFor(this.$id("@add_name"),{parentCid:this.cid,useLoadingSpinner:false}).send()}});exports.AddNewUserSelector=o.extend({onResultWasSelected:function(e){this._onResultWasSelected=e},resultWasSelected:function(e){this.setQuery("");this.$input.blur();if(this._onResultWasSelected){this._onResultWasSelected(e.data.uid)}}});exports.RSGraph=i.extend({onLoad:function(){var e=this;var t=new Rickshaw.Color.Palette({scheme:"#3E78AD"});for(var i in this.data_json){this.data_json[i].color=t.color()}e.$(window).on("resize",function(){n.configure({width:window.innerWidth-255,height:300});n.render()});var n=new Rickshaw.Graph({element:this.$id("@rsgraph").get(0),series:this.data_json,width:window.innerWidth-255,height:300,renderer:this.renderer,stroke:true,interpolation:"linear",padding:{right:.04}});n.render();var s=new Rickshaw.Graph.Axis.Y({graph:n,orientation:"left",element:this.$id("@y_axis").get(0),ticks:3});s.render();var o=new Rickshaw.Graph.Axis.Time({graph:n});o.render();var r=new Rickshaw.Graph.HoverDetail({
graph:n,formatter:function(e,t,i){if(e.name=="dollars"){return"$"+parseFloat(i).toFixed(2)}else{return i}}})}});exports.PerformanceGraph=i.extend({onLoad:function(){var e=this;var t=e.default_graph;var i=e.default_days;var n=this.$id("@graph");var s=this.getContext(u);var o=e.date_range_order_error;var r=e.date_range_valid_error;e.startDate=this.$id("@start_date");e.endDate=this.$id("@end_date");e.dateWrapper=this.$id("@date_range_wrapper");var a=e.startDate.datepicker().on("changeDate",function(){a.hide();e.endDate.focus()}).data("datepicker");var d=e.endDate.datepicker().on("changeDate",function(){d.hide()}).data("datepicker");s.set("numDays",i);s.set("graphName",t);var l=function(t,i,s){e.serverCall("load_new_graphs").args(t,i,s).contentFor(n).send()};var c=function(t,i){e.serverCall("load_new_totals").success(function(t){e.$id("@conversions").find(".subtext").html(t.conversion);e.$id("@impressions").find(".subtext").html(t.impression);e.$id("@clicks").find(".subtext").html(t.click);e.$id("@spent").find(".subtext").html(t.spent);
}).args(t,i).send()};s.on("numDays",function(e,t){var i=s.get("graphName");var n=s.get("endDate");l(i,t,n);c(t,n)});s.on("graphName",function(e,t){var i=s.get("numDays");var n=s.get("endDate");l(t,i,n)});this.$id("@conversions").click(function(){$(this).addClass("active").siblings().removeClass("active");s.set("graphName","conversion")});this.$id("@impressions").click(function(){$(this).addClass("active").siblings().removeClass("active");s.set("graphName","impression")});this.$id("@clicks").click(function(){$(this).addClass("active").siblings().removeClass("active");s.set("graphName","redirect")});this.$id("@spent").click(function(){$(this).addClass("active").siblings().removeClass("active");s.set("graphName","spend")});this.$id("@refresh").click(function(){var t=e.startDate.val();var i=e.endDate.val();var n=i.split("/");var a=24*60*60*1e3;s.set("endDate",n[2]+"-"+n[0]+"-"+n[1]);i=new Date;i.setMonth(n[0]-1);i.setYear(n[2]);i.setDate(n[1]);n=t.split("/");t=new Date;t.setMonth(n[0]-1);t.setYear(n[2]);
t.setDate(n[1]);var d=Math.round(Math.abs((i.getTime()-t.getTime())/a))+1;if(t>i){window.alert(o)}else if(isNaN(t.getTime())||isNaN(i.getTime())){window.alert(r)}else{s.set("numDays",d)}});this.$id("@filter_time").on("change",function(){var t=parseInt($(this).val());var i=$(this).find("option:selected").text();if(t==0){e.dateWrapper.removeClass("hidden");f(e,i);return false}else{e.dateWrapper.addClass("hidden");s.set("endDate","today");s.set("numDays",t);f(e,i)}})}});exports.AdsTable=i.extend({onLoad:function(){var e=this;e.table=e.$id("@table");e.headers=e.$id("@table_header").children("th");e.adContext=e.getContext(u);e.tableSort(e.adContext.get("sortColumn"),e.adContext.get("sortDirection"));this.$id("@global_table_check").click(function(){e.globalTableCheck(this)});this.$(".table_checkbox:checkbox").change(function(){e.tableRowHighlight(this)});e.tableRowHighlight();e.addQuickEditHover();for(var t=0;t<e.headers.length;t++){$(e.headers[t]).on("click",{col:t},i)}function i(t){e.adContext.set("sortColumn",t.data.col);
e.tableSort(t.data.col);setTimeout(function(){e.updateCsv()},0);e.emitEvent({type:l.Types.ADS_MANAGER_TABLE_SORT,payload:{}})}setTimeout(function(){e.updateCsv()},0)},updateCsv:function(){var e=this;var t=[];var i=".CampaignTable tr, .AdSetTable tr, .AdsTable tr, .BillingTable tr";e.$(i).each(function(e,i){var n=[];$(i).children("td,th").each(function(e,t){if(e==0){return}var i=$(t).text();if(/[,"\n]/.test(i)){n.push('"'+i.replace(/"/g,'""')+'"')}else{n.push(i)}});t.push(n.join(","))});e.adContext.set("csv",t.join("\n")+"\n")},globalTableCheck:function(e){$(".table_checkbox").prop("checked",$(e).prop("checked"));$(".table_checkbox").closest("tr").toggleClass("highlight",e.checked)},tableRowHighlight:function(e){var t=$(".table_checkbox:checked").length;if(e){$(e).closest("tr").toggleClass("highlight",e.checked)}if(t==1){$(".table_edit").removeClass("disabled")}else{$(".table_edit").addClass("disabled")}if(t>=1){$(".table_delete").removeClass("disabled")}else{$(".table_delete").addClass("disabled");
}if(e!==undefined){var i=$(".table_checkbox").length;if(i>0&&t===i){this.$id("@global_table_check").prop("checked",true)}else{this.$id("@global_table_check").prop("checked",false)}}},addQuickEditHover:function(){this.$(".ad_name_td").hover(function(){$(this).find(".quick_edit").removeClass("invisible")},function(){$(this).find(".quick_edit").addClass("invisible")})},tableSort:function(e,t){var i=this;var n=$(i.headers[e]);var s;if(!n.hasClass("micro_table_col")){if(!t&&n.hasClass("sort_desc")||t==="asc"){i.headers.removeClass("sort_asc sort_desc");i.adContext.set("sortDirection","asc");n.addClass("sort_asc");s=function(t,n){var s=$(t.childNodes[e]).text();var o=$(n.childNodes[e]).text();return-i.compare(s,o)}}else{i.headers.removeClass("sort_asc sort_desc");i.adContext.set("sortDirection","desc");n.addClass("sort_desc");s=function(t,n){var s=$(t.childNodes[e]).text();var o=$(n.childNodes[e]).text();return i.compare(s,o)}}var o=i.table.find("tr");o.splice(0,1);o.splice(o.length-1,1);o.sort(s);
o.remove();for(var r=0;r<o.length;r++){i.headers.parent().after(o[r])}}i.tableRowHighlight();i.addQuickEditHover()},compare:function(e,t){if(typeof e==="string"){e=e.replace("$","").replace(",","").replace("%","")}if(typeof t==="string"){t=t.replace("$","").replace(",","").replace("%","")}var i=parseFloat(e);var n=parseFloat(t);if(!isNaN(i)&&!isNaN(n)){e=i;t=n}if(e>t){return 1}else if(t>e){return-1}else{return 0}}});exports.AdTableActions=i.extend({onLoad:function(){var e=this;var t=e.ad_type.split(" ").join("_").toLowerCase();this.$id("@edit").click(function(){var e=$(".table_checkbox:checked").attr("cid");window.location="/ads/edit_"+t+"?id="+e});this.$id("@create").click(function(){window.location="/ads/create_"+t+"?id="+e.oid});this.$id("@delete").click(function(){e.parent().deleteSelected()})}});exports.CampaignEnableAddCardModal=s.extend({onSubmit:function(){var e=this;e.child("add_card_form").submit(function(){e.createModal("load_enable_campaign_confirmation_modal").show()})}});exports.ToggleCampaignConfirmationModal=s.extend({
onSubmit:function(){var e=this;e.serverCall("unpause_campaign").liveMutate().send();e._super.apply(e,arguments)}})});define("view/fixable2",["shared/polyfills","interface/jquery","shared/browser","shared/util"],function Xe(require,exports,e){var $=require("interface/jquery")._jQuery,t=require("shared/browser"),i=require("shared/util");function n(){return t.mobile||t.tablet}var s=[],o=window,r=document,a=["resize","scroll","w2.fixable.trigger"],d=false,l={height:function(e,t){return t.winHeight>=e.min_height},width:function(e,t){return t.winWidth>=e.min_width},scroll:function(e,t){if(e.min_scroll>=0&&(e.min_scroll_callback||e.max_scroll_callback)){var i=e.min_scroll;if(e.min_scroll_callback){i=e.min_scroll_callback()}var n=e.max_scroll;if(e.max_scroll_callback){n=e.max_scroll_callback()}return t.winScroll<=n&&i<=t.winScroll}else if(e.min_scroll>=0&&e.max_scroll>=0){return e.min_scroll<=t.winScroll&&t.winScroll<=e.max_scroll}else if(e.min_scroll>=0){return t.winScroll>=e.min_scroll}else if(e.max_scroll>=0){
return t.winScroll<=e.max_scroll}else{return false}}};var c=function(e,t){e=S(e);if(!e){throw new Error("No element given for makeFixable")}if(k(e)!==-1){return}p(e,t);a.forEach(function(e){if(e==="resize"){o.removeEventListener(e,_);o.addEventListener(e,_)}r.removeEventListener(e,_);r.addEventListener(e,_)});return e};var u=function(e){e=S(e);if(!e){throw new Error("No element given for removeFixable")}var t=k(e),i;if(t>-1){i=s.splice(t,1)[0];i.el.style.top=i.state.elTop+"px";i.el.style.position=i.state.elPosition;i.el.classList.remove("fixable_fixed")}if(s.length<=0){a.forEach(function(e){r.removeEventListener(e,_);o.removeEventListener(e,_)})}return e};var h=function(e,t,i){e=S(e);t=S(t);i=i||{};i.top=i.top||0;i.bottom=i.bottom||0;c(e,{scroll_dep:true,custom_trigger:n});function n(){if(!e||!t){return false}var n=e.offsetHeight,s=document.body.scrollTop+window.innerHeight,o=M(t).top+n+i.top,r=e.parentNode,a;if(r.classList.contains("fixable_clone")){a=M(r).top+n-i.bottom}else{a=M(e).top+n-i.bottom;
}return s>=o&&s<=a}e.addEventListener("w2.fixable.fixed",function(){this.style.top="auto";this.style.bottom=0})};var f=function(e,t){var n=e.length,s;for(s=0;s<n-1;s++){c(e[s],i.extend(t,{scroll_dep:true,footer:e[s+1]}))}c(e[s],i.extend(t,{scroll_dep:true,footer:t&&t.footer||null}))};function p(e,t){if(typeof t!=="object"||t===null){t={}}if(n()&&!t.enable_mobile){return}var r=S(t.header)||document.querySelector(".SiteHeader"),a=S(t.footer)||null,d=r&&r.offsetHeight||0,l=r&&M(r).top||0,c={winHeight:o.innerHeight,winWidth:o.innerWidth,winScroll:document.body.scrollTop,scrollingDown:true,elPosition:window.getComputedStyle(e).position,elTop:parseInt(window.getComputedStyle(e).top),elWidth:e.offsetWidth,topSpacing:0};t=i.extend({scroll_dep:false,height_dep:true,width_dep:true,header:r,footer:a,extra_top_spacing:t.extra_top_spacing||0,extra_bottom_spacing:t.extra_bottom_spacing||0,min_scroll:m(e,r,c.winScroll),max_scroll:v(e,r,a,c.winScroll),min_height:e.offsetHeight+d+l-c.winScroll,min_width:c.elWidth,
sticky_release:true,custom_trigger:null,enable_mobile:false,min_scroll_callback:null,max_scroll_callback:null,responsive_width:false},t);t.min_scroll-=t.extra_top_spacing;t.max_scroll-=t.extra_top_spacing+t.extra_bottom_spacing;c.topSpacing=M(e).top-t.min_scroll-parseInt(window.getComputedStyle(e)["margin-top"]);b(e,t,c);s.push(new g(e,t,c))}function g(e,t,i){this.el=e||null;this.options=t||{};this.state=i||{}}g.prototype.getDependencies=function(){return{resize:this.options.height_dep||this.options.width_dep,scroll:this.options.scroll_dep,custom:this.options.custom_trigger!==null}};function m(e,t,i){var n=M(e).top,s=t&&t.offsetHeight||0,o=(t&&M(t).top||0)-i,r=parseInt(window.getComputedStyle(e)["margin-top"]);return n-s-o-r}function v(e,t,i,n){var s=i&&M(i).top||0,o=M(e).top,r=e.offsetHeight,a=parseInt(window.getComputedStyle(e)["margin-bottom"]);return m(e,t,n)+s-o-r-a}function _(e){var t={scrollTop:document.body.scrollTop,height:o.innerHeight,width:o.innerWidth};if(!d){requestAnimationFrame(w.bind(null,e,t));
}d=true}function w(e,t){var n=e.type;s.filter(function(e){if(n==="w2.fixable.trigger"){return e.getDependencies().custom}return e.getDependencies()[n]}).forEach(function(n){var s=n.state.winScroll;i.extend(n.state,{winScroll:t.scrollTop,winHeight:t.height,winWidth:t.width,customTop:e.top||n.state.customTop||null});n.state.scrollingDown=n.state.winScroll>s;b(n.el,n.options,n.state)});d=false}function b(e,t,i){if(y(e,t,i)){C(e,t,i)}else{x(e,t,i)}}function y(e,t,i){if(window.getComputedStyle(e).display==="none"){return false}var n=true;if(t.custom_trigger!==null){n=t.custom_trigger(t,i)}else if(t.scroll_dep){n=l.scroll(t,i)}if(n){if(t.height_dep){n=l.height(t,i)}if(t.width_dep){n=n&&l.width(t,i)}}return n}function C(e,t,i){if(!e.classList.contains("fixable_fixed")){var n=i.topSpacing,s;i.elWidth=e.offsetWidth;T(e);if(t.custom_trigger!==null&&i.customTop!==null){n=i.customTop;i.customTop=null}else if(!t.scroll_dep){n=M(e).top+parseInt(window.getComputedStyle(e)["margin-top"])}e.style.top=n+"px";
e.style.position="fixed";e.style.width=t.responsive_width?"100%":i.elWidth+"px";e.classList.add("fixable_fixed");try{s=new window.Event("w2.fixable.fixed")}catch(o){s=document.createEvent("Event");s.initEvent("w2.fixable.fixed",true,true)}e.dispatchEvent(s)}}function x(e,t,i){var n;if(e.classList.contains("fixable_fixed")){if(t.custom_trigger!==null){i.customTop=parseInt(window.getComputedStyle(e).top)}if(i.scrollingDown&&t.custom_trigger===null&&t.sticky_release){e.style.top=t.max_scroll-t.min_scroll+"px";e.style.position="relative"}else{e.style.top=i.elTop+"px";e.style.position=i.elPosition;L(e)}e.classList.remove("fixable_fixed");try{n=new window.Event("w2.fixable.unfixed")}catch(s){n=document.createEvent("Event");n.initEvent("w2.fixable.unfixed",true,true)}e.dispatchEvent(n)}}exports.makeFixable=c;exports.removeFixable=u;exports.makeBottomFixable=h;exports.makeStackedFixables=f;function k(e){for(var t=0,i=s.length;t<i;t++){if(e===s[t].el){return t}}return-1}function S(e){if($&&e instanceof $){
if(e.length>=2){throw new Error("Error in makeFixable(): getDomNode must only have a single element. "+"(check the fixable element, header, and footer, are not collections)")}return e[0]}return e}function E(e){var t=document.createElement("div"),i=window.getComputedStyle(e);t.classList.add("fixable_clone");t.style.height=e.offsetHeight+"px";t.style.width=e.offsetWidth+"px";t.style["margin-top"]=i["margin-top"];t.style["margin-right"]=i["margin-right"];t.style["margin-bottom"]=i["margin-bottom"];t.style["margin-left"]=i["margin-left"];return t}function T(e){var t=E(e),i=e.parentNode;i.replaceChild(t,e);t.appendChild(e);return t}function L(e){var t=e.parentNode.parentNode;t.replaceChild(e,e.parentNode);return e}function M(e){var t=e.getBoundingClientRect();return{top:t.top+document.body.scrollTop,left:t.left+document.body.scrollLeft}}});define("app/view/ama",["shared/polyfills","shared/core/component","interface/jquery","view/fixable2","view/selector"],function Ye(require,exports,e){var t=require("shared/core/component").Component,$=require("interface/jquery")._jQuery,i=require("view/fixable2"),n=require("view/selector").WithServerCallMessageMixin;
exports.AMAAddQuestionSelector=n.extend({onLoad:function(){var e=this;e._super.apply(e,arguments);e.questionMarkInserted=false;var t=e.$id("@logged_out_ama_ask");if(t){t.on("click",this.triggerSignupWall.bind(this))}},triggerSignupWall:function(){this.serverCall("trigger_signup_wall").send()},resultsServerCallHandler:function(){this._super.apply(this,arguments);this.$input.focus()},createNewQuestion:function(){var e=this;if(e.hasPendingServerCall()){return}e.makeServerCall(e.serverCall("create_new_question").kwargs({input_text:e.query}).liveMutate())},pickExistingQuestion:function(e){var t=this;if(t.hasPendingServerCall()){return}t.makeServerCall(t.serverCall("pick_existing_question").kwargs({qid:e}).liveMutate())},maybeInsertQuestionMark:function(){if(this.query==="?"&&this.questionMarkInserted){this.setQuery("");this.questionMarkInserted=false;return}if(!this.query){this.questionMarkInserted=false;return}if(this.questionMarkInserted){return}if(this.query.match(/[?]$/)===null){this.questionMarkInserted=true;
this.setQuery(this.query+"?")}},queryDidChange:function(){this._super.apply(this,arguments);this.maybeInsertQuestionMark()},resultWasSelected:function(e){switch(e.ty){case"question":this.pickExistingQuestion(e.data.qid);break;case"create_question":this.createNewQuestion();break}},updateServerMessage:function(e,t){if(e){this.setQuery("")}else{if(t&&t["message"]){this.$id("@server_message_title").text(t["message"]["title"]);if(t["message"]["note"]){this.$id("@server_message_note").text(t["message"]["note"])}return true}}return false}});exports.AMACoverBar=t.extend({onLoad:function(){this.$id("@question_button").on("click",function(){var e=$(".AMAQuestionAddHeader").offset().top;$("html,body").animate({scrollTop:e-80},"slow");$(".AMAQuestionAddHeader").find(".selector_input").focus();$(".AMAQuestionAddHeader").find(".selector_input").addClass("highlighted");setTimeout(function(){$(".AMAQuestionAddHeader").find(".selector_input").removeClass("highlighted")},750)})}});exports.AmaSessionRightCol=t.extend({
onLoad:function(){var e=this.$id("@ticker").get(0);if(!e){e=this.$id("@upcoming").get(0)}if(e){var t=16;i.makeFixable(e,{scroll_dep:true,height_dep:true,extra_top_spacing:t})}}});exports.AMAWriterStats=t.extend({onLoad:function(){var e=this.$id("@writer_stats").get(0);if(e){i.makeFixable(e,{scroll_dep:true,extra_top_spacing:110})}}});exports.AMAMetricGraph=t.extend({onLoad:function(){var e=new Rickshaw.Graph({element:this.$id("@rsgraph").get(0),series:[{color:"steelblue",data:this.series_data}],width:150,height:40,interpolation:"basis",renderer:"line"});e.render()}});exports.FinishSessionButton=t.extend({onLoad:function(){this.$id("@finish_session_button").on("click",this.finishSessionConfirm.bind(this))},finishSessionConfirm:function(){this.createModal("finish_session_confirm").onSubmit(this.finishSession.bind(this)).show()},finishSession:function(){this.serverCall("finish_session").kwargs({ama_id:this.ama_id}).success(this.redirectToSessionPage.bind(this)).send()},redirectToSessionPage:function(){
window.location.replace(this.redirect_url)}})});define("app/view/ama/self_serve",["shared/polyfills","shared/core/component"],function Ze(require,exports,e){var t=require("shared/core/component").Component;exports.StartSessionModalLink=t.extend({onLoad:function(){this.$id("@start_session_modal_link").on("click",this.openSessionModal.bind(this))},openSessionModal:function(){this.createModal("open_session_modal").show()}});exports.QuestionA2ARow=t.extend({onLoad:function(){this.$id("@request_button").on("click",this.addRequest.bind(this))},addRequest:function(){this.serverCall("add_request").liveMutate().send();this.$id("@unrequested_state").addClass("hidden");this.$id("@requested_state").removeClass("hidden")}})});define("shared/views",["shared/polyfills","shared/viewport","interface/settings","shared/core/component","shared/log","shared/logging","shared/Class"],function et(require,exports,e){var t=require("shared/viewport"),i=require("interface/settings").pageIsMobile,n=require("shared/core/component"),s=require("shared/log").log,o=require("shared/logging"),r;
if(i){r=require("mobile_app2/client")}var a=require("shared/Class").Class.extend({__init__:function(){var e=this;e.trackedKeys={};e.trackedComponents=[];e.lastCheckTime=0;e.rateLimitMs=400;if(i){r.registerMessageHandler("tick",function(){e.logViews()})}else{document.addEventListener("scroll",e.logViews.bind(e))}},addComponentToTrack:function(e){var t=e.view_tracking_key;if(!t){if(s&&s.enabled){var i="View tracking key not found for the component. "+"This should be specified in js_data.";s("views",i)}return}if(this.trackedKeys[t]){return}this.trackedKeys[t]=true;this.trackedComponents.push(e)},logViews:function(){var e=Date.now();if(e<this.lastCheckTime+this.rateLimitMs){return}this.lastCheckTime=e;var t=[];var i=[];for(var n=0;n<this.trackedComponents.length;n++){var s=this.trackedComponents[n];if(!s){continue}if(!this.inViewPort(s)){continue}t.push(s.view_tracking_key);i.push(s.view_tracking_hash);this.trackedComponents[n]=undefined}var r={keys:t,hashes:i};if(t.length){o.log("object_views",{
messages:r})}this.trackedComponents=this.trackedComponents.filter(function(e){return e!==undefined})},inViewPort:function(e){var i=n.getLiveDomElement(e.cid);if(!i){return false}return t.isElementInViewport(i)}});exports.viewsLogger=new a});define("app/view/answer",["shared/polyfills","webnode2","shared/views","shared/events/index"],function tt(require,exports,e){var t=require("webnode2").Component,i=require("shared/views").viewsLogger,n=require("shared/events/index");exports.AnswerHeader=t.extend({onLoad:function(){var e=this;this.handleEvent(n.Types.ANSWER_VOTE_STATE,function(t){if(t.payload.aid==e.aid){var i=t.payload.state=="upvoted";e.$id("@credibility_fact_no_vote").toggleClass("hidden",i);e.$id("@credibility_fact_upvoted").toggleClass("hidden",!i)}})}});exports.ToggledAnswerHeader=t.extend({onLoad:function(){var e=this;this.toggled=false;this.handleEvent(n.Types.INLINE_EDITOR_STATE,function(t){if(t.payload.contentType!=e.contentType){return}if(t.payload.oid!=e.oid){return}if(t.payload.state=="cancel"){
e.performCancel()}else if(t.payload.state=="edit"){e.updateState(true)}else if(t.payload.state=="submit"){e.updateState(false)}else if(t.payload.state=="submitted"){e.updateState(false)}else if(t.payload.state=="toggle"){e.updateState(!e.toggled)}})},updateState:function(e){setTimeout(this._updateState.bind(this,e),0)},_updateState:function(e){this.toggled=e;if(this.toggled){this.performEdit()}else{this.performCancel()}},performEdit:function(){this.$id("@read_mode_header").addClass("hidden");this.$id("@edit_mode_header").removeClass("hidden")},performCancel:function(){this.$id("@read_mode_header").removeClass("hidden");this.$id("@edit_mode_header").addClass("hidden")}});exports.AnswerListItem=t.extend({onLoad:function(){i.addComponentToTrack(this);var e=this;e.answerFeedbackLoaded=false;e.handleEvent(n.Types.ANSWER_VOTE_STATE,function(t){if(t.payload.aid==e.aid){if(t.payload.state=="downvoted"){e.showAnswerDownvoteFeedback()}else{e.hideAnswerDownvoteFeedback()}}})},showAnswerDownvoteFeedback:function(){
var e=this;e.$id("@item").addClass("hidden");e.$id("@answer_feedback").removeClass("hidden");if(e.answerFeedbackLoaded===false){e.serverCall("load_downvote_feedback").contentFor(e.$id("@answer_feedback"),{parentCid:e.cid}).success(function(){e.answerFeedbackLoaded=true}).send()}},hideAnswerDownvoteFeedback:function(){this.$id("@item").removeClass("hidden");this.$id("@answer_feedback").addClass("hidden")}})});define("app/view/answer_wiki",["shared/polyfills","interface/jquery","view/inline_editor"],function it(require,exports,e){var $=require("interface/jquery")._jQuery,t=require("view/inline_editor").InlineEditor;exports.CreateAnswerWikiInlineEditor=t.extend({onLoad:function(){var e=this;this._super.apply(this,arguments);this.$id("@inline_editor_cancel").click(function(){e.hideEditor();return false})},trigger_request:function(){this._super.apply(this,arguments);if(this.isEditorEmpty()){this.hideEditor()}return false},hideEditor:function(){this.toggle_editor();$("#answer_wiki").addClass("hidden");
},_get_kwargs:function(){return{qid:this.id,input:this.get_value()}}});exports.AnswerWikiInlineEditor=t.extend({_get_kwargs:function(){var e="";if(this.has_comment&&!this.child("comment_editor").isOnlyWhiteSpace()){e=this.child("comment_editor").serialize()}var t=this.$id("@notif"),i;if(t){i=t.prop("checked")?1:0}else{i=0}return{qid:this.id,input:this.get_value(),sugg_exists:this.sugg_exists,comment:e,notif:i}}})});define("app/view/ask",["shared/polyfills","interface/jquery","shared/window_manager","view/selector"],function nt(require,exports,e){var $=require("interface/jquery")._jQuery,t=require("shared/window_manager"),i=require("view/selector").WithServerCallMessageMixin;exports.AskSelector=i.extend({onLoad:function(){var e=this;e._super.apply(e,arguments);e.questionMarkInserted=false;e.$headerNav=e.parent().$("#@nav");e.$contentWrapper=$(".ContentWrapper");e.$id("@ask_button").click(function(t){e.addQuestion()});e.$input.focus(function(t){e.$headerNav.fadeTo(400,.4)});e.$input.blur(function(t){
e.$headerNav.fadeTo(400,1);e.$contentWrapper.fadeTo(400,1)});if(e.$input.val().length>0){e.$input.focus();e.updateResults()}},addQuestion:function(){var e=this;if(e.hasPendingServerCall()){return}e.makeServerCall(e.serverCall("add_question").kwargs({input_text:e.query}))},maybeInsertQuestionMark:function(){if(this.query==="?"&&this.questionMarkInserted){this.setQuery("");this.questionMarkInserted=false;return}if(!this.query){this.questionMarkInserted=false;return}if(this.questionMarkInserted){return}if(this.query.match(/[?]$/)===null){this.questionMarkInserted=true;this.setQuery(this.query+"?")}},queryDidChange:function(){this._super.apply(this,arguments);this.maybeInsertQuestionMark()},resultsDidChange:function(){var e=this.child("results").numResults>0?.4:1;this.$contentWrapper.fadeTo(400,e)},resultWasSelected:function(e){switch(e.ty){case"question":t.navigateTo(e.data.url);break;case"ask_question":this.addQuestion();break}},updateServerMessage:function(e,i){if(e){if(i["url"]){t.navigateTo(i["url"]);
}}else{if(i&&i["message"]){this.$id("@server_message_title").text(i["message"]["title"]);if(i["message"]["note"]){this.$id("@server_message_note").text(i["message"]["note"])}return true}}return false}})});define("app/view/board",["shared/polyfills","webnode2","shared/cookies"],function st(require,exports,e){var t=require("webnode2").Component,i=require("shared/cookies");exports.BoardNameLink=t.extend({onLoad:function(e){var t=this;this.$id("@link").mousedown(function(){i.setQfeedLog(t,"BoardClickthrough");i.setQueryLog(t,"BoardClickthrough")})}})});define("app/view/board/blog",["shared/polyfills","webnode2","interface/jquery"],function ot(require,exports,e){var t=require("webnode2").Component,$=require("interface/jquery")._jQuery;exports.CreateBlog=t.extend({onLoad:function(){var e=this;this.submitted=false;this.$id("@name").focus();this.$id("@fake_editor").click(function(){e.$id("@fake_editor_row").hide();e.$id("@editor_row").show();e.child("editor").focus();return false});this.$id("@create").click(function(){
var t=$.trim(e.$id("@name").val());var i=e.child("subdomain").getInput().val();if(!t){e.$id("@name").addClass("input_validation_error");e.$id("@name").focus()}else{e.$id("@name").removeClass("input_validation_error")}if(!i){e.child("subdomain").getInput().addClass("input_validation_error");if(t){e.child("subdomain").getInput().focus()}}else{e.child("subdomain").getInput().removeClass("input_validation_error")}if(i&&t&&e.child("subdomain").urlIsOK&&!e.submitted){e.$id("@create").addClass("submit_button_disabled");e.submitted=true;var n=e.child("editor").serialize();e.disable();e.serverCall("create").kwargs({name:t,description:n,url:i,topics:""}).success(function(e){if(e){document.location=e}}).liveMutate().send()}return false})},disable:function(){this.child("editor").disable()}})});define("app/view/board/create_box",["shared/polyfills","webnode2","w2.dialog","facebook","view/inline_editor","view/selector"],function rt(require,exports,e){var t=require("webnode2").Component,i=require("webnode2"),n=require("w2.dialog").Dialog,s=require("facebook"),o=require("view/inline_editor").InlineEditor,r=require("view/selector").MultiSelector;
exports.BoardCreatePostBox=t.extend({onLoad:function(){var e=this.child("title_box");var t=this.child("editor");e.whenOnLoaded(function(){e.setMeaningfulChangeCallback(function(){t.save_draft(false)})});t.whenOnLoaded(function(){t.setTitleBox(e)})}});exports.BoardCreatePostTitleBox=t.extend({onLoad:function(){this.editor=this.child("title_editor");var e=this;this.$id("@fake_editor").click(function(){e.toggle_editor();return false})},isOnlyWhiteSpace:function(){return this.editor.isOnlyWhiteSpace()},disableEditor:function(){this.editor.disable()},clearEditor:function(){this.editor.clear()},serialize:function(){return this.editor.serialize()},setMeaningfulChangeCallback:function(e){this.editor.setMeaningfulChangeCallback(e)},toggle_editor:function(){this.$id("@fake_editor_row").hide();this.$id("@editor_row").show();this.$id("@editor_row .qtext_editor_content").focus()},titleRequired:function(){this.$id("@title_required").show()},titleRequiredReset:function(){this.$id("@title_required").hide();
}});exports.CreateBoardPostEditor=o.extend({onLoad:function(){var e=this;this._super.apply(this,arguments);this.$id("@remove_via").click(function(){e.$id("@via_text").hide();e.$id("@via").remove();return false});this.seenUrls={};this.$id("@fake_editor").click(this.showEditor.bind(this));if(this.saved_seen_urls){for(var t=0;t<this.saved_seen_urls.length;t++){this.seenUrls[this.saved_seen_urls[t]]=true}}this.titleBox=null;var i=this.child("topic_selector");if(i){i.whenOnSavedResultsChanged(function(t){e._topics=t})}},setTitleBox:function(e){this.titleBox=e},showEditor:function(){this.$id("@content").show();this.editor.focus()},submitHandler:function(){var e=this;this.input_button_obj.click(function(){if(!e.editor.isOnlyWhiteSpace()||(e.preview!==null||e.id)){if(e.titleBox){e.titleBox.titleRequiredReset();if(e.titleBox.isOnlyWhiteSpace()){e.titleBox.toggle_editor();e.titleBox.titleRequired();return false}e.titleBox.disableEditor()}e.editor.disable();e.trigger_request()}return false})},removeUrl:function(){
this.$id("@preview_url").html("");this.$id("@preview_url_section, #@link_editor_buttons").hide();this.$id("@remove_url").hide();this.preview=null;this.editor.focus()},reset:function(){if(this.titleBox){this.titleBox.clearEditor()}this.editor.enable();this.editor.clear(true);this.$id("@preview_url_section, #@link_editor_buttons").hide();this.$id("@remove_url").hide();this.seenUrls={};this.removeUrl();if(this.draft_space){this.draft_space.draft_id=null}if(!this.is_submission){this.parent().reset()}},cancelEditor:function(){if(this.canSaveDraft()&&this.draft_space.draft_id!==null){this.save_draft(false)}this.closeDialog()},reportSuccess:function(){},ajax_callback:function(e){if(this.redirect_on_post&&e){document.location=e}else if(this.is_dialog){this.reportSuccess();this.closeDialog();return}else{this.reset()}},closeDialog:function(){n.dialogFor(this).close_()},getBid:function(){return this.bid?this.bid:null},getBoardName:function(){return null},getVia:function(){return this.$id("@via")?this.$id("@via").val():null;
},getIsSubmission:function(){return this.is_submission},setIsSubmission:function(e){this.is_submission=e},getLinkURL:function(){var e=this.getLinkPreview();if(e){return e.url}return null},getLinkPreview:function(){if(this.preview){return this.child("link_editor").getPreviewLinkInfo()}return null},getTitle:function(){if(!this.titleBox){return null}return this.titleBox.serialize()},getSeenUrlsAsArray:function(){var e=[];for(var t in this.seenUrls){e.push(t)}return e},getLoggedAction:function(){return"PostAdd"},canSaveDraft:function(){return this.draft_space&&!this.save_draft_disabled},enableSaveDraft:function(){this.save_draft_disabled=false},disableSaveDraft:function(){this.save_draft_disabled=true},onClearDraft:function(){this.reset()},save_draft:function(e){var t=this;if(!this.canSaveDraft()){return}this.disableSaveDraft();var n=e?"save_draft":"save_draft_auto";var s=this._get_kwargs();s.window_id=i.windowId;s.target=this.target;s.url=this.url;s.seen_urls=this.getSeenUrlsAsArray();var o=this.serverCall(n).kwargs(s).success(function(e){
t.enableSaveDraft();if(t.draft_space&&t.draft_space.draft_id!=e){t.draft_space.draft_id=e}t.updateSavedState(s.description)}).error(this.enableSaveDraft.bind(this));if(e){o.liveMutate()}o.send()},_get_kwargs:function(){return{draft_space:this.draft_space,bid:this.getBid(),object_id:this.id,name:this.getBoardName(),description:this.get_value(),title:this.getTitle(),link_url:this.getLinkURL(),preview:this.getLinkPreview(),via:this.getVia(),topics:this._topics||[],is_submission:this.getIsSubmission(),fb_uid:s.getFbUid(),fb_access_token:s.getAccessToken(),fb_expires:s.getExpiresIn()}}});exports.BoardTopicMultiSelector=r.extend({whenOnSavedResultsChanged:function(e){this._onSavedResultsChanged=e},onSavedResultsChanged:function(){if(this._onSavedResultsChanged){this._onSavedResultsChanged(this.saved_results)}}})});define("app/view/board/follow_invite",["shared/polyfills","webnode2","settings"],function at(require,exports,e){var t=require("webnode2").Component,i=require("settings").interface_strings;
exports.FollowInviteEmailButton=t.extend({onLoad:function(){var e=this;this.$id("@invite").click(function(){e.setEmailTo(e.email);return false})},setEmailTo:function(e){var t=this;this._dialog=this.dialog().title(null).cancel(null,i.cancel).ok(function(i){var n=i.dialogComponent;var s=n.getMessage();var o=n.getSubject();var r=n.name;t.serverCall("invite_to_follow").kwargs({name:r,email:e,msg:s,subject:o}).liveMutate().success(function(){t._dialog.close_()}).send()},this.invite_text).load("invite_dialog",{kwargs:{email:e}})}});exports.InviteToFollowDialogContents=t.extend({onLoad:function(){this.child("msg").focus()},getMessage:function(){return this.child("msg").serialize()},getSubject:function(){return this.child("subject").serialize()}})});define("app/view/board/view_tracker",["shared/polyfills","webnode2","shared/core/component","interface/jquery","shared/viewport"],function dt(require,exports,e){var t=require("webnode2").Component,i=require("shared/core/component"),$=require("interface/jquery")._jQuery,n=require("shared/viewport");
exports.instance=null;exports.BoardItemViewTracker=t.extend({init:function(){exports.instance=this;this.all_board_item_ids={};this.reported_board_item_ids={};this.last_report_time=+new Date;this.rate_limit_ms=3e3},onLoad:function(){var e=this.report.bind(this);document.addEventListener("mousemove",e);document.addEventListener("keypress",e);document.addEventListener("scroll",e)},addBoardItem:function(e,t){this.all_board_item_ids[e]=t},removeBoardItem:function(e,t){delete this.all_board_item_ids[e]},isBoardItemVisible:function(e){var t=i._domids[e];if(!t){return false}var s=document.getElementById(t);if(!s){return false}var o=$(s);if(n.isElementInViewport(o.children("div:first").get(0))){return false}if(!o.is(":visible")){return false}return true},report:function(){var e=+new Date;if(e<this.last_report_time+this.rate_limit_ms){return}this.last_report_time=e;var t=[];for(var i in this.all_board_item_ids){var n=this.all_board_item_ids[i];if(this.reported_board_item_ids[n]===undefined){if(this.isBoardItemVisible(i)){
t.push(n);this.reported_board_item_ids[n]=true}}}if(t.length>0){this.serverCall("report").kwargs({board_item_ids:t}).send()}}})});define("app/view/board/item",["shared/polyfills","webnode2","shared/cookies","app/view/board/view_tracker","view/inline_editor","shared/views"],function lt(require,exports,e){var t=require("webnode2").Component,i=require("shared/cookies"),n=require("app/view/board/view_tracker"),s=require("view/inline_editor").InlineEditor,o=require("shared/views").viewsLogger;exports.BoardItemTimestamp=t.extend({onLoad:function(e){var t=this;t.$id("@link").mousedown(function(){i.setQfeedLog(t,"BoardItemClickthrough");i.setQueryLog(t,"BoardItemClickthrough")})}});exports.BoardItemTitle=t.extend({onLoad:function(e){var t=this;t.$id("@link").mousedown(function(){i.setQfeedLog(t,"BoardItemClickthrough");i.setQueryLog(t,"BoardItemClickthrough")})}});exports.LinkBoardItemView=t.extend({onLoad:function(){this._super.apply(this,arguments);var e=this;e.$id("@edit").click(function(){e.showEditor();
return false});e.$id("@item").hover(function(t){e.$id("@item").addClass("hover")},function(t){e.$id("@item").removeClass("hover")})},showEditor:function(){this.child("description").child("editor").toggle_editor()}});exports.LinkBoardItemDescriptionInlineEditor=s.extend({_get_kwargs:function(){return{input:this.get_value(),preview:this.child("link_editor").getPreviewLinkInfo()}}});exports.BoardListItem=t.extend({onLoad:function(){if(n.instance){n.instance.addBoardItem(this.cid,this.board_item_id)}},onUnload:function(){if(n.instance){n.instance.removeBoardItem(this.cid,this.board_item_id)}}});exports.BoardItem=t.extend({onLoad:function(){o.addComponentToTrack(this)}})});define("app/view/board/settings",["shared/polyfills","webnode2","view/selector"],function ct(require,exports,e){var t=require("webnode2").Component,i=require("view/selector").Selector;exports.BlogSubdomainInput=t.extend({onLoad:function(){var e=this;this.urlIsOK=false;this.$id("@url").bind("keyup",function(t){e.checkURL()});
this.$id("@update").click(function(){e.updateURL();return false})},checkURL:function(){var e=this;var t=this.$id("@url").val();this.serverCall("check_url").kwargs({url:t}).success(function(t){if(t===true){e.urlAvailable()}else if(t===false){e.urlNotAvailable()}else{e.urlEmpty()}}).error(this.urlNotAvailable.bind(this)).send()},getInput:function(){return this.$id("@url")},urlEmpty:function(){this.urlAvailable();this.urlIsOK=false;if(this.bid){this.$id("@button").hide()}},urlAvailable:function(){this.urlIsOK=true;this.$id("@domain_unavailable").hide();this.$id("@url").removeClass("input_validation_error");if(this.bid){this.$id("@button").show()}},urlNotAvailable:function(){this.urlIsOK=false;this.$id("@domain_unavailable").show();this.$id("@url").addClass("input_validation_error");if(this.bid){this.$id("@button").hide()}},updateURL:function(){var e=this.$id("@url").val();if(e){this.serverCall("register_choice").kwargs({url:e}).success(function(){window.location.reload(true)}).liveMutate().send();
}return false}});exports.BoardParticipantSelector=i.extend({resultWasSelected:function(e){var t=this;this.serverCall("add").kwargs({bid:this.metadata.bid,target_uid:e.data.uid}).success(function(){t.setQuery("");t.focus()}).liveMutate().send()}})});define("app/view/board/submission",["shared/polyfills","webnode2","settings"],function ut(require,exports,e){var t=require("webnode2").Component,i=require("settings").interface_strings;exports.RejectSubmission=t.extend({onLoad:function(){var e=this;this.$id("@link").click(function(){e._dialog=e.dialog().title(e.title).cancel(null,i.cancel).ok(function(t){var i=t.dialogComponent;var n=i.child("comment").serialize();e.serverCall("reject").kwargs({comment:n}).liveMutate().send()},e.button_text).load("comment_dialog");return false})}});exports.SubmissionView=t.extend({onLoad:function(e){var t=this;this.$id("@item").hover(function(e){t.$id("@delete").show();t.$id("@item").addClass("hover")},function(e){t.$id("@delete").hide();t.$id("@item").removeClass("hover");
});this.$id("@update_accept").click(function(){t.request("update_accept");return false});this.$id("@update").click(function(){t.request("update");return false});this.$id("@edit").click(function(){t.toggle();return false});this.$id("@cancel").click(function(){t.toggle();return false})},getNewPreview:function(){return null},request:function(e){var t=this.child("description").serialize();var i=this.child("title").serialize();var n=this.getNewPreview();this.serverCall(e).kwargs({new_description:t,new_title:i,new_preview:n}).liveMutate().send()},toggle:function(){this.$id("@editor").toggle();this.$id("@content").toggle()}});exports.RejectSubmissionDialogContents=t.extend({onLoad:function(){var e=this;this.$id("@link").click(function(){e.$id("@comment").toggle();e.child("comment").focus();return false})}})});define("shared/upload",["shared/polyfills","settings"],function ht(require,exports,e){var t=require("settings");exports.uploadData=function(e,i,n,s){var o=new window.FormData;o.append("formkey",t.formkey);
var r=Object.keys(e);for(var a=0;a<r.length;a++){o.append(r[a],e[r[a]])}for(var d=0;d<i.length;d++){o.append("file",i[d])}var l=new XMLHttpRequest;l.onreadystatechange=function(){if(l.readyState!=4){return}if(l.status!=200){s()}var e=JSON.parse(l.response);if(e.success){n(e)}else{s(e)}};l.open("POST","/_/imgupload/upload_POST",true);l.send(o)}});define("view/upload",["shared/polyfills","webnode2","w2.dialog","interface/jquery","shared/events/index","shared/browser","shared/upload","shared/facebook","shared/loading"],function ft(require,exports,e){var t=require("webnode2").Component,i=require("w2.dialog").Dialog,$=require("interface/jquery")._jQuery,n=require("shared/events/index"),s=require("shared/browser"),o=require("shared/upload"),r=require("shared/facebook"),a=require("shared/loading");var d=s.msie&&s.version<=9;exports.UploadDialogContents=t.extend({onLoad:function(){var e=this;this.child("upload_form").success(this.uploadSuccess.bind(this)).failure(this.uploadFailure.bind(this));if(d){
this.$id("@drop_zone").removeClass("drop_zone");this.child("drag_and_drop_form").$id("@drag_and_drop_form").addClass("hidden");return false}this.inlineUploadForm=this.child("upload_web");if(this.inlineUploadForm){this.inlineUploadForm.setContentForTarget(this.$id("@iframe"));this.inlineUploadForm.setShowPhotoChoiceCallback(function(){e.disableDropZone();e.onShowInlinePhotoChoice()})}this.handleEvent(n.Types.UPLOAD_DIALOG_DROPZONE,function(t){if(t.payload.enabled){e.enableDropZone()}else{e.disableDropZone()}});if(this.child("drag_and_drop_form")){e.addBodyDragoverListener();var t=function(t){t.stopPropagation();t.preventDefault();t.originalEvent.dataTransfer.dropEffect="copy";e.child("drag_and_drop_form").$id("@form_title").addClass("drag_and_hover");e.$id("@drop_zone").addClass("drag_and_hover")};var i=function(t){t.stopPropagation();t.preventDefault();e.child("drag_and_drop_form").$id("@form_title").removeClass("drag_and_hover");e.$id("@drop_zone").removeClass("drag_and_hover")};this.child("drag_and_drop_form").setDropZone(this.$id("@drop_zone"),t,i);
this.child("drag_and_drop_form").success(this.uploadSuccess.bind(this)).failure(this.uploadFailure.bind(this))}},disableDropZone:function(){this.$id("@drop_zone").addClass("disabled");this.child("drag_and_drop_form").$id("@form_title").addClass("disabled")},enableDropZone:function(){this.$id("@drop_zone").removeClass("disabled");this.child("drag_and_drop_form").$id("@form_title").remove("disabled")},onUnload:function(){this.removeBodyDragoverListener()},removeBodyDragoverListener:function(){$("document, body").unbind(".uploadDialog")},addBodyDragoverListener:function(){$("document, body").bind({"dragenter.uploadDialog":function(e){e.stopPropagation();e.preventDefault();var t=e.originalEvent.dataTransfer;t.effectAllowed=t.dropEffect="none"},"dragover.uploadDialog":function(e){e.stopPropagation();e.preventDefault();var t=e.originalEvent.dataTransfer;t.effectAllowed=t.dropEffect="none"}})},uploadSuccess:function(){},uploadFailure:function(){$(".drop_zone").removeClass("drag_and_hover");this.child("drag_and_drop_form").$id("@form_title").removeClass("drag_and_hover");
this.child("upload_form").hideSpinner()},onShowInlinePhotoChoice:function(){this.child("drag_and_drop_form").$id("@form_title").text(this.click_best_text);this.child("drag_and_drop_form").$("h3").removeClass("drag_and_hover");this.$id("@drop_zone").removeClass("drag_and_hover")}});exports.UploadBaseForm=t.extend({onUpload:function(e){if(e&&!e.success){if(e.message){alert(e.message)}if(this._failureCallback){this._failureCallback(e)}return}if(this._successCallback){this._successCallback(e)}},success:function(e){this._successCallback=e;return this},failure:function(e){this._failureCallback=e;return this},_uploadFiles:function(e){var t=this,i=this.$id("@form").get(0);if(d){$(document).one("quora_file_upload",function(e,i){t.onUpload(i)});i.submit();return}var n={};$.each(i,function(e,t){if(t.type=="hidden"){n[t.name]=t.value}});var s=this.onUpload.bind(this);o.uploadData(n,e,s,s)}});exports.UploadFileForm=exports.UploadBaseForm.extend({onLoad:function(){this._super.apply(this,arguments);var e=this;
e.file_input=e.$id("@file");e.file_button=e.$id("@file_button");e.shouldShowUploadButton=!d&&e.file_button.length;e.$id("@upload_spinner").append(a.createLoadingDotsElement());this.handleEvent(n.Types.UPLOAD_DIALOG_LOADING_STATE,function(t){if(t.payload.state=="loading"){e.showSpinner()}else{e.hideSpinner()}});e.file_input.on("change",function(){var t=e.$id("@file")[0].files;e.showSpinner();e._uploadFiles(t)});e.file_button.on("click",function(){e.file_input.click()});e._showInput()},_showInput:function(){if(this.shouldShowUploadButton){this.file_input.addClass("hidden");this.file_button.removeClass("hidden")}else{this.file_button.addClass("hidden");this.file_input.removeClass("hidden")}},_hideInput:function(){this.file_button.addClass("hidden");this.file_input.addClass("hidden")},showSpinner:function(){this._hideInput();this.$id("@upload_spinner").removeClass("hidden");this.emitEvent({type:n.Types.UPLOAD_DIALOG_DROPZONE,payload:{enabled:false}})},hideSpinner:function(){this.$id("@upload_spinner").addClass("hidden");
this._showInput();this.emitEvent({type:n.Types.UPLOAD_DIALOG_DROPZONE,payload:{enabled:true}})}});exports.DragAndDropForm=exports.UploadBaseForm.extend({setDropZone:function(e,t,i){this.dropZoneElement=e;this.dropZoneElement.bind("dragover",t);this.dropZoneElement.bind("dragleave",i);this.addDropEventListener()},addDropEventListener:function(){if(this.dropZoneElement){this.onDropListener=this.onDrop.bind(this);this.dropZoneElement[0].addEventListener("drop",this.onDropListener,false)}},removeDropEventListener:function(){if(this.dropZoneElement){this.dropZoneElement[0].removeEventListener("drop",this.onDropListener)}},onUnload:function(){this.removeDropEventListener()},onDrop:function(e){if(e&&e.dataTransfer){e.stopPropagation();e.preventDefault();this.emitEvent({type:n.Types.UPLOAD_DIALOG_LOADING_STATE,payload:{state:"loading"}});this._uploadFiles(e.dataTransfer.files)}}});exports.EditPhotoDialogContents=exports.UploadDialogContents.extend({onLoad:function(){this._super.apply(this,arguments);
this.$id("@from_facebook").on("click",this.fetchFacebookPicture.bind(this));var e=this;e.addBodyDragoverListener();var t=function(t){t.stopPropagation();t.preventDefault();t.originalEvent.dataTransfer.dropEffect="copy";e.child("drag_and_drop_form").$id("@form_title").addClass("drag_and_hover");e.$id("@drop_zone").addClass("drag_and_hover")};var i=function(t){t.stopPropagation();t.preventDefault();e.child("drag_and_drop_form").$id("@form_title").removeClass("drag_and_hover");e.$id("@drop_zone").removeClass("drag_and_hover")};this.child("drag_and_drop_form").setDropZone(this.$id("@drop_zone"),t,i);this.child("drag_and_drop_form").success(this.uploadSuccess.bind(this));this.child("upload_form").success(this.uploadSuccess.bind(this));return false},fetchFacebookPicture:function(){if(!this.fb_uid){return}var e=this;r.onInit(function(){window.FB.api("/me/picture?type=large",function(t){var i=t.data;if(i.url){e.$id("@web_upload").addClass("hidden");e.$id("@from_facebook").addClass("hidden");e.child("upload_web").$id("@url").addClass("hidden").val(i.url);
e.child("upload_web").$id("@download").click();e.$id("@web_upload").removeClass("hidden")}else{alert(e.no_fb_picture_error)}})})},uploadSuccess:function(e){if(e.need_thumb_selection){this.serverCall("upload").kwargs({target_id:this.target_id,target:this.target}).contentFor(this.$id("@iframe"),{parentCid:this.cid}).success(this.onShowInlinePhotoChoice.bind(this)).send()}else{i.dialogFor(this).close_()}}})});define("app/view/bug_report",["shared/polyfills","webnode2","interface/jquery","view/modal","view/upload"],function pt(require,exports,e){var t=require("webnode2").Component,$=require("interface/jquery")._jQuery,i=require("view/modal").Base,n=require("view/upload");exports.BugReportModalLink=t.extend({onLoad:function(){var e=this;this.$("#@send_feedback").on("click",function(t){e.modal("load_inner");t.preventDefault()})}});exports.BugReportModal=i.extend({onLoad:function(){var e=this;this.child("upload_form").success(this.uploadSuccess.bind(this)).failure(this.uploadFailure.bind(this));
this.$("#@editor").focus();this.$("#@close_button").click(function(){e._closeModal()});this.$("#@cancel_button").click(function(){e._closeModal()});this.$("#@submit_button").click(function(t){t.preventDefault();var i=e.$("#@editor").val().trim();var n=e.$("#@photo_key").val();e.serverCall("submit_feedback").kwargs({target:e.target,msg:i,photo_key:n}).success(function(){if(i){e._closeModal()}}).sendOnlyOnce();return false})},uploadSuccess:function(e){this.$("#@photo_key").val(e.photo_key);this.serverCall("upload").kwargs({photo_key:e.photo_key,target:this.target}).contentFor(this.$("#@iframe"),{parentCid:this.cid}).send()},uploadFailure:function(){$(".drop_zone").removeClass("drag_and_hover");this.child("drag_and_drop_form").$("#@form_title").removeClass("drag_and_hover");this.child("upload_form").hideSpinner()}});exports.BugReportMain=n.UploadDialogContents.extend({onLoad:function(){this._super.apply(this,arguments);var e=this;this.$id("@submit_report").click(function(t){t.preventDefault();
e.$id("@submit_report").attr("disabled",true);var i=e.$id("@subject").val();var n=e.$id("@description").val();var s=e.$id("@photo_key").val();var o=e.$id("@project").val();var r=e.$id("@priorities").val();var a;if(o===e.$id("@queue_project").val()){a=$.map(e.$id("@select_queues input:checked"),function(e){return e.value})}else{a=null}e.serverCall("submit_report").kwargs({target:e.target,subject:i,description:n,photo_key:s,project:o,priority:r,queue_types:a}).success(function(e){window.location.reload()}).sendOnlyOnce();return false});this.$id("@project").change(function(t){var i=e.$id("@select_queues");if($(this).val()===e.$id("@queue_project").val()){i.show()}else{i.hide()}})},uploadSuccess:function(e){this.$id("@photo_key").val(e.photo_key);this.serverCall("upload").kwargs({photo_key:e.photo_key,target:this.target}).contentFor(this.$id("@upload_screenshot"),{parentCid:this.cid}).send()}});exports.BugReportTableCell=t.extend({onLoad:function(){var e=this;this.$id("@delete_report").click(function(t){
e.serverCall("delete_report").kwargs({report_id:e.report_id}).success(function(e){window.location.reload()}).send();return false})}})});define("app/view/comment",["shared/polyfills","webnode2","shared/logging"],function gt(require,exports,e){var t=require("webnode2").Component,i=require("shared/logging");exports.CommentLink=t.extend({onLoad:function(){var e=this,t=e.$id("@view_comment_link");e.hasCheckedTriggeringModal=false;t.on("click",function(t){i.log("comments_toggled",{comment_type:e.comment_type,object_id:e.object_id})})},maybeTriggerModal:function(){var e=this;if(!e.is_logged_in){return}if(e.type==="board_item_id"||e.hasCheckedTriggeringModal){return}e.hasCheckedTriggeringModal=true;e.serverCall("should_trigger_warning_modal").success(function(t){if(t){e.triggerModal()}}).send()},triggerModal:function(){this.modal("load_modal");this.serverCall("mark_education_modal_seen").send()}})});define("third_party/prettify",["shared/polyfills"],function mt(require,exports,e){!function(){var e=null;
window.PR_SHOULD_USE_CONTINUATION=!0;(function(){function t(e){function t(e){var t=e.charCodeAt(0);if(t!==92)return t;var i=e.charAt(1);return(t=u[i])?t:"0"<=i&&i<="7"?parseInt(e.substring(1),8):i==="u"||i==="x"?parseInt(e.substring(2),16):e.charCodeAt(1)}function i(e){if(e<32)return(e<16?"\\x0":"\\x")+e.toString(16);e=String.fromCharCode(e);return e==="\\"||e==="-"||e==="]"||e==="^"?"\\"+e:e}function n(e){var n=e.substring(1,e.length-1).match(/\\u[\dA-Fa-f]{4}|\\x[\dA-Fa-f]{2}|\\[0-3][0-7]{0,2}|\\[0-7]{1,2}|\\[\S\s]|[^\\]/g),e=[],s=n[0]==="^",o=["["];s&&o.push("^");for(var s=s?1:0,r=n.length;s<r;++s){var a=n[s];if(/\\[bdsw]/i.test(a))o.push(a);else{var a=t(a),d;s+2<r&&"-"===n[s+1]?(d=t(n[s+2]),s+=2):d=a;e.push([a,d]);d<65||a>122||(d<65||a>90||e.push([Math.max(65,a)|32,Math.min(d,90)|32]),d<97||a>122||e.push([Math.max(97,a)&-33,Math.min(d,122)&-33]))}}e.sort(function(e,t){return e[0]-t[0]||t[1]-e[1]});n=[];r=[];for(s=0;s<e.length;++s)a=e[s],a[0]<=r[1]+1?r[1]=Math.max(r[1],a[1]):n.push(r=a);
for(s=0;s<n.length;++s)a=n[s],o.push(i(a[0])),a[1]>a[0]&&(a[1]+1>a[0]&&o.push("-"),o.push(i(a[1])));o.push("]");return o.join("")}function s(e){for(var t=e.source.match(/\[(?:[^\\\]]|\\[\S\s])*]|\\u[\dA-Fa-f]{4}|\\x[\dA-Fa-f]{2}|\\\d+|\\[^\dux]|\(\?[!:=]|[()^]|[^()[\\^]+/g),s=t.length,a=[],d=0,l=0;d<s;++d){var c=t[d];c==="("?++l:"\\"===c.charAt(0)&&(c=+c.substring(1))&&(c<=l?a[c]=-1:t[d]=i(c))}for(d=1;d<a.length;++d)-1===a[d]&&(a[d]=++o);for(l=d=0;d<s;++d)c=t[d],c==="("?(++l,a[l]||(t[d]="(?:")):"\\"===c.charAt(0)&&(c=+c.substring(1))&&c<=l&&(t[d]="\\"+a[c]);for(d=0;d<s;++d)"^"===t[d]&&"^"!==t[d+1]&&(t[d]="");if(e.ignoreCase&&r)for(d=0;d<s;++d)c=t[d],e=c.charAt(0),c.length>=2&&e==="["?t[d]=n(c):e!=="\\"&&(t[d]=c.replace(/[A-Za-z]/g,function(e){e=e.charCodeAt(0);return"["+String.fromCharCode(e&-33,e|32)+"]"}));return t.join("")}for(var o=0,r=!1,a=!1,d=0,l=e.length;d<l;++d){var c=e[d];if(c.ignoreCase)a=!0;else if(/[a-z]/i.test(c.source.replace(/\\u[\da-f]{4}|\\x[\da-f]{2}|\\[^UXux]/gi,""))){
r=!0;a=!1;break}}for(var u={b:8,t:9,n:10,v:11,f:12,r:13},h=[],d=0,l=e.length;d<l;++d){c=e[d];if(c.global||c.multiline)throw Error(""+c);h.push("(?:"+s(c)+")")}return RegExp(h.join("|"),a?"gi":"g")}function i(e,t){function i(e){var d=e.nodeType;if(d==1){if(!n.test(e.className)){for(d=e.firstChild;d;d=d.nextSibling)i(d);d=e.nodeName.toLowerCase();if("br"===d||"li"===d)s[a]="\n",r[a<<1]=o++,r[a++<<1|1]=e}}else if(d==3||d==4)d=e.nodeValue,d.length&&(d=t?d.replace(/\r\n?/g,"\n"):d.replace(/[\t\n\r ]+/g," "),s[a]=d,r[a<<1]=o,o+=d.length,r[a++<<1|1]=e)}var n=/(?:^|\s)nocode(?:\s|$)/,s=[],o=0,r=[],a=0;i(e);return{a:s.join("").replace(/\n$/,""),d:r}}function n(e,t,i,n){t&&(e={a:t,e:e},i(e),n.push.apply(n,e.g))}function s(e){for(var t=void 0,i=e.firstChild;i;i=i.nextSibling)var n=i.nodeType,t=n===1?t?e:i:n===3?y.test(i.nodeValue)?e:t:t;return t===e?void 0:t}function o(i,s){function o(e){for(var t=e.e,i=[t,"pln"],c=0,u=e.a.match(a)||[],h={},f=0,p=u.length;f<p;++f){var g=u[f],m=h[g],v=void 0,_;if(typeof m==="string")_=!1;else{
var w=r[g.charAt(0)];if(w)v=g.match(w[1]),m=w[0];else{for(_=0;_<d;++_)if(w=s[_],v=g.match(w[1])){m=w[0];break}v||(m="pln")}if((_=m.length>=5&&"lang-"===m.substring(0,5))&&!(v&&typeof v[1]==="string"))_=!1,m="src";_||(h[g]=m)}w=c;c+=g.length;if(_){_=v[1];var b=g.indexOf(_),y=b+_.length;v[2]&&(y=g.length-v[2].length,b=y-_.length);m=m.substring(5);n(t+w,g.substring(0,b),o,i);n(t+w+b,_,l(m,_),i);n(t+w+y,g.substring(y),o,i)}else i.push(t+w,m)}e.g=i}var r={},a;(function(){for(var n=i.concat(s),o=[],d={},l=0,c=n.length;l<c;++l){var u=n[l],h=u[3];if(h)for(var f=h.length;--f>=0;)r[h.charAt(f)]=u;u=u[1];h=""+u;d.hasOwnProperty(h)||(o.push(u),d[h]=e)}o.push(/[\S\s]/);a=t(o)})();var d=s.length;return o}function r(t){var i=[],n=[];t.tripleQuotedStrings?i.push(["str",/^(?:'''(?:[^'\\]|\\[\S\s]|''?(?=[^']))*(?:'''|$)|"""(?:[^"\\]|\\[\S\s]|""?(?=[^"]))*(?:"""|$)|'(?:[^'\\]|\\[\S\s])*(?:'|$)|"(?:[^"\\]|\\[\S\s])*(?:"|$))/,e,"'\""]):t.multiLineStrings?i.push(["str",/^(?:'(?:[^'\\]|\\[\S\s])*(?:'|$)|"(?:[^"\\]|\\[\S\s])*(?:"|$)|`(?:[^\\`]|\\[\S\s])*(?:`|$))/,e,"'\"`"]):i.push(["str",/^(?:'(?:[^\n\r'\\]|\\.)*(?:'|$)|"(?:[^\n\r"\\]|\\.)*(?:"|$))/,e,"\"'"]);
t.verbatimStrings&&n.push(["str",/^@"(?:[^"]|"")*(?:"|$)/,e]);var s=t.hashComments;s&&(t.cStyleComments?(s>1?i.push(["com",/^#(?:##(?:[^#]|#(?!##))*(?:###|$)|.*)/,e,"#"]):i.push(["com",/^#(?:(?:define|e(?:l|nd)if|else|error|ifn?def|include|line|pragma|undef|warning)\b|[^\n\r]*)/,e,"#"]),n.push(["str",/^<(?:(?:(?:\.\.\/)*|\/?)(?:[\w-]+(?:\/[\w-]+)+)?[\w-]+\.h(?:h|pp|\+\+)?|[a-z]\w*)>/,e])):i.push(["com",/^#[^\n\r]*/,e,"#"]));t.cStyleComments&&(n.push(["com",/^\/\/[^\n\r]*/,e]),n.push(["com",/^\/\*[\S\s]*?(?:\*\/|$)/,e]));if(s=t.regexLiterals){var r=(s=s>1?"":"\n\r")?".":"[\\S\\s]";n.push(["lang-regex",RegExp("^(?:^^\\.?|[+-]|[!=]=?=?|\\#|%=?|&&?=?|\\(|\\*=?|[+\\-]=|->|\\/=?|::?|<<?=?|>>?>?=?|,|;|\\?|@|\\[|~|{|\\^\\^?=?|\\|\\|?=?|break|case|continue|delete|do|else|finally|instanceof|return|throw|try|typeof)\\s*("+("/(?=[^/*"+s+"])(?:[^/\\x5B\\x5C"+s+"]|\\x5C"+r+"|\\x5B(?:[^\\x5C\\x5D"+s+"]|\\x5C"+r+")*(?:\\x5D|$))+/")+")")])}(s=t.types)&&n.push(["typ",s]);s=(""+t.keywords).replace(/^ | $/g,"");
s.length&&n.push(["kwd",RegExp("^(?:"+s.replace(/[\s,]+/g,"|")+")\\b"),e]);i.push(["pln",/^\s+/,e," \r\n	Â "]);s="^.[^\\s\\w.$@'\"`/\\\\]*";t.regexLiterals&&(s+="(?!s*/)");n.push(["lit",/^@[$_a-z][\w$@]*/i,e],["typ",/^(?:[@_]?[A-Z]+[a-z][\w$@]*|\w+_t\b)/,e],["pln",/^[$_a-z][\w$@]*/i,e],["lit",/^(?:0x[\da-f]+|(?:\d(?:_\d+)*\d*(?:\.\d*)?|\.\d\+)(?:e[+-]?\d+)?)[a-z]*/i,e,"0123456789"],["pln",/^\\[\S\s]?/,e],["pun",RegExp(s),e]);return o(i,n)}function a(e,t,i){function n(e){var t=e.nodeType;if(t==1&&!o.test(e.className))if("br"===e.nodeName)s(e),e.parentNode&&e.parentNode.removeChild(e);else for(e=e.firstChild;e;e=e.nextSibling)n(e);else if((t==3||t==4)&&i){var d=e.nodeValue,l=d.match(r);if(l)t=d.substring(0,l.index),e.nodeValue=t,(d=d.substring(l.index+l[0].length))&&e.parentNode.insertBefore(a.createTextNode(d),e.nextSibling),s(e),t||e.parentNode.removeChild(e)}}function s(e){function t(e,i){var n=i?e.cloneNode(!1):e,s=e.parentNode;if(s){var s=t(s,1),o=e.nextSibling;s.appendChild(n);for(var r=o;r;r=o)o=r.nextSibling,
s.appendChild(r)}return n}for(;!e.nextSibling;)if(e=e.parentNode,!e)return;for(var e=t(e.nextSibling,0),i;(i=e.parentNode)&&i.nodeType===1;)e=i;l.push(e)}for(var o=/(?:^|\s)nocode(?:\s|$)/,r=/\r\n?|\n/,a=e.ownerDocument,d=a.createElement("li");e.firstChild;)d.appendChild(e.firstChild);for(var l=[d],c=0;c<l.length;++c)n(l[c]);t===(t|0)&&l[0].setAttribute("value",t);var u=a.createElement("ol");u.className="linenums";for(var t=Math.max(0,t-1|0)||0,c=0,h=l.length;c<h;++c)d=l[c],d.className="L"+(c+t)%10,d.firstChild||d.appendChild(a.createTextNode("Â ")),u.appendChild(d);e.appendChild(u)}function d(e,t){for(var i=t.length;--i>=0;){var n=t[i];x.hasOwnProperty(n)?u.console&&console.warn("cannot override language handler %s",n):x[n]=e}}function l(e,t){if(!e||!x.hasOwnProperty(e))e=/^\s*</.test(t)?"default-markup":"default-code";return x[e]}function c(e){var t=e.h;try{var n=i(e.c,e.i),s=n.a;e.a=s;e.d=n.d;e.e=0;l(t,s)(e);var o=/\bMSIE\s(\d+)/.exec(navigator.userAgent),o=o&&+o[1]<=8,t=/\n/g,r=e.a,a=r.length,n=0,d=e.d,c=d.length,s=0,h=e.g,f=h.length,p=0;
h[f]=a;var g,m;for(m=g=0;m<f;)h[m]!==h[m+2]?(h[g++]=h[m++],h[g++]=h[m++]):m+=2;f=g;for(m=g=0;m<f;){for(var v=h[m],_=h[m+1],w=m+2;w+2<=f&&h[w+1]===_;)w+=2;h[g++]=v;h[g++]=_;m=w}h.length=g;var b=e.c,y;if(b)y=b.style.display,b.style.display="none";try{for(;s<c;){var C=d[s+2]||a,x=h[p+2]||a,w=Math.min(C,x),k=d[s+1],S;if(k.nodeType!==1&&(S=r.substring(n,w))){o&&(S=S.replace(t,"\r"));k.nodeValue=S;var E=k.ownerDocument,T=E.createElement("span");T.className=h[p+1];var L=k.parentNode;L.replaceChild(T,k);T.appendChild(k);n<C&&(d[s+1]=k=E.createTextNode(r.substring(w,C)),L.insertBefore(k,T.nextSibling))}n=w;n>=C&&(s+=2);n>=x&&(p+=2)}}finally{if(b)b.style.display=y}}catch(M){u.console&&console.log(M&&M.stack||M)}}var u=window,h=["break,continue,do,else,for,if,return,while"],f=[[h,"auto,case,char,const,default,double,enum,extern,float,goto,inline,int,long,register,short,signed,sizeof,static,struct,switch,typedef,union,unsigned,void,volatile"],"catch,class,delete,false,import,new,operator,private,protected,public,this,throw,true,try,typeof"],p=[f,"alignof,align_union,asm,axiom,bool,concept,concept_map,const_cast,constexpr,decltype,delegate,dynamic_cast,explicit,export,friend,generic,late_check,mutable,namespace,nullptr,property,reinterpret_cast,static_assert,static_cast,template,typeid,typename,using,virtual,where"],g=[f,"abstract,assert,boolean,byte,extends,final,finally,implements,import,instanceof,interface,null,native,package,strictfp,super,synchronized,throws,transient"],m=[f,"abstract,as,base,bool,by,byte,checked,decimal,delegate,descending,dynamic,event,finally,fixed,foreach,from,group,implicit,in,interface,internal,into,is,let,lock,null,object,out,override,orderby,params,partial,readonly,ref,sbyte,sealed,stackalloc,string,select,uint,ulong,unchecked,unsafe,ushort,var,virtual,where"],f=[f,"debugger,eval,export,function,get,null,set,undefined,var,with,Infinity,NaN"],v=[h,"and,as,assert,class,def,del,elif,except,exec,finally,from,global,import,in,is,lambda,nonlocal,not,or,pass,print,raise,try,with,yield,False,True,None"],_=[h,"alias,and,begin,case,class,def,defined,elsif,end,ensure,false,in,module,next,nil,not,or,redo,rescue,retry,self,super,then,true,undef,unless,until,when,yield,BEGIN,END"],w=[h,"as,assert,const,copy,drop,enum,extern,fail,false,fn,impl,let,log,loop,match,mod,move,mut,priv,pub,pure,ref,self,static,struct,true,trait,type,unsafe,use"],h=[h,"case,done,elif,esac,eval,fi,function,in,local,set,then,until"],b=/^(DIR|FILE|vector|(de|priority_)?queue|list|stack|(const_)?iterator|(multi)?(set|map)|bitset|u?(int|float)\d*)\b/,y=/\S/,C=r({
keywords:[p,m,f,"caller,delete,die,do,dump,elsif,eval,exit,foreach,for,goto,if,import,last,local,my,next,no,our,print,package,redo,require,sub,undef,unless,until,use,wantarray,while,BEGIN,END",v,_,h],hashComments:!0,cStyleComments:!0,multiLineStrings:!0,regexLiterals:!0}),x={};d(C,["default-code"]);d(o([],[["pln",/^[^<?]+/],["dec",/^<!\w[^>]*(?:>|$)/],["com",/^<\!--[\S\s]*?(?:--\>|$)/],["lang-",/^<\?([\S\s]+?)(?:\?>|$)/],["lang-",/^<%([\S\s]+?)(?:%>|$)/],["pun",/^(?:<[%?]|[%?]>)/],["lang-",/^<xmp\b[^>]*>([\S\s]+?)<\/xmp\b[^>]*>/i],["lang-js",/^<script\b[^>]*>([\S\s]*?)(<\/script\b[^>]*>)/i],["lang-css",/^<style\b[^>]*>([\S\s]*?)(<\/style\b[^>]*>)/i],["lang-in.tag",/^(<\/?[a-z][^<>]*>)/i]]),["default-markup","htm","html","mxml","xhtml","xml","xsl"]);d(o([["pln",/^\s+/,e," 	\r\n"],["atv",/^(?:"[^"]*"?|'[^']*'?)/,e,"\"'"]],[["tag",/^^<\/?[a-z](?:[\w-.:]*\w)?|\/?>$/i],["atn",/^(?!style[\s=]|on)[a-z](?:[\w:-]*\w)?/i],["lang-uq.val",/^=\s*([^\s"'>]*(?:[^\s"'\/>]|\/(?=\s)))/],["pun",/^[\/<->]+/],["lang-js",/^on\w+\s*=\s*"([^"]+)"/i],["lang-js",/^on\w+\s*=\s*'([^']+)'/i],["lang-js",/^on\w+\s*=\s*([^\s"'>]+)/i],["lang-css",/^style\s*=\s*"([^"]+)"/i],["lang-css",/^style\s*=\s*'([^']+)'/i],["lang-css",/^style\s*=\s*([^\s"'>]+)/i]]),["in.tag"]);
d(o([],[["atv",/^[\S\s]+/]]),["uq.val"]);d(r({keywords:p,hashComments:!0,cStyleComments:!0,types:b}),["c","cc","cpp","cxx","cyc","m"]);d(r({keywords:"null,true,false"}),["json"]);d(r({keywords:m,hashComments:!0,cStyleComments:!0,verbatimStrings:!0,types:b}),["cs"]);d(r({keywords:g,cStyleComments:!0}),["java"]);d(r({keywords:h,hashComments:!0,multiLineStrings:!0}),["bash","bsh","csh","sh"]);d(r({keywords:v,hashComments:!0,multiLineStrings:!0,tripleQuotedStrings:!0}),["cv","py","python"]);d(r({keywords:"caller,delete,die,do,dump,elsif,eval,exit,foreach,for,goto,if,import,last,local,my,next,no,our,print,package,redo,require,sub,undef,unless,until,use,wantarray,while,BEGIN,END",hashComments:!0,multiLineStrings:!0,regexLiterals:2}),["perl","pl","pm"]);d(r({keywords:_,hashComments:!0,multiLineStrings:!0,regexLiterals:!0}),["rb","ruby"]);d(r({keywords:f,cStyleComments:!0,regexLiterals:!0}),["javascript","js"]);d(r({keywords:"all,and,by,catch,class,else,extends,false,finally,for,if,in,is,isnt,loop,new,no,not,null,of,off,on,or,return,super,then,throw,true,try,unless,until,when,while,yes",
hashComments:3,cStyleComments:!0,multilineStrings:!0,tripleQuotedStrings:!0,regexLiterals:!0}),["coffee"]);d(r({keywords:w,cStyleComments:!0,multilineStrings:!0}),["rc","rs","rust"]);d(o([],[["str",/^[\S\s]+/]]),["regex"]);var k=u.PR={createSimpleLexer:o,registerLangHandler:d,sourceDecorator:r,PR_ATTRIB_NAME:"atn",PR_ATTRIB_VALUE:"atv",PR_COMMENT:"com",PR_DECLARATION:"dec",PR_KEYWORD:"kwd",PR_LITERAL:"lit",PR_NOCODE:"nocode",PR_PLAIN:"pln",PR_PUNCTUATION:"pun",PR_SOURCE:"src",PR_STRING:"str",PR_TAG:"tag",PR_TYPE:"typ",prettyPrintOne:u.prettyPrintOne=function(e,t,i){var n=document.createElement("div");n.innerHTML="<pre>"+e+"</pre>";n=n.firstChild;i&&a(n,i,!0);c({h:t,j:i,c:n,i:1});return n.innerHTML},prettyPrint:u.prettyPrint=function(t,i){function n(){for(var i=u.PR_SHOULD_USE_CONTINUATION?p.now()+250:Infinity;g<d.length&&p.now()<i;g++){for(var o=d[g],l=x,h=o;h=h.previousSibling;){var f=h.nodeType,k=(f===7||f===8)&&h.nodeValue;if(k?!/^\??prettify\b/.test(k):f!==3||/\S/.test(h.nodeValue))break;
if(k){l={};k.replace(/\b(\w+)=([\w%+\-.:]+)/g,function(e,t,i){l[t]=i});break}}h=o.className;if((l!==x||_.test(h))&&!w.test(h)){f=!1;for(k=o.parentNode;k;k=k.parentNode)if(C.test(k.tagName)&&k.className&&_.test(k.className)){f=!0;break}if(!f){o.className+=" prettyprinted";f=l.lang;if(!f){var f=h.match(v),S;if(!f&&(S=s(o))&&y.test(S.tagName))f=S.className.match(v);f&&(f=f[1])}if(b.test(o.tagName))k=1;else var k=o.currentStyle,E=r.defaultView,k=(k=k?k.whiteSpace:E&&E.getComputedStyle?E.getComputedStyle(o,e).getPropertyValue("white-space"):0)&&"pre"===k.substring(0,3);E=l.linenums;if(!(E=E==="true"||+E))E=(E=h.match(/\blinenums\b(?::(\d+))?/))?E[1]&&E[1].length?+E[1]:!0:!1;E&&a(o,E,k);m={h:f,c:o,j:E,i:k};c(m)}}}g<d.length?setTimeout(n,250):"function"===typeof t&&t()}for(var o=i||document.body,r=o.ownerDocument||document,o=[o.getElementsByTagName("pre"),o.getElementsByTagName("code"),o.getElementsByTagName("xmp")],d=[],l=0;l<o.length;++l)for(var h=0,f=o[l].length;h<f;++h)d.push(o[l][h]);var o=e,p=Date;
p.now||(p={now:function(){return+new Date}});var g=0,m,v=/\blang(?:uage)?-([\w.]+)(?!\S)/,_=/\bprettyprint\b/,w=/\bprettyprinted\b/,b=/pre|xmp/i,y=/^code$/i,C=/^(?:pre|code|xmp)$/i,x={};n()}};typeof define==="function"&&define.amd&&define("google-code-prettify",[],function(){return k})})()}()});define("shared/prettyprint",["shared/polyfills","third_party/prettify"],function vt(require,exports,e){require("third_party/prettify");exports.prettyPrint=window.prettyPrint});define("shared/mathify",["shared/polyfills","interface/jquery"],function _t(require,exports,e){exports.iterMaths=function(e,t){return n(e,function(e,i){if(i){t(i,e)}return""})};var t=function(e,t){return e?"<b>"+e+"</b>":t};var i=exports.getParts=function(e){var t="\\s\\S",i=new RegExp("\\[math\\](["+t+"]+?)\\[\\/math\\]","g");var n,s,o,r=[],a=0,d,l;while(n=i.exec(e)){s=n[0];o=n[1];d=i.lastIndex;l=d-s.length;if(a!=l){r.push([e.slice(a,l)])}a=d;r.push([s,o])}if(a!=e.length){r.push([e.substr(a)])}return r};var n=exports.mathify=function(e,n){
n=n||t;var s=i(e);var o="";for(var r=0;r<s.length;r++){o+=n.apply(window,s[r])}return o||e};var s=require("interface/jquery").isJQueryObj;exports.renderMath=function(e){if(s(e)){e=e.get(0)}if(window.MathJax&&MathJax.Hub){MathJax.Hub.Queue(["Typeset",MathJax.Hub,e])}}});define("app/view/common",["shared/polyfills","webnode2","view/inline_editor","shared/events/index","shared/prettyprint","shared/mathify","shared/twitter_oembed"],function wt(require,exports,e){var t=require("webnode2").Component,i=require("view/inline_editor"),n=require("shared/events/index"),s=require("shared/prettyprint").prettyPrint,o=i.InlineEditor,r=require("shared/mathify").renderMath,a=require("shared/twitter_oembed").loadEmbeds;exports.SuggestedEditSaveButton=t.extend({onLoad:function(){var e=this;this.$id("@accept").click(function(){e.serverCall("publish_edit").liveMutate().send();return false})}});exports.Content=t.extend({onLoad:function(){this.$content=this.$id("@content");this.$editor=this.$id("@editor");this.bindEditorCallbacks();
this.editorFetched=this.editor_loaded;this.editorLoaded=this.editor_loaded;r(this.$content);s()},toggle:function(e){this.emitEvent({type:n.Types.QTEXT_EXPANDABLE_STATE,payload:{content_type:this.content_type,oid:this.oid}});var t=this.$content.hasClass("hidden");if(e!=null){t=e}if(t){this.showContent()}else{this.showEditor()}},showContent:function(){this.$content.removeClass("hidden");this.$editor.addClass("hidden");a()},showEditor:function(){if(!this.editorLoaded){this.$id("@loading").removeClass("hidden");this.fetchEditor();return}this.$content.addClass("hidden");this.$editor.removeClass("hidden")},fetchEditor:function(){var e=this;if(this.editorFetched){return}this.editorFetched=true;this.serverCall("editor_component").contentFor(this.$editor).success(function(){e.$id("@loading").addClass("hidden");e.editorLoaded=true;e.emitEvent(n.helpers.inlineEditorEdit(e.content_type,e.oid));e.showEditor()}).send()},bindEditorCallbacks:function(){var e=this;this.handleEvent(n.Types.INLINE_EDITOR_STATE,function(t){
if(t.payload.contentType!=e.content_type){return}if(t.payload.oid!=e.oid){return}if(t.payload.state=="edit"){e.toggle(false)}else if(t.payload.state=="cancel"){e.toggle(true)}else if(t.payload.state=="submitted"){e.toggle(true)}else if(t.payload.state=="toggle"){e.toggle()}})}});var d=exports.SuggestedEditsEditor=o.extend({onLoad:function(){this._super.apply(this,arguments);this.disclaimer_update="";this.answer_attribution_update="";var e=this;this.setToggleCallback(function(){if(e.parent()){if(e.parent().toggleButtons){e.parent().toggleButtons()}e.parent().$("#@disclaimer, #@nfr, #@answer_attribution").toggle()}if(e.editorShown){e.editor.fixEditorButtons()}});e.child("editor").setEditorReadyCallback(function(){e.original_input=e.get_value()})},submitHandler:function(){var e=this;this.input_button_obj.click(function(t){e.trigger_request();t.preventDefault()})},okToSubmitRequest:function(){if(!(this.editor.hasChanged(this.original_input)||this.always_submit)&&this.disclaimer_update===""&&this.answer_attribution_update===""){
return false}return this._super.apply(this,arguments)},_get_kwargs:function(){var e="";if(this.has_comment&&!this.child("comment_editor").isOnlyWhiteSpace()){e=this.child("comment_editor").serialize()}return{object_id:this.id,input:this.get_value(),sugg_exists:this.sugg_exists,notif:this.$id("@notif").prop("checked")?1:0,comment:e,disclaimer_update:this.disclaimer_update,answer_attribution_update:this.answer_attribution_update,share_values:{}}}});exports.AnswerEditor=d.extend({onLoad:function(){this._super.apply(this,arguments);this.answerShareForm=this.child("answer_share_form");this.editorShare=this.answerShareForm&&this.answerShareForm.child("editor_share")},_get_kwargs:function(){var e=this._super();if(this.editorShare){e["share_values"]=this.editorShare.getValues()}return e}});exports.PostEditor=d.extend({onLoad:function(){this._super.apply(this,arguments);var e=this;this.handleEvent(n.Types.POST_DISCLAIMER,function(t){if(t.payload.pid==e.id){e.disclaimer_update=t.payload.state}})}
});exports.FeedStoryItem=t.extend({onLoad:function(){var e=this;this.$id("@item").hover(function(){e.$id("@item").addClass("hover")},function(){e.$id("@item").removeClass("hover")});this.handleEvent(n.Types.QUESTION_CANT_ANSWER_STATE,function(t){if(t.payload.qid==e.qid){var i=t.payload.state=="passed";e.$id("@item").toggleClass("cant_answer",i)}})},getHash:function(){return this.hash}})});define("app/view/components",["shared/polyfills","webnode2","shared/cookies","shared/prettyprint","interface/jquery","shared/mathify","settings","shared/action_log","shared/twitter_oembed"],function bt(require,exports,e){var t=require("webnode2").Component,i=require("shared/cookies"),n=require("shared/prettyprint").prettyPrint,$=require("interface/jquery")._jQuery,s=require("shared/mathify").renderMath,o=require("settings").interface_strings,r=require("shared/action_log"),a=require("shared/twitter_oembed").loadEmbeds;exports.TruncatedQText=t.extend({onLoad:function(e){this.$more=this.$id("@more_link");var t=this.$more.attr("href");
if(t&&t!="#"){this.$id("@truncated").on("click",function(e){e.preventDefault();window.open(t,"_blank")})}s(this.$id("@truncated"));n()}});exports.ExpandedQText=t.extend({onLoad:function(){this._super.apply(this,arguments);s(this.$id("@expanded"));n();a()}});exports.TruncatePhraseList=t.extend({onLoad:function(){var e=this;e.$id("@view_all_link").click(function(){e.$id("@partial_phrases").addClass("hidden");e.$id("@all_phrases").removeClass("hidden");return false})}});var d=function(e){return e.target.nodeName=="A"||$(e.target).hasClass("qtext_embed")};exports.QtextTruncate=t.extend({init:function(){this._super.apply(this,arguments);this.callback=null},onLoad:function(e){var t=this;if(t.show_more&&t.was_truncated||t.$id("@more_link").length>0){t.$id("@text_snip").click(function(e){if(!d(e)){return t.onClick()}});t.$id("@more_link").click(function(){return t.onClick()})}s(this.$id("@text_snip"));n()},onClick:function(){var e=this;e.viewMore();if(e.callback){e.callback()}return false},setCallback:function(e){
this.callback=e},viewMore:function(){this.$id("@text_snip").addClass("hidden");this.$id("@full_text").removeClass("hidden");s(this.$id("@full_text"));n()}});exports.SimpleUserRequest=t.extend({onLoad:function(){var e=this;this.$id("@link").click(function(t){e.onClick();t.preventDefault()})},onClick:function(){if(this.upvote){i.setQfeedLog(this,"BoardItemUpvote");i.setQueryLog(this,"BoardItemUpvote");i.setTlog({type:"BoardItemUpvote",board_item_id:this.board_item_id});r.logSecondaryAction("BoardItemUpvote",{type:"board_item",board_item_id:this.board_item_id})}if(this.downvote){i.setQfeedLog(this,"BoardItemDownvote");i.setTlog({type:"BoardItemVoteDown",board_item_id:this.board_item_id})}if(this.board_follow_button||this.board_request_follow_button){i.setQfeedLog(this,"BoardFollow");i.setQueryLog(this,"BoardFollow");i.setTlog({type:"BoardFollow",bid:this.bid});r.logSecondaryAction("BoardFollow",{type:"board",bid:this.bid})}this.serverCall("request").liveMutate().send()}});exports.SimpleUserRequestConfirm=t.extend({
onLoad:function(){var e=this;this.$id("@link").click(function(){e._dialog=e.dialog().title(e.title).cancel(null,o.cancel).ok(function(){e.serverCall("request").liveMutate().send()},e.button_text).html(e.confirm_text);return false})}});exports.OrderItemButtons=t.extend({onLoad:function(){var e=this;this.$id("@up").click(function(){e.serverCall("move_up").liveMutate().send();return false});this.$id("@down").click(function(){e.serverCall("move_down").liveMutate().send();return false})}});exports.QuestionFooter=t.extend({onLoad:function(){var e=this;e.$id("@link").mousedown(function(){i.setQfeedLog(e,"QuestionClickthrough");i.setQueryLog(e,"QuestionClickthrough")})}})});define("shared/google_",["shared/polyfills","shared/loadjs","shared/util","shared/onload"],function yt(require,exports,e){var t=require("shared/loadjs").loadJS,i=require("shared/util"),n=require("shared/onload"),s=false,o=[];var r=i.once(function(){var e="//apis.google.com/js/client:plusone.js?onload=gapiAsyncInit";window.gapiAsyncInit=function(){
s=true;while(o.length){o.pop().call()}};t(e)});exports.onInit=function(e){if(s){e()}else{n.execAfterLoadDelayed(r);o.push(e)}}});define("app/view/contact_importer",["shared/polyfills","settings","interface/jquery","shared/events/index","shared/google_","webnode2"],function Ct(require,exports,e){var t=require("settings"),$=require("interface/jquery")._jQuery,i=require("shared/events/index"),n=require("shared/google_"),s=require("webnode2").Component;var o=[/@yahoo\.(ca|cn|co\.id|co\.in|co\.jp|co\.kr|co\.nz|co\.uk|com|com\.ar|com\.au|com\.br|com\.cn|com\.hk|com\.mx|com\.my|com\.ph|com\.sg|com\.tr|com\.tw|com\.vn|de|dk|es|fr|gr|ie|it|no|pl|se)$/,/@ymail\.com$/,/@rocketmail\.com$/],r=[/@gmail\.com$/,/@googlemail\.com$/];function a(e,t){var i=false;$.each(t,function(t,n){if(n.test(e)){i=true;return}});return i}var d=exports.ImportContactsForm=s.extend({isGoogleAppsEmail:false,shouldLogImpression:true,onLoad:function(){var e=this;this.isGoogleAppsEmail=this.is_google_apps_email;this.prevEmail=this.getEmail();
$("input[type=submit]").focus();this.$id("@email").on("keyup",function(){if(e.prevEmail!=e.getEmail()){e.prevEmail=e.getEmail();e.validateEmail()}});$("input[type=submit]").on("click",function(){return e.onSubmit()});if(this.shouldLogImpression){this.serverCall("log_impression").kwargs({email:this.getEmail()}).send()}$(document).bind("oauth_approved",function(t,i){e.updateAndSubmitForm(i.service,i.accessToken)});$(document).bind("oauth_rejected",function(t,i){e.onOAuthRejected(i.service)})},submitForm:function(){this.$id("@contact_importer_form").submit()},updateAndSubmitForm:function(e,t){this.$id("@service").val(e);this.$id("@access_token").val(t);this.$id("@spinner").show();this.submitForm()},onOAuthRejected:function(e){},onSubmit:function(){if(this.openOAuthDialog(this.getEmail())){return false}return true},getEmail:function(){return $.trim(this.$id("@email").val())},lastTimeoutId:null,validateEmail:function(){var e=this.getEmail();if(!e){this.onOAuthEmailEntered("empty");return false;
}if(this.lastTimeoutId){clearTimeout(this.lastTimeoutId);this.lastTimeoutId=null}var t=a(e,o);var i=a(e,r);this.isGoogleAppsEmail=false;this.isGoogleAppsDomainCheckQueued=false;if(t){this.onOAuthEmailEntered("yahoo")}else if(i){this.onOAuthEmailEntered("gmail")}else{this.onUnknownDomainEntered();this.lastTimeoutId=setTimeout(this.checkGoogleAppsDomain.bind(this),500)}},onOAuthEmailEntered:function(e){},onUnknownEmailDomainEntered:function(){},isCheckingGoogleAppsDomain:false,isGoogleAppsDomainCheckQueued:false,checkGoogleAppsDomain:function(){if(this.isCheckingGoogleAppsDomain){this.isGoogleAppsDomainCheckQueued=true;return}this.isCheckingGoogleAppsDomain=true;var e=this.getEmail();var t=this;this.serverCall("is_google_apps_domain").kwargs({email:e}).success(function(i){if(i){t.isGoogleAppsEmail=true}t.onCheckGoogleAppsDomainResponse(e,i);t.isCheckingGoogleAppsDomain=false;if(t.isGoogleAppsDomainCheckQueued){t.isGoogleAppsDomainCheckQueued=false;t.checkGoogleAppsDomain()}}).send()},onCheckGoogleAppsDomainResponse:function(e,t){},
logOAuthAttempt:function(e){this.serverCall("log_contact_importer_oauth_attempt").kwargs({email:e}).send()},onGoogleOAuthCallback:function(e){if(e&&e.error===undefined){var t="google";var i=e.access_token;this.updateAndSubmitForm(t,i)}else{this.onOAuthRejected()}},openOAuthDialog:function(e){var i=this;if(a(e,o)){i.logOAuthAttempt(e);window.open("/oauth/yahoo","_BLANK","height=400,width=800");return true}else if(a(e,r)||i.isGoogleAppsEmail){i.logOAuthAttempt(e);n.onInit(function(){var e={callback:i.onGoogleOAuthCallback.bind(i),clientid:t.googleClientId,cookiepolicy:t.googleCookiePolicy,scope:i.scopes};if(i.prompt_ota_install){e.apppackagename=t.androidAppPackageName}window.gapi.auth.signIn(e)});return true}return false},getEmailDomain:function(e){if(a(e,o)){return"yahoo"}else if(a(e,r)||this.isGoogleAppsEmail){return"google"}return"other"}});exports.SimpleImportContactsForm=d.extend({onLoad:function(){this._super.apply(this,arguments);this.$id("@contact_importer_form").submit(this.onFormSubmit.bind(this));
},onFormSubmit:function(){return!this.child("submit").$("#@import_contacts").is(":disabled")},unsupportedMessageTimeoutId:null,clearUnsupportedMessageTimeout:function(){if(this.unsupportedMessageTimeoutId){clearTimeout(this.unsupportedMessageTimeoutId);this.unsupportedMessageTimeoutId=null}},onOAuthEmailEntered:function(e){this.$id("@spinner").hide();this.$id("@email_import_error").hide();this.$id("@unsupported_domain").hide();this.$id("@form_error").hide();this.enableSubmitButton(true);this.clearUnsupportedMessageTimeout()},onUnknownDomainEntered:function(){this.$id("@spinner").show();this.$id("@email_import_error").hide();this.$id("@form_error").hide();this.enableSubmitButton(false);this.clearUnsupportedMessageTimeout()},onUnsupportedDomainEntered:function(){this.$id("@spinner").hide();this.$id("@unsupported_domain").show();this.$id("@email_import_error").show();this.enableSubmitButton(false)},onCheckGoogleAppsDomainResponse:function(e,t){if(this.getEmail()==e){if(!t){var i=this;this.unsupportedMessageTimeoutId=setTimeout(function(){
i.onUnsupportedDomainEntered()},500)}else{this.$id("@spinner").hide();this.$id("@unsupported_domain").hide();this.enableSubmitButton(true)}}},enableSubmitButton:function(e){if(e){this.child("submit").$("#@import_contacts").attr("disabled",false).removeClass("submit_button_disabled").addClass("follow_button")}else{this.child("submit").$("#@import_contacts").attr("disabled",true).addClass("submit_button_disabled").removeClass("follow_button")}}});exports.NuxDialogImportContactsForm=exports.SimpleImportContactsForm.extend({shouldLogImpression:false,onLoad:function(){var e=this;e._super.apply(e,arguments);e.$id("@change_email_link").click(function(){e.$id("@default_email_container").hide();e.$id("@change_email_container").show();return false});if(e.getEmailDomain(e.getEmail())=="other"){e.onUnsupportedDomainEntered()}e.$id("@skip").click(function(){e.serverCall("record_step").kwargs({step_name:"skip_oauth_dialog"}).success(function(){e.emitEvent({type:i.Types.NUX_DIALOG_SKIP_NEXT_STEP,payload:{}
})}).send();return false})},onOAuthRejected:function(e){this.serverCall("record_step").kwargs({step_name:"reject_oauth"}).send()},onSubmit:function(){var e=this._super.apply(this,arguments);var t=!e;if(t){this.serverCall("record_step").kwargs({step_name:"open_oauth",props:{domain:this.getEmailDomain(this.getEmail())}}).send()}else{this.serverCall("record_step").kwargs({step_name:"invalid_import_domain"}).send()}return e},submitForm:function(){var e=this.$id("@service").val();var t=this.$id("@access_token").val();this.importContacts(this.getEmail(),e,t);return false},importContacts:function(e,t,n){var s=this;s.$id("@alt_spinner").show();s.serverCall("import_contacts").kwargs({email:e,service:t,access_token:n}).liveMutate().success(function(){s.emitEvent({type:i.Types.NUX_DIALOG_NEXT_STEP,payload:{}})}).sendOnlyOnce()}})});define("app/view/draft",["shared/polyfills","webnode2","shared/window_manager"],function xt(require,exports,e){var t=require("webnode2").Component,i=require("shared/window_manager");
exports.ClearDraft=t.extend({onLoad:function(){var e=this;this.$id("@clear_draft").click(function(){e.dialog().title(e.clear_draft_title).cancel().ok(function(){e.clearDraft()},e.clear_draft_title).text(e.clear_draft_message);return false})},clearDraft:function(){this.serverCall("clear_draft").liveMutate().success(function(){i.reload()}).send()}})});define("third_party/truncate",["shared/polyfills","jquery"],function kt(require,exports,e){var $=require("jquery");var t=["table","thead","tbody","tfoot","tr","col","colgroup","object","embed","param","ol","ul","dl","blockquote","select","optgroup","option","textarea","script","style"];function i(e,t){if(e.innerText){e.innerText=t}else if(e.nodeValue){e.nodeValue=t}else if(e.textContent){e.textContent=t}else{return false}}function n(e,t,n,o){var r=e.parent();var a;e.remove();var d=n?n.length:0;if(r.contents().length>d){a=r.contents().eq(-1-d);return s(a,t,n,o)}else{var l=r.prev();a=l.contents().eq(-1);if(a.length){i(a[0],a.text()+o.ellipsis);
r.remove();if(n.length){l.append(n)}return true}}return false}function s(e,t,s,o){var r=e[0];var a=e.text();var d="";var l,c;var u=0;var h=a.length;while(u<=h){l=u+(h-u>>1);c=$.trim(a.substr(0,l+1))+o.ellipsis;i(r,c);if(t.height()>o.maxHeight){h=l-1}else{u=l+1;d=d.length>c.length?d:c}}if(d.length>0){i(r,d);return true}else{return n(e,t,s,o)}}function o(e,i,n,r){var a=e[0];var d=e.contents();var l,c;var u=0;var h=d.length;var f=false;e.empty();for(;u<h&&!f;u++){l=d.eq(u);c=l[0];if(c.nodeType===8){continue}a.appendChild(c);if(n.length){if($.inArray(a.tagName.toLowerCase(),t)>=0){e.after(n)}else{e.append(n)}}if(i.height()>r.maxHeight){if(c.nodeType===3){f=s(l,i,n,r)}else{f=o(l,i,n,r)}}if(!f&&n.length){n.remove()}}return f}function r(e,t){this.element=e;this.$element=$(e);this._name="truncate";this._defaults={lineHeight:parseInt(this.$element.css("line-height")),lines:1,ellipsis:"â¦",showMore:"",showLess:""};this.options=$.extend({},this._defaults,t);if(this.options.maxHeight===undefined){this.options.maxHeight=parseInt(this.options.lines,10)*parseInt(this.options.lineHeight,10);
}this.$clipNode=$($(this.options.showMore),this.$element);this.original=this.cached=e.innerHTML;this.isTruncated=false;this.isCollapsed=true;this.update()}r.prototype={update:function(e){var t=!this.isCollapsed;if(e){this.original=this.element.innerHTML=e}else if(this.isCollapsed&&this.element.innerHTML===this.cached){this.element.innerHTML=this.original}var i=this.$element.wrapInner("<div/>").children();i.css({border:"none",margin:0,padding:0,width:"auto",height:"auto"});this.isTruncated=false;if(i.height()>this.options.maxHeight){this.isTruncated=o(i,i,this.$clipNode,this.options)}else{this.isCollapsed=false}i.replaceWith(i.contents());this.cached=this.element.innerHTML;if(t){this.element.innerHTML=this.original}},expand:function(){if(!this.isCollapsed){return}this.isCollapsed=false;this.element.innerHTML=this.isTruncated?this.original+this.options.showLess:this.original},collapse:function(e){if(this.isCollapsed){return}this.isCollapsed=true;e=e||false;if(e){this.update()}else{this.element.innerHTML=this.cached;
}}};exports.Truncate=r});define("truncate",["shared/polyfills","third_party/truncate"],function St(require,exports,e){var t=require("third_party/truncate");exports.truncate=function(e,i){return new t(e,i)}});define("app/view/embed",["shared/polyfills","webnode2","interface/jquery","tooltip","view/modal","truncate","shared/views"],function Et(require,exports,e){var t=require("webnode2").Component,$=require("interface/jquery")._jQuery,i=require("tooltip"),n=require("view/modal").Base,s=require("truncate").truncate,o=require("shared/views").viewsLogger;exports.EmbedModalLink=t.extend({onLoad:function(){var e=this;this.$id("@modal_link").on("click",function(t){e.modal("load_inner");t.preventDefault()});i.attach(this.$id("@embed_disabled"),this.embed_disabled_text)}});exports.EmbedModal=n.extend({onLoad:function(){this._super.apply(this,arguments);this.selectAllOnFocus(this.$id("@code_area"));this.$id("@checkbox").on("click",this.toggleFullAnswer.bind(this))},selectAllOnFocus:function(e){e.focus(function(){
var e=$(this);e.select();window.setTimeout(function(){e.select()},1);e.mouseup(function(){e.unbind("mouseup");return false})})},toggleFullAnswer:function(){if(this.$id("@full_answer").is(":checked")){this.$id("@truncated_preview").addClass("hidden");this.$id("@full_preview").removeClass("hidden");this.$id("@code_area").val(this.full_answer_code)}else{this.$id("@truncated_preview").removeClass("hidden");this.$id("@full_preview").addClass("hidden");this.$id("@code_area").val(this.truncated_answer_code)}}});exports.AnswerEmbedAnswer=t.extend({onLoad:function(){o.addComponentToTrack(this);o.logViews();if(this.embedly){s(this.$id("@question_text").get(0),{lineHeight:"24",lines:3});s(this.$id("@answer_header").get(0),{lines:1})}}})});define("app/view/error",["shared/polyfills","webnode2","shared/w2.context"],function Tt(require,exports,e){var t=require("webnode2"),i=require("webnode2").Component,n=require("shared/w2.context").CaptchaInput;exports.CaptchaForm=i.extend({contextConstructor:function(){
return n},onLoad:function(){t.Error.shown=true;t.Error.hide();var e=this;e.captchaContext=e.getContext(n);e.captchaContext.on("isCaptchaFilled",function(t,i){if(!i){return}var n=e.captchaContext.get("captchaResponse");e.serverCall("verify_captcha").kwargs({captcha_response:n}).success(function(e){if(!e.response){return}window.location.reload(true)}).send()})}})});define("view/paged_list",["shared/polyfills","shared/log","interface/jquery","webnode2","shared/core/component","w2.errors","shared/viewport","shared/onload","shared/eventemitter","shared/window_manager","shared/loading","shared/perf"],function $t(require,exports,e){var t=require("shared/log").log,$=require("interface/jquery")._jQuery,i=require("webnode2").Component,n=require("shared/core/component"),s=require("w2.errors"),o=require("shared/viewport"),r=require("shared/onload"),a=require("shared/eventemitter").EventEmitter,d=require("shared/window_manager"),l=require("shared/loading"),c=require("shared/perf");exports.PagedList=i.extend({
init:function(e){this._super.apply(this,arguments);this.model_count=e.initial_count;this.container=window;this.first_hidden_index=0;this.visible_count=0;this.invisible_count=0;this.total_count=0;this.initializeCounts();this.max_should_show=this.buffer_count;this.hidden_count=0;this.currently_fetching=false;this.waiting_for_updates=false;this.waiting_for_updates_from_preload=false;this.show_hidden_when_done_updating=false;this.lastGetMoreSucceeded=true;this.eventEmitter=new a;this.eventEmitter.on("onGetMoreDone",this.maybeUpdateOptimizedPaged);if(this.retarget_links){this.retarget()}this.pagingDone=false;this.userPerceivedAction=null},getFocusedItem:function(){var e=n.getLiveDomId(this.cid),t=$("#"+e+" .pagedlist_item:focus").first();if(t.length){return t}return null},maybeScrollToItem:function(e,t,i){var n=e.height(),s=e.position().top,o=s+n,r=$(document).scrollTop()+d.headerOffset,a=Math.max(0,$(window).height()-(d.headerOffset+d.actionBarHeight+d.scrollContext)),l=r+a;if(!t.length){if(i&&s>=r){
d.scrollAndFocus(0);return}else if(!i&&o<=l){d.scrollAndFocus($(document).height());return}t=e}if(o<r||s>l){d.scrollAndFocus(s);return}else{var c=i&&s>=r-5||!i&&o<=l+5;if(c){n=t.height();s=t.position().top;o=s+n}var u=r;if(i){if(c&&n>a){u=o-a}else if(s<r){u=s}}else{var h=$(window).height()*.25;if(s>r+h){u=s-h+5}else if(!c){u=r+a}}u=r+Math.max(Math.min(u-r,a),-a);d.scrollAndFocus(u,c&&t)}},onMoreButtonClick:function(e){if(!e){s.beginCanBeRelatedToUserActionBlock(100)}if(t&&t.enabled){t("paged_list.PagedList.onMoreButtonClick",this.cid,"'More...' button clicked",e?"(auto)":"")}var i=this.showHiddenAndMaybeGetMore();if(!i){this.show_hidden_when_done_updating=true}if(this.currently_fetching){this.showLoading()}this.startUserPerceivedAction();return false},loadMoreButton:function(){var e=this;this.child("more_button").$("#@more").click(this.onMoreButtonClick.bind(this));if(!this.crawler&&this.has_more){r.execAfterLoadDelayed(function(){setTimeout(e.maybeGetMore.bind(e),50)})}},initializeCounts:function(){
var e=n.getLiveDomId(this.cid);if(!e){return}var t=document.getElementById(e);if(!t){return}var i=t.childNodes;for(var s=0;s<i.length;s++){var o=$(i[s]);var r=o.attr("id");if(r&&o.hasClass("pagedlist_item")){this.first_hidden_index+=1;this.total_count+=1;if(!o.hasClass("pagedlist_invisible")){this.visible_count+=1}else{this.invisible_count+=1}}}},showHiddenAndMaybeGetMore:function(){this.showHidden(this.buffer_count);return this.maybeGetMore()},showHidden:function(e){var t=0;var i=0;var s=n.getLiveDomElement(this.cid);if(!s){return}var o=s.childNodes;var r=false;for(var a=0;a<o.length;a++){var d=$(o[a]);if(d.hasClass("pagedlist_item")&&d.hasClass("pagedlist_hidden")){if(!d.hasClass("pagedlist_invisible")){t+=1}if(!r){r=true}d.removeClass("pagedlist_hidden");o[a].style.display="";i+=1;if(t>=e){break}}}this.visible_count+=t;this.hidden_count-=t;this.first_hidden_index+=i;if(!this.has_more&&!this.pagingDone){this.pagingDone=true;this.onPagingDone()}if(this.visible_count>this.max_should_show){
this.max_should_show=this.visible_count}this.eventEmitter.trigger("onShowHidden")},onPagingDone:function(){},hideLoading:function(){if(t&&t.enabled){t("paged_list.PagedList.hideLoading","Hide loading...")}var e=this.child("more_button");if(!e){return}e.$("#@loading").hide();if(this.lastGetMoreSucceeded){e.updateAutoClickCapable()}else{e.auto_click_capable=false}e.maybeEnableOrDisableAutoClick()},showLoading:function(){if(t&&t.enabled){t("paged_list.PagedList.showLoading","Show loading...")}var e=this.child("more_button");if(e&&this.auto_paged&&!this.crawler){var i=this.child("more_button").$("#@loading");if(!this.spinner){this.spinner=l.createLoadingDotsElement();i.append(this.spinner)}i.show()}else if(e){e.$("#@loading").show()}},hideMoreButton:function(){var e=this.child("more_button");if(e&&!e.isVirtual){e.maybeHideButton()}},showMoreButton:function(){var e=this.child("more_button");if(e&&!e.isVirtual){e.maybeShowButton()}},maybeGetMore:function(e){if(this.currently_fetching||this.waiting_for_updates||this.waiting_for_updates_from_preload){
if(e!==undefined&&this.total_count<e){this.eventEmitter.once("onGetMoreDone",this.maybeGetMore.bind(this,e));return true}else{return false}}if(e!==undefined&&this.total_count<e){this.getMore(e)}else if(this.visible_count+this.hidden_count>=this.model_count&&this.hidden_count<=this.buffer_count/4){this.getMore()}else if(this.hidden_count<=0){this.hideMoreButton()}return true},maybeUpdateOptimizedPaged:function(){if(!this.optimize_for_seo){return}if(this.model_count>this.offset_count){this.model_count-=this.offset_count}if(this.child("html_nav")){this.html_nav_item=n.getLiveDomElement(this.child("html_nav").cid);this.html_nav_item.style.display="block"}},getMore:function(e){this.currently_fetching=true;this.waiting_for_updates=true;this.serverCall("increase_count").kwargs({cid:this.cid,num:e!==undefined?e-this.total_count:this.buffer_count,current:this.model_count}).disableDefaultUserPerceivedLogging().success(this._onGetMoreSuccess.bind(this)).error(this._onGetMoreError.bind(this)).send();
return false},_onGetMoreSuccess:function(){this.lastGetMoreSucceeded=true;this.currently_fetching=false;if(!this.waiting_for_updates){this.hideLoading();if(this.show_hidden_when_done_updating){this.show_hidden_when_done_updating=false;this.showHiddenAndMaybeGetMore()}}this.eventEmitter.trigger("onGetMoreDone")},_onGetMoreError:function(){var e=this;this.lastGetMoreSucceeded=false;this.currently_fetching=false;setTimeout(function(){if(e.waiting_for_updates&&e.userPerceivedAction){c.finishAction(e.userPerceivedAction);e.userPerceivedAction=null}e.waiting_for_updates=false;e.hideLoading()},2e3)},onInsertNode:function(e,t){var i=this.$("#"+t);if(!i.hasClass("pagedlist_item")){return}if(this.retarget_links){i.find('a:not([href^="#"])').each(function(){if(this.target!="feed_modal"){$(this).attr("target","_blank")}})}var s=i.hasClass("pagedlist_invisible");this.total_count+=1;if(e.position>0&&e.position>=this.first_hidden_index){i.addClass("pagedlist_hidden");e.transition.type="none";if(!s){this.hidden_count+=1;
if(this.fixed_size_paged_list&&this.first_hidden_index<this.max_should_show){this.showHidden(1)}else{this.showMoreButton()}}}else{i.removeClass("pagedlist_hidden");i[0].style.display="";var o=true;if(!s){this.visible_count+=1;if(this.fixed_size_paged_list&&this.visible_count>=this.first_hidden_index&&this.first_hidden_index>=this.max_should_show){o=true;var r=n._domids[this.cid];var a=document.getElementById(r);var d=a.childNodes;var l=0;for(var c=0;c<d.length;c++){var u=$(d[c]);if(u.hasClass("pagedlist_item")&&!u.hasClass("pagedlist_hidden")&&!u.hasClass("pagedlist_invisible")){l+=1;if(l>this.first_hidden_index){u.addClass("pagedlist_hidden");d[c].style.display="none";this.hidden_count+=1;this.visible_count-=1;this.showMoreButton();break}}}}}else{this.invisible_count+=1}if(!this.fixed_size_paged_list||!o){this.first_hidden_index+=1}}},onDeleteNode:function(e,t){var i=this.$("#"+t);if(!i.hasClass("pagedlist_item")){return}var n=i.hasClass("pagedlist_invisible");this.total_count-=1;if(e.position>=this.first_hidden_index){
if(!n){this.hidden_count-=1}}else{this.first_hidden_index-=1;if(!n){this.visible_count-=1;if(this.fixed_size_paged_list){this.showHidden(1)}}else{this.invisible_count-=1}}},startUserPerceivedAction:function(){if(!this.userPerceivedAction){this.userPerceivedAction=c.startUserPerceived({vcon:this.__vcon,method:"increase_count"})}},finishUserPerceivedAction:function(){this.startUserPerceivedAction();c.finishAction(this.userPerceivedAction);this.userPerceivedAction=null},onUpdate:function(e){this.model_count=e.count;this.has_more=e.has_more;var t=this.child("more_button");if(t&&!t.isVirtual){t.maybeEnableOrDisableAutoClick();if(this.hidden_count<=0){this.hideMoreButton()}else{this.showMoreButton()}}if(this.auto_paged&&this.waiting_for_updates){this.finishUserPerceivedAction()}this.waiting_for_updates=false;this.waiting_for_updates_from_preload=false;if(this.visible_count<this.buffer_count&&this.hidden_count>0){this.show_hidden_when_done_updating=true}var i=true;if(!this.currently_fetching){
this.hideLoading();if(this.show_hidden_when_done_updating){this.show_hidden_when_done_updating=false;this.showHiddenAndMaybeGetMore();i=false}}this.eventEmitter.trigger("onGetMoreDone");if(i){this.maybeGetMore()}},orderedVisibleChildren:function(){var e=n.getLiveDomElement(this.cid);var t=e.childNodes;var i=[],s;for(s=0;s<t.length;s++){var o=$(t[s]);var r=o.attr("id");if(r&&o.hasClass("pagedlist_item")&&!o.hasClass("pagedlist_invisible")){i.push(r)}}return i},allOrderedChildren:function(){var e=n.getLiveDomElement(this.cid);var t=e.childNodes;var i=false;var s=[];for(var o=0;o<t.length;o++){var r=$(t[o]);var a=r.attr("id");if(a&&r.hasClass("pagedlist_item")){if(i||!r.hasClass("pagedlist_invisible")){i=true;s.push(a)}}}return s},retarget:function(){this.$("#"+n.getLiveDomId(this.cid)+" .pagedlist_item").find('a:not([href^="#"])').each(function(){if(this.target!="feed_modal"){$(this).attr("target","_blank")}})}});exports.PagedListMoreButton=i.extend({init:function(){this._super.apply(this,arguments);
this.last_check_time=0;this.rate_limiter_ms=245;this.auto_click_enabled=false;this.updateAutoClickCapable()},updateAutoClickCapable:function(){this.auto_click_capable=this.auto_click_period!==null&&this.auto_click_period>0},checkButtonPosition:function(e){if(!this.auto_click_capable){return}if(!this.parent()){return}var t=+new Date;if(!e&&t<this.last_check_time+this.rate_limiter_ms){return}var i=this.parent().model_count;if(this.parent().waiting_for_updates){i+=this.parent().buffer_count}var n=this.shouldEnableAutoClickFromModelCount(i);this.last_check_time=t;var s=this.$id("@more");if(s.length===0){return}var r=this.$id("@sentinel");var a=this.parent().container;var d=Math.ceil($(a).height());var l=false;if(o.isElementInViewport(r.get(0))){l=true;if(this.parent().auto_paged){this.parent().startUserPerceivedAction()}}else{var c=$(a).height()+$(a).scrollTop();var u=c<=$(r).offset().top-d;if(!u){l=true}}if(!l){return}if(this.parent().currently_fetching||this.parent().waiting_for_updates){
this.parent().showLoading();if(n){this.parent().show_hidden_when_done_updating=true}return}if(!n){return}this.parent().onMoreButtonClick()},onLoad:function(){var e=this;this.parent().loadMoreButton();this.parent().eventEmitter.on("onShowHidden",function(){if(!e.auto_click_capable){return}if(!e.auto_click_enabled&&e.shouldEnableAutoClickFromModelCount(e.parent().model_count+e.parent().buffer_count)&&e.$id("@more").is(":visible")){e.maybeHideButton()}});if(this.auto_click_capable){var t=function(){setTimeout(e.checkButtonPosition.bind(e,false),125)};this._mousemove_handler=t;this._keypress_handler=t;this._scroll_handler=t;document.addEventListener("mousemove",this._mousemove_handler);document.addEventListener("keypress",this._keypress_handler);document.addEventListener("scroll",this._scroll_handler)}this.maybeEnableOrDisableAutoClick();if(this.auto_click_enabled){r.execAfterLoadDelayed(function(){setTimeout(e.checkButtonPosition.bind(e,true),125)})}},onUnload:function(){if(this._mousemove_handler!==undefined){
document.removeEventListener("mousemove",this._mousemove_handler)}if(this._keypress_handler!==undefined){document.removeEventListener("keypress",this._keypress_handler)}if(this._scroll_handler!==undefined){document.removeEventListener("scroll",this._scroll_handler)}},maybeShowButton:function(){if(!this.auto_click_enabled){this.$id("@more").show()}},maybeHideButton:function(){this.$id("@more").hide()},shouldEnableAutoClickFromModelCount:function(e){return e%this.auto_click_period!==0},maybeEnableOrDisableAutoClick:function(){if(!this.auto_click_capable){this.auto_click_enabled=false;return}var e=this.shouldEnableAutoClickFromModelCount(this.parent().model_count);if(e&&!this.auto_click_enabled){this.auto_click_enabled=true;this.parent().hideMoreButton()}else if(!e&&this.auto_click_enabled){this.auto_click_enabled=false}},counterStr:function(){return"PagedList counters: "+"total_count "+this.total_count+", visible_count "+this.visible_count+", invisible_count "+this.invisible_count+", hidden_count "+this.hidden_count+", first_hidden_index "+this.first_hidden_index;
}})});define("shared/toast",["shared/polyfills","shared/Class","interface/settings","shared/client","interface/jquery"],function Lt(require,exports,e){var t=require("shared/Class").Class,i=require("interface/settings"),n=require("shared/client"),s=i.interface_strings,o=i.pageIsMobile,r=require("interface/jquery").jQuery;var a=null;var d=exports.Toast={show:function(){if(a!==null){a.close()}a=this;this.closeTimeout=setTimeout(this.close.bind(this),3e3);if(o&&n.isUIWebView()){var e=this.$container.get(0);var t=document.documentElement.clientHeight-window.innerHeight;if(t>0&&e){e.style.paddingBottom=t+"px"}}},close:function(){clearTimeout(this.closeTimeout);a=null;if(this.$container.length===0){return}this.$container.addClass("animate_out");this.$container.css("paddingBottom","");setTimeout(this.cleanup.bind(this),1e3)},cleanup:function(){var e=this.$container.get(0);if(e.parentNode){e.parentNode.removeChild(e)}}};var l=t.extend(d).extend({__init__:function(e,t){this.additionalClasses=t||[];
this.message=e;this.$container=r(this.render())},render:function(){var e=document.getElementById("pmsg_container");if(!e){e=document.createElement("div");e.id="pmsg_container";document.body.appendChild(e)}e.className="PMsgContainer";var t=document.createElement("div");t.className=["PMsg"].concat(this.additionalClasses).join(" ");e.appendChild(t);var i=document.createElement("div");i.className="contents";r(i).text(this.message);t.appendChild(i);return t}});exports.show=function(e){var t=new l(e);t.show()};var c=exports.showError=function(e){var t=new l(e,["PMsgError"]);t.show()};exports.showPleaseTryAgainError=function(){c(s.please_try_again)}});define("unified_view/toggle",["shared/polyfills","shared/core/component","shared/errors","shared/debounce","shared/toast","interface/settings","shared/perf","shared/viewport"],function Mt(require,exports,e){var t=require("shared/core/component").Component,i=require("shared/errors"),n=require("shared/debounce").debounce,s=require("shared/toast"),o=require("interface/settings").pageIsMobile,r=require("shared/perf"),a=require("shared/viewport");
exports.ToggleBase=t.extend({onLoad:function(){this._userPerceivedAction=null;this.fetchCalled=false;this.fetchCompleted=false;this.switchCompleted=false;this.switchPending=false;this.$fetchInto=this.$id(this.fetch_into);this.$switchShow=this.optional$id(this.switch_show);this.$switchHide=this.optional$id(this.switch_hide);this.$loadingShow=this.optional$id(this.loading_show);this.$loadingHide=this.optional$id(this.loading_hide);this.$fetchOnElem=this.fetch_on.length>1?this.$id(this.fetch_on[1]):this.$switchHide;this.$switchOnElem=this.switch_on.length>1?this.$id(this.switch_on[1]):this.$switchHide;this.bindFetch();this.handleSwitch();if(!this.fetchCompleted&&!this.$fetchInto){i.logJsError("Toggle","$fetchInto undefined but fetch is not completed.")}},optional$id:function(e){return e?this.$id(e):null},bindFetch:function(){switch(this.fetch_on[0]){case"request":this.fetchCalled=true;this.fetchCompleted=true;break;case"load":this.fetch();break;case"js":break;case"view":case"hover":case"click":
var e=this.fetch_on[0];if(!this.$fetchOnElem){i.logJsError("Toggle","$fetchOnElem undefined for view/hover/click triggers.");return}if(e=="hover"){this.bindHover(this.$fetchOnElem,this.fetch.bind(this))}else if(e=="view"){this.bindInViewPort(this.$fetchOnElem,this.fetch.bind(this))}else{this.bindClick(this.$fetchOnElem,this.fetch.bind(this))}break;default:throw new Error("Invalid fetch trigger specified "+this.fetch_on)}},handleSwitch:function(){switch(this.switch_on[0]){case"request":this.fetchCalled=true;this.fetchCompleted=true;this.switchCompleted=true;break;case"load":this.triggerSwitch();break;case"js":break;case"view":case"hover":case"click":var e=this.switch_on[0];if(!this.$switchOnElem){i.logJsError("Toggle","$switchOnElem undefined for view/hover/click triggers.");return}if(e=="hover"){this.bindHover(this.$switchOnElem,this.triggerSwitch.bind(this))}else if(e=="view"){this.bindInViewPort(this.$switchOnElem,this.triggerSwitch.bind(this))}else{this.bindClick(this.$switchOnElem,this.triggerSwitch.bind(this));
}break;default:throw new Error("Invalid show trigger specified "+this.switch_on)}},fetch:function(){if(this.fetchCalled){return}this.fetchCalled=true;this.serverCall("fetch_toggled_component").kwargs({serialized_args:this.serialized_args}).disableDefaultUserPerceivedLogging().sendJsData(false).contentFor(this.$fetchInto.get(0)).success(this.onFetched.bind(this)).error(this.onFetchError.bind(this)).send({batched:true})},onFetchError:function(){if(this.switchPending&&this.switch_on[0]=="click"){s.showPleaseTryAgainError()}this.switchPending=false;this.fetchCalled=false;this.exitLoadingState()},onFetched:function(){this.fetchCompleted=true;if(this.switchPending){this.switchPending=false;this.triggerSwitch()}},enterLoadingState:function(){if(this.$loadingShow){this.$loadingShow.removeClass("hidden")}if(this.$loadingHide){this.$loadingHide.addClass("hidden")}},exitLoadingState:function(){if(this.$loadingShow){this.$loadingShow.addClass("hidden")}},actualSwitch:function(){if(this.switchCompleted){
return}this.switchCompleted=true;if(this.$switchShow){this.$switchShow.toggleClass("hidden")}if(this.$switchHide){this.$switchHide.toggleClass("hidden")}},triggerSwitch:function(){this.switchStart();this.fetch();if(!this.fetchCompleted){this.switchPending=true;this.enterLoadingState()}else{this.exitLoadingState();this.actualSwitch();this.switchEnd()}},switchStart:function(){if(!this.log_switch_time){return}this._userPerceivedAction=r.startUserPerceived({vcon:this.__vcon,method:"fetch_toggled_component"})},switchEnd:function(){if(!this.log_switch_time){return}this.log_switch_time=false;if(this._userPerceivedAction){r.finishAction(this._userPerceivedAction);this._userPerceivedAction=null}},_isLinkedAnchorTag:function(e){return e.tagName=="A"&&e.getAttribute("href")&&e.getAttribute("href")!="#"},bindClick:function(e,t){var i=this;e.on("click",function(n){var s=n.target;while(s&&s!=e.get(0)){if(i._isLinkedAnchorTag(s)){return}s=s.parentElement}n.preventDefault();t()})},bindHover:function(e,t){
if(!o){e.on("mouseenter",t)}else{this.bindInViewPort(e,t)}},bindInViewPort:function(e,t){if(a.isElementInViewport(e.get(0))){t()}else{var i={leading:true};var s=n(function(){if(a.isElementInViewport(e.get(0))){t();window.removeEventListener("scroll",s)}},50,i);window.addEventListener("scroll",s)}}})});define("app/view/home",["shared/polyfills","webnode2","view/fixable2","unified_view/toggle","shared/events/index","shared/viewport","shared/logging"],function Dt(require,exports,e){var t=require("webnode2").Component,i=require("view/fixable2"),n=require("unified_view/toggle"),s=require("shared/events/index"),o=require("shared/viewport"),r=require("shared/logging");exports.HomeMain=t.extend({onLoad:function(){var e=this.$id("@left_col_inner");var t=this.$id("@left_col");if(t.length>0&&e.length>0){i.makeFixable(e,{min_height:t.outerHeight()+t.offset().top,min_width:990})}}});exports.HomeFeed=t.extend({onLoad:function(){var e=this;this.handleEvent(s.Types.FEED_PAGING_DONE,function(){e.child("home_main_feed").triggerSwitch();
})}});exports.ContentPageFeed=n.ToggleBase.extend({onLoad:function(){this._super.apply(this,arguments);setTimeout(this.recordImpression.bind(this),0)},recordImpression:function(){if(o.isElementInViewport(this.$id("@wrapper").get(0))){r.log("funnel_impression",{impression_type:"qp_feed_impression"})}else{setTimeout(this.recordImpression.bind(this),200)}}})});define("app/view/feed",["shared/polyfills","shared/core/component","interface/jquery","webnode2","view/fixable2","truncate","shared/window_manager","shared/cookies","shared/events/index","shared/log","shared/logging","shared/viewport","shared/views","gating","shared/action_log","fx","view/paged_list","app/view/home"],function At(require,exports,e){var t=require("shared/core/component"),$=require("interface/jquery")._jQuery,i=require("webnode2").Component,n=require("view/fixable2"),s=require("truncate").truncate,o=require("shared/window_manager"),r=require("shared/cookies"),a=require("shared/events/index"),d=require("shared/log").log,l=require("shared/logging"),c=require("shared/viewport"),u=require("shared/views").viewsLogger,h=require("gating"),f=require("shared/action_log").ActionableComponent,p=require("fx");
exports.UniversalPageFeed=require("view/paged_list").PagedList.extend({init:function(e){this._super.apply(this,arguments);this.pageLoadTime=+new Date;this.viewerUid=e.uid;this.hashPosition={};this.initiallyVisible={};this.firstQueryID=0;this.offset=0;this.firstElement=0;this.needsRefresh=false;this.num_prefeed_stories=e.num_prefeed_stories;this.bundle_position=e.bundle_position;this.hashImpressions={};this.lastCheckTime=0;this.lastRevealTime=0;this.visibleStorySelectors=[];this.impressionData=[];this.dontLogImpressions=e.dont_log_imp;this.maxImpPos=-1;var t=this;this.handleEvent(a.Types.FEED_IMPRESSIONS_DISABLED,function(e){t.dontLogImpressions=e.payload.disabled});this.hashReadingTime={};this.loggedReadingTime={};this.hashPreviousVisibleTime={};this.lastVisibilityUpdate=0;this.shouldLogReadingTime=h.enable_reading_time_logging;this.nextThreshold={};this.readingTimeUpdates=[];this.usePersistentFeed=e.use_persistent_feed;this.pfInitialMoreStoriesPos=e.pf_initial_morestories_pos;this.moreStoriesShown=false;
this.pfPrefetchStarted=false;this.numConsecutivePreloadFails=0;this.bannerShown=false;this.setDvar("feed_story_hash",null);this.setDvar("feed_story_position",null);this.setDvar("feed_story_inner_position",null);this.setDvar("feed_story_initial",null);this.setDvar("feed_ty",e.feed_ty);this.setDvar("feed_page",e.feed_page);this.setDvar("page_data",e.page_data);this.setDvar("focus_ty",e.focus_ty);this.setDvar("bundle_position",e.bundle_position)},onLoad:function(e){d("feed.UniversalPageFeed.onLoad","start");this._super.apply(this,arguments);var t=this;if(this.debug){return}this.recordImpressions(true);setInterval(this.recordImpressions.bind(this,false),t.rate_limiter_ms+500);if(this.shouldLogReadingTime){this.updateVisibility(true);setInterval(this.updateVisibility.bind(this,false),this.reading_time_rate)}var i=this.recordImpressions.bind(this,false,false);this._mousemove_handler=i;this._keypress_handler=i;this._scroll_handler=i;document.addEventListener("mousemove",this._mousemove_handler);
document.addEventListener("keypress",this._keypress_handler);document.addEventListener("scroll",this._scroll_handler);if(this.usePersistentFeed){this._pfPrefetchScrollHandler=function(){if(!t.pfPrefetchStarted){t.pfPrefetchStarted=true;setInterval(t.prefetchPersistentFeed.bind(t),2500)}};document.addEventListener("scroll",t._pfPrefetchScrollHandler)}var n=this.child("more_stories");n.$("#@more_stories").on("click",function(e){e.stopPropagation();var i=+new Date;if(i-t.pageLoadTime>=2.5*3600*1e3){window.location.reload()}else{t.revealPreloadedPersistentFeed(true,true)}t.hideMoreStoriesButton()});this.handleEvent(a.Types.INTERACTION_MODE_BANNER_STATE,function(e){if(e.payload.shown){t.bannerShown=true;t.hideMoreStoriesButton()}else{t.bannerShown=false}})},onFeedBottomIndicatorClicked:function(){if(!this.hasHiddenPrefetchedStories()){window.location.reload()}else{this.revealPreloadedPersistentFeed(true,true)}},onUnload:function(){document.removeEventListener("mousemove",this._mousemove_handler);
document.removeEventListener("keypress",this._keypress_handler);document.removeEventListener("scroll",this._scroll_handler);document.removeEventListener("scroll",this._pfPrefetchScrollHandler)},getPrefetchedItems:function(){return $(".UniversalPageFeed").find(".preloaded_pf")},hasHiddenPrefetchedStories:function(){return this.getPrefetchedItems().length>0},prefetchPersistentFeed:function(){var e=this;if(!this.usePersistentFeed){return}if(this.currently_fetching||this.waiting_for_updates||this.waiting_for_updates_from_preload){d("feed.UniversalPageFeed.prefetchPersistentFeed","end early","    currently_fetching:",this.currently_fetching,"    waiting_for_updates:",this.waiting_for_updates,"    waiting_for_updates_from_preload:",this.waiting_for_updates_from_preload);return}if(this.hasHiddenPrefetchedStories()){d("feed.UniversalPageFeed.prefetchPersistentFeed","already prefetched");return}if(this.numConsecutivePreloadFails>2){d("feed.UniveresalPageFEed.prefetchPersistentFeed","rate limit due to consecutive fails");
return}d("feed.UniversalPageFeed.prefetchPersistentFeed","start");e.waiting_for_updates_from_preload=true;this.serverCall("prefetch_stories").kwargs({cid:this.cid,current:this.model_count}).success(function(t){if(!t){e.waiting_for_updates_from_preload=false;e.numConsecutivePreloadFails+=1;d("feed.UniversalPageFeed.prefetchPersistentFeed","prefetch return empty. number of consecutive failures:",e.numConsecutivePreloadFails)}else{d("feed.UniversalPageFeed.prefetchPersistentFeed","prefetch return success",e.waiting_for_updates_from_preload);e.numConsecutivePreloadFails=0}}).error(function(){e.waiting_for_updates_from_preload=false;e.numConsecutivePreloadFails+=1;d("feed.UniversalPageFeed.prefetchPersistentFeed","prefetch return error. number of consecutive failures:",e.numConsecutivePreloadFails)}).send();d("feed.UniversalPageFeed.prefetchPersistentFeed","fetched")},revealStories:function(){setTimeout(function(){$(".reveal_story").removeClass("reveal_story")},1500)},revealPreloadedPersistentFeed:function(e,t){
if(!this.usePersistentFeed){return}d("feed.UniversalPageFeed.revealPreloadedPersistentFeed","start");if(!this.hasHiddenPrefetchedStories()){d("feed.UniversalPageFeed.revealPreloadedPersistentFeed","no stories to reveal");return}if(e){var i=+new Date;this.lastRevealTime=i}var n=this.children();var s=0;var o=false;for(var r=0;r<n.length;r++){var a=n[r];var l=a.$("#@item");if(l.hasClass("preloaded_pf")){l.removeClass("preloaded_pf");l.removeClass("hidden");if(e&&t){l.addClass("reveal_story");this.revealStories()}++s;if(!o){this.firstElement=a.getHash();o=true}}else if(l.hasClass("hidden_timestamp")){l.removeClass("hidden_timestamp");l.removeClass("hidden")}}d("feed.UniversalPageFeed.revealPreloadedPersistentFeed",s,"stories revealed");this.hideMoreStoriesButton();if(e){this.scrollToTop()}d("feed.UniversalPageFeed.revealPreloadedPersistentFeed","server call");this.serverCall("reveal_stories").send();d("feed.UniversalPageFeed.revealPreloadedPersistentFeed","end")},scrollToTop:function(){var e=$(".SiteHeader");
var i=0;if(e){i=e.height()}var n=$(t.getLiveDomElement(this.cid));var s=n.prev(".HomeMainFeedHeader")[0];var o=0;if(s){o=s.offsetTop}else{o=n[0].offsetTop}var r=30;var a=Math.max(o*2,window.innerHeight*2);var d=o-i-r;window.scrollTo(0,a);$("html, body").animate({scrollTop:d},700)},showMoreStoriesButton:function(){if(!this.usePersistentFeed||!this.hasHiddenPrefetchedStories()||this.bannerShown){return}d("feed.UniversalPageFeed.showMoreStoriesButton","show more stories button");var e=this.child("more_stories");var t=e.$("#@more_stories");t.removeClass("hidden");this.moreStoriesShown=true},hideMoreStoriesButton:function(){if(!this.usePersistentFeed){return}d("feed.UniversalPageFeed.hideMoreStoriesButton","hide more stories button");var e=this.child("more_stories");var t=e.$("#@more_stories");t.addClass("hidden")},bottomIndicatorIsVisible:function(){var e=$(".FeedBottomIndicator");return e&&c.isElementInViewport(e.get(0))},updatePositions:function(e){var i=this.children();var n=false;var s,o,r,a;
if(!e){a=this.offset;for(s=0;s<i.length;s++){r=i[s];if(!r.getDvar){continue}if(r.getDvar("feed_story_hash")==this.firstElement){var d=this.orderedVisibleChildren();for(o=0;o<d.length;o++){if(d[o]==t.getLiveDomId(r.cid)){this.offset=o}}}}if(this.offset!=a){n=true}}var l=this.orderedVisibleChildren();var c,u;this.firstQueryID=0;for(o=0;o<l.length;o++){c=document.getElementById(l[o]);r=t.getComponentFromElement(c);u=r.$("#@item");if(this.firstQueryID<=0&&!u.hasClass("preloaded_pf")){this.firstQueryID=r.query_id}var h=o-this.offset+this.num_prefeed_stories;var f=r.getHash();this.hashPosition[f]=h}if(e){for(o=0;o<i.length;o++){if(t.getLiveDomId(i[o].cid)==l[0]){this.firstElement=i[o].getDvar("feed_story_hash")}}}return n},addReadingTimeEntry:function(e){this.readingTimeUpdates.push({hash:e,position:this.hashPosition[e],initially_visible:this.initiallyVisible.hasOwnProperty(e),reading_time:this.hashReadingTime[e],bundle_position:this.bundle_position});this.loggedReadingTime[e]=this.hashReadingTime[e];
},updateVisibility:function(e){var t=+new Date;if(!document.hasFocus()||this.dontLogImpressions){this.lastVisibilityUpdate=t;return}var i=this.children();var n,s,o;for(o=0;o<i.length;o++){n=i[o];if(!n.getHash||!n.validForLoggingImpression(false)){continue}s=n.getHash();if(n.isVisible()){if(this.hashPreviousVisibleTime[s]===this.lastVisibilityUpdate&&this.lastVisibilityUpdate>t-2*this.reading_time_rate){this.hashReadingTime[s]=(this.hashReadingTime[s]||0)+(t-this.lastVisibilityUpdate)}this.hashPreviousVisibleTime[s]=t}else if(this.hashReadingTime[s]&&this.hashReadingTime[s]>this.loggedReadingTime[s]){this.addReadingTimeEntry(s)}}var r;for(s in this.hashReadingTime){r=this.nextThreshold[s]||0;if(this.hashPosition.hasOwnProperty(s)&&this.reading_time_thresholds[r]&&this.hashReadingTime[s]>=this.reading_time_thresholds[r]){this.addReadingTimeEntry(s);this.nextThreshold[s]=r+1}}if(this.readingTimeUpdates.length>0&&this.viewerUid&&t-this.pageLoadTime>=this.wait_until_log_impression_ms){var a=this.readingTimeUpdates;
d("feed.UniversalPageFeed.updateVisibility","server call");l.log("feed_reading_times",{request_data:a,__js_data__:this.__js_init});d("feed.UniversalPageFeed.updateVisibility","server call sent");this.readingTimeUpdates=[]}d("feed.UniversalPageFeed.updateVisibility","end");this.lastVisibilityUpdate=t},addImpression:function(e,i){var n=e.getHash();this.hashImpressions[n]=true;this.impressionData.push({hash:n,initially_visible:this.initiallyVisible.hasOwnProperty(n),position:i,bundle_position:this.bundle_position});if(h.feed_impression_feedback){var s=t._domids[e.cid];var o=$(document.getElementById(s));this.visibleStorySelectors.push(o)}},recordImpressions:function(e){if(this.debug){return}var i=this;var n=+new Date;var s=e||this.needsRefresh;this.needsRefresh=false;if(!s&&n<this.lastCheckTime+this.rate_limiter_ms||n<this.lastRevealTime+3e3){return}this.lastCheckTime=n;d("feed.UniversalPageFeed.recordImpressions","started, called with",e);var o=this.children();var r,a;s=this.updatePositions(e)||s;
var c=false;for(a=0;a<o.length;a++){r=o[a];if(!r.getHash||!r.validForLoggingImpression(s)){continue}var u=r.isVisible();var h=r.getHash();var f=this.hashPosition[h];d("feed.UniversalPageFeed.recordImpressions","    firstQueryID:",this.firstQueryID,"    comp.query_id:",r.query_id,"    domid:",t._domids[r.cid],"    inViewport:",u,"    position:",f,"    bundle_position:",this.bundle_position,"    hash:",h);if(this.usePersistentFeed&&u){this.maxImpPos=Math.max(this.maxImpPos,f);if(r.query_id!=this.firstQueryID&&r.query_id>0){d("feed.UniversalPageFeed.recordImpressions","diff",r.query_id,this.firstQueryID);c=true}else if(!this.moreStoriesShown&&(this.pfInitialMoreStoriesPos>=0&&f>=this.pfInitialMoreStoriesPos)){d("feed.UniversalPageFeed.recordImpressions","initial morestories button shown: pos",f);c=true}}if(this.hashImpressions[h]||!s&&!u){continue}d("feed.UniversalPageFeed.recordImpressions","check to see if should reset dvars/record impression");if(s){r.setDvar("feed_story_position",f);r.setDvar("feed_story_initial",true);
}if(u){d("feed.UniversalPageFeed.recordImpressions","impression recorded");if(e){i.initiallyVisible[r.getHash()]=true}this.addImpression(r,f)}}if(c||this.bottomIndicatorIsVisible()){if(this.hasHiddenPrefetchedStories()){this.showMoreStoriesButton()}}if(this.impressionData.length>0&&this.viewerUid&&n-this.pageLoadTime>=this.wait_until_log_impression_ms){var p=this.impressionData;if(!this.dontLogImpressions){d("feed.UniversalPageFeed.recordImpressions","server call");l.log("feed_impression",{request_data:p,__js_data__:this.__js_init});d("feed.UniversalPageFeed.recordImpressions","server call sent")}for(var g=0;g<this.visibleStorySelectors.length;g++){this.visibleStorySelectors[g].addClass("seen")}this.visibleStorySelectors=[];this.impressionData=[]}d("feed.UniversalPageFeed.recordImpressions","end")}});exports.DigestFeed=exports.UniversalPageFeed.extend({onPagingDone:function(){this._super.apply(this,arguments);this.emitEvent({type:a.Types.FEED_PAGING_DONE,payload:{}})}});exports.QuestionPageNuxFeed=exports.UniversalPageFeed.extend({
onPagingDone:function(){this._super.apply(this,arguments);this.emitEvent({type:a.Types.FEED_PAGING_DONE,payload:{}})}});exports.FeedMain=require("app/view/home").HomeMain.extend({onLoad:function(){this._super.apply(this,arguments);var e=o.getURL();if(e.indexOf("?qp_story=")!=-1||e.indexOf("?digest_story=")!=-1){o.replaceURL("/");$("#feed_visibility_wrapper").removeClass("invisible")}}});exports.PinnedFeedMain=require("app/view/home").HomeMain.extend({onLoad:function(){this._super.apply(this,arguments);this.removeQpUrlParam()},removeQpUrlParam:function(){var e=o.getURL();var t=e.indexOf("?qp_story=");if(t!=-1){o.replaceURL(e.substring(0,t));this.child("pinned_feed").$("#@topic_feed").removeClass("invisible")}}});exports.ExpandableLink=i.extend({onLoad:function(){var e=this;this.$id("@show").click(function(){e.$id("@inner_tree").show();e.$id("@show").hide();return false});this.$id("@hide").click(function(){e.$id("@inner_tree").hide();e.$id("@show").show();return false})}});exports.ContentPageFeedStoryItemBase=i.extend({
onLoad:function(){var e=this;var t="";this.$id("@item .truncated_q_text a.more_link").html(t).removeClass("more_link").removeAttr("id").addClass("read_more").attr("href",this.target_url);this.$id("@item a.lil_button.rate_up").removeAttr("id").attr("href",this.target_url);this.$id("@item .answer_content").css({cursor:"pointer"});this.$id("@item_overlay").mousedown(function(){e.serverCall("on_item_click").send();return false})}});exports.QuestionNumberAnswers=i.extend({onLoad:function(e){var t=this;this.$id("@link").mousedown(function(){r.setQfeedLog(t,"QuestionClickthrough");r.setQueryLog(t,"QuestionClickthrough")})}});exports.HomepageFeedStoryItem=i.extend({init:function(){this._super.apply(this,arguments);this.setDvar("feed_story_hash",this.hash);var e=this;e.allowServerCall=true;e.alreadySent=false;function t(){if(e.alreadySent){return}e.alreadySent=true;r.setMessage("vtc",[e.hash,e.view_tracking_key]);if(e.allowServerCall){e.serverCall("dummy_call_nonlivedepped").send()}}this.parent().needsRefresh=true;
this.$id("@item").mousedown(t);$("a",this.$id("@item")).mousedown(function(i){e.allowServerCall=i.target.pathname==window.location.pathname;t()});if(this.scroll_to_top){var i=this.$id("@item").offset().top;i-=o.headerOffset+20;window.scroll(0,i);p.highlight(this.$id("@item"),2e3)}if(e.is_suggestion_story){this.handleEvent(a.Types.CAROUSEL_DISMISS_ALL,function(t){if(t.payload.story_oid!=e.oid){return}e.$id("@item").fadeOut(300,function(){$(this).hide()})})}},onLoad:function(){var e=this;e.questionFeedbackLoaded=false;e.answerFeedbackLoaded=false;u.addComponentToTrack(e);this.handleEvent(a.Types.ANSWER_VOTE_STATE,function(t){if(t.payload.aid==e.aid){var i=t.payload.state=="upvoted";var n=t.payload.state=="downvoted";if(i){e.showRelatedStories()}else{e.hideRelatedStories()}if(n){e.showAnswerDownvoteFeedback()}else{e.hideDownvoteFeedback("answer")}}});e.handleEvent(a.Types.QUESTION_VOTE_STATE,function(t){if(t.payload.qid==e.qid){if(t.payload.state=="downvoted"){e.showQuestionDownvoteFeedback();
}else{e.hideDownvoteFeedback("question")}}});e.handleEvent(a.Types.QUESTION_CANT_ANSWER_STATE,function(t){if(t.payload.qid==e.qid){var i=t.payload.state=="passed";e.$id("@item").toggleClass("cant_answer",i)}})},showRelatedStories:function(){if(!h.related_stories){return}var e=this;e.$stories=e.$id("@related_stories");e.serverCall("load_related_stories").contentFor(e.$stories,{parentCid:e.cid}).success(function(){e.$stories.removeClass("hidden")}).send()},hideRelatedStories:function(){},scrollFeedbackToViewport:function(){var e=this.$id("@feed_item").offset().top;if($(window).scrollTop()>e){$("html, body").animate({scrollTop:e-80},1e3)}},showAnswerDownvoteFeedback:function(){var e=this;e.$id("@feed_item").addClass("hidden");e.$id("@answer_feedback").removeClass("hidden");e.scrollFeedbackToViewport();if(e.answerFeedbackLoaded===false){e.serverCall("load_downvote_feedback").kwargs({feedback_type:"answer"}).contentFor(e.$id("@answer_feedback"),{parentCid:e.cid}).success(function(){e.answerFeedbackLoaded=true;
}).send()}},showQuestionDownvoteFeedback:function(){var e=this;e.$id("@feed_item").addClass("hidden");e.$id("@question_feedback").removeClass("hidden");e.scrollFeedbackToViewport();if(e.questionFeedbackLoaded===false){e.serverCall("load_downvote_feedback").kwargs({feedback_type:"question"}).contentFor(e.$id("@question_feedback"),{parentCid:e.cid}).success(function(){e.questionFeedbackLoaded=true}).send()}},hideDownvoteFeedback:function(e){this.$id("@feed_item").removeClass("hidden");if(e=="question"){this.$id("@question_feedback").addClass("hidden")}else if(e=="answer"){this.$id("@answer_feedback").addClass("hidden")}},getHash:function(){return this.hash},isVisible:function(){var e=$("#"+t.getLiveParent(this.cid));if(!e.is(":visible")){return false}var i=this.$id("@item");return!i.hasClass("hidden")&&c.isElementInViewport(e.get(0))},validForLoggingImpression:function(e){var i=t.getLiveParent(this.cid);if(!i){return false}var n=$("#"+i);if(!e&&!n.is(":visible")){return false}return true}
});exports.FeedBottomIndicator=i.extend({onLoad:function(){var e=this;this.$id("@feed_bottom").click(function(){e.parent().onFeedBottomIndicatorClicked()})}});exports.InlineFollowSuggestionCard=f.extend({onLoad:function(){this._super.apply(this,arguments);this.setDvar("feed_story_inner_position",this.inner_position)}});exports.PinnedTopicHeader=i.extend({onLoad:function(){var e=this;var t=e.$id("@topic_header");var i=t.height();n.makeFixable(t,{scroll_dep:true,min_height:i,min_scroll:i+20});t[0].addEventListener("w2.fixable.fixed",function(){t.css({top:$(".SiteHeader").outerHeight()})})}});exports.AMASuggestionCard=f.extend({onLoad:function(){this._super.apply(this,arguments);var e=this;e.$id("@ama_suggestion_card").on("click",function(){r.setQfeedLog(e,"AMAClickthrough")});s(e.$id("@ama_suggestion_card .name").get(0),{lines:1});s(e.$id("@ama_suggestion_card .sig").get(0),{lines:2})}})});define("app/view/feed/ama",["shared/polyfills","webnode2","shared/views"],function It(require,exports,e){
var t=require("webnode2").Component,i=require("shared/views").viewsLogger;exports.AMAFeedItem=t.extend({onLoad:function(){i.addComponentToTrack(this)}});exports.AMAListItem=t.extend({onLoad:function(){var e=this;e.$id("@item_button").click(function(){if(!e.is_following){e.serverCall("show_pmsg").liveMutate().send()}e.is_following=!e.is_following})}})});define("app/view/feed/question",["shared/polyfills","webnode2","shared/events/index","shared/w2.context"],function qt(require,exports,e){var t=require("webnode2").Component,i=require("shared/events/index"),n=require("shared/w2.context");exports.QuestionStoryEditable=t.extend({onLoad:function(){this.$editorElem=this.getEditor();this.$storyElem=this.getStory();this.$hoverElem=this.$storyElem.closest(".hover_highlight");var e=this;this.handleEvent(i.Types.QUESTION_EDITING_STATE,function(t){if(t.payload.qid!=e.qid){return}if(t.payload.state=="edit"){e.openEditor()}else if(t.payload.state=="request"){e.closeEditor()}else if(t.payload.state=="cancel"){
e.closeEditor()}});this.modalStoryContext=this.getContext(n.StoryItemModal);this.editor_fetched=false},getEditor:function(){return this.$id("@question_story_editable")},getStory:function(){return this.$id("@question_story")},loadEditor:function(){this.editor_fetched=true;this.serverCall("load_editor").contentFor(this.$editorElem).send()},openEditor:function(){this.$storyElem.addClass("hidden");this.$editorElem.removeClass("hidden");if(this.$hoverElem){this.$hoverElem.removeClass("hover_highlight")}if(this.modalStoryContext){this.modalStoryContext.set("disableModal",true)}if(!this.editor_fetched){this.loadEditor()}},closeEditor:function(){this.$editorElem.addClass("hidden");this.$storyElem.removeClass("hidden");if(this.$hoverElem){this.$hoverElem.addClass("hover_highlight")}if(this.modalStoryContext){this.modalStoryContext.set("disableModal",false)}}});exports.QuestionStoryEditableToggled=t.extend({onLoad:function(){this.$id("@feed_question_update").on("click",this.updateQuestion.bind(this));
this.$id("@feed_question_cancel").on("click",this.closeEditor.bind(this))},updateQuestion:function(){this.emitEvent({type:i.Types.QUESTION_EDITING_STATE,payload:{qid:this.qid,state:"request"}})},closeEditor:function(){this.emitEvent({type:i.Types.QUESTION_EDITING_STATE,payload:{qid:this.qid,state:"cancel"}})}})});define("app/view/feed/answer",["shared/polyfills","app/view/feed/question"],function Nt(require,exports,e){var t=require("app/view/feed/question");exports.EditableQuestionAnswerStory=t.QuestionStoryEditable.extend({getEditor:function(){return this.$id("@question_answer_story_editable")},getStory:function(){return this.$id("@answer_story")}})});define("app/view/feed/feedback",["shared/polyfills","webnode2","shared/events/index"],function Ot(require,exports,e){var t=require("webnode2").Component,i=require("shared/events/index");exports.Feedback=t.extend({onLoad:function(){var e=this;if(e.can_undo){e.$id("@undo").click(function(t){t.preventDefault();e.undoDownvote();e.serverCall("undo").liveMutate().error(function(){
e.redoDownvote()}).send()})}},undoDownvote:function(){if(this.type=="question"){this.emitEvent(i.helpers.removeQuestionDownvote(this.oid))}else if(this.type=="answer"){this.emitEvent(i.helpers.removeAnswerDownvote(this.oid))}},redoDownvote:function(){if(this.type=="question"){this.emitEvent(i.helpers.addQuestionDownvote(this.oid))}else if(this.type=="answer"){this.emitEvent(i.helpers.addAnswerDownvote(this.oid))}}})});define("unified_view/button/abstract",["shared/polyfills","shared/core/component","interface/settings","shared/cookies","shared/perf","shared/client"],function Rt(require,exports,e){var t=require("shared/core/component").Component,i=require("interface/settings"),n=require("shared/cookies"),s=require("shared/perf");exports.Button=t.extend({onLoad:function(){this._userPerceivedAction=null;if(!this.disabled){var e=this,t=e.$id("@button");t.on("click",function(t){t.preventDefault();e.onClick()})}},onClick:function(){this.onPressed()},onPressed:function(){var e=this;if(e.qfeed_log_press_action){
n.setQfeedLog(e,e.qfeed_log_press_action)}this._userPerceivedAction=s.startUserPerceived({vcon:this.__vcon,method:"press"});this.serverCall("press").disableDefaultUserPerceivedLogging().liveMutate().error(function(){e.switchState(false)}).send()}});exports.TwoStateButton=exports.Button.extend({onClick:function(){this.dirtyURL();var e=this.pressed;if(e){this.onUnpressed()}else{this.onPressed()}this.switchState(!e)},dirtyURL:function(){var e=this;if(i.pageIsMobile){if(e.url_to_dirty){if(require("shared/client").isNativeApp()){var t=require("mobile_app2/messages");t.send("removeURLFromCache",{url:e.url_to_dirty})}}}},switchState:function(e){if(this.pressed==e){return}if(!i.isLoggedIn){return}var t=this.$id("@button");var n=this.$id("@text");var o=n.text();n.text(this.optimistic_text);this.optimistic_text=o;if(this.optimistic_count){var r=this.$id("@count");if(this.optimistic_count==="0"){r.addClass("hidden")}else{r.removeClass("hidden")}var a=r.text();r.text(this.optimistic_count);this.optimistic_count=a;
}if(this.pressed){t.removeClass("pressed")}else{t.addClass("pressed")}this.pressed=e;if(this._userPerceivedAction){s.finishAction(this._userPerceivedAction);this._userPerceivedAction=null}},onPressedKwargs:function(){return{}},onPressed:function(){var e=this;if(e.qfeed_log_press_action){n.setQfeedLog(e,e.qfeed_log_press_action)}this._userPerceivedAction=s.startUserPerceived({vcon:this.__vcon,method:"press"});var t=this.onPressedKwargs();this.serverCall("press").disableDefaultUserPerceivedLogging().liveMutate({optimisticUpdate:true}).kwargs(t).error(function(){e.switchState(false)}).send()},onUnpressedKwargs:function(){return{}},onUnpressed:function(){var e=this;if(e.qfeed_log_unpress_action){n.setQfeedLog(e,e.qfeed_log_unpress_action)}this._userPerceivedAction=s.startUserPerceived({vcon:this.__vcon,method:"unpress"});var t=this.onUnpressedKwargs();this.serverCall("unpress").disableDefaultUserPerceivedLogging().liveMutate({optimisticUpdate:true}).kwargs(t).error(function(){e.switchState(true);
}).send()}})});define("unified_view/button/write_answer",["shared/polyfills","interface/settings","shared/events/index","unified_view/button/abstract"],function Pt(require,exports,e){var t=require("interface/settings"),i=require("shared/events/index"),n=require("unified_view/button/abstract").Button;exports.WriteAnswer=n.extend({onLoad:function(){if(!this.use_answer_draft_page){this._super.apply(this,arguments)}},onClick:function(){if(!this.logged_in){this.serverCall("force_login").send();return}if(!t.pageIsMobile){this.$id("@button").addClass("disabled")}this.emitEvent({type:i.Types.ANSWER_TOGGLE_EDITOR,payload:{qid:this.qid,bundle:this.getDvar("__writeMultiFeedBundle")}})}})});define("app/view/feed/modal",["shared/polyfills","view/modal","shared/events/index","unified_view/button/write_answer","shared/client_tracker","shared/cookies","shared/window_manager","shared/logging","shared/beforeunload","shared/w2.context","w2.modal"],function Bt(require,exports,e){var t=require("view/modal").ToggleModal,i=require("shared/events/index"),n=require("unified_view/button/write_answer").WriteAnswer,s=require("shared/client_tracker"),o=require("shared/cookies"),r=require("shared/window_manager"),a=require("shared/logging"),d=require("shared/beforeunload"),l=require("shared/w2.context").StoryItemModal,c=require("w2.modal"),u;
u=r.getURL();d.registerHandler(function(){r.replaceURL(u)});var h=c.ModalBase.extend({_onCloseCallBack:null,onCloseCallBack:function(e){this._onCloseCallBack=e;return this},close:function(){this._super.apply(this,arguments);if(this._onCloseCallBack){this._onCloseCallBack()}}});exports.StoryItemToggleModal=t.extend({contextConstructor:function(){return l},onLoadInline:function(){this._super.apply(this,arguments);this.storyItemModalContext=this.getContext(l)},initModal:function(){this._modal=new h(this,{kwargs:{serialized_args:this.serialized_args},closeOnScroll:this.close_on_scroll,showFixedCloseButton:true,customOverlayClass:"feed_desktop_modal"}).onCloseCallBack(this.closeModal.bind(this))},showModal:function(){if(this.storyItemModalContext.get("disableModal")){return}this._super.apply(this,arguments);this.emitEvent({type:i.Types.FEED_IMPRESSIONS_DISABLED,payload:{disabled:true}});if(this.qfeed_primary_action){s.track(this.qfeed_primary_action,null,this);o.setQfeedLog(this,this.qfeed_primary_action);
}r.replaceURL(this.story_url);this._logAction("open")},closeModal:function(){this.emitEvent({type:i.Types.FEED_IMPRESSIONS_DISABLED,payload:{disabled:false}});r.replaceURL(u);this._logAction("close")},handleClick:function(e){e.preventDefault();this.$inlineElem.addClass("read_item");if(e.button===0&&!e.ctrlKey&&!e.metaKey&&!e.shiftKey){this.showModal()}else{window.open(this.story_url,"_blank")}},_logAction:function(e){a.log("web_modal_reading_time",{action:e,time:Date.now(),object_type:this.obj_type,object_id:this.obj_id,page_type:this.page_type})}});exports.WriteAnswerButton=n.extend({onLoad:function(){var e=this,t=e.$id("@button");t.on("click",function(t){t.preventDefault();e.onClick()})},onClick:function(){new h(this,{kwargs:{qid:this.qid,serialized_dvars:this.serialized_dvars},showFixedCloseButton:true,customOverlayClass:"feed_desktop_modal"}).load("load_modal")}})});define("app/view/funnel",["shared/polyfills","webnode2","shared/cookies","shared/keystrokes"],function Ft(require,exports,e){
var t=require("webnode2").Component,i=require("shared/cookies"),n=require("shared/keystrokes"),s;exports.FunnelState=t.extend({onLoad:function(){var e=this;e.$id("@show_unstarted").click(function(){e.$id("@unstarted").show();e.$id("@show_unstarted").hide()});e.$id("@refresh").click(function(){window.location.reload()})}});exports.ResetFunnelLink=t.extend({onLoad:function(){var e=this;e.$id("@reset").click(function(){e.serverCall("reset_funnel").success(function(){window.location.reload()}).send()})}});exports.ActivateFunnelLink=t.extend({onLoad:function(){var e=this;e.$id("@activate").click(function(){e.serverCall("activate_funnel").liveMutate().send()})}});n.on([70,48,70,48],function(){if(s){s.toggle()}});exports.FunnelRideAlong=t.extend({onLoad:function(){var e=this,t;s=e;e.$id("@wrapper").hover(function(){t=clearTimeout(t);e.hovering=true;e.slideIn()},function(){t=setTimeout(function(){e.hovering=false;e.slideOut()},500)})},toggle:function(){if(this.$id("@wrapper").hasClass("hidden")){
this.turnOn()}else{this.turnOff()}},turnOn:function(){this.$id("@wrapper").removeClass("hidden");i.setCookie("funnelRideAlongOnByDefault","1")},turnOff:function(){this.$id("@wrapper").addClass("hidden");i.setCookie("funnelRideAlongOnByDefault",null)},slideOut:function(){if(!this.hovering){var e=this.$id("@wrapper"),t=parseInt(e.css("padding"));e.animate({right:t-e.width()+50+"px"})}},slideIn:function(){this.$id("@wrapper").animate({right:"0px"})}})});define("app/view/growl",["shared/polyfills","webnode2"],function Ut(require,exports,e){var t=require("webnode2").Component;var i=false;exports.GrowlBase=t.extend({onLoad:function(e){var t=this;this.growl=this.$id("@growl");if(this.age_sec<(!e?15:1.5)){this.show(!e)}this.growl.mouseover(function(e){if(!t.growl.hasClass("fade_out")){clearTimeout(t.hideTimer);t.growl.removeClass("fade_out");t.customMouseOver()}});this.growl.mouseout(function(e){t.hideAfter(1)});this.hideAfter(this.visible_sec)},show:function(e){var t=this;if(i){e=false}i=true;if(e){
this.growl.addClass("fade_in")}this.growl.removeClass("fade_out").removeClass("hidden");if(e){setTimeout(function(){t.growl.removeClass("fade_in")},200)}},hideAfter:function(e){this.hideTimer=setTimeout(this.hide.bind(this),e*1e3)},hide:function(){var e=this;this.growl.addClass("fade_out");setTimeout(function(){if(e.growl.hasClass("fade_out")){e.growl.addClass("hidden").removeClass("fade_out");i=false}},1250)},customMouseOver:function(){}})});define("app/view/intro_to_quora",["shared/polyfills","interface/jquery","webnode2"],function jt(require,exports,e){var $=require("interface/jquery")._jQuery,t=require("webnode2").Component;exports.ITQSidebar=t.extend({onLoad:function(){var e=this;e.stepHandler=function(t){e.nextStep(t)};e.introToQuoraSidebar=e.$id("@intro_to_quora_sidebar");e.activeInstruction=e.$(".sidebar_step_show");e.highlight(e.currStep);e.scrollToStory(e.currStep);e.$id("@close").one("click",function(){e.cancel()});e.$("div[sidebar-selector=next_step]").one("click",function(){
e.nextStep()});e.$("div[sidebar-selector=opt_out]").one("click",function(){e.cancel()});e.serverCall("log_impression").send()},nextStep:function(){var e=this;e.activeInstruction=e.activeInstruction.next();if(e.activeInstruction.length!==0){e.activeInstruction.prev().hide(0);e.activeInstruction.show(0);e.currStep++;e.highlight(e.currStep);e.scrollToStory(e.currStep);e.serverCall("complete_step").kwargs({step_num:e.currStep}).send()}else{e.serverCall("complete_itq").liveMutate().send();e.close()}},highlight:function(e){this.clearHighlight();var t={pinned_topics:{selector:".HomeNavList"},upvote:{selector:".add_upvote"},follow:{selector:".itq_follow"},answer:[{selector:".answer_editor"},{selector:".write_answer"}],ask:{selector:".AddQuestionLookupBarButton",noticeSuffix:"_bottom_left"}};e=e.toString();var i=this.stepMap[e];if(i in t){var n=t[i];if(!Array.isArray(n)){n=[n]}for(var s=0;s<n.length;s++){var o=n[s];var r="itq_notice_bubble";var a=o.selector;if(typeof o.noticeSuffix!=="undefined"){
r+=o.noticeSuffix}$(a).addClass(r);$(a).one("click",this.stepHandler)}}if(i==="ask"){this.introToQuoraSidebar.addClass("intro_to_quora_sidebar_point_up")}},clearHighlight:function(){var e=["","_bottom_left","_smaller"];for(var t=0;t<e.length;t++){var i="itq_notice_bubble"+e[t];$("."+i).unbind("click",this.stepHandler);$("."+i).removeClass(i)}this.introToQuoraSidebar.removeClass("intro_to_quora_sidebar_point_up")},selectStory:function(e){var t={upvote:"a.add_upvote",follow:"a.itq_follow",answer:"a.write_answer"};var i=null;var n=this.stepMap[e.toString()];if(n in t){i=t[n];if(Array.isArray(i)){i=i.join(",")}}else{return null}var s=$(".pagedlist_item").has(i);var o=null;for(var r=0;r<s.length;r++){var a=$(s[r]);var d=a.offset().top-$(window).scrollTop();if($(window).scrollTop()){d-=$(".SiteHeader").height()}else{d-=$(".Feed").offset().top}if(d>=0){return a}else{o=a}}return o},scrollToStory:function(e){var t=this;var i=t.selectStory(e);if(i===null){return}if(i.prev(".pagedlist_item").length===0){
$("body").animate({scrollTop:0},1e3)}else{var n=i.prev(".pagedlist_item");var s=n.offset().top+n.height()-$(".SiteHeader").height();$("body").animate({scrollTop:s},1e3)}},close:function(){var e=this;e.clearHighlight();e.$(".sidebar_title").css("white-space","nowrap");e.introToQuoraSidebar.animate({opacity:0},1e3);e.introToQuoraSidebar.addClass("hidden")},cancel:function(){this.serverCall("cancel_itq").liveMutate().send();this.close()}})});define("shared/youtube",["shared/polyfills","shared/loadjs","shared/util","shared/onload"],function Ht(require,exports,e){var t=require("shared/loadjs").loadJS,i=require("shared/util"),n=require("shared/onload"),s=[],o=false;var r=i.once(function(){t("//www.youtube.com/player_api",function(){o=true;while(s.length){s.pop().call()}})});exports.onInit=function(e){if(o){e()}else{n.execAfterLoadDelayed(r);s.push(e)}}});define("view/livenode",["shared/polyfills","shared/log","jquery","webnode2","shared/events/index","w2.livenode","shared/core/component","shared/window_manager","shared/loading"],function Qt(require,exports,e){
var t=require("shared/log").log,$=require("jquery"),i=require("webnode2"),n=require("shared/events/index"),s=i.Component,o=require("w2.livenode"),r=require("shared/core/component"),a=require("shared/window_manager"),d=require("shared/loading");exports.LiveSpinner=s.extend({init:function(){this._super.apply(this,arguments);this.t=null;this.showing=false;var e=this;this.handleEvent(n.Types.LIVENODE_LOADING_SPINNER,function(t){if(t.payload.show){e.show()}else{e.hide()}})},show:function(){if(this.showing){return}this.showing=true;if(!this.spinner){this.spinner=d.createLoadingDotsElement({size:"small"});this.$id("@spinner").append(this.spinner)}this.$id("@loading").removeClass("fade_out").removeClass("hidden")},hide:function(){var e=this;if(!this.showing){return}this.showing=false;this.$id("@loading").addClass("fade_out");setTimeout(function(){if(e.$id("@loading").hasClass("fade_out")){e.$id("@loading").removeClass("fade_out").addClass("hidden")}},150)}});exports.ErrorBanner=s.extend({init:function(){
var e=this;this._super.apply(this,arguments);i.Error=this;this.shown=false;this.$id("@hide").click(function(){e.hide();return false})},show:function(e){e=e||this.default_text;this.$id("@text").text(e);if(this.shown){return}this.shown=true;this.emitEvent({type:n.Types.INTERACTION_MODE_BANNER_STATE,payload:{shown:true}});this.$id("@banner").show().addClass("fade_in");l()},hide:function(){if(!this.shown){return}this.shown=false;this.emitEvent({type:n.Types.INTERACTION_MODE_BANNER_STATE,payload:{shown:false}});var e=this;e.$id("@banner").removeClass("fade_in").addClass("fade_out");setTimeout(function(){e.$id("@banner").hide()},150);c()}});var l=exports.addContentPadding=function(){$(".ContentWrapper").addClass("extra_padding");$(".NotifHeaderBar").addClass("extra_padding")};var c=function(){$(".ContentWrapper").removeClass("extra_padding");$(".NotifHeaderBar").removeClass("extra_padding")};exports.InteractionModeBanner=s.extend({init:function(){this._super.apply(this,arguments);i.interactionMode=this;
this._changedComponents={};this._cidToDomId={};this._otherInteractions={};this._states={OFF:0,PENDING:1,ON:2,BLOCKING:3}},onLoad:function(){var e=this;if(t&&t.enabled){t("w2.interaction.InteractionModeBanner.onLoad","onLoad is called on",this)}this.resumeUpdates();this._state=this._states.OFF;this._lastVal=null;this._lastDOMNode=null;this.bindInteractionMode($(":input,div[contenteditable=true]"));$(document).bind("w2addcomponents",function(n,s){var o=s.parents;if(t&&t.enabled){t("w2.interaction.InteractionModeBanner.onLoad","w2addcomponents is triggered, metadata: ",s)}$.each(o,function(t,n){var s=new i.VirtualComponent(t).$("%@interaction");e.bindInteractionMode(s)})})},updateStateForLastFocusedDOMElement:function(e){var t;if(!e){return false}if(this._state==this._states.PENDING){t=this._getCIDForElement(e);if(this._lastVal==this._val(e)){this._changedComponents[t]=this._states.OFF;return false}else{this._changedComponents[t]=this._states.ON;this._cidToDomId[t]=this._getLiveDOMIdForElement(e);
return true}}else if(this._state==this._states.ON){t=this._getCIDForElement(e);var i=this._changedComponents[t];if(this._lastVal==this._val(e)&&i==this._states.PENDING){this._changedComponents[t]=this._states.OFF;return false}else{this._changedComponents[t]=this._states.ON;this._cidToDomId[t]=this._getLiveDOMIdForElement(e);return true}}return false},_getLiveDOMIdForElement:function(e){if(e.id){if(e.id.substr(0,3)=="ld_"){return e.id}}if(e.parentNode){return this._getLiveDOMIdForElement(e.parentNode)}else{return null}},_getCIDForElement:function(e){if(!(e&&e.getAttribute)){return null}if(e.getAttribute("w2cid")){return e.getAttribute("w2cid")}else{return this._getCIDForElement(e.parentNode)}},isBlocking:function(){return this._state==this._states.BLOCKING},startBlocking:function(){var e=this;console.log("startBlocking called");var t=[];$.each(this._changedComponents,function(i,n){if(n==e._states.ON||n==e._states.PENDING){var s=r._components[i];if(!!s.meaningfulChangeCallback&&!s.draft_space){
t.push(s)}}});this.showBanner(t);l();this._setBlockingState()},_setBlockingState:function(){this._state=this._states.BLOCKING},bindInteractionMode:function(e){var t=this;e.not(".ignore_interaction").bind("focus.w2interactionmode",function(e){var i=t._getCIDForElement(e.target);t._lastVal=t._val(e.target);t._lastDOMNode=e.target;if(o.state.pendingMutationCount===0){if(t._state==t._states.OFF){t._changedComponents[i]=t._states.PENDING;t._state=t._states.PENDING}else{var n=t._changedComponents[i];if(!n||n==t._states.OFF){t._changedComponents[i]=t._states.PENDING}}}}).bind("blur.w2interactionmode",function(e){switch(t._state){case t._states.PENDING:t.updateStateForLastFocusedDOMElement(e.target);if(t._lastVal==t._val(e.target)){t._state=t._states.OFF}else{t._state=t._states.ON}break;case t._states.ON:t.updateStateForLastFocusedDOMElement(e.target);break;case t._states.OFF:case t._states.BLOCKING:break;default:console.error("Unknown state of InteractionMode at blur time... weird")}})},_val:function(e){
var t=$(e);if(t.is(":input")){return t.val()}else{return t.html()}},_setVal:function(e,t){var i=$(e);if(i.is(":input")){i.val(t)}else{i.html(t)}},showBanner:function(e){this.emitEvent({type:n.Types.INTERACTION_MODE_BANNER_STATE,payload:{shown:true}});if(e.length>0){this.$id("@draftable").removeClass("hidden");this.$id("@not_draftable").addClass("hidden");this.$id("@resume").click(function(t){$.each(e,function(e,t){t.meaningfulChangeCallback()});a.reload();return false})}return this.$id("@banner").show().removeClass("fade_out").addClass("fade_in")},hideBanner:function(){this.emitEvent({type:n.Types.INTERACTION_MODE_BANNER_STATE,payload:{shown:false}});var e=this;e.$id("@banner").removeClass("fade_in").addClass("fade_out");setTimeout(function(){e.$id("@banner").hide()},150);return},resumeUpdates:function(){this._state=this._states.OFF;this._changedComponents={};this.hideBanner();c();var e=o.state.interactionDelayedLivedepOperations;while(e.length>0&&this._state==this._states.OFF){var t=e.shift();
o.onLivedepOperations(t.data,t.textStatus,true)}}})});define("app/view/layout",["shared/polyfills","webnode2","interface/jquery","shared/youtube","w2.livenode","view/livenode","shared/keystrokes","shared/keyboard_event_handler"],function Wt(require,exports,e){var t=require("webnode2").Component,$=require("interface/jquery")._jQuery,i=require("shared/youtube"),n=require("w2.livenode"),s=require("view/livenode").addContentPadding,o=require("shared/keystrokes"),r=require("shared/keyboard_event_handler");exports.QTextImageEnlarger=t.extend({onLoad:function(){var e=this;$(document).on("click",".qtext_image",function(t){e.openModal(t)});$(document).on("click",".photo_modal_bg, .photo_modal_close",function(){for(var t in e.masters){e.hideModal(e.masters[t])}})},getContainer:function(e,t){var i=this;i.masters={};return i.masters[e]||(i.masters[e]=$("<div>").addClass("photo_modal_container").append($("<div>").addClass("photo_modal_bg")).append($("<div>").addClass("photo_modal_close")).append($("<img>").addClass("photo_modal_img").attr("src",e)).append($("<img>").addClass("photo_modal_img_large").attr("src",t)));
},openModal:function(e){var t=this,i=$(e.target),n=i.attr("src"),s=i.attr("master_src"),o=i.hasClass("zoomable_in"),a=i.parents(".truncated_q_text").length>0,d=i.hasClass("qtext_image_large"),l=a&&!d;if(!o||!s||l){return}var c=parseInt(i.attr("master_w")),u=parseInt(i.attr("master_h")),h=$(window).width(),f=$(window).height(),p=t.getContainer(n,s),g=false;if(u>3*f&&u/c>3){g=true}if(c>h){u*=(h-40)/c;c=h-40}if(u>f){c*=(f-40)/u;u=f-40}var m=i.offset().left,v=i.offset().top-$(window).scrollTop(),_=Math.round((h-i.width())/2-m),w=Math.round((f-i.height())/2-v),b=c/i.width();p.find(".photo_modal_img").css("left",m).css("top",v).css("width",i.width()).css("height",i.height());if(g){p.find(".photo_modal_img").css("visibility","hidden")}p.appendTo("body");i.css("visibility","hidden");var y=$(document).scrollTop();$("body").css({position:"fixed",width:"100%",top:-y});var C=p.find(".photo_modal_close").outerWidth();if(g){p.find(".photo_modal_close").css("left",(h+parseInt(i.attr("master_w")))/2-C).css("top",(f-u)/2);
}else{p.find(".photo_modal_close").css("left",(h+c)/2-C).css("top",(f-u)/2)}t.handler=function(e){if(e.keyCode==27){e.preventDefault();t.hideModal(p)}};r.push(t.handler);setTimeout(function(){p.find(".photo_modal_bg, .photo_modal_close").addClass("active");if(g){p.find(".photo_modal_bg").css("height",20+parseInt(i.attr("master_h")))}else{p.find(".photo_modal_img").css("transform","translate3d("+_+"px,"+w+"px,0) scale("+b+")").css("-moz-transform","translate3d("+_+"px,"+w+"px,0) scale("+b+")").css("-ms-transform","translate3d("+_+"px,"+w+"px,0) scale("+b+")").css("-o-transform","translate3d("+_+"px,"+w+"px,0) scale("+b+")").css("-webkit-transform","translate3d("+_+"px,"+w+"px,0) scale("+b+")")}},1);var x=false;var k=false;setTimeout(function(){k=true;S()},333);if(g){p.css("position","fixed").css("overflow","scroll")}p.find(".photo_modal_img_large").load(function(){$(this).css("top",(f-u)/2);if(!g){$(this).css("left",(h-c)/2).css("width",c).css("height",u)}else{$(this).css("position","relative").css("left",(h-i.attr("master_w"))/2);
}x=true;S()});function S(){if(x&&k){p.find(".photo_modal_img_large").css("visibility","visible");p.find(".photo_modal_img").css("visibility","hidden")}}},hideModal:function(e){r.remove(this.handler);e.find(".photo_modal_bg, .photo_modal_close").removeClass("active");e.find(".photo_modal_img_large").remove();e.find(".photo_modal_img").css("visibility","visible");e.find(".photo_modal_img").css("-webkit-transform","translate3d(0,0,0) scale(1)");e.find(".photo_modal_img").css("-moz-transform","translate3d(0,0,0) scale(1)");e.find(".photo_modal_img").css("-ms-transform","translate3d(0,0,0) scale(1)");e.find(".photo_modal_img").css("-o-transform","translate3d(0,0,0) scale(1)");e.find(".photo_modal_img").css("ms-transform","translate3d(0,0,0) scale(1)");setTimeout(function(){$(".qtext_image").css("visibility","visible");var t=Math.abs(parseInt($("body").css("top")));$("body").css({position:"",width:"",top:""});if(t){$(document).scrollTop(t)}e.remove()},333)}});exports.QTextGIFPlayer=t.extend({
onLoad:function(e){if(!e){return}$(document).click(function(e){var t=$(e.target).parent("[gif-embedded]");if(!t){return}var i=t.attr("gif-embedded");var n=t.attr("background-url");if(t.attr("is-playing")=="false"){var s=new Image;s.onload=function(){t.children(".qtext_image").attr("src",i);t.children(".gif_embed_noclick").css("visibility","hidden");t.attr("is-playing","true")};s.src=i}else{t.children(".qtext_image").attr("src",n);t.children(".gif_embed_noclick").css("visibility","visible");t.attr("is-playing","false")}})}});function a(e,t){$.each(window.YT.players,function(i,n){if(n.playerId==t){n.state=e.data;if(n.state==window.YT.PlayerState.PLAYING&&n.onReady){n.onReady(n);n.onReady=null}}});if(e.data==window.YT.PlayerState.PLAYING){d(t)}}function d(e){if(!window.YT||!window.YT.players){return}$.each(window.YT.players,function(t,i){if(i.playerId!=e){if(i.player&&$("#"+i.playerId).size()){i.player.pauseVideo()}}})}exports.QTextEmbedEnlarger=t.extend({onLoad:function(e){var t=this;if(!e){
return}$(document).click(function(e){var i=$(e.target),n;if(i.attr("data-embed")){n=i.attr("data-embed")}else{i=i.parent();n=i&&i.attr("data-embed")}if(!n||!i.hasClass("thumbnail")){return}t.loadEmbed(i,n)})},loadEmbed:function(e,t){if(!window.YT){window.YT={};window.YT.players=[];window.YT.next_id=0}var n=this;i.onInit(function(){if(!window.YT.Player){setTimeout(n.loadEmbed.bind(n,e,t),100);return}e.append(t).removeClass("thumbnail");var i="YTPlayer-"+window.YT.next_id++;e.find(":first-child").attr("id",i);var s=new window.YT.Player(i,{events:{onStateChange:function(e){return a(e,i)}}});window.YT.players.push({player:s,playerId:i,state:-1});d(i)})}});exports.GridGuide=t.extend({onLoad:function(){this.setupKeyboardShortcut()},toggle:function(){if(this.$id("@grid-guide").is(":visible")){this.$id("@grid-guide").fadeOut(150)}else{this.$id("@grid-guide").fadeIn(150)}},setupKeyboardShortcut:function(){o.on([71,82,73,68],this.toggle.bind(this))}});exports.BrowserWarning=t.extend({onLoad:function(){
s()}});exports.LogoutNavElement=t.extend({onLoad:function(){var e=this;this.$id("@logout_link").click(function(){e.$id("@logout_form").submit();n.stopLiveUpdates();return false})}})});define("app/view/link",["shared/polyfills","webnode2"],function Vt(require,exports,e){var t=require("webnode2").Component;exports.NewLinkEditor=t.extend({onLoad:function(){var e=this;this.$id("@link_no_image").click(function(){e.clearAllSelected();e.setDisplayType("link_no_image");e.$id("@link_no_image").addClass("selected");return false});this.$id("@link_small_image").click(function(){e.clearAllSelected();e.setDisplayType("link_small_image");e.$id("@link_small_image").addClass("selected");return false});this.$id("@link_large_image").click(function(){e.clearAllSelected();e.setDisplayType("link_large_image");e.$id("@link_large_image").addClass("selected");return false});this.$id("@remove_url").click(function(){e.parent().removeUrl();return false})},clearAllSelected:function(){this.$id("@link_no_image").removeClass("selected");
this.$id("@link_small_image").removeClass("selected");this.$id("@link_large_image").removeClass("selected")},getPreviewLinkInfo:function(){return this.child("preview").getLinkInfo()},setDisplayType:function(e){var t;if(e=="link_no_image"){t=1}else if(e=="link_small_image"){t=2}else{t=3}this.child("preview").setDisplayType(e,t)}});exports.LinkVideo=t.extend({onLoad:function(){var e=this;this.$id("@video_wrapper").click(function(){e.parent().playVideo();e.$id("@video_wrapper .qtext_embed.thumbnail").css("width","100%").css("height","272px")})}});exports.LinkImageEditor=t.extend({onLoad:function(){var e=this;this.index=0;this.$id("@next_photo").click(function(t){e.cycle_photo(1);return false});this.$id("@prev_photo").click(function(t){e.cycle_photo(e.keys_and_sources.length-1);return false});this.$id("@link").click(function(){e.serverCall("track").send()})},get_image_keys:function(){if(this.keys_and_sources!={}){var e=[];for(var t=this.index,i=0,n=this.keys_and_sources.length;i<n;i++,t=(t+1)%n){
e.push(this.keys_and_sources[t][0])}return e}else{return[]}},cycle_photo:function(e){var t=this.index;this.index=(t+e)%this.keys_and_sources.length;this.$id("@img").attr("src",this.keys_and_sources[this.index][1])}});exports.LinkTitle=t.extend({onLoad:function(){var e=this;this.$id("@link").click(function(){e.serverCall("track").send()})},getValue:function(){return this.child("editor").get_value()}});exports.Link=t.extend({getLinkInfo:function(){this.link_info.title=this.child("title").getValue();this.link_info.snippet=this.child("snippet").child("editor").get_value();var e=this.child("media");if(e.editable){this.link_info.image_keys=e.get_image_keys()}return this.link_info},setDisplayType:function(e,t){this.$id("@link_wrapper").removeClass().addClass(e);this.link_info.display_type=t},playVideo:function(){var e=2;if(this.link_info.display_type==e){this.$id("@image_col").css("float","left");this.$id("@info_col").css("float","left");this.$id("@image_col").css("width","100%");this.$id("@image_and_info").css("display","block");
}}})});define("app/view/linkedin_",["shared/polyfills","webnode2"],function zt(require,exports,e){var t=require("webnode2").Component;exports.LinkedinCallbackPage=t.extend({onLoad:function(){if(window.opener){window.opener.$(window.opener.document).trigger("linkedin_oauth_approved",this.liUid);window.close()}}})});define("app/view/login",["shared/polyfills","webnode2"],function Gt(require,exports,e){var t=require("webnode2").Component;exports.LogoutAllSessionsButton=t.extend({onLoad:function(){var e=this;e.$id("@logout").click(function(t){e.serverCall("logout_all_sessions").kwargs({unh:e.unh,time:e.time,uid:e.uid}).liveMutate().send();return false})}})});define("app/view/manage",["shared/polyfills","webnode2","interface/jquery","view/modal","shared/events/index"],function Kt(require,exports,e){var t=require("webnode2").Component,$=require("interface/jquery")._jQuery,i=require("view/modal").Base,n=require("shared/events/index");exports.FeedControlModal=i.extend({onLoad:function(){var e=this;
e._super.apply(this,arguments);var t=e.$id("@organize");var i=e.$id("@discover");var s=e.$("#__w2_modal_overlay_");var o=e.child("feed_control_container").$("#@organize");var r=e.child("feed_control_container").$("#@discover");t.click(function(){t.addClass("selected");o.removeClass("hidden");i.removeClass("selected");r.addClass("hidden")});i.click(function(){i.addClass("selected");r.removeClass("hidden");t.removeClass("selected");o.addClass("hidden")});s.on("mousedown",function(t){if(t.target==this&&!e._isScrollBarClicked(t)){e.maybeRefreshFeed()}});e.serverCall("maybe_complete_zapdos").send();this._updatedItems={};this.handleEvent(n.Types.FEED_CONTROL_UPDATE,function(t){var i=t.payload.contentRowCid;if(e._updatedItems[i]){delete e._updatedItems[i]}else{e._updatedItems[i]=true}})},_isScrollBarClicked:function(e){var t=$.getScrollbarWidth();if(window.innerWidth-e.clientX<t){return true}else{return false}},onClose:function(){this.maybeRefreshFeed()},onSubmit:function(){this.maybeRefreshFeed();
},onCancel:function(){this.maybeRefreshFeed()},maybeRefreshFeed:function(){this._closeModal();if(Object.keys(this._updatedItems).length>0){this.refreshFeed()}},refreshFeed:function(){var e=this;var t=$("#feed_control_update_feed_screen");var i=5500;t.removeClass("hidden");e.serverCall("refresh_feed").success(function(){setTimeout(t.addClass("hidden"),i)}).error(function(){setTimeout(t.addClass("hidden"),i)}).liveMutate().send()}});exports.FeedControlModalLink=t.extend({onLoad:function(){var e=this;this.$id("@create_modal_link").click(function(){e.modal("load_inner",{closeOnBackgroundClick:false});return false})}});exports.FeedControlContent=t.extend({onLoad:function(){var e=this;e.feed_control_contents={};for(var t in e.content_ids){var i=e.content_ids[t];var n="#@"+i;e.feed_control_contents[i]={js_id:n,scroll_position:0}}for(var s in e.feed_control_contents){var o=e.feed_control_contents[s];var r=e._createOnLinkClicked(s);var a=e.child("filter_section").$(o.js_id);a.click(r.bind(this));
}},_createOnLinkClicked:function(e){var t=this;return function(){var i=t.feed_control_contents[t.active_id];var n=t.child("filter_section").$(i.js_id);var s=t.$(i.js_id);i.scroll_position=s.parent().scrollTop();n.removeClass("selected");s.addClass("hidden");var o=t.feed_control_contents[e];var r=t.child("filter_section").$(o.js_id);var a=t.$(o.js_id);r.addClass("selected");a.removeClass("hidden");a.parent().scrollTop(o.scroll_position);t.active_id=e}}});exports.FeedControlContentRow=t.extend({onLoad:function(){var e=this;this.$id("@item_button").on("click",function(){e.emitEvent({type:n.Types.FEED_CONTROL_UPDATE,payload:{contentRowCid:e.cid}})})}});exports.FeedControlsPopover=t.extend({hide:function(){this.$id("@popover").addClass("hidden")}});exports.DismissFeedControlsPopoverLink=t.extend({onLoad:function(){var e=this;this.$id("@dismiss_link").on("click",function(){e.parent().hide()})}});exports.DiscoverInlineFeedCallToAction=t.extend({onLoad:function(){var e=this;e.serverCall("log_impression").send();
this.$id("@dismiss_link").on("click",function(){e.serverCall("dismiss").send();e.$id("@main_card").addClass("hidden")})}})});define("app/view/messages",["shared/polyfills","webnode2","interface/jquery","view/modal"],function Jt(require,exports,e){var t=require("webnode2").Component,$=require("interface/jquery")._jQuery,i=require("view/modal").Base;exports.MessagesMain=t.extend({onLoad:function(){this.resizeMessages();$(window).resize(this.resizeMessages.bind(this))},resizeMessages:function(){var e=$(window).height()-$(".SiteHeader").height();$(".MessagesMain").height(e-30);$(".MessagesMain").show()}});exports.MessagesThreadDetail=exports.MessagesMain.extend({onLoad:function(){this._super.apply(this,arguments);var e=this;e.scrollMessageThreadToHeight();e.$id("@thread").bind("DOMNodeInserted",function(t){t.preventDefault();var i=t.target;if($(i.children).is(".ThreadMessage")){setTimeout(function(){e.scrollMessageThreadToHeight()},10)}});e.isShowingMoreMessages=false;e.$id("@show").click(function(){
e.showMoreClicked()})},scrollMessageThreadToHeight:function(e){e=e||0;var t=this.$id("@thread")[0].scrollHeight-e;$(".thread_list").scrollTop(t)},showMoreClicked:function(){var e=this;this.isShowingMoreMessages=true;this.serverCall("get_message_count").kwargs({thread_id:this.threadId}).success(function(t){e.messageCount=t;e.showMoreMessages()}).send()},showMoreMessages:function(){var e=this;var t=this.$id("@thread")[0].scrollHeight;var i=45;this.shownCount*=2;if(this.shownCount>this.messageCount){this.reachedLastMessage=true;this.shownCount=this.messageCount}this.serverCall("show_messages").kwargs({thread_id:this.threadId,count:this.shownCount}).contentFor(this.$id("@thread"),{parentCid:this.cid}).success(function(){if(e.reachedLastMessage){e.$id("@more").hide();t+=i}e.scrollMessageThreadToHeight(t);e.isShowingMoreMessages=false}).send()}});exports.ComposeMessageModalLink=t.extend({onLoad:function(){var e=this;this.$id("@create_modal_link").on("click",function(t){e.modal("load_inner",{closeOnBackgroundClick:false
});t.preventDefault()})}});exports.ComposeMessageModal=i.extend({onLoad:function(){var e=this;this._super.apply(this,arguments);this.$id("@change_person").click(function(t){e.change();t.preventDefault()});this.load()},load:function(){if(this.object_id){this.setTo(this.object_id)}},getData:function(){if(this.$id("@compose_message_to_uid").val()){this.object_id=this.$id("@compose_message_to_uid").val()}if(!this.object_id||this.child("editor").isOnlyWhiteSpace()){return false}return{to_uid:this.object_id,msg:this.child("editor").serialize()}},onSubmit:function(){if(this.submitDisabled){return}var e=this;var t=e.getData();if(t===false){return}this.serverCall("submit_message").kwargs(t).success(function(){e._closeModal()}).send()},change:function(){this.child("people_selector").setQuery("");this.$id("@pick_people").removeClass("hidden");this.$id("@picked_person").addClass("hidden");this.$id("@to_name").html("");this.child("people_selector").focus();this.disableSubmit()},setTo:function(e){if(isNaN(parseInt(e))){
return}this.$id("@pick_people").addClass("hidden");this.$id("@picked_person").removeClass("hidden");this.$id("@compose_message_to_uid").val(e);this.getName(e);this.enableSubmit()},getName:function(e){var t=this;this.serverCall("get_name").kwargs({to_uid:e}).contentFor(this.$id("@to_name"),{parentCid:this.cid}).success(function(){t.child("editor").focus()}).send()}});exports.HideMessagesModalLink=t.extend({onLoad:function(){var e=this;this.$id("@create_dialog_link").on("click",function(t){e.modal("load_inner");t.preventDefault()})}});exports.HideMessagesModal=i.extend({onSubmit:function(){if(this.submitDisabled){return}var e=this;this.serverCall("hide_thread").liveMutate().success(function(){e._closeModal();window.location="/messages"}).send()}})});define("app/view/moderation/appeal",["shared/polyfills","webnode2","view/modal"],function Xt(require,exports,e){var t=require("webnode2").Component,i=require("view/modal").Base;exports.AppealLink=t.extend({onLoad:function(){var e=this;this.$id("@show_appeal_modal").click(function(){
e.showAppealModal();return false})},showAppealModal:function(){this.modal("appeal_modal")}});exports.AppealModal=i.extend({onLoad:function(){this._super.apply(this,arguments);this.$id("@submit_button").addClass("submit_button_disabled");var e=this.$id("@policy_checkbox");var t=this;e.click(function(e){if(e.currentTarget.checked){t.$id("@appeal_details").removeClass("hidden")}else{t.$id("@appeal_details").addClass("hidden");t.$id("@submit_button").addClass("submit_button_disabled")}});t.$id("@appeal_type").change(function(){t.$id("@submit_button").removeClass("submit_button_disabled")});var i=this.$id("@answer_tag_details_link");var n=this.$id("@answer_tag_details_content");i.click(function(e){if(n.hasClass("hidden")){n.removeClass("hidden");i.text(t.collapse_details)}else{n.addClass("hidden");i.text(t.show_details)}})},onSubmit:function(){this.appeal()},appeal:function(){var e=this.child("appeal_comment").serialize();var t=this.$("input:radio:checked").val();var i={comment:e,appeal_type:t
};this.serverCall("send_appeal").liveMutate().kwargs(i).success(this._closeModal()).send()}})});define("app/view/moderation/flag",["shared/polyfills","webnode2","interface/jquery","view/modal","shared/events/index"],function Yt(require,exports,e){var t=require("webnode2").Component,$=require("interface/jquery")._jQuery,i=require("view/modal").Base,n=require("shared/events/index");exports.AddModerationFlag=t.extend({onLoad:function(){var e=this;e.$id("@show_flag_dialog").on("click",function(t){if(!e.in_menu){t.preventDefault();t.stopPropagation()}if(e.one_click_report){e.serverCall("one_click_report").liveMutate().send()}else{e.showFlagDialog()}})},showFlagDialog:function(){this.modal("flag_modal")}});exports.AddFlagModal=i.extend({onLoad:function(){var e=this;this._super.apply(this,arguments);this.$id("@show_more_reasons a").click(function(){e.$id("@show_more_reasons").toggleClass("hidden");e.$id("@more_reasons").toggleClass("hidden");return false});this.$("%@flag_input").click(function(t){
e.$id("@report").removeAttr("disabled").removeClass("submit_button_disabled");e.$id("@comment").show();e.child("comment").focus();e.$id("@required_comment_warning").hide();e.$id("@required_report_reason_warning").hide();var i=parseInt($(t.target).eq(0).val(),10);var n=parseInt(e.other_reason_id,10);var s=parseInt(e.factually_incorrect_reason_id,10);if(i==n||i==s){e.$id("@optional_label").hide()}else{e.$id("@optional_label").show()}})},onSubmit:function(){this.report()},report:function(){var e=this;var t={flag_reason:this.getFlagReason(),comment:this.child("comment").serialize()};var i=t.flag_reason==this.other_reason_id||t.flag_reason==this.factually_incorrect_reason_id;if(!t.flag_reason){this.$id("@required_report_reason_warning").show()}else if(i&&this.child("comment").isOnlyWhiteSpace()){this.$id("@required_comment_warning").show()}else{if(t.flag_reason!==null){this.serverCall("flag_object").kwargs(t).liveMutate().success(function(t){e._closeModal();if(t&&t[0]=="/"){window.location=t;
}else{e.addDownvote()}}).send()}}},addDownvote:function(){var e=this.targets[0];if(e.type==="answer"){this.emitEvent(n.helpers.addAnswerDownvote(e.aid))}else if(e.type==="question"){this.emitEvent(n.helpers.addQuestionDownvote(e.qid))}},getFlagReason:function(){return this.$("%@flag_input").filter(":checked").val()}});exports.NeedsImprovementButton=t.extend({onLoad:function(){var e=this;e.$id("@add_ni_button").on("click",function(){e.serverCall("add_topic").kwargs({}).liveMutate().send()})}});exports.DismissLink=t.extend({onLoad:function(){var e=this;this.$id("@dismiss").click(function(t){e.dismiss();return false})},dismiss:function(){this.serverCall("dismiss").liveMutate().send()}});exports.TargetAndReports=t.extend({onLoad:function(){var e=this;this.$id("@toggle").click(function(t){e.toggleComments();return false})},toggleComments:function(){this.$id("@reports").toggleClass("hidden")}});exports.LockLink=t.extend({onLoad:function(){var e=this;e.$id("@lock_link").click(function(t){t.preventDefault();
if($(this).hasClass("unlocked")){e.serverCall("lock_answer").liveMutate().send();$(this).removeClass("unlocked")}else{e.serverCall("unlock_answer").liveMutate().send();$(this).addClass("unlocked")}return false})}})});define("view/hover_menu",["shared/polyfills","webnode2","interface/jquery","shared/Class","shared/log","shared/onload","shared/perf","shared/w2.context"],function Zt(require,exports,e){var t=require("webnode2").Component,$=require("interface/jquery")._jQuery,i=require("shared/Class").Class,n=require("shared/log").log,s=require("shared/onload"),o=require("shared/perf"),r=require("shared/w2.context");exports.HoverMenu=t.extend({contextConstructor:function(){return r.HoverMenu},onLoad:function(e){this.on=this.on||350;this.off=this.off||350;this.st=null;this.ht=null;this.loaded=this.loaded||this.should_preload_menu;this.loading=false;this.shown=false;this.cancelHover=false;if(this.load_on_pageload&&e){this.loadMenu(true)}this.registerClickHandlers();this.maybeRegisterHoverHandlers();
this.hoverMenuContext=this.getContext(r.HoverMenu);this._userPerceivedAction=null;this.setDvar("hovermenu_parent",this.cid)},registerClickHandlers:function(){var e=this;e.hoverMenuContext=e.getContext(r.HoverMenu);e.hoverMenuContext.on("hidden",function(t,i){if(i===true){e.cancelHover=true;e.doHide()}});if(this.click_open){this.$id("@link").click(function(t){if(e.shown){e.cancelHover=true;e.doHide()}else{e._userPerceivedAction=o.startUserPerceived({vcon:e.__vcon,method:"load_menu"});e.cancelHover=false;e.loadMenu();e.doShow()}t.preventDefault()});$(document).click(function(t){var i=e.isInvalidCloseTarget($(t.target));if(e.shown&&!i){e.cancelHover=true;e.doHide()}})}else{this.$id("@link").click(function(){e.cancelHover=true;e.doHide()})}},isInvalidCloseTarget:function(e){var t=this.$id("@link");if(e.is(t)||e.parents(t).is(t)){return true}return false},maybeRegisterHoverHandlers:function(){var e=this;if(this.show_menu&&!this.click_open){this.$id("@link").hover(this.show.bind(this),function(){
e.hide();e.cancelHover=false;e.$id("@link").removeClass("hover")});this.$id("@menu").hover(this.show.bind(this),this.hide.bind(this))}},setPosition:function(){if(!this.css_positioning){var e=this.$id("@link").outerHeight();var t=this.$id("@link").offset();var i=t;var n=$(window).height();var s=275;var o=i.top-$(window).scrollTop();var r=n-o<s;var a=this.menu_offset_px?this.menu_offset_px:0;this.$id("@menu").removeAttr("style");if(r){if(this.attach_to_body){this.$id("@menu").css("bottom",n-t.top+a+"px")}else{this.$id("@menu").css("bottom",e+"px")}this.$id("@menu").addClass("hover_menu_above")}else{if(this.attach_to_body){this.$id("@menu").css("top",t.top+e+1+a+"px")}else{this.$id("@menu").css("top",e+"px")}this.$id("@menu").removeClass("hover_menu_above")}if(this.attach_to_body){var d=$(window).width();var l=this.$id("@menu").outerWidth();var c=l+i.left;var u=i.left;var h=this.$id("@link").outerWidth();if(this.alignment=="right"){this.$id("@menu").css("left",u-l+h+"px")}else if(this.alignment=="center"){
this.$id("@menu").css("left",u-l/2+h/2+"px")}else{if(d<c){this.$id("@menu").addClass("right_align");this.$id("@menu").css("left",u-l+h+"px")}else{this.$id("@menu").css("left",u+"px");this.$id("@menu").removeClass("right_align")}}}}},hide:function(){if(this._userPerceivedAction){o.cancelAction(this._userPerceivedAction);this._userPerceivedAction=null}clearTimeout(this.st);this.ht=setTimeout(this.doHide.bind(this),this.off)},doHide:function(){var e=this;if(!this.shown){return}if(!this.hoverMenuContext.get("hidden")){this.hoverMenuContext.set("hidden",true)}this.hoverMenuContext.set("isShown",false);this.shown=false;this.$id("@link").removeClass("hover");this.$id("@menu").addClass("animate_out");setTimeout(function(){if(!e.shown){e.$id("@menu").removeClass("animate_out");e.$id("@menu").addClass("hidden")}},150)},getKwargs:function(){if(this.kwargs){return this.kwargs}return{}},okToShowHoverMenu:function(){return this.should_show_hover_menu&&this.$id("@menu").parents(".hover_menu_contents").length===0;
},show:function(){if(this.okToShowHoverMenu()){this.showInner()}},showInner:function(){this._userPerceivedAction=o.startUserPerceived({vcon:this.__vcon,method:"load_menu"});clearTimeout(this.ht);this.st=setTimeout(this.doShow.bind(this),this.on);this.loadMenu();this.$id("@menu").removeClass("animate_out");this.$id("@link").addClass("hover")},doShow:function(){if(this.shown||this.cancelHover){return}this.hoverMenuContext.set("isShown",true);this.hoverMenuContext.set("hidden",false);this.shown=true;if(!this.css_positioning&&!this.movedToBody&&this.attach_to_body){this.$id("@menu").detach().prependTo($("body"));this.movedToBody=true}$(".GrowlNotification").hide();this.$id("@menu").removeClass("hidden").show();this.$id("@link").addClass("hover");this.setPosition();if(this.loaded===true&&this._userPerceivedAction){o.finishAction(this._userPerceivedAction);this._userPerceivedAction=null}},loadMenu:function(e){var t=this;if(e===undefined){e=false}var i=function(){if(t.loaded||t.loading){return;
}if(n&&n.enabled){n("Quora.HoverMenu.loadMenu",t.cid,"is loading, preload =",e)}t.loading=true;t.serverCall("load_menu").kwargs(t.getKwargs()).disableDefaultUserPerceivedLogging().contentFor(t.$id("@menu_contents"),{parentCid:t.cid}).success(function(i){if(n&&n.enabled){n("Quora.HoverMenu.loadMenu",t.cid,"is loaded, preload =",e)}t.loaded=true;t.loading=false;if(t.shown===true&&t._userPerceivedAction){o.finishAction(t._userPerceivedAction);t._userPerceivedAction=null}}).except(function(i){if(n&&n.enabled){n("Quora.HoverMenu.loadMenu",t.cid,"is failed to load, preload =",e)}t.loading=false}).send()};if(e){s.execAfterLoadDelayed(function(){i()})}else{i()}}});exports.ToggleableMenu=i.extend({__init__:function(e){this.$linkElem=e.$linkElem;this.$menuElem=e.$menuElem;this.loadFunction=e.loadFunction;if(!(this.$linkElem&&this.$menuElem&&this.loadFunction)){throw new Error("Invalid kwargs given: "+e)}this.useCssPositioning=e.useCssPositioning||false;this.shouldAttachToBody=!!e.shouldAttachToBody;
this.menuOffsetPx=e.menuOffsetPx||0;this.alignment=e.alignment||"left";this.clickOpen=e.clickOpen||false;this.showDelayMs=e.showDelayMs||350;this.hideDelayMs=e.hideDelayMs||350;this.shown=false;this.movedToBody=false;this.cancelHover=false;this.hideTimeout=null;this.showTimeout=null;this.registerHoverHandlers();this.registerClickHandlers()},registerHoverHandlers:function(){if(this.clickOpen){return}this.$linkElem.hover(this.showMenuSlow.bind(this),function(){this.hideMenuSlow();this.cancelHover=false;this.$linkElem.removeClass("hover")}.bind(this));this.$menuElem.hover(this.showMenuSlow.bind(this),this.hideMenuSlow.bind(this))},registerClickHandlers:function(){if(this.clickOpen){this.$linkElem.click(this.toggleMenu.bind(this));$(document).on("click",this.maybeHideMenu.bind(this))}else{this.$linkElem.click(this.hideMenu.bind(this))}},toggleMenu:function(e){e.preventDefault();if(this.shown){this.cancelHover=true;this.hideMenu()}else{this.cancelHover=false;this.loadFunction();this.showMenu();
}},maybeHideMenu:function(e){var t=e.target;var i=this.$linkElem.get(0);if(t==i||t.parentNode==i){return}this.hideMenu()},hideMenuSlow:function(){clearTimeout(this.showTimeout);this.hideTimeout=setTimeout(this.hideMenu.bind(this),this.hideDelayMs)},hideMenu:function(){if(!this.shown){return}this.cancelHover=true;this.shown=false;this.$linkElem.removeClass("hover");this.$menuElem.addClass("animate_out");setTimeout(function(){if(this.shown){return}this.$menuElem.removeClass("animate_out");this.$menuElem.addClass("hidden")}.bind(this),150)},shouldShowMenu:function(){return this.$menuElem.parents(".hover_menu_contents").length===0},showMenuSlow:function(){if(!this.shouldShowMenu()){return}clearTimeout(this.hideTimeout);this.showTimeout=setTimeout(this.showMenu.bind(this),this.showDelayMs);this.loadFunction();this.$menuElem.removeClass("animate_out");this.$linkElem.addClass("hover")},showMenu:function(){if(this.shown||this.cancelHover){return}this.shown=true;this.moveMenuToBody();$(".GrowlNotification").hide();
this.$menuElem.removeClass("hidden").show();this.$linkElem.addClass("hover");this.setPosition()},moveMenuToBody:function(){if(this.useCssPositioning||this.movedToBody){return}this.movedToBody=true;if(this.shouldAttachToBody){this.$menuElem.detach().prependTo($("body"))}else{this.$menuElem.detach().prependTo(this.$linkElem)}},setPosition:function(){if(!this.useCssPositioning){var e=$(window);var t=this.$linkElem.outerHeight();var i=this.$linkElem.offset();var n=i;var s=e.height();var o=275;var r=n.top-e.scrollTop();var a=s-r<o;var d=this.$menuElem.outerWidth();var l=this.$linkElem.outerWidth();this.$menuElem.removeAttr("style");if(a){if(this.shouldAttachToBody){this.$menuElem.css("bottom",s-i.top+this.menuOffsetPx+"px")}else{this.$menuElem.css("bottom",t+"px")}this.$menuElem.addClass("hover_menu_above")}else{if(this.shouldAttachToBody){this.$menuElem.css("top",i.top+t+1+this.menuOffsetPx+"px")}else{this.$menuElem.css("top",t+"px")}this.$menuElem.removeClass("hover_menu_above")}if(this.shouldAttachToBody){
var c=e.width();var u=d+n.left;var h=n.left;if(c<u){var f=u-c;if(this.alignment=="left"){h-=f+10}}if(this.alignment=="right"){this.$menuElem.css("left",h-d+l+"px")}else if(this.alignment=="center"){this.$menuElem.css("left",h-d/2+l/2+"px")}else{this.$menuElem.css("left",h+"px")}}else{if(this.alignment=="right"){this.$menuElem.css("right",0)}else if(this.alignment=="center"){this.$menuElem.css("left",l/2-d/2+"px")}else{this.$menuElem.css("left",0)}}}}})});define("app/view/topic_selector",["shared/polyfills","view/selector","shared/w2.context"],function ei(require,exports,e){var t=require("view/selector").Selector,i=require("shared/w2.context");var n=exports.TopicSelector=t.extend({resultWasSelected:function(e,t,i){if(e.ty==="topic"){this.topicWasSelected(e.data.tid,e.data.topic_name,t,i,e)}else if(e.ty==="create_topic"){this.createTopicWasSelected(e.data.new_topic_name,t,i)}else{throw Error()}},topicWasSelected:function(e,t,i,n){},createTopicWasSelected:function(e,t,i){}});exports.AddTopicSelector=n.extend({
showErrorDialog:function(){this.dialog().title(this.dialog_title).ok(null,this.close_button_text).text(this.dialog_message)},topicWasSelected:function(e,t,i,n){this.setQuery("");this.serverCall("add_topic").kwargs({tid:e}).liveMutate().error(this.showErrorDialog.bind(this)).send()},createTopicWasSelected:function(e,t,i){this.setQuery("");this.serverCall("create_and_add_topic").kwargs({new_topic_name:e}).liveMutate().error(this.showErrorDialog.bind(this)).send()}});exports.TopicSelectorForFormField=exports.AddTopicSelector.extend({onLoad:function(){this._super.apply(this,arguments);this.formFieldTopicSelectorContext=this.getContext(i.FormFieldTopicSelector)},topicWasSelected:function(e,t,i){this.formFieldTopicSelectorContext.set("topicName",t);this.formFieldTopicSelectorContext.set("tid",e);this.setQuery("")},createTopicWasSelected:function(e,t){var i=this;i.serverCall("create_and_add_topic").kwargs({new_topic_name:e}).success(function(t){i.setQuery("");if(t){i.formFieldTopicSelectorContext.set("topicName",e);
i.formFieldTopicSelectorContext.set("tid",t)}}).liveMutate().send()}})});define("view/editable_list",["shared/polyfills","webnode2","settings"],function ti(require,exports,e){var t=require("webnode2").Component,i=require("settings").interface_strings;exports.EditableList=t.extend({onLoad:function(){var e=this;e.setEditLink();setTimeout(function(){e.update()},1);e.initState();e.bindClickHandler()},setEditLink:function(){this.editLink=this.$id("@edit")},initState:function(){this.editLink.removeClass("hidden")},bindClickHandler:function(){var e=this;this.editLink.click(function(t){t.preventDefault();e.toggleEdit()})},toggleEdit:function(){this.is_editing=!this.is_editing;this.update()},update:function(){if(this.is_editing){this.$id("@wrapper").addClass("is_editing");this.editLink.text(i.done)}else{this.$id("@wrapper").removeClass("is_editing");this.editLink.text(this.edit_text)}}});exports.EditableListItem=t.extend({onLoad:function(){var e=this;this.$id("@remove").click(function(t){e.serverCall("remove").liveMutate().send();
})}})});define("app/view/navigation",["shared/polyfills","webnode2","view/fixable2","view/hover_menu","shared/w2.context","app/view/topic_selector","view/editable_list"],function ii(require,exports,e){var t=require("webnode2").Component,i=require("view/fixable2"),n=require("view/hover_menu").HoverMenu,s=require("shared/w2.context"),o=require("app/view/topic_selector").AddTopicSelector,r=require("view/editable_list").EditableList;exports.SettingsNavListContents=r.extend({onLoad:function(){this._super.apply(this,arguments);i.makeFixable(this.$id("@wrapper"),{min_width:990})}});exports.HomeNavList=r.extend({setEditLink:function(){this.editLink=this.child("hover_menu").$id("@link")}});exports.HomeNavListHoverMenu=n.extend({isInvalidCloseTarget:function(e){var t=this.$id("@menu");var i=this._super.apply(this,arguments);if(i||e.parents().filter(t).length>0||e.hasClass("HomeNavListItem")||e.hasClass("remove_link")){return true}if(this.shown){this.parent().toggleEdit()}return false}});exports.TrendingTopicsNavListItem=t.extend({
onLoad:function(){var e=this;this.$id("@tid").on("click",function(t){e.metaKey=t.metaKey;e.serverCall("log_click").success(function(){if(e.metaKey){return}window.location.href=e.uri}).error(function(){if(e.metaKey){return}window.location.href=e.uri}).send()});return false}});exports.HomePagePinnedTopicSelector=o.extend({onLoad:function(){this._super.apply(this,arguments);this.hoverMenuContext=this.getContext(s.HoverMenu);this.hoverMenuContext.on("isShown",function(e,t){if(t){window.setTimeout(this.focus.bind(this),0)}}.bind(this));this.showResults(true)},showResults:function(e){if(!e){return}this._super.apply(this,arguments)}})});define("app/view/network/selector",["shared/polyfills","shared/events/index","view/selector"],function ni(require,exports,e){var t=require("shared/events/index"),i=require("view/selector").Selector;exports.InvitePeopleSelector=i.extend({onLoad:function(){this._super.apply(this,arguments);var e=this;e.$input.focus();e.$id("@clear").on("click",function(){e.setQuery("");
})},resultWasSelected:function(e){this.emitEvent({type:t.Types.NETWORK_INVITE_USER,payload:{uid:e.data.uid,email:e.data.email}})},queryDidChange:function(){var e=this;if(e.$input.val().length>0){e.$id("@clear").removeClass("hidden")}else{e.$id("@clear").addClass("hidden")}}})});define("app/view/notifications",["shared/polyfills","webnode2","view/fixable2","shared/events/index","shared/w2.context"],function si(require,exports,e){var t=require("webnode2").Component,i=require("view/fixable2"),n=require("shared/events/index"),s=require("shared/w2.context");exports.NotificationsMain=t.extend({onLoad:function(){i.makeFixable(this.$id("@notifs_nav"),{min_width:990})}});exports.NotificationsClearButton=t.extend({onLoad:function(){var e=this;e.hoverMenuContext=e.getContext(s.HoverMenu);this.$id("@clear").click(function(t){e.serverCall("mark_as_seen").liveMutate().success(function(t){if(!t){e.hoverMenuContext.set("hidden",true)}}).send();t.preventDefault()})}});exports.MarkAllAsReadLink=t.extend({
onLoad:function(){this.$id("@link").on("click",this.markAllRead.bind(this))},markAllRead:function(e){e.preventDefault();this.emitEvent({type:n.Types.NOTIFS_MARK_ALL_READ,payload:{},scope:n.scope.GLOBAL});this.$id("@link").toggleClass("hidden");this.serverCall("request").liveMutate().send()}});exports.NotificationPreview=t.extend({onLoad:function(){var e=this;this.$id("@details").click(function(){e.$id("@notification_details").toggleClass("hidden");return false});this.$id("@notification").click(function(){e.$id("@notification_diff").toggleClass("hidden");e.$id("@notification").hide();e.$id("@bullet").hide();return false})}})});define("app/view/notifications/base",["shared/polyfills","webnode2","interface/jquery","shared/events/index","shared/action_log","shared/w2.context"],function oi(require,exports,e){var t=require("webnode2").Component,$=require("interface/jquery")._jQuery,i=require("shared/events/index"),n=require("shared/action_log").ActionableComponent,s=require("shared/w2.context");
exports.Notif=t.extend({onLoad:function(){var e=this;var t=this.$id("@notif a");this.hoverMenuContext=this.getContext(s.HoverMenu);this.handleEvent(i.Types.NOTIFS_MARK_ALL_READ,this.removeUnseen.bind(this));t.on("click",function(t){if($(this).attr("href")=="#"){t.preventDefault()}if(e.$id("@notif").hasClass("unseen")){e.markAsSeen()}});if(this.actionBar){this.$id("@content_toggle").on("click",function(t){t.preventDefault();e.$id("@notif_content").removeClass("hidden");e.$id("@content_toggle").addClass("hidden")})}},removeUnseen:function(){this.$id("@notif").removeClass("unseen")},markAsSeen:function(e){var t=this;this.removeUnseen();this.serverCall("mark_as_seen").liveMutate().success(function(e){if(!e){t.hoverMenuContext.set("hidden",true)}}).send()}});exports.AggregatedNotif=t.extend({onLoad:function(){this.$listElem=this.$id("@list");this.$id("@expand").click(this.toggleList.bind(this));this.$id("@mark").click(this.markAsSeen.bind(this));this.hoverMenuContext=this.getContext(s.HoverMenu);
},toggleList:function(e){e.preventDefault();this.$listElem.toggleClass("hidden")},markAsSeen:function(e){e.preventDefault();var t=this;this.serverCall("mark_as_seen").liveMutate().success(function(e){if(!e){t.hoverMenuContext.set("hidden",true)}}).send()}});exports.Notif3Base=n.extend({onLoad:function(){this._super.apply(this,arguments);var e=this;var t=this.$id("@notif a");this.hoverMenuContext=this.getContext(s.HoverMenu);this.$id("@bad_notif").on("click",function(t){e.markAsIrrelevant()});this.handleEvent(i.Types.NOTIFS_MARK_ALL_READ,this.removeUnseen.bind(this));t.on("click",function(t){if($(this).attr("href")=="#"){t.preventDefault()}if(e.$id("@notif").hasClass("unseen")){e.markAsSeen()}});if(this.actionBar){this.$id("@content_toggle").on("click",function(t){t.preventDefault();e.$id("@notif_content").removeClass("hidden");e.$id("@content_toggle").addClass("hidden")})}},removeUnseen:function(){this.$id("@notif").removeClass("unseen")},markAsSeen:function(e){var t=this;this.removeUnseen();
this.serverCall("mark_as_seen").liveMutate().success(function(e){if(!e){t.hoverMenuContext.set("hidden",true)}}).send()},removeMarkAsIrrelevant:function(){this.$id("@bad_notif").addClass("hidden")},markAsIrrelevant:function(e){this.removeMarkAsIrrelevant();this.serverCall("mark_as_irrelevant").liveMutate().send()}})});define("app/view/notifications/header",["shared/polyfills","webnode2","shared/window_manager"],function ri(require,exports,e){var t=require("webnode2").Component,i=require("shared/window_manager");exports.TitleNotificationsCount=t.extend({onLoad:function(e){if(!e){this.setTitle()}},setTitle:function(){var e=i.getTitle(),t=e,n="";if(this.notif_count||this.inbox_count){n+="(";if(this.notif_count){n+=this.notif_count}if(this.inbox_count){n+="/"+this.inbox_count}n+=") "}t=e.replace(/^\(((\d+)?\/)?\d+\) |/,n);if(e!=t){i.setTitle(t)}}})});define("app/view/nux",["shared/polyfills","webnode2","shared/events/index"],function ai(require,exports,e){var t=require("webnode2").Component,i=require("shared/events/index");
exports.HeaderProgressBar=t.extend({onLoad:function(){this.$id("@progress_bar").css({width:this.getWidth()});var e=this;this.handleEvent(i.Types.NUX_PROGRESS_BAR_STEP,function(t){var i=t.payload.step||this.curr;e.update(i)})},getWidth:function(){var e=this.$id("@progress_bar_wrapper");var t=parseInt(e.css("min-width"),10);var i=parseInt(e.css("width"),10);var n=this.curr/this.total*i;return Math.min(i,Math.max(n,t))},update:function(e){this.curr=e;this.$id("@progress_bar").animate({width:this.getWidth()})}});exports.HeaderProgressBarBeacon=t.extend({onLoad:function(){this.emitEvent({type:i.Types.NUX_PROGRESS_BAR_STEP,payload:{step:this.curr}})}})});define("app/view/nux/dialog",["shared/polyfills","webnode2","interface/jquery","shared/events/index","shared/cookies","w2.dialog","shared/viewport","shared/logging"],function di(require,exports,e){var t=require("webnode2").Component,$=require("interface/jquery")._jQuery,i=require("shared/events/index"),n=require("shared/cookies"),s=require("w2.dialog").Dialog,o=require("shared/viewport"),r=require("shared/logging");
exports.ModalNuxDialogCloseIndicator=t.extend({onLoad:function(){this.emitEvent({type:i.Types.NUX_DIALOG_CLOSE,payload:{}});this.emitEvent({type:i.Types.FEED_IMPRESSIONS_DISABLED,payload:{disabled:false}})}});exports.ModalNuxDialog=t.extend({onLoad:function(e){this.lastStep=null;this.emitEvent({type:i.Types.FEED_IMPRESSIONS_DISABLED,payload:{disabled:true}});o.setPageScroll(false);this.handleEvent(i.Types.NUX_DIALOG_CLOSE,this.hide.bind(this));if(e){r.log("nux_dialog_impression",{})}if($(window).height()<600){$(".dialog .dialog_wrapper").css("position","static")}},hide:function(){this.$id("@modal_nux_wrapper").hide();o.setPageScroll(true)}});exports.InternalModalNuxDialogRenderer=exports.ModalNuxDialog.extend({onLoad:function(e){var t=this;this.curr_step=this.step_num;$("body").keydown(function(e){if(e.keyCode==37&&t.curr_step>0){t.changeStep(t.curr_step,--t.curr_step)}else if(e.keyCode==39&&t.curr_step<t.num_steps-1){t.changeStep(t.curr_step,++t.curr_step)}});this.$id("@modal_nux_wrapper .step_name").click(function(){
if(!$(this).hasClass("curr_step")){var e=parseInt($(this).attr("id"));t.changeStep(t.curr_step,e);t.curr_step=e}})},changeStep:function(e,t){this.$id("@modal_nux_wrapper .dialog_wrapper.step_"+e).parent().addClass("hidden");this.$id("@modal_nux_wrapper .step_name.step_name_"+e).removeClass("curr_step");this.$id("@modal_nux_wrapper .dialog_wrapper.step_"+t).parent().removeClass("hidden");this.$id("@modal_nux_wrapper .step_name.step_name_"+t).addClass("curr_step")}});exports.NuxDialogStep=t.extend({onLoad:function(){this.serverCall("record_step").kwargs({step_name:this.step_name+"_impr"}).send();this.handleEvent(i.Types.NUX_DIALOG_SKIP_NEXT_STEP,this.skipNextStep.bind(this));this.handleEvent(i.Types.NUX_DIALOG_NEXT_STEP,this.gotoNextStep.bind(this));this.handleEvent(i.Types.NUX_DIALOG_STANDALONE_DONE,this.standaloneRefreshFeed.bind(this))},gotoStep:function(e){this.emitEvent({type:i.Types.NUX_PROGRESS_BAR_STEP,payload:{step:e}});this.serverCall("goto_step").kwargs({step_num:e}).liveMutate().send();
},closeDialogAndGoToStep:function(e){if(e>this.num_steps){var t=n.getCookie("question_nux");if(t){window.location="/?question_nux="+t;return}else{this.closeDialog()}}this.gotoStep(e)},closeDialog:function(){this.emitEvent({type:i.Types.NUX_DIALOG_CLOSE,payload:{}})},gotoNextStep:function(){this.closeDialogAndGoToStep(this.step_num+1)},skipNextStep:function(){var e=this.step_num+2;if(e<=this.num_steps){this.emitEvent({type:i.Types.NUX_PROGRESS_BAR_STEP,payload:{step:this.step_num+1}})}else{this.emitEvent({type:i.Types.NUX_DIALOG_CLOSE,payload:{}})}this.serverCall("skip_step").kwargs({step_num:this.step_num+1}).liveMutate().send()},stepUrl:function(e){return"#step="+e},standaloneRefreshFeed:function(){this.serverCall("standalone_refresh_feed").liveMutate().send();s.dialogFor(this).close_()}});exports.NuxDialogRefreshFeedStep=exports.NuxDialogStep.extend({onLoad:function(){var e=this;this._super.apply(this,arguments);this.serverCall("refresh_feed").liveMutate().success(function(){e.delayed_next_step();
return false}).error(function(){e.delayed_next_step();return false}).send()},delayed_next_step:function(){if(this.page_context!="internal_page"){setTimeout(this.gotoNextStep.bind(this),5500)}},gotoStep:function(e){this.serverCall("goto_step").kwargs({step_num:e}).send()}});var a=exports.NuxDialogContinueButton=t.extend({onLoad:function(){this.$id("@next").on("click",this.onClick.bind(this))},finishStep:function(){if(!this.$id("@next").hasClass("submit_button_disabled")){if(this.standalone){this.emitEvent({type:i.Types.NUX_DIALOG_STANDALONE_DONE,payload:{}})}else{this.emitEvent({type:i.Types.NUX_DIALOG_NEXT_STEP,payload:{}})}}},onClick:function(){this.finishStep();return false}});exports.NuxDialogInferredFriendsContinueButton=a.extend({onLoad:function(){this._super.apply(this,arguments);this.fuid_map={};for(var e=0;e<this.unchecked_fuids.length;++e){this.fuid_map[this.unchecked_fuids[e]]=false}for(var t=0;t<this.checked_fuids.length;++t){this.fuid_map[this.checked_fuids[t]]=true}var n=this;
this.handleEvent(i.Types.NUX_DIALOG_FRIENDS_UPDATE,function(e){if(e.payload.addFriend){n.add(e.payload.addFriend)}else if(e.payload.removeFriend){n.remove(e.payload.removeFriend)}else if(e.payload.addAll){n.addAll()}else if(e.payload.removeAll){n.removeAll()}})},onClick:function(e){e.preventDefault();this.serverCall("button_clicked").kwargs({fuid_map:this.fuid_map,prechecked_fuids:this.checked_fuids}).success(this.finishStep.bind(this)).error(this.finishStep.bind(this)).send()},add:function(e){this.fuid_map[e]=true},remove:function(e){this.fuid_map[e]=false},addAll:function(){for(var e in this.fuid_map){this.add(e)}},removeAll:function(){for(var e in this.fuid_map){this.remove(e)}}});exports.NewNuxDialogSkipButton=a.extend({onClick:function(e){e.preventDefault();this.serverCall("button_clicked").success(this.finishStep.bind(this)).error(this.finishStep.bind(this)).send()}});exports.NuxDialogFollowMinimumTopicsContinueButton=a.extend({onLoad:function(){this._super.apply(this,arguments);this.tids={};
var e=this;this.handleEvent(i.Types.TOPICS_GRID_ADD,function(t){if(t.payload.tid){e.tids[t.payload.tid]=true;e.num_followed+=1;e.updateButton(e.num_followed)}});this.handleEvent(i.Types.TOPICS_GRID_REMOVE,function(t){if(t.payload.tid){delete e.tids[t.payload.tid];e.num_followed-=1;e.updateButton(e.num_followed)}})},onClick:function(e){e.preventDefault();if(this.$id("@next").hasClass("submit_button_disabled")){return false}var t=Object.keys(this.tids).map(function(e){return parseInt(e,10)});this.serverCall("button_clicked").kwargs({tids:t}).liveMutate().success(this.finishStep.bind(this)).error(this.finishStep.bind(this)).send()},updateButton:function(e){var t=this.min_interests-e;if(t>=1){this.$id("@next").addClass("submit_button_disabled").text(this.num_topics_texts[t])}else{this.$id("@next").removeClass("submit_button_disabled").text(this.button_continue_text)}}});exports.DynamicTopicGrid=t.extend({onLoad:function(){var e=this;this.handleEvent(i.Types.TOPICS_GRID_ADD,function(t){if(t.payload.tid){
e.addTopic(t.payload.tid)}});this.handleEvent(i.Types.TOPICS_GRID_REMOVE,function(t){if(t.payload.tid){e.removeTopic(t.payload.tid)}});this.handleEvent(i.Types.TOPICS_GRID_UPDATE_SHOWN,function(t){if(t.payload.tids){for(var i=0;i<t.payload.tids.length;i++){e.shownTids.push(t.payload.tids[i])}}})},addTopic:function(e){this.followedTids.push(e)},addRow:function(e){this.$id("@more").append('<span class="new_items"></span>');var t=this.$id("@more").children(".new_items").last();this.serverCall("load_row").kwargs({tid:e}).contentFor(t).sendOnlyOnce()},getFollowingCount:function(){return this.followedTids.length},removeTopic:function(e){var t=this.followedTids.indexOf(e);if(t!=-1){this.followedTids.splice(t,1)}}});exports.DynamicInterestsGrid=exports.DynamicTopicGrid.extend({addTopic:function(e){this._super.apply(this,arguments);this.addRow(e);this.serverCall("follow_topic").kwargs({tid:e}).send()},removeTopic:function(e){this._super.apply(this,arguments);this.serverCall("unfollow_topic").kwargs({
tid:e}).send()}});exports.InterestsGridItems=t.extend({onLoad:function(){this.emitEvent({type:i.Types.TOPICS_GRID_UPDATE_SHOWN,payload:{tids:this.new_tids}})}});exports.ExpertiseTopicListItemRemoveButton=t.extend({onLoad:function(){this.$id("@expertise-remove-button").click(this.dismiss.bind(this))},dismiss:function(e){e.preventDefault();this.serverCall("remove_expertise_topic").kwargs({tid:this.tid}).liveMutate().send();return false}});exports.NuxDialogFollowExpertiseContinueButton=exports.NuxDialogFollowMinimumTopicsContinueButton.extend({onClick:function(e){e.preventDefault();this.serverCall("button_clicked").liveMutate().success(this.finishStep.bind(this)).error(this.finishStep.bind(this)).send()}})});define("app/view/nux/existing_user",["shared/polyfills","webnode2"],function li(require,exports,e){var t=require("webnode2").Component;exports.ExistingUserNuxSidebar=t.extend({onLoad:function(){this.serverCall("track_impression").send()}});exports.ExistingUserNuxButton=t.extend({onLoad:function(){
this.$id("@existing-user-nux").click(this.initate.bind(this))},initate:function(e){e.preventDefault();this.serverCall("start_existing_user_nux").liveMutate().send();return false}});exports.ExistingUserNuxDismiss=t.extend({onLoad:function(){this.$id("@existing-user-nux-dismiss").click(this.dismiss.bind(this))},dismiss:function(e){e.preventDefault();this.serverCall("dismiss_existing_user_nux").liveMutate().send();return false}})});define("app/view/nux/find_friends",["shared/polyfills","webnode2","w2.dialog","facebook","shared/facebook","shared/events/index","view/paged_list"],function ci(require,exports,e){var t=require("webnode2").Component,i=require("w2.dialog").Dialog,n=require("facebook"),s=require("shared/facebook"),o=require("shared/events/index"),r=require("view/paged_list").PagedList;exports.FacebookFindFriendsButton=n.FacebookConnectButton.extend({onLoad:function(){this._super.apply(this,arguments);this.$id("@facebook_follow_button").on("click",this.onClick.bind(this))},onClick:function(){
if(s.isLoaded()){this.serverCall("button_clicked").send();this.connect()}return false},onLogin:function(e){this.showLoading();this._super.apply(this,arguments)},closeDialog:function(){if(this.standalone){i.dialogFor(this).close_();if(this.parent()){this.parent().standaloneRefreshFeed()}}},_onLogin:function(e){var t=this.serverCall("connect_facebook").kwargs({fb_access_token:e.accessToken,fb_uid:e.userID,expires:e.expiresIn});if(this.live_mutate){t.liveMutate()}t.success(this.closeDialog.bind(this)).error(this.closeDialog.bind(this)).send()},onLoginFailed:function(){this.serverCall("record_connect_failure").send()},showLoading:function(){this.$id("@normal_text").hide();this.$id("@loading_text").show();this.$id("@row").addClass("complete")}});exports.FacebookFindFriendsAndContinueButton=exports.FacebookFindFriendsButton.extend({onLoginFailed:function(){if(this.standalone){i.dialogFor(this).close_()}else{this.serverCall("login_failed").liveMutate().send()}this.serverCall("record_connect_failure").send();
}});exports.PowerUserFacebookFindFriendsAndContinueButton=exports.FacebookFindFriendsAndContinueButton.extend({onLoginFailed:function(){i.dialogFor(this).close_();this.serverCall("record_connect_failure").send()},_onLogin:function(e){this.serverCall("connect_facebook").kwargs({fb_access_token:e.accessToken,fb_uid:e.userID,expires:e.expiresIn}).error(this.closeDialog.bind(this)).send()},closeDialog:function(){i.dialogFor(this).close_()}});exports.FriendFollowIndicatorLink=t.extend({onLoad:function(){this.$toggle=this.$id("@toggle");this.$toggle.on("click",this.onClick.bind(this));this.isSelected=this.$toggle.hasClass("selected");var e=this;this.handleEvent(o.Types.NUX_DIALOG_FRIENDS_UPDATE,function(t){if(t.payload.addAll){e.toggleSelection(true)}else if(t.payload.removeAll){e.toggleSelection(false)}})},toggleSelection:function(e){this.isSelected=e;this.$toggle.toggleClass("selected",e);this.$toggle.toggleClass("unselected",!e)},onClick:function(){this.toggleSelection(!this.isSelected);if(this.isSelected){
this.emitEvent({type:o.Types.NUX_DIALOG_FRIENDS_UPDATE,payload:{addFriend:this.fuid}})}else{this.emitEvent({type:o.Types.NUX_DIALOG_FRIENDS_UPDATE,payload:{removeFriend:this.fuid}})}}});exports.FriendToggleCheckbox=t.extend({onLoad:function(){this.checkbox=this.$id("@friend_row").find(":checkbox");this.checkbox.on("change",this.onChange.bind(this));var e=this;this.$id("@friend_row").on("click",function(){e.checkbox.prop("checked",!e.checkbox.prop("checked"));e.onChange()});this.handleEvent(o.Types.NUX_DIALOG_FRIENDS_UPDATE,function(t){if(t.payload.addAll){e.toggleChecked(true)}else if(t.payload.removeAll){e.toggleChecked(false)}})},toggleChecked:function(e){this.checkbox.prop("checked",e);if(e){this.$id("@friend_row").find(".follow_button").addClass("unfollow_button").text("â")}else{this.$id("@friend_row").find(".follow_button").removeClass("unfollow_button").text(this.follow_text)}},onChange:function(){this.toggleChecked(this.checkbox.prop("checked"));if(this.checkbox.prop("checked")){
this.emitEvent({type:o.Types.NUX_DIALOG_FRIENDS_UPDATE,payload:{addFriend:this.fuid}})}else{this.emitEvent({type:o.Types.NUX_DIALOG_FRIENDS_UPDATE,payload:{removeFriend:this.fuid}})}}});exports.UnfollowedInferredFriendsToggleLink=t.extend({onLoad:function(){this.$id("@add").on("click",this.onAddClick.bind(this));this.$id("@remove").on("click",this.onRemoveClick.bind(this));var e=this;this.handleEvent(o.Types.NUX_DIALOG_FRIENDS_UPDATE,function(t){if(t.payload.updateAll){e.updateFriendsList()}})},changeAll:function(e){this.emitEvent({type:o.Types.NUX_DIALOG_FRIENDS_UPDATE,payload:{addAll:e,removeAll:!e}})},updateFriendsList:function(){if(!this.action){return}this.changeAll(this.action=="add_all")},onAddClick:function(){this.action="add_all";this.changeAll(true);this.$id("@add").hide();this.$id("@remove").show();this.serverCall("button_clicked").kwargs({button_name:this.action}).send()},onRemoveClick:function(){this.action="remove_all";this.changeAll(false);this.$id("@add").show();this.$id("@remove").hide();
this.serverCall("button_clicked").kwargs({button_name:this.action}).send()}});exports.InferredFriendsList=r.extend({onUpdate:function(e){this._super.apply(this,arguments);this.emitEvent({type:o.Types.NUX_DIALOG_FRIENDS_UPDATE,payload:{updateAll:true}})}})});define("app/view/oauth",["shared/polyfills","webnode2"],function ui(require,exports,e){var t=require("webnode2").Component;exports.OauthCallbackPage=t.extend({onLoad:function(){if(window.opener){if(this.access_token){window.opener.$(window.opener.document).trigger("oauth_approved",{service:this.service,accessToken:this.access_token})}else{window.opener.$(window.opener.document).trigger("oauth_rejected",{service:this.service})}window.close()}else{this.$id("@me").text("access token: "+JSON.stringify(this.access_token))}}})});define("app/view/payment/payable",["shared/polyfills","webnode2","view/modal"],function hi(require,exports,e){var t=require("webnode2").Component,i=require("view/modal").Base;exports.BankSettings=t.extend({onLoad:function(){
var e=this;e.$id("@edit").click(function(t){t.preventDefault();e.modal("load_edit_bank_modal")})}});exports.EditBankModal=i.extend({onSubmit:function(){var e=this;e.child("add_bank_form").submit(function(){e._closeModal()})}})});define("app/view/payment/receivable",["shared/polyfills","webnode2","unified_view/modal"],function fi(require,exports,e){var t=require("webnode2").Component,i=require("unified_view/modal").ModalBase;exports.PaymentSettings=t.extend({onLoad:function(){var e=this;var t=e.$id("@change_default");var i=t.find("input:radio");e.$id("@edit").click(function(t){t.preventDefault();e.createModal("load_edit_card_modal").show()});i.change(function(){e.serverCall("update_default_card").kwargs({index:i.index(t.find(":checked"))}).send()})}});exports.EditCardModal=i.extend({onSubmit:function(){var e=this,t=e._super;e.child("add_card_form").submit(function(){t.apply(e,arguments)})}});exports.DeleteCardLink=t.extend({onLoad:function(){var e=this;e.$id("@create_modal_link").on("click",function(t){
t.preventDefault();e.createModal("load_inner").show()})}});exports.DeleteCardConfirmationModal=i.extend({onSubmit:function(){this.serverCall("delete_card").liveMutate().send();this.close()}});exports.CannotDeleteCardModal=i.extend({onSubmit:function(){this.close()}})});define("app/view/people_selector",["shared/polyfills","view/selector"],function pi(require,exports,e){var t=require("view/selector").Selector,i=require("view/selector").MultiSelector;exports.LegacyPeopleSelector=t.extend({resultWasSelected:function(e){this.parent().setTo(e.data.uid);this.setQuery("");this.$input.blur()}});exports.PeopleAndSocialContactsMultiSelector=i.extend({whenOnSavedResultsChanged:function(e){this._onSavedResultsChanged=e},onSavedResultsChanged:function(){if(this._onSavedResultsChanged){this._onSavedResultsChanged(this.saved_results)}}})});define("app/view/photo",["shared/polyfills","webnode2","w2.dialog","interface/jquery","shared/errors","shared/window_manager"],function gi(require,exports,e){var t=require("webnode2").Component,i=require("w2.dialog").Dialog,$=require("interface/jquery")._jQuery,n=require("shared/errors"),s=require("shared/window_manager");
exports.EditPhotoDialogLink=t.extend({onLoad:function(){var e=this;this.$id("@open_edit_photo").click(function(){e.editPhoto();return false})},editPhoto:function(){var e=this;if(!this._dialog){this._dialog=this.dialog({showXButton:true,closeOnClickOut:true,width:550}).title(this.dialog_title).load("set_dialog_contents").close(function(){e._dialog=null})}}});exports.InlineEditPhotoChoice=t.extend({onLoad:function(){var e=this;this.$(".@img_choice").click(function(t){var n=$(t.target).attr("choice");e.serverCall("choose_photo").kwargs({choice:n}).success(function(){if(e.next_url){s.navigateTo(e.next_url)}else{i.dialogFor(e).close_()}}).send();e.$id("@choices").text(e.setting_text);return false})}});exports.InlineUploadPhotoWeb=t.extend({onLoad:function(){this.$id("@download").on("click",this.onClick.bind(this));this.$id("@url").on("input",this.onChange.bind(this));this.downloading=false},onChange:function(){var e=this.$id("@url").val();this.$id("@download").toggleClass("hidden",!e)},onClick:function(){
if(this.downloading){return}var e=this.$id("@url").val();if(e){this.downloading=true;var t=new Image;t.onload=this.downloadImage.bind(this,e);t.onerror=this.downloadImageError.bind(this);t.src=e}},downloadImageError:function(){this.downloading=false;alert(this.invalid_image_text);this.$id("@url").val("")},downloadImage:function(e){if(!this._contentForTarget){n.logJsError("InlineUploadPhotoWeb","contentFor target not set.");return}var t=this;this.serverCall("download").kwargs({target_id:this.target_id,target:this.target,url:e}).contentFor(this._contentForTarget).liveMutate().except("image_error",function(e){alert(e.message);i.dialogFor(t).close_()}).except("thumbs_already_set",function(){i.dialogFor(t).close_()}).success(this.onShowPhotoChoice.bind(this)).send()},focus:function(){this.$id("@url").focus()},setContentForTarget:function(e){this._contentForTarget=e},setShowPhotoChoiceCallback:function(e){this._showPhotoChoice=e},onShowPhotoChoice:function(){if(this._showPhotoChoice){this._showPhotoChoice();
}}})});define("view/pmsg",["shared/polyfills","webnode2","shared/events/index","interface/jquery"],function mi(require,exports,e){var t=require("webnode2").Component,i=require("shared/events/index"),$=require("interface/jquery")._jQuery;exports.PMsg=t.extend({onLoad:function(){var e=this;this.$id("@x").click(function(){e.close();return false})},close:function(){this.$id("@container").hide();$(".pmsg_container").hide()}});exports.PMsgContainer=t.extend({onLoad:function(e){var t=$("#layout_header");if(t.length!==0){this.headerHeight=t.outerHeight();if(!this.mobile){this.$id("@pmsg_container").css("top",this.headerHeight+10)}}if(this.$id("@pmsg_container").html()&&!this.mobile){this.$id("@pmsg_container").fadeIn(350);this.setFadeTimeout(5e3)}var n=this;this.handleEvent(i.Types.PMSG_SHOW,function(e){n.setContent(e.payload.content,e.payload.fadeOut)})},setFadeTimeout:function(e){var t=this;this.t=setTimeout(function(){t.$id("@pmsg_container").fadeOut(350)},e)},setContent:function(e,t){var i=this;
i.$id("@pmsg_container").hover(function(){clearTimeout(i.t);i.$id("@pmsg_container").stop();i.$id("@pmsg_container").css("opacity",100)},function(){i.setFadeTimeout(1e3)});var n=function(e){i.$id("@pmsg_container").setContent(e);i.$id("@pmsg_container").fadeIn(350);i.setFadeTimeout(5e3)};if(this.$id("@pmsg_container").is(":visible")){clearTimeout(this.t);this.$id("@pmsg_container").fadeOut(350,function(){n(e)})}else{n(e)}return this}})});define("app/view/pmsg/pmsg",["shared/polyfills","view/pmsg"],function vi(require,exports,e){var t=require("view/pmsg");exports.FlagConfirmationPmsg=t.PMsg.extend({onLoad:function(){var e=this;this._super.apply(this,arguments);this.$id("@undo").click(function(t){e.undo();return false})},undo:function(){this.serverCall("undo").liveMutate().send()}})});define("app/view/post",["shared/polyfills","webnode2"],function _i(require,exports,e){var t=require("webnode2").Component;exports.PostSuggestedEditDiscardButtonInline=t.extend({onLoad:function(){var e=this;this.$id("@submit").click(function(t){
e.serverCall("discard_suggested_edit").kwargs({pid:e.pid}).liveMutate().send();t.preventDefault()})}})});define("app/view/prize/add_answer",["shared/polyfills","webnode2"],function wi(require,exports,e){var t=require("webnode2").Component;exports.PrizeAnswerEditorCheckbox=t.extend({checked:function(){var e=this.$id("@checkbox");if(e.length===0){return undefined}else{return e.is(":checked")}},addChangeCallback:function(e){this.$id("@checkbox").change(e)}})});define("app/view/query/filters",["shared/polyfills","webnode2","view/fixable2","view/selector"],function bi(require,exports,e){var t=require("webnode2").Component,i=require("view/fixable2"),n=require("view/selector").Selector;exports.SearchFilters=t.extend({onLoad:function(){var e=this;i.makeFixable(e.$id("@sidebar_filters"),{min_height:e.$id("@sidebar_filters").outerHeight()+e.$id("@sidebar_filters").offset().top,min_width:990})}});exports.SearchFilterAuthorSelector=n.extend({resultWasSelected:function(e){this.parent().addFilterToKey(e.data.uid);
}});exports.SearchFilterTopicSelector=n.extend({resultWasSelected:function(e){this.parent().addFilterToKey(e.data.topic_routing_name)}})});define("app/view/query/query",["shared/polyfills","webnode2","shared/viewport","shared/action_log"],function yi(require,exports,e){var t=require("webnode2").Component,i=require("shared/viewport"),n=require("shared/action_log");exports.QueryResult=n.ActionableComponent.extend({onLoad:function(){this._super.apply(this,arguments);this.setDvar("query_id",this.query_id);this.setDvar("index",this.index);var e="_blank";if(this.compact){e="_parent"}this.$id('@title a[href!="#"]').attr("target",e);this.$id('@content a[href!="#"]').attr("target",e);this.checkHighlight();if(!this.unseen.bound){document.addEventListener("scroll",this.recordPrivateViews.bind(this));setTimeout(this.recordPrivateViews.bind(this),400);this.unseen.bound=true}this.unseen.items[this.cid]=this;this.view_item=[this.type,this.object_id]},navigateToObject:function(){var e=this.$id("@title a").attr("href");
window.open(e,"_parent")},checkHighlight:function(){var e=this.$id("@title").get(0);var t=this.$id("@content").get(0);if(e==null||t==null||(e.innerHTML+t.innerHTML).indexOf("matched_term")<0){this.serverCall("log_highlight_error").send()}},unseen:{bound:false,items:{},lastCheckTime:0,rateLimit:500},recordPrivateViews:function(){var e=+new Date;if(e<this.unseen.lastCheckTime+this.unseen.rateLimit){return}this.unseen.lastCheckTime=e;var t=[];var n=[];for(var s in this.unseen.items){var o=this.unseen.items[s];if(i.isElementInViewport(o.$id("@item").get(0))){t.push(o);n.push(o.view_item);delete this.unseen.items[s]}}if(t.length>0){t[0].serverCall("log_private_views").kwargs({view_items:n}).send()}}});exports.QueryResultRankingMetadata=t.extend({onLoad:function(){var e=this;this.$id("@metadata").click(function(){var t=e.$id("@metadata").parent().hasClass("expanded");e.$(".metadata").parent().removeClass("expanded");if(!t){e.$id("@metadata").parent().addClass("expanded")}})}});exports.QueryResults=t.extend({
onLoad:function(){var e=this;this.$id("@create_topic_link").click(function(){e.dialog().load("create_topic_dialog");return false})}})});define("app/view/question",["shared/polyfills","webnode2","w2.modal","view/dialog","tooltip","shared/prettyprint","interface/jquery","shared/events/index","shared/cookies","shared/window_manager","view/modal","shared/views","shared/mathify","view/inline_editor","shared/scroll_animation_handler","view/fixable2","shared/logging","shared/action_log"],function Ci(require,exports,e){var t=require("webnode2").Component,i=require("w2.modal"),n=require("view/dialog"),s=require("tooltip"),o=require("shared/prettyprint").prettyPrint,$=require("interface/jquery")._jQuery,r=require("shared/events/index"),a=require("shared/cookies"),d=require("shared/window_manager"),l=require("view/modal").Base,c=require("shared/views").viewsLogger,u=require("shared/mathify").renderMath,h=require("view/inline_editor").InlineEditor,f=require("shared/scroll_animation_handler"),p=require("view/fixable2"),g=require("shared/logging"),m=require("shared/action_log").ActionableComponent;
var v=r.Types;var _=exports.NewGridQuestionPage=t.extend({onLoad:function(){var e=this;e.handleEvent(v.QUESTION_DELETE_STATE_CHANGE,function(t){if(t.payload.qid==e.qid){d.reload()}})}});exports.QuestionMain=_.extend({onLoad:function(e){this._super.apply(this,arguments);if(e&&this.record_impression){setTimeout(function(){g.log("funnel_impression",{impression_type:"question_page_impression"})},1e3)}}});exports.QuestionLink=t.extend({onLoad:function(){var e=this;this.$id("@link").mousedown(function(){a.setQfeedLog(e,"QuestionClickthrough");a.setQueryLog(e,"QuestionClickthrough")});u(this.$id("@link"));o()}});exports.QuestionDetails=t.extend({onLoad:function(){u(this.$id("@text"));o()}});exports.NewUserSendNotif=t.extend({init:function(){this._super.apply(this,arguments);this.seen=false;this.notif_bottom=false;this.idleTime=1;this.noActivity=false;var e=$(document).find(".answer_wrapper").get();this.answersLocation=[];for(var t=0;t<e.length;t++){var i=$(e[t]);this.answersLocation.push(i.offset().top+i.height());
}var n=this;this.handleEvent(r.Types.NUX_DIALOG_CLOSE,function(){n._scrollHandler=n.scrollHandler.bind(n);window.addEventListener("scroll",n._scrollHandler);if(n.delay===true){n.delay=false;n.maybeSendNotif()}if(n.delay){window.setTimeout(function(){n.maybeSendNotif()},n.delay*1e3)}if(n.no_activity){window.setInterval(function(){n.idleTime=n.idleTime+1;if(n.idleTime>n.no_activity){n.noActivity=true}},1e3);$(this).mousemove(function(e){n.onUserActivity()});$(this).keypress(function(e){n.onUserActivity()})}})},onUserActivity:function(){if(this.noActivity){this.maybeSendNotif();this.noActivity=false}this.idleTime=0},maybeSendNotif:function(){if(!this.seen){this.seen=true;this.serverCall("send_go_home_notif").kwargs({}).send()}},maybeSendNotifBottom:function(){if(!this.notif_bottom){this.notif_bottom=true;this.serverCall("send_go_home_notif_double").kwargs({}).send()}},hitBottomHandler:function(){var e=$(window).scrollTop();var t=$(document).height();var i=$(window).height();if(e+i==t){if(this.double_notif){
this.maybeSendNotifBottom()}else{this.maybeSendNotif()}}},answerReadHandler:function(){var e=$(window).scrollTop();var t=0;for(var i=0;i<this.answersLocation.length;i++){if(e>this.answersLocation[i]){t=t+1}}if(t>=this.answer_read){this.maybeSendNotif()}},scrollHandler:function(){var e=$(window).scrollTop();if(this.hit_bottom||this.double_notif){this.hitBottomHandler()}if(this.answer_read){this.answerReadHandler()}if(this.on_scroll){if(e>200){this.maybeSendNotif()}}},onUnload:function(){if(this._scrollHandler){window.removeEventListener("scroll",this._scrollHandler)}}});exports.RelatedQuestionsList=t.extend({onLoad:function(){var e=this;var t=false;var i=300;this.recordStep(["rq_impression","rq_impression_repeated"]);if(!this.inline){var n=e.$id("@related_questions_list").get(0);var s=$(".layout_2col_side").height()+$(".SiteHeader").height()+10;if(s-i>$(window).height()){t=true}if(t){var o=$(n).find(".related_question").slice(8);if(n){p.makeFixable(n,{scroll_dep:true,min_scroll_callback:function(){
return s},min_height:0,footer:$(".first_content_page_feed").get(0)})}f.add(window,function(){if(window.scrollY>s){o.addClass("hidden")}else{o.removeClass("hidden")}})}else{if(n){p.makeFixable(n,{scroll_dep:true,min_height:s,extra_bottom_spacing:40,footer:$(".first_content_page_feed").get(0)})}}}},recordStep:function(e){g.log("related_question_steps",{steps:e})}});exports.RelatedQuestionLink=m.extend({onLoad:function(){this._super.apply(this,arguments);var e=this;e.$id("@actionable").on("mousedown",function(){e.recordStep("related_question_click")})},recordStep:function(e){this.serverCall("record_step").kwargs({step_name:e}).send()}});exports.QuestionArea=t.extend({onLoad:function(){this._super.apply(this,arguments);this._detailsOverLimit=false;this._textOverLimit=false;var e=this;this.handleEvent(r.Types.QUESTION_EDITING_STATE,function(t){if(t.payload.qid!=e.qid){return}if(t.payload.state=="edit"){e.editLinkClicked()}else if(t.payload.state=="cancel"){e.cancelLinkClicked()}else if(t.payload.state=="text_limit"){
e._textOverLimit=t.payload.is_over}else if(t.payload.state=="details_limit"){e._detailsOverLimit=t.payload.is_over}});e.$id("@question_update").click(function(t){t.preventDefault();e.emitEvent({type:r.Types.QUESTION_EDITING_STATE,payload:{qid:e.qid,state:"request"}});e.$id("@details_container").addClass("hidden")});e.$id("@question_cancel").click(function(t){t.preventDefault();e.emitEvent({type:r.Types.QUESTION_EDITING_STATE,payload:{qid:e.qid,state:"trigger_cancel"}});e.$id("@details_container").addClass("hidden")})},editLinkClicked:function(){this.$id("@details_container").removeClass("hidden")},cancelLinkClicked:function(){this.$id("@details_container").addClass("hidden")},updateButton:function(){this.$id("@question_update").toggleClass("disabled",this._textOverLimit||this._detailsOverLimit)}});var w=h.extend({onLoad:function(){this._super.apply(this,arguments);var e=this;this.handleEvent(r.Types.QUESTION_EDITING_STATE,function(t){if(t.payload.qid!=e.id){return}if(t.payload.state=="edit"){
if(!e.editorShown){e.toggle_editor()}}else if(t.payload.state=="cancel"){if(e.editorShown){e.toggle_editor()}}else if(t.payload.state=="request"){e.trigger_request()}else if(t.payload.state=="trigger_cancel"){e.trigger_cancel()}})},onEditLinkClick:function(){this.emitEvent({type:r.Types.QUESTION_EDITING_STATE,payload:{qid:this.id,state:"edit"}})},cancelEditor:function(){this._super.apply(this,arguments);this.emitEvent({type:r.Types.QUESTION_EDITING_STATE,payload:{qid:this.id,state:"cancel"}})}});exports.QuestionTextInlineEditor=w.extend({onLoad:function(){this._super.apply(this,arguments);var e=this;this.editor.setLengthChangeCallback(function(t){e.emitEvent({type:r.Types.QUESTION_EDITING_STATE,payload:{qid:e.id,state:"text_limit",is_over:t}})})}});exports.FeedQuestionTextInlineEditor=exports.QuestionTextInlineEditor.extend({toggle_editor:function(){}});exports.QuestionDetailsInlineEditor=w.extend({onLoad:function(){this._super.apply(this,arguments);var e=this;this.editor.setLengthChangeCallback(function(t){
e.emitEvent({type:r.Types.QUESTION_EDITING_STATE,payload:{qid:e.id,state:"details_limit",is_over:t}})})}});exports.FeedQuestionDetailsInlineEditor=exports.QuestionDetailsInlineEditor.extend({toggle_editor:function(){}});exports.QuestionDeleteUndeleteLink=t.extend({onLoad:function(){var e=this;this.$id("@undelete_question_link").click(function(){e.dialog().title(e.undelete_title).cancel().ok(function(){e._request("undelete_question")}).text(e.undelete_content);return false})},_request:function(e){var t=this;this.serverCall(e).kwargs({qid:this.qid}).success(function(){t.emitEvent(r.helpers.changeQuestionDeletionState(t.qid))}).liveMutate().send()}});exports.QuestionDeleteDialog=n.AddCommentDialog.extend({onLoad:function(){var e=this;this._super.apply(this,arguments);e.setSuccessCallback(function(){e.emitEvent(r.helpers.changeQuestionDeletionState(e.object_id))})},getPars:function(){if(this.comment_required&&this.editor.isOnlyWhiteSpace()){return false}return{comment:this.editor.serialize(),
review:this.review}}});exports.AnswerActions=t.extend({});exports.AnswerPermaLink=t.extend({onLoad:function(){var e=this;this.$id("@link").mousedown(function(){a.setQfeedLog(e,"AnswerClickthrough");a.setQueryLog(e,"AnswerClickthrough")});if(this.tooltip){s.attach(this.$id("@link"),this.tooltip)}}});exports.AnswerUndeleteBanner=t.extend({onLoad:function(){var e=this;e.$id("@answer_undelete").click(function(t){e.modal("load_answer_delete_modal").onSubmitCallBack(function(){e.serverCall("unremove_answer").kwargs({aid:e.aid}).liveMutate().send()})})}});exports.AnswerUndeleteModal=l.extend({onSubmit:function(){this._super.apply(this,arguments);i.Modal.modalFor(this).executeOnSubmitCallBack()}});exports.AnswerPageViewMoreLink=t.extend({onLoad:function(){var e=this;this.$id("@link").mousedown(function(){a.setQfeedLog(e,"QuestionClickthrough");a.setQueryLog(e,"QuestionClickthrough")})}});exports.CreateAnswerWikiLink=t.extend({onLoad:function(){this.$id("@create_answer_wiki").click(function(e){$("#answer_wiki").toggleClass("hidden");
e.preventDefault()})}});exports.AnswerListDiv=t.extend({onLoad:function(){this.header_height=$(".SiteHeader").outerHeight();this.offset=15;this.$id("@answers_anchor").css("top","-"+this.header_height+"px");if(window.location.hash=="#answers"){$(window).scrollTop(this.$id("@answers_anchor").offset().top)}},show:function(){this.$id("@collapsed").show()}});exports.QuestionAnswerMain=t.extend({onLoad:function(e){if(e){setTimeout(function(){g.log("funnel_impression",{impression_type:"answer_page_impression"})},1e3)}this.recordStep("share_impression")},recordStep:function(e){this.serverCall("record_step").kwargs({step_name:e}).send()}});var b=_;exports.QuestionAnswerPageMain=b.extend({onLoad:function(e){var t=this;this._super.apply(this,arguments);if(t.prompt_topic_bio){if(t.use_credentials){t.createModal("credentials_modal").kwargs({aid:t.aid}).show()}else{t.modal("topic_bio_modal",{kwargs:{aid:t.aid}})}}else if(t.prompt_share_answer){t.createModal("share_answer_modal").kwargs({aid:t.aid}).show();
}if(e){setTimeout(function(){g.log("funnel_impression",{impression_type:"answer_page_impression"})},1e3)}this.recordStep("share_impression")},recordStep:function(e){this.serverCall("record_step").kwargs({step_name:e}).send()}});exports.AttachDisclaimerLink2=t.extend({onLoad:function(){var e=this;this.$id("@add_disclaimer_link").click(function(){e._dialog=e.dialog().title(e.create_disclaimer_title).load("set_disclaimer_dialog");return false})}});exports.AnswerPagedListItem=t.extend({onLoad:function(){c.addComponentToTrack(this)}})});define("app/view/share",["shared/polyfills","webnode2","tooltip"],function xi(require,exports,e){var t=require("webnode2").Component,i=require("tooltip");var n=exports.ShareAction=t.extend({onLoad:function(){var e=this;e.$id("@share").on("click",function(t){t.preventDefault();e.modal("load_modal")})}});var s;exports.AutoShowShareAction=n.extend({onLoad:function(){s=this},show:function(e){this.__js_init=e;setTimeout(this.showDialog.bind(this),1500)}});exports.showShareAction=function(e){
if(s){s.show(e)}};exports.CopyToClipboardShareLink=t.extend({onLoad:function(){var e=this;var t=this.$id("@copy_link");this.tooltip=i.attach(t,this.copy_url,{attach_to_body:true});t.click(function(t){t.stopPropagation();var i=document.createElement("textarea");document.body.appendChild(i);i.value=e.copy_url;i.select();var n=document.execCommand("copy");i.remove();if(n){e.tooltip.updateText(e.copy_message_success);e.tooltip.render();e.tooltip.updateText(e.copy_url)}else{e.$id("@copy_link").addClass("completed");e.tooltip.updateText(e.copy_message_fail);e.tooltip.render()}})}})});define("app/view/question/add_answer",["shared/polyfills","jquery.webnode2","webnode2","interface/jquery","view/inline_editor","shared/cookies","shared/window_manager","view/modal","settings","facebook","app/view/share"],function ki(require,exports,e){require("jquery.webnode2");var t=require("webnode2").Component,$=require("interface/jquery")._jQuery,i=require("view/inline_editor").InlineEditor,n=require("shared/cookies"),s=require("shared/window_manager"),o=require("view/modal").Base,r=require("settings"),a=r.interface_strings,d=require("facebook"),l=require("app/view/share").showShareAction;
exports.AnswerAdd=t.extend({onLoad:function(){var e=this;e.$id("@toggle_zen").click(function(){e.toggleZen()});e.$id("@answer_add").find(".submit_button").click(function(){if(e.$id("@answer_add").hasClass("is_zen")){e.toggleZen()}});var t=this.child("editor_section").child("editor");t.whenOnLoaded(t.focusEditorInputWhenReady.bind(t))},toggleZen:function(){var e=this;function t(t){if(t.keyCode==27){e.toggleZen()}}if(e.$id("@answer_add").hasClass("is_zen")){e.serverCall("zen_mode_exited").send();$(document).unbind("keyup",t)}else{e.serverCall("zen_mode_entered").send();$(document).keyup(t)}$("body").toggleClass("zen_mode");e.$id("@answer_add").toggleClass("is_zen");e.$id("@zen_bg").toggleClass("hidden")}});var c=exports.AnswerEditor=i.extend({onLoad:function(){this.editor=this.child("editor");this.answerShareForm=this.child("answer_share_form");this.editorShare=this.answerShareForm&&this.answerShareForm.child("editor_share");var e=this;this.editor.prevent_load_drop_zone=true;this._super.apply(this,arguments);
this.disclaimer_update="";this.editor.setFocusCallback(function(){e.focusEditor()});if(!this.editor.isInteractive()){this.focusEditor()}this.updated_question_modal_shown=false;var t=this.child("prize_confidentiality_checkbox");if(t.checked()!==undefined){if(!t.checked()){e.$id("@inline_editor_submit").addClass("disabled")}t.addChangeCallback(function(i){if(t.checked()){e.$id("@inline_editor_submit").removeClass("disabled")}else{e.$id("@inline_editor_submit").addClass("disabled")}})}},focusEditor:function(){if(this.editor.support_drag_and_drop_upload){if(!this.dragAndDropFormLoaded){this.dragAndDropFormLoaded=true;this.editor.loadDragAndDropForm()}}},focusEditorInputWhenReady:function(){var e=this;this.editor.setEditorReadyCallback(function(){e.editor.hideFakeEditor()})},showShareWarningDialog:function(){var e=this;var t=this.editorShare.getValues(),i;if(t.tw){if(t.fb){i=this.share_warning_texts.tw_fb}else{i=this.share_warning_texts.tw}}else if(t.fb){i=this.share_warning_texts.fb}this.editorShare.serverCall("warning_dialog_shown").send();
this.editorShare.dialog().title(this.share_warning_dialog_title).cancel(null,a.cancel).ok(function(){e.shouldShowShareWarningDialog=false;e.input_button_obj.click()},this.share_warning_dialog_ok).html(i)},showAnonAnswerWarningDialog:function(){var e=this;e.modal("anon_answer_warning").onSubmitCallBack(function(){e.shouldShowAnonAnswerWarningDialog=false;e.input_button_obj.click()})},submitHandler:function(){var e=this;this.input_button_obj.click(function(t){if(e.getConfidentialityCheckboxChecked()===false){return false}if(e.getEditor()&&e.isEditorEmpty()){return false}var i={};if(e.editorShare){i=e.editorShare.getValues()}var n=(i.tw||i.fb)&&e.shouldShowShareWarningDialog;if(n){e.showShareWarningDialog();return false}if(e.shouldShowAnonAnswerWarningDialog){e.showAnonAnswerWarningDialog();return false}e.trigger_request();t.preventDefault()})},invokeEditServerCall:function(e){var t={};if(this.editorShare){t=this.editorShare.getValues()}if(t.fb&&!d.hasPermission("publish_actions")){var i=this._super;
var n=this;d.requestPermissions("publish_actions",function(){i.call(n,e)})}else{this._super.call(this,e)}},ajax_callback:function(e){if(e.ans_url){s.navigateTo(e.ans_url)}if(e&&e.show_updated_question_modal){this.save_draft(true);this.modal("load_changed_modal",{kwargs:{submit_id:this.input_button_obj.attr("id"),qid:e.qid}});this.updated_question_modal_shown=true;this.locked=false;return}if(e.prompt_topic_bio&&!e.ans_url){this.modal("topic_bio_modal",{kwargs:{aid:e.aid}})}if(e.share_data&&e.share_data.autoShowShareDialog){l(e.share_data)}if(s.sameDomainURL(e.url)){s.navigateTo(e.url)}return this._super.apply(this,arguments)},tlog_data:function(){return{type:"AddAnswer"}},getLoggedAction:function(){return"AnswerAdd"},logSaveDraft:function(){n.setTlog({type:"QuestionSaveDraft",qid:this.id})},_get_kwargs:function(){var e={id:this.id,input:this.get_value(),disclaimer_update:this.disclaimer_update,fb_uid:d.getFbUid(),fb_access_token:d.getAccessToken(),fb_expires:d.getExpiresIn(),updated_question_modal_shown:this.updated_question_modal_shown,
prize_confidentiality_checkbox:this.getConfidentialityCheckboxChecked(),prize_opted_into_notifs:this.getOptIntoNotifsCheckboxChecked(),redirect_to_answer_page:this.redirect_to_answer_page};if(this.editorShare){e.share_values=this.editorShare.getValues()}return e},getSaveDraftKwargs:function(){var e=this._super.apply(this,arguments);return e},getConfidentialityCheckboxChecked:function(){return this.child("prize_confidentiality_checkbox").checked()},getOptIntoNotifsCheckboxChecked:function(){return this.child("prize_opt_into_notifs_checkbox").checked()}});exports.AnswerInFeedEditor=c.extend({trigger_request:function(){n.setQfeedLog(this,"AddAnswer");this._super.apply(this,arguments)},logSaveDraft:function(){n.setQfeedLog(this,"QuestionSaveDraft")},ajax_callback:function(e){this.$id("@inline_editor_form").parents(".answer_editor").addClass("hidden");this._super.apply(this,arguments)}});exports.AnswerDraftPageEditor=c.extend({onLoad:function(){this._super.apply(this,arguments);this.should_toggle_on_submit=false;
this.editor=this.child("editor");this.editor.focus()},trigger_request:function(){n.setQfeedLog(this,"AddAnswer");this._super.apply(this,arguments)},logSaveDraft:function(){n.setQfeedLog(this,"QuestionSaveDraft")}});exports.AnswerEditorMetadataItem=t.extend({onLoad:function(){var e=this,t=this.$id("@toggle");t.click(function(){e.$id("@item").toggleClass("ghosted");if(t.text()===e.show_text){e.showItem();t.text(e.hide_text)}else{e.hideItem();t.text(e.show_text)}return false})},showItem:function(){return false},hideItem:function(){return false}});exports.ChangedQuestionModal=o.extend({onSubmit:function(){var e=this;this._closeModal();$("#"+e.submit_id).click()},onCancel:function(){this.$(".answer_editor").removeClass("hidden");this._closeModal()},onClose:function(){this.$(".answer_editor").removeClass("hidden");this._closeModal()}})});define("app/view/question/answer_tag",["shared/polyfills","webnode2","tooltip","w2.dialog"],function Si(require,exports,e){var t=require("webnode2").Component,i=require("tooltip"),n=require("w2.dialog").Dialog;
exports.AnswerTagAdminActions=t.extend({onLoad:function(){if(!this.enabled){this.$id("@tag_options").addClass("hidden")}}});exports.AnswerTagOption=t.extend({onLoad:function(){var e=this;this.$id("@select_tag").click(function(){e._dialog=e.dialog().title(e.dialog_title).load("add_tag_dialog");return false})}});exports.AnswerSoftCollapseMenuListItem=t.extend({onLoad:function(){var e=this;e.$id("@toggle_soft_collapse").on("click",function(t){t.preventDefault();e.serverCall("toggle_soft_collapse").send()})}});exports.AddTagDialog=t.extend({onLoad:function(){var e=this;this.$id("@cancel").click(function(){n.dialogFor(e).close_();return false});this.$id("@add_tag").click(function(){var t=null;if(e.should_show_editor){var i=e.child("editor");t=i.serialize()}var s=e.$id("@locked").is(":checked");e.serverCall("add_tag").kwargs({comment:t,lock:s}).liveMutate().success(function(){n.dialogFor(e).close_()}).send();return false})}});exports.AnswerTag=t.extend({onLoad:function(){var e=this;this.$id("@show_comment").click(function(){
e.$id("@comment").removeClass("hidden");e.$id("@show_comment").addClass("hidden");return false});i.attach(this.$id("@remove"),this.remove_short_text);this.$id("@remove").click(function(){e._dialog=e.dialog().title(e.remove_text).cancel().ok(function(){var t=arguments[0].dialogComponent;var i=t.child("editor").serialize();e.serverCall("remove_tag").kwargs({comment:i}).liveMutate().send()},e.remove_short_text).load("remove_tag_dialog");return false})}});exports.SoftenAnswerTag=t.extend({onLoad:function(){var e=this;this.$id("@remove").click(function(){e._dialog=e.dialog().title(e.remove_text).cancel().ok(function(){var t=arguments[0].dialogComponent;var i=t.child("editor").serialize();e.serverCall("remove_tag").kwargs({comment:i}).liveMutate().send()},e.remove_short_text).load("remove_tag_dialog");return false})}});exports.AnswerCollapsedTag=t.extend({onLoad:function(){var e=this;this.$id("@show_comment").click(function(t){t.preventDefault();e.$id("@comment").removeClass("hidden");e.$id("@show_comment").addClass("hidden");
})}})});define("app/view/question/ask_question",["shared/polyfills","webnode2","view/selector","shared/events/index","unified_view/modal"],function Ei(require,exports,e){var t=require("webnode2").Component,i=require("view/selector").WithServerCallMessageMixin,n=require("shared/events/index"),s=require("unified_view/modal").ModalBase;exports.AskQuestionButton=t.extend({onLoad:function(){var e=this;this.$id("@button").click(function(){e.createModal("ask_question_modal").kwargs({target_type:e.targetType,target_oid:e.targetOid}).show()})}});exports.AskQuestionModal=s.extend({onLoad:function(){var e=this;e._super.apply(e,arguments);e.handleEvent(n.Types.QUESTION_SUBMIT,function(t){e.onSubmit()});this.$id("@anon_checkbox").on("change",function(t){var i=e.$id("@anon_checkbox").prop("checked")||false;if(i){e.$id("@user_asks").addClass("hidden");e.$id("@anon_asks").removeClass("hidden")}else{e.$id("@anon_asks").addClass("hidden");e.$id("@user_asks").removeClass("hidden")}})},onSubmit:function(){
var e=this;var t=e.child("question_bar");e.$id("@submit").addClass("submit_button_disabled");var i=e.$id("@submit").get(0).innerHTML;e.$id("@submit").get(0).innerHTML="Asking...";e.serverCall("ask_question").kwargs({question_text:t.query,is_anon:e.$id("@anon_checkbox").prop("checked")||false,question_details:"",source:e.source,target_type:e.targetType,target_oid:e.targetOid}).success(function(t){if(t){e.close()}e.$id("@submit").removeClass("submit_button_disabled");e.$id("@submit").get(0).innerHTML=i}).except(function(t){e.$id("@submit").removeClass("submit_button_disabled");e.$id("@submit").get(0).innerHTML=i}).error(function(t){e.$id("@submit").removeClass("submit_button_disabled");e.$id("@submit").get(0).innerHTML=i}).send()}});exports.AskQuestionSelector=i.extend({onLoad:function(){var e=this;e._super.apply(e,arguments);e.minWords=3;e.delay=500;e.timer=null;e.firstEdit=true;e.allow_no_selection=true;e.focus();e.$input.on("keydown",function(t){if(t.which==13){t.preventDefault();e.emitEvent({
type:n.Types.QUESTION_SUBMIT,payload:{}})}});e.$id("@add_details").click(function(t){t.preventDefault();e.showQuestionDetailsEditor(true)});e.$id("@remove_details").click(function(t){t.preventDefault();e.showQuestionDetailsEditor(false)})},setInputVal:function(e,t){var i=this.$input[0].selectionStart,n=this.$input[0].selectionEnd;if(t){i+=t;n+=t}this.$input.val(e);if(e.length>0){this.$input[0].setSelectionRange(i,n)}},showQuestionDetailsEditor:function(e){if(e){this.$id("@add_details").addClass("hidden");this.$id("@remove_details").removeClass("hidden");this.$id("@details_wrapper").removeClass("hidden")}else{this.$id("@remove_details").addClass("hidden");this.$id("@add_details").removeClass("hidden");this.$id("@details_wrapper").addClass("hidden")}},capitalize:function(e){if(!e){return e}var t=this.opening_question_punctuation.length;e=e.slice(0,t)+e.charAt(t).toUpperCase()+e.slice(t+1);return e},queryDidChange:function(){var e=0;if(this.firstEdit){this.firstEdit=false;this.query=this.opening_question_punctuation+this.query+this.closing_question_punctuation;
e=this.opening_question_punctuation.length}this.setInputVal(this.capitalize(this.query),e)},wrapperFocusoutHandler:function(){},updateResults:function(){var e=this;window.clearTimeout(e.timer);if(e.query.split(" ").length>=e.minWords){e.timer=window.setTimeout(function(){i.prototype.updateResults.call(e)},e.delay)}}})});define("app/view/question/cant_answer",["shared/polyfills","shared/core/component","shared/cookies","shared/events/index","unified_view/modal","shared/perf"],function Ti(require,exports,e){var t=require("shared/core/component").Component,i=require("shared/cookies"),n=require("shared/events/index"),s=require("unified_view/modal").ModalBase,o=require("shared/perf");var r=exports.CantAnswerLink=t.extend({onLoad:function(){var e=this;var t=this.unsafe$id("@cant_answer");t.on("click",function(){e._userPerceivedAction=o.startUserPerceived({vcon:e.__vcon,method:"mark_as_cant_answer"});i.setQfeedLog(e,"QuestionPass");e.emitEvent(n.helpers.addQuestionCantAnswer(e.id));if(e._userPerceivedAction){
o.finishAction(e._userPerceivedAction);e._userPerceivedAction=null}e.cantAnswer();return false})},cantAnswer:function(){this.serverCall("mark_as_cant_answer").disableDefaultUserPerceivedLogging().liveMutate({optimisticUpdate:true}).send();return false}});exports.AMACantAnswerLink=r.extend({onLoad:function(){var e=this;this.$id("@cant_answer").on("click",function(){e.cantAnswer();return false})}});exports.A2ACantAnswerLink=t.extend({onLoad:function(){var e=this;this.$id("@cant_answer").on("click",function(){e._userPerceivedAction=o.startUserPerceived({vcon:e.__vcon,method:"decline"});e.emitEvent(n.helpers.addQuestionCantAnswer(e.id));if(e._userPerceivedAction){o.finishAction(e._userPerceivedAction);e._userPerceivedAction=null}e.decline();return false})},decline:function(){this.serverCall("decline").disableDefaultUserPerceivedLogging().liveMutate({optimisticUpdate:true}).send();return false}});exports.A2ACantAnswerReasonLink=t.extend({onLoad:function(){var e=this;this.$id("@a2a_cant_answer").on("click",function(){
if(e.allow_reason){e.createModal("decline_modal").show()}return false})}});exports.A2ACantAnswerReasonModal=s.extend({onLoad:function(){this._super.apply(this);this.reason=this.child("editor")},onSubmit:function(){this.serverCall("attach_decline_reason").kwargs({reason:this.reason.serialize()}).liveMutate().send();this.close()}});exports.UndoCantAnswerLink=t.extend({onLoad:function(){var e=this;this.$id("@undo_cant_answer").on("click",function(){e.emitEvent(n.helpers.removeQuestionCantAnswer(e.id));e.undoCantAnswer();return false})},undoCantAnswer:function(){this.serverCall("undo_mark_as_cant_answer").liveMutate().send();return false}})});define("app/view/question/disclaimer",["shared/polyfills","webnode2","shared/events/index","tooltip","w2.dialog"],function $i(require,exports,e){var t=require("webnode2").Component,i=require("shared/events/index"),n=require("tooltip"),s=require("w2.dialog").Dialog;exports.AttachDisclaimerToPost=t.extend({onLoad:function(){var e=this;e.$id("@add_disclaimer_link").click(function(){
e.attachDisclaimer();return false});n.attach(e.$id("@remove_button"),e.remove_disclaimer_tooltip);e.$id("@remove_button").click(function(){e.removeAttachedDisclaimer();return false})},attachDisclaimer:function(){this.$id("@add_disclaimer_link").toggleClass("hidden");this.$id("@disclaimer_attached").toggleClass("hidden");this.emitEvent({type:i.Types.POST_DISCLAIMER,payload:{pid:this.pid,state:"attach"}})},removeAttachedDisclaimer:function(){this.$id("@add_disclaimer_link").toggleClass("hidden");this.$id("@disclaimer_attached").toggleClass("hidden");this.emitEvent({type:i.Types.POST_DISCLAIMER,payload:{pid:this.pid,state:"remove"}})}});exports.SetDisclaimerDialog=t.extend({onLoad:function(){var e=this;e.$id("@cancel").click(function(){s.dialogFor(e).close_();return false})},showEditor:function(){this.$id("@choose_profession_area").hide();this.$id("@edit_disclaimer_area").show();this.child("editor").focusInput();this.$id("@cancel").hide()},showError:function(){this.$id("@choose_profession_area").hide();
this.$id("@wrong_profession_error").show()}});exports.DisclaimerIndicateProfession=t.extend({onLoad:function(){var e=this;e.$("%@profession").click(function(){e.parent().showEditor();return false});e.$("%@other").click(function(){e.parent().showError();return false})}})});define("app/view/site_header/logged_in",["shared/polyfills","webnode2","interface/jquery","view/hover_menu","shared/events/index","shared/cookies","shared/w2.context"],function Li(require,exports,e){var t=require("webnode2").Component,$=require("interface/jquery")._jQuery,i=require("view/hover_menu"),n=require("shared/events/index"),s=require("shared/cookies"),o=require("shared/w2.context");exports.LoggedInSiteHeaderContext=o.Context.extend({initialProperties:function(){return{question_query_empty:true,question_title_over_limit:false,question_details_over_limit:false,question_details_in_focus:false,question_details_cleared:false,question_details_is_empty:true,question_details_text_serialized:"",lookup_bar_focused:false,
force_enable_button:null}}});exports.LoggedInSiteHeader=t.extend({contextConstructor:function(){return exports.LoggedInSiteHeaderContext},onLoad:function(){var e=this;this.handleEvent(n.Types.SITE_HEADER_SEARCH_FOCUSED,function(t){e.$id("@header").toggleClass("search_focused",t.payload.focused)});this.$id("@go_to_feed_popup_close").click(function(){e.$id("@go_to_feed_popup").addClass("hide")})}});exports.NotifsNavBadge=t.extend({onLoad:function(){this.hoverMenuContext=this.getContext(o.HoverMenu);if(this.hoverMenuContext){this.hoverMenuContext.on("isShown",this.onMenuExpand.bind(this))}},onMenuExpand:function(){this.$id("@badge").addClass("hidden")}});exports.NotifsNavItemBase=i.HoverMenu.extend({isInvalidCloseTarget:function(e){var t=this.$id("@link");var i=".SiteHeaderHoverMenuContents";if(e.is(t)||e.parents(t).is(t)||e.is(i)||e.parents(i).length!==0){return true}return false},doShow:function(){this.serverCall("clear_badge").send();this._super.apply(this,arguments)}});exports.NotifsHoverMenuContents=t.extend({
onLoad:function(){this.$id("@dropdown").on("DOMMouseScroll mousewheel",function(e){var t=this.scrollTop,i=this.scrollHeight,n=e.type=="DOMMouseScroll"?e.originalEvent.detail*4:e.originalEvent.deltaY,s=n<0;if(!s&&n>i-$(this).height()-t){$(this).scrollTop(i);e.preventDefault()}else if(s&&-n>t){$(this).scrollTop(0);e.preventDefault()}})}});exports.MobileSiteLink=t.extend({onLoad:function(){this.$id("@mobile_link").click(function(){s.setCookie("m","1");window.location.reload(true);return false})}})});define("app/view/question/lookup_bar",["shared/polyfills","webnode2","interface/jquery","view/selector","shared/window_manager","shared/events/index","shared/siteuri","shared/cookies","app/view/site_header/logged_in","unified_view/toggle"],function Mi(require,exports,e){var t=require("webnode2").Component,$=require("interface/jquery")._jQuery,i=require("view/selector").WithServerCallMessageMixin,n=require("shared/window_manager"),s=require("shared/events/index"),o=require("shared/siteuri").URI,r=require("shared/cookies"),a=require("app/view/site_header/logged_in").LoggedInSiteHeaderContext,d=require("unified_view/toggle");
var l=null;exports.LookupBarSelector=i.extend({onLoad:function(){var e=this;l=e;this._super.apply(this,arguments);e.context=e.getContext(a);if(e.logged_in){e.context.set("question_query_empty",this.isQueryEmpty())}this.$results_wrapper=this.$id("@results_wrapper");this.$results_container.removeClass("hidden");e.displayedRevision=0;e.currentRevision=0;e.currentOutstandingRequests=0;e.lastRevisionNeedsUpdate=false;e.cache={};e.cacheSize=0;e.focused=true;e.shouldSimScroll=true;e.$wrapper=e.$id("@wrapper");e.shouldHighlightOnFocus=!e.should_autofocus;e.editingQuestionDetails=false;e.targetType=null;e.targetOid=null;e.adding_followup=false;e.$(document).mousedown(function(t){if(e.logged_in){e.context.set("lookup_bar_focused",true)}if(!e.$wrapper.is(t.target)&&e.$wrapper.has(t.target).length===0&&!$(t.target).closest(".SiteHeader.search_focused")[0]&&!$(t.target).closest(".ClearQuestionDetailsConfirmationModal")[0]){e.focused=false;e.setHighlight(false);e.showResults(false);if(e.askMode==="forced"){
if(e.isQueryEmpty()){e.setAskMode(false);e.setQuery("")}else{e.askMode=true}}}else if(e.$id("@details_wrapper").has(t.target).length>0){e.showResults(false)}else{e.shouldSimScroll=false;e.focused=true;if(e.query.trim().length!==0){if(!e.hasResults){e._setQuery(e.$input.val())}else{e.showResults(true)}}else{e.showResults(false)}}});e.$input.click(function(){if(!e.shouldHighlightOnFocus){e.setHighlight(true)}if(e._queryIsPunctation(e.query)&&e.askMode==="forced"){var t=e.opening_question_punctuation.length;e.$input[0].setSelectionRange(t,t)}});e.askMode=false;e.showingInterstitial=false;e.source=null;e.currentSession=0;this.handleEvent(s.Types.LOOKUP_BAR_ASK_QUESTION,function(t){e.ask(t.payload.isPrivate)});this.handleEvent(s.Types.LOOKUP_BAR_QUESTION_DETAILS_STATE,function(t){if(t.payload.state=="focused"){e.showResults(false)}else if(t.payload.state=="shown"){e.$id("@details_wrapper").removeClass("hidden");e.editingQuestionDetails=true}else if(t.payload.state=="hidden"){e.$id("@details_wrapper").addClass("hidden");
e.editingQuestionDetails=false;e.$input.focus()}})},inputFocusHandler:function(){this._super.apply(this,arguments);if(this.shouldHighlightOnFocus){this.setHighlight(true);if(!this.isQueryEmpty()&&this.hasResults&&!this.editingQuestionDetails){this.showResults(true)}}},inputBlurHandler:function(){this._super.apply(this,arguments);if(this.logged_in){var e=this;if(document.activeElement.id!=e.$input.attr("id")&&!e.focused){e.setHighlight(false);e.shouldHighlightOnFocus=true}}},handleEscKey:function(){this._super.apply(this,arguments);if(this.logged_in){this.setHighlight(false)}},capitalize:function(e){if(!e){return e}e=e.charAt(0).toUpperCase()+e.slice(1);return e},setInputVal:function(e,t){var i=this.$input[0].selectionStart,n=this.$input[0].selectionEnd;if(t){i+=t;n+=t}this.$input.val(e);if(e.length>0){this.$input[0].setSelectionRange(i,n)}},_queryIsPunctation:function(e){return e===this.opening_question_punctuation+this.closing_question_punctuation||e===this.opening_question_punctuation&&e.length>0||e===this.closing_question_punctuation&&e.length>0;
},_setQuery:function(e,t){var i=this.capitalize(e);if(t||this.askMode&&i!==e){var n="";if((e||t)&&e.indexOf(this.opening_question_punctuation)==-1){n=this.opening_question_punctuation}var s="";if((e||t)&&e.indexOf(this.closing_question_punctuation)==-1){s=this.closing_question_punctuation}e=n+i+s;this.setInputVal(e,n.length)}else if(this.askMode&&this.askMode!=="forced"&&this._queryIsPunctation(e)){e="";this.setInputVal(e)}if(this.length_limit&&this.logged_in){var o=e.length>this.length_limit;this.context.set("question_title_over_limit",o)}this._super.apply(this,[e])},addToCache:function(e,t){if(!(e in this.cache)){this.cacheSize++}this.cache[e]=t;if(this.cacheSize>this.max_cache_size){var i=this.currentRevision+1;var n=null;for(var s in this.cache){if(this.cache[s][1]<i){i=this.cache[s][1];n=s}}this.cacheSize--;delete this.cache[n]}},updateResults:function(){var e=this;if(e.query===""){e.setAskingTarget(null,null)}var t=e.query.trim();if(e.askMode==="forced"&&(e._queryIsPunctation(t)||t==="")){
e.showInterstitial("ask_question");return}var i={query:e.query};var n=e.getExtraKwargs();for(var s in n){i[s]=n[s]}var o=JSON.stringify(i);var r=e.currentRevision;e.lastRevisionNeedsUpdate=false;if(t.length===0){e.displayedRevision=r;e.setAskMode(false);e.showResults(false);e.currentSession++}else if(o in e.cache){e.currentOutstandingRequests++;e.resultsServerCallHandler(r,e.cache[o][0],this.showingInterstitial)}else{var a=function(){if(e.query!==i.query){return}if(e.currentOutstandingRequests<e.max_concurrent_requests){i.parent_cid=e.cid;i.selector_id=e.selector_id;e.currentOutstandingRequests++;var t=e.showingInterstitial;e.serverCall("results_content_for").kwargs(i).sendJsData(e.shouldSendJSData).success(function(i){e.resultsServerCallHandler(r,i,o,t)}).except(function(){e.resultsServerCallHandler(r,null,o,t)}).error(function(){e.resultsServerCallHandler(r,null,o,t)}).send()}else{e.lastRevisionNeedsUpdate=true}};if(!e.queryTypingDelay){a()}else{setTimeout(a,e.queryTypingDelay)}}},getExtraKwargs:function(){
return{ask_mode:this.askMode,current_session:this.currentSession}},resultsServerCallHandler:function(e,t,i,n){this.currentOutstandingRequests--;this.hasResults=true;if(e<this.displayedRevision){return}if(n){this.showingInterstitial=false;this.$id("@ask_mode_interstitial").addClass("hidden");this.$id("@results").removeClass("hidden")}if(t!==null){this.$results.forgetContents();this.$results.setContent(t);this.displayedRevision=e;this.addToCache(i,[t,e])}this.showResults(true);if(this.lastRevisionNeedsUpdate){this.updateResults()}},queryDidChange:function(){this.currentRevision++;if(this.logged_in){this.context.set("question_query_empty",this.isQueryEmpty());this.context.set("force_enable_button",true)}this._super.apply(this,arguments)},isQueryEmpty:function(){return this.query.trim()===""||this._queryIsPunctation(this.query.trim())},showResults:function(e){var t=this;if(e&&t.focused&&!t.isQueryEmpty()){t.$results_wrapper.removeClass("hidden");t.$results_wrapper.removeClass("fade_out");t.setHighlight(true);
}else{t.$results_wrapper.addAnimationClass("fade_out",function(){if(!t.$results_wrapper.hasClass("hidden")){t.$results_wrapper.addClass("hidden")}})}},resultWasSelected:function(e,t){var i=this;var n=this.child("results").child(e.data.cname);n.processAction(e.data.action_mousedown);if(e.ty==="search"){i.goToSearch(t)}else{if(e.data.qid!==-1){r.setMessage("look",[e.data.qid,true])}if(i.query.length<140){r.setCookie("qsu-q",JSON.stringify(i.query),{expires:1})}if(e.data.qid!==-1&&i.targetType){if(!i.adding_followup){i.adding_followup=true;i.serverCall("add_followup").kwargs({qid:e.data.qid,target_type:i.targetType,target_oid:i.targetOid}).success(function(e){if(t){window.open(e)}else{window.location.href=e}i.adding_followup=false}).error(function(){i.adding_followup=false}).send()}}else{if(t){window.open(e.data.url)}else{window.location.href=e.data.url}}}},hideInterstitials:function(){this.showingInterstitial=false;this.$id("@ask_mode_interstitial").addClass("hidden");this.$id("@results").removeClass("hidden");
},showInterstitial:function(e){this.hideInterstitials();this.showingInterstitial=true;this.$id("@ask_mode_interstitial").removeClass("hidden");this.$id("@results").addClass("hidden");var t=this.interstitials[e][0];var i=this.interstitials[e][1];this.$id("@interstitial_title").text(t);this.$id("@interstitial_text").text(i)},setHighlight:function(e,t){var i=this.parent().parent().$("#@body_blur");if(e){i.addClass("lookup_bar_modal_overlay");i.removeClass("closing");if(this.logged_in){this.context.set("force_enable_button",true)}this.emitEvent({type:s.Types.SITE_HEADER_SEARCH_FOCUSED,payload:{focused:true}});var n=this.$input.outerWidth();this.$results_wrapper.width(n-2);this.focused=true}else{i.addAnimationClass("closing",function(){if(i.hasClass("lookup_bar_modal_overlay")){i.removeClass("lookup_bar_modal_overlay")}});this.emitEvent({type:s.Types.SITE_HEADER_SEARCH_FOCUSED,payload:{focused:false}});this.focused=false}if(this.nextHighlightCallback){this.nextHighlightCallback()}this.nextHighlightCallback=t;
},setAskMode:function(e,t){this.askMode=e;if(this.query.trim()||e){this._setQuery(this.query.trim(),true)}if(e){this.$input.focus();if(t){this.showInterstitial(t)}else if(this.query.trim().length>=10&&this.query.split(" ").length>=3){this.showInterstitial("good")}else{this.showInterstitial("bad")}this.logMiscAction("LookupBarSetAskModeClickthrough");this.lastRevisionNeedsUpdate=false;this.focused=true;this.showResults(true)}},logMiscAction:function(e){var t=this.child("results");if(!t){return}var i=t.child("search");if(!i){return}i.processAction(e)},submit:function(e){if(!this.logged_in){this.logMiscAction("LookupBarPressEnterSearch");this.goToSearch(e)}else{if(this.should_go_to_search_on_enter){this.logMiscAction("LookupBarPressEnterSearch");this.goToSearch(e)}else{this.logMiscAction("LookupBarPressEnterNothing")}}},goToSearch:function(e){if(this.query.trim()){var t=o("/search?q="+encodeURIComponent(this.query).replace(/%20/g,"+")+this.keepFilters);if(e){window.open(t.unicode())}else{window.location.href=t.unicode();
}}},ask:function(e){var t=this;if(t.hasPendingServerCall()){return}this.context.set("force_enable_button",false);var i=t.getQuestionDetails();t.makeServerCall(t.serverCall("add_question").kwargs({input_text:t.query,is_anon:e,question_details:i,source:t.source,target_type:t.targetType,target_oid:t.targetOid}))},getQuestionDetails:function(){return this.context.get("question_details_text_serialized")},setSource:function(e){var t=this;t.source=e},updateServerMessage:function(e,t){var i=this;if(!e){if(t.type==="confirm_email"){i.createModal("email_confirmation_dialog_contents").onSubmit(function(){i.serverCall("resend_email_confirmation").send()}).show();return false}i.logMiscAction("LookupBarAddQuestionFail");i.context.set("force_enable_button",true);i.$input.focus();if(t&&t["message"]){this.$id("@server_message_title").text(t["message"]["title"]);if(t["message"]["note"]){this.$id("@server_message_note").text(t["message"]["note"])}return true}return false}else{if(t["url"]){i.logMiscAction("LookupBarAddQuestionSuccess");
n.navigateTo(t["url"])}return false}},setAskingTarget:function(e,t){this.targetType=e;this.targetOid=t;this.emitEvent({type:s.Types.LOOKUP_BAR_SET_ASKING_TARGET,payload:{isCleared:this.targetType==null}})}});exports.LookupBarSiteHeaderAddQuestion=t.extend({onLoad:function(){var e=this;e.$askButton=e.$id("@submit_question");e.context=e.getContext(a);e.context.on("question_details_over_limit",function(t,i){e.enableButton(!i)});e.context.on("question_title_over_limit",function(t,i){e.enableButton(!i)});e.context.on("force_enable_button",function(t,i){e.enableButton(i)});e.$askButton.click(function(t){t.preventDefault();e.emitEvent({type:s.Types.LOOKUP_BAR_ASK_QUESTION,payload:{isPrivate:e.getIsPrivate()}})});e.$id("@add_details").click(function(t){t.preventDefault();e.showQuestionDetailsEditor(true)});e.$id("@remove_details").click(function(t){t.preventDefault();if(e.context.get("question_details_is_empty")){e.showQuestionDetailsEditor(false)}else{e.createModal("load_clear_confirmation").onSubmit(function(){
e.showQuestionDetailsEditor(false);e.context.set("question_details_cleared",true)}).show()}});e.context.on("question_details_in_focus",function(t,i){if(i){e.emitEvent({type:s.Types.LOOKUP_BAR_QUESTION_DETAILS_STATE,payload:{state:"focused"}})}});this.handleEvent(s.Types.LOOKUP_BAR_SET_ASKING_TARGET,function(t){if(t.payload.isCleared){e.$id("@anon_checkbox").prop("disabled",false)}else{e.$id("@anon_checkbox").prop("checked",false);e.$id("@anon_checkbox").prop("disabled",true)}})},showQuestionDetailsEditor:function(e){if(e){this.$id("@add_details").addClass("hidden");this.$id("@remove_details").removeClass("hidden");this.context.set("question_details_in_focus",true)}else{this.$id("@remove_details").addClass("hidden");this.$id("@add_details").removeClass("hidden")}this.emitEvent({type:s.Types.LOOKUP_BAR_QUESTION_DETAILS_STATE,payload:{state:e?"shown":"hidden"}})},getIsPrivate:function(){return this.$id("@anon_checkbox").prop("checked")||false},enableButton:function(e){if(this.context.get("question_title_over_limit")||this.context.get("question_details_over_limit")){
this.$askButton.addClass("fake_disabled")}else if(this.context.get("question_query_empty")){this.$askButton.addClass("disabled")}else{if(e){this.$askButton.removeClass("disabled");this.$askButton.removeClass("fake_disabled")}else{this.$askButton.addClass("disabled")}}}});var c=[];exports.AddQuestionLookupBarButton=t.extend({setAllEnabled:function(e){c.forEach(function(t){t.setEnabled(e)})},setEnabled:function(e){if(e){this.$id("@dialog_link").removeClass("disabled")}else{this.$id("@dialog_link").addClass("disabled")}},onLoad:function(){var e=this;c.push(e);this.$id("@dialog_link").click(function(){var t=l;t.setAskingTarget(e.targetType,e.targetOid);var i="button";if(e.source){i="answer"}else{i="ask_question"}t.setAskMode("forced",i);e.setAllEnabled(false);t.setHighlight(true,function(){e.setAllEnabled(true)});t.setSource(e.source);e.serverCall("log_click").kwargs({source:e.source}).send();return false})}});exports.LazyAskBarDetails=d.ToggleBase.extend({onLoad:function(){this._super.apply(this,arguments);
var e=this;e.context=e.getContext(a);e.context.on("lookup_bar_focused",function(t,i){if(i&&!t){e.loadAskBarDetails()}})},loadAskBarDetails:function(){this.fetch();this.triggerSwitch()}})});define("shared/email",["shared/polyfills"],function Di(require,exports,e){exports.isValidEmail=function(){var e="[^\\x0d\\x22\\x5c\\x80-\\xff]";var t="[^\\x0d\\x5b-\\x5d\\x80-\\xff]";var i="[^\\x00-\\x20\\x22\\x28\\x29\\x2c\\x2e\\x3a-\\x3c\\x3e\\x40\\x5b-\\x5d\\x7f-\\xff]+";var n="\\x5c[\\x00-\\x7f]";var s="\\x5b("+t+"|"+n+")*\\x5d";var o="\\x22("+e+"|"+n+")*\\x22";var r=i;var a="("+r+"|"+s+")";var d="("+i+"|"+o+")";var l=a+"(\\x2e"+a+")*";var c=d+"(\\x2e"+d+")*";var u=c+"\\x40"+l;var h="^"+u+"$";var f=new RegExp(h);return function(e){return f.test(e)}}()});define("shared/linkify",["shared/polyfills"],function Ai(require,exports,e){exports.iterLinks=function(e,i){t(e,{callback:function(e,t){if(t){i(t,e)}return""}})};var t=exports.linkify=function(){var e="[a-z\\d.-]+://",t="(?:(?:[0-9]|[1-9]\\d|1\\d{2}|2[0-4]\\d|25[0-5])\\.){3}(?:[0-9]|[1-9]\\d|1\\d{2}|2[0-4]\\d|25[0-5])",i="(?:(?:[^\\s!@#$%^&*()_=+[\\]{}\\\\|;:'\",.<>/?]+)\\.)+",n="(?:ac|ad|aero|ae|af|ag|ai|al|am|an|ao|aq|arpa|ar|asia|as|at|au|aw|ax|az|ba|bb|bd|be|bf|bg|bh|biz|bi|bj|bm|bn|bo|br|bs|bt|bv|bw|by|bz|cat|ca|cc|cd|cf|cg|ch|ci|ck|cl|cm|cn|coop|com|co|cr|cu|cv|cx|cy|cz|de|dj|dk|dm|do|dz|ec|edu|ee|eg|er|es|et|eu|fi|fj|fk|fm|fo|fr|ga|gb|gd|ge|gf|gg|gh|gi|gl|gm|gn|gov|gp|gq|gr|gs|gt|gu|gw|gy|hk|hm|hn|hr|ht|hu|id|ie|il|im|info|int|in|io|iq|ir|is|it|je|jm|jobs|jo|jp|ke|kg|kh|ki|km|kn|kp|kr|kw|ky|kz|la|lb|lc|li|lk|lr|ls|lt|lu|lv|ly|ma|mc|md|me|mg|mh|mil|mk|ml|mm|mn|mobi|mo|mp|mq|mr|ms|mt|museum|mu|mv|mw|mx|my|mz|name|na|nc|net|ne|nf|ng|ni|nl|no|np|nr|nu|nz|om|org|pa|pe|pf|pg|ph|pk|pl|pm|pn|pro|pr|ps|pt|pw|py|qa|re|ro|rs|ru|rw|sa|sb|sc|sd|se|sg|sh|si|sj|sk|sl|sm|sn|so|sr|st|su|sv|sy|sz|tc|td|tel|tf|tg|th|tj|tk|tl|tm|tn|to|tp|travel|tr|tt|tv|tw|tz|ua|ug|uk|um|us|uy|uz|va|vc|ve|vg|vi|vn|vu|wf|ws|xn--0zwm56d|xn--11b5bs3a9aj6g|xn--80akhbyknj4f|xn--9t4b11yi5a|xn--deba0ad|xn--g6w251d|xn--hgbk6aj7f53bba|xn--hlcj6aya9esc7a|xn--jxalpdlp|xn--kgbechtv|xn--zckzah|ye|yt|yu|za|zm|zw)",s="(?:"+i+n+")",o="(?:[;/][^#?<>\\s\\[\\]]*)?",r="(?:\\?[^#<>\\s]*)?(?:#[^<>\\s]*)?",a="\\b"+e+"[^<>\\s\\[\\]]+",d="\\b"+s+o+r+"(?!\\w)",l="mailto:",c="(?:"+l+")?[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*@"+s+r+"(?!\\w)",u=new RegExp("(?:"+a+"|"+d+"|"+c+")","ig"),h=new RegExp("^"+e,"i"),f={
"'":"`",">":"<",")":"(","]":"[","}":"{","Â»":"Â«","âº":"â¹"},p={callback:function(e,t){return t?'<a href="'+t+'" title="'+t+'">'+e+"</a>":e},punct_regexp:/(?:[!?.,:;'"]|(?:&|&amp;)(?:lt|gt|quot|apos|raquo|laquo|rsaquo|lsaquo);)$/};return function(e,t){t=t||{};var i,n,s,o,r="",a=[],d,c,g,m,v,_,w,b;for(n in p){if(t[n]===undefined){t[n]=p[n]}}while(i=u.exec(e)){s=i[0];c=u.lastIndex;g=c-s.length;if(/[\/:]/.test(e.charAt(g-1))){continue}do{m=s;b=s.substr(-1);w=f[b];if(w){v=s.match(new RegExp("\\"+w+"(?!$)","g"));_=s.match(new RegExp("\\"+b,"g"));if((v?v.length:0)<(_?_.length:0)){s=s.substr(0,s.length-1);c--}}if(t.punct_regexp){s=s.replace(t.punct_regexp,function(e){c-=e.length;return""})}}while(s.length&&s!==m);o=s;if(!h.test(o)){o=(o.indexOf("@")!==-1?!o.indexOf(l)?"":l:!o.indexOf("irc.")?"irc://":!o.indexOf("ftp.")?"ftp://":"http://")+o}if(d!=g){a.push([e.slice(d,g)]);d=c}a.push([s,o])}a.push([e.substr(d)]);for(n=0;n<a.length;n++){r+=t.callback.apply(window,a[n])}return r||e}}()});define("qtext2/util",["shared/polyfills","shared/email","interface/jquery","shared/log","shared/linkify","shared/util"],function Ii(require,exports,e){
var t=require("shared/email").isValidEmail,$=require("interface/jquery")._jQuery,i=require("shared/log").log,n=["keydown","keyup","keypress"],s=require("shared/linkify"),o=/^https?\:\/\//,r=require("shared/util");i.warn=i.warn.bind(i,"qtext2");var a={assert:function(e){if(!e){var t=Array.prototype.slice.call(arguments,1);throw new Error(t)}},escapeHTML:function(e){e=e.replace(/&/g,"&amp;");e=e.replace(/</g,"&lt;");e=e.replace(/>/g,"&gt;");return e},create:function(e){return document.createElement(e)},objectIntersection:function(e,t){var i=Object.keys(e);var n={};for(var s=0;s<i.length;s++){var o=i[s];if(a.jsonEqual(e[o],t[o])){n[o]=e[o]}}return n},removeNullValues:function(e){var t=Object.keys(e),i;for(var n=0;n<t.length;n++){i=t[n];if(e[i]===null){delete e[i]}else if(Object.prototype.toString.call(e[i])==="[object Object]"){a.removeNullValues(e[i])}else if(Object.prototype.toString.call(e[i])==="[object Array]"){for(var s=0;s<e[i].length;s++){a.removeNullValues(e[i][s])}}}return e},getData:function(e,t){
return e.getAttribute("data-"+t)},setData:function(e,t,i){e.setAttribute("data-"+t,i)},removeData:function(e,t){e.removeAttribute("data-"+t)},isTextNode:function(e){return e&&e.nodeType==3},safeRemoveChild:function(e,t){if(!e){i.warn("Node is undefined.")}else if(!e.parentNode){i.warn("Node already detached from parent.",e)}else if(e.parentNode!=t){i.warn("Tried to remove node from non parent",e,t)}else{t.removeChild(e)}},on:function(e,t,i){e=e instanceof Array?e:[e];e.forEach(function(e){t.addEventListener(e,function(t){var s;if(n.indexOf(e)!=-1){t.which=t.charCode!==undefined?t.charCode:t.keyCode}s=i(t,e);if(s===false){t.preventDefault();t.stopPropagation()}return s})})},ensureProtocol:function(e){if(t(e)){return e}if(!o.test(e)){e="http://"+e}return e},splitLines:function(e){return e.split(/\n|\r\n?/)},splitByRegex:function(e,t){var i,n=[];while(e){i=e.match(t);if(i){if(i.index){n.push({text:e.slice(0,i.index)})}n.push({text:i[0],match:i});e=e.slice(i.index+i[0].length)}else{n.push({
text:e});e=""}}return n},jsonEqual:function(e,t){var i,n;if(e===t){return true}if(typeof e!="object"||typeof t!="object"){return e===t}if(e===null||e===undefined||t===null||t===undefined){return false}if(typeof e!==typeof t){return false}if(e instanceof Array){if(e.length!==t.length){return false}for(var s=0;s<e.length;s++){if(!a.jsonEqual(e[s],t[s])){return false}}return true}i=Object.getOwnPropertyNames(e);n=Object.getOwnPropertyNames(t);if(i.length!=n.length){return false}return i.every(function(i){return a.jsonEqual(e[i],t[i])})},linkify:function(e){var t=[];s.linkify(e,{callback:function(e,i){if(e.length===0){return}t.push({text:e,href:i})}});return t},firstScrollingParent:r.firstScrollingParent,getContainerOffset:function(e){var t=$(e).offset(),i=a.firstScrollingParent(e);if(i!==document.body){var n=$(i).offset();t.left+=i.scrollLeft-n.left;t.top+=i.scrollTop-n.top}return t}};exports.Util=a});define("qtext2/quirks",["shared/polyfills","shared/browser"],function qi(require,exports,e){
var t=require("shared/browser");var i={usesCompositionEvents:function(){return t.gecko||t.webkit&&t.webkitVersion>532},dragEventContainsFile:function(e){var t=e.dataTransfer;if(!t){return false}if(t.files&&t.files.length>0){return true}if(!t.types){return false}if(t.types.indexOf&&t.types.indexOf("Files")!=-1){return true}if(t.types.contains&&t.types.contains("application/x-moz-file")){return true}return false}};exports.Quirks=i});define("qtext2/extension/base",["shared/polyfills","shared/Class"],function Ni(require,exports,e){var t=require("shared/Class").Class;exports.Extension=t.extend({__init__:function(e){this.doc=e},install:function(){throw new Error("Sub-classes should implement this method.")},destroy:function(){}})});define("qtext2/extension/link_interaction",["shared/polyfills","qtext2/extension/base","interface/settings","gating"],function Oi(require,exports,e){var t=require("qtext2/extension/base").Extension,i=require("interface/settings").pageIsMobile,n=require("gating");var s=exports.linkInteractionEnabled=function(){
return!i&&n.qtext2_link_interaction};exports.LinkInteraction=t.extend({install:function(){if(s()){this._activeLinkSpan=null;this.doc.on("caretMoved",this.onCaretMoved.bind(this))}},onCaretMoved:function(){this._maybeSwitchToolbar()},_maybeSwitchToolbar:function(){if(this._shouldSwitchToolbar()){this._switchToolbar()}else if(this._activeLinkSpan){this._switchBackToolbar()}},_shouldSwitchToolbar:function(){var e=this.doc.caret.start.span;return this.doc.caret.isCollapsed()&&(e.hasModifier("link")||e.hasModifier("citation"))},_switchToolbar:function(){var e=this.doc.caret.start.span,t;if(e.hasModifier("link")){t=e.getModifier("link")}else if(e.hasModifier("citation")){t=e.getModifier("citation").target}if(!(t&&t.url)){return}if(this._activeLinkSpan===e){return}this._activeLinkSpan=e;this.doc.setLinkInputFocus(false);this.doc.handleCommand("link")},_switchBackToolbar:function(){this.doc.trigger("focus");this.doc.setLinkInputFocus(true);this._activeLinkSpan=null}})});define("qtext2/ui",["shared/polyfills","shared/Class","qtext2/util","shared/log","qtext2/quirks","qtext2/extension/link_interaction","shared/upload"],function Ri(require,exports,e){
var t=require("shared/Class").Class,i=require("qtext2/util").Util,n=require("shared/log").log,s=require("qtext2/quirks").Quirks,o=require("qtext2/extension/link_interaction").linkInteractionEnabled,r=require("shared/upload");n=n.bind(n,"qtext2");exports.LinkSelector=t.extend({__init__:function(e){this.editor=e;this.toolbar=e.toolbar;this.active=false;this.key="";this._onSubmitCallback=null;this._onCancelCallback=null},isActive:function(){return this.active},show:function(){throw new Error("NotImplemented: Subclasses should override")},hide:function(){this.active=false;this.key=""},submit:function(){throw new Error("NotImplemented: Subclasses should override")},cancel:function(){throw new Error("NotImplemented: Subclasses should override")},onSubmit:function(e){this._onSubmitCallback=e},onCancel:function(e){this._onCancelCallback=e},getExternalURL:function(e,t,i){if(this.toolbar){this.toolbar.on("linkInput",e);this.toolbar.showBar(0);if(o()){this.toolbar.setLinkToolbarStatus(t,i)}}},getLinkPreview:function(e,t,i){
this.editor.serverCall("get_link_preview").kwargs({url:e}).success(t).error(i).send()}});exports.ImageUploader=t.extend({__init__:function(e,t,i,n,s){this.editor=e;this.doc=t;this.$dropZone=i;this.$fileInput=n;this.interface_strings=s;this._dragStartedInDoc=false;this.initEventHandlers()},_debugEvent:function(e,t){n("dropzone",e,t)},initEventHandlers:function(){i.on("dragenter",this.doc.node,this.onDragEnter.bind(this));i.on("dragstart",this.doc.node,this.onDragStart.bind(this));i.on("dragend",this.doc.node,this.onDragEnd.bind(this));i.on("paste",this.doc.node,this.onPaste.bind(this));i.on("drop",this.doc.node,this.onDropInDoc.bind(this));i.on("dragleave",this.$dropZone,this.onDragLeave.bind(this));i.on("dragover",this.$dropZone,this.onDragOver.bind(this));i.on("click",this.$dropZone,this.onClick.bind(this));i.on("drop",this.$dropZone,this.onDrop.bind(this));i.on("change",this.$fileInput,this.onChange.bind(this))},onDragEnter:function(e){this._debugEvent("dragenter",e);if(!s.dragEventContainsFile(e)){
return}if(this._dragStartedInDoc){return}this.showDropZone()},onDragStart:function(e){this._debugEvent("dragstart",e);this._dragStartedInDoc=true},onDragEnd:function(e){this._debugEvent("dragend",e);this._dragStartedInDoc=false},onDropInDoc:function(e){this._debugEvent("drop (in doc)",e);this._dragStartedInDoc=false},onDragLeave:function(e){this._debugEvent("dragleave",e);this.hideDropZone()},onDragOver:function(e){this._debugEvent("dragover",e);e.preventDefault()},onClick:function(e){this._debugEvent("click",e);this.hideDropZone()},onDrop:function(e){this._debugEvent("drop",e);e.preventDefault();e.stopPropagation();if(!e.dataTransfer){this.hideDropZone();return}this.startUpload(e.dataTransfer.files)},onChange:function(e){this._debugEvent("change",e);this.startUpload(this.$fileInput.files);this.$fileInput.value=null},onPaste:function(e){this._debugEvent("paste",e);var t=e.clipboardData,i=[];if(!t||!t.items){return false}for(var n=0;n<t.items.length;++n){var s=t.items[n].type;if(s.match(/image/i)||s.match(/file/i)){
i.push(t.items[n].getAsFile())}}this.startUpload(i);return false},showDropZone:function(){this.$dropZone.innerHTML=this.interface_strings.drop_images;this.$dropZone.classList.remove("hidden");this.$dropZone.style.lineHeight=this.doc.node.clientHeight+"px";this.$dropZone.style.top=this.doc.node.offsetTop+"px"},hideDropZone:function(){this.$dropZone.classList.remove("uploading");this.$dropZone.classList.add("hidden")},showUploading:function(e){this.showDropZone();if(e>1){this.$dropZone.innerHTML=this.interface_strings.uploading_images.replace("{}",e)}else{this.$dropZone.innerHTML=this.interface_strings.uploading_image}},_onUpload:function(e){this.doc.insertImages(e.qimg_urls);this.hideDropZone()},_onError:function(e){if(e&&e.message){alert(e.message)}else{alert(this.interface_strings.upload_error)}this.hideDropZone()},startUpload:function(e){if(e.length===0){this.hideDropZone();return}this.showUploading(e.length);r.uploadData({kind:"qtext"},e,this._onUpload.bind(this),this._onError.bind(this));
},uploadImageUrl:function(e,t){this.editor.serverCall("upload_image_url").kwargs({url:e}).success(t).error(this._onError.bind(this,null)).send()}});exports.PhotoSearch=t.extend({__init__:function(e,t,i,n){this.$searchComponent=t;this.$wrapper=i;this.$searchComponent.setSelectCallback(this.submit.bind(this));this.$searchComponent.setUploadCallback(this.hide.bind(this));this.$searchComponent.setUploader(n);this.active=false},isActive:function(){return this.active},fixPosition:function(){var e=this.$wrapper,t=this.$wrapper.parent(),i=6;var n=function(){var s=t.find(".editor_toolbar"),o=t.offset().left+t.width()-e.width();if(s.css("position")==="fixed"){e.css("position","fixed").css("left",o).css("right","auto")}else{e.css("position","absolute").css("left","auto").css("right",0)}e.css("top",parseInt(s.css("top"))+s.height()+i);window.requestAnimationFrame(n)};n()},show:function(){var e=this;e.fixPosition();e.$wrapper.addClass("animate_in");setTimeout(function(){e.$wrapper.removeClass("animate_in");
e.$wrapper.addClass("is_shown")},200);e.$searchComponent.makeActive();e.active=true},hide:function(){var e=this;e.active=false;e.$wrapper.addClass("animate_out");setTimeout(function(){e.$wrapper.removeClass("is_shown");e.$wrapper.removeClass("animate_out")},200)},toggle:function(){if(this.active){this.hide()}else{this.show()}},submit:function(e){if(this._onInsertCallback){this._onInsertCallback(e)}},cancel:function(){if(this._onCancelCallback){this._onCancelCallback();return false}},onInsert:function(e){this._onInsertCallback=e},onCancel:function(e){this._onCancelCallback=e}})});define("unified_view/qtext2/editor/mobile",["shared/polyfills","shared/client","interface/settings","unified_view/modal","qtext2/ui","shared/debounce"],function Pi(require,exports,e){var t,i,n=require("shared/client"),s=require("interface/settings").pageIsMobile,o=require("unified_view/modal").ModalBase,r=require("qtext2/ui"),a=require("shared/debounce").debounce;if(s){t=require("mobile_app2/client");i=require("mobile_app2/messages");
}exports.EditorModal=o.extend({onLoad:function(){this._super.apply(this,arguments);t.setNavigationCancelButton(this.cancelButtonText,false);exports.activeEditor=this;if(n.isNativeApp()){i.send("setupEditor",{hasDraft:!!this.has_draft});i.send("restoreState",{key:this.key})}this._setupEditor()},_setupEditor:function(){var e=this;this.editor=this.child("editor");this.editor.setFocusCallback(function(){exports.activeEditor=e});if(this.has_draft){var t=a(this.autoSaveDraft.bind(this),750,{maxWait:1e4,leading:true});this.editor.setMeaningfulChangeCallback(function(){e.saveState();t()})}else{this.editor.setMeaningfulChangeCallback(this.saveState.bind(this))}},focus:function(){this.editor.focus()},getState:function(){return this.editor.serialize()},saveState:function(){if(n.isNativeApp()){i.send("saveState",{key:this.key,value:this.getState()})}},restoreState:function(e){this.editor.doc.fromJSON(e)},_onDraftSaveSuccess:function(){i.send("draftSaveComplete",{success:true})},_onDraftSaveError:function(){
i.send("draftSaveComplete",{success:false})},_onDraftClearSuccess:function(){i.send("draftClearComplete",{key:this.key,success:true})},_onDraftClearError:function(){i.send("draftClearComplete",{key:this.key,success:false})},_saveDraftServerCall:function(){return this.serverCall("save_draft").kwargs({oid:this.oid,content:this.getState()})},autoSaveDraft:function(){this.saveState();this._saveDraftServerCall().send()},saveDraft:function(){i.send("showLoadingView");this.saveState();this._saveDraftServerCall().success(this._onDraftSaveSuccess.bind(this)).error(this._onDraftSaveError.bind(this)).send()},clearDraft:function(){i.send("showLoadingView");this.serverCall("clear_draft").kwargs({oid:this.oid}).success(this._onDraftClearSuccess.bind(this)).error(this._onDraftClearError.bind(this)).send()},onSubmit:function(){var e=this._super.bind(this);var t=this;if(n.isIOSApp()){i.send("showProgressBar")}else{i.send("showLoadingView")}var s;if(n.isAndroidApp()){s=setInterval(function(){t.setMobileDoneButtonDisabled(true);
},30)}this.serverCall("submit").kwargs({oid:this.oid,content:this.getState(),extra_kwargs:this.extra_kwargs}).success(function(o){if(n.isIOSApp()){i.send("hideProgressBar",{complete:true})}else{i.send("hideLoadingView")}if(n.isAndroidApp()){clearInterval(s);t.setMobileDoneButtonDisabled(false)}if(o.success){e(o)}}).error(function(){if(n.isIOSApp()){i.send("hideProgressBar")}else{i.send("hideLoadingView")}if(n.isAndroidApp()){clearInterval(s);t.setMobileDoneButtonDisabled(false)}}).sendOnlyOnce()}});exports.DualEditorModal=exports.EditorModal.extend({_setupEditor:function(){var e=this;this.title_editor=this.child("title");this.details_editor=this.child("details");this.isTitleOverLimit=false;this.isDetailsOverLimit=false;this.lastFocusedEditor=null;this.title_editor.setFocusCallback(function(){exports.activeEditor=e;e.lastFocusedEditor=e.title_editor});this.details_editor.setFocusCallback(function(){exports.activeEditor=e;e.lastFocusedEditor=e.details_editor});this.title_editor.setMeaningfulChangeCallback(this.saveState.bind(this));
this.details_editor.setMeaningfulChangeCallback(this.saveState.bind(this));if(this.title_length_limit){this.title_editor.setLengthChangeCallback(function(t){e.isTitleOverLimit=t;e.updateButton()})}if(this.details_length_limit){this.details_editor.setLengthChangeCallback(function(t){e.isDetailsOverLimit=t;e.updateButton()})}},updateButton:function(){this.setMobileDoneButtonDisabled(this.isTitleOverLimit||this.isDetailsOverLimit)},focus:function(){var e=document.activeElement;if(!(this.title_editor.doc.contains(e)||this.details_editor.doc.contains(e))){if(this.lastFocusedEditor===null){this.title_editor.focus()}else{this.lastFocusedEditor.focus()}}},getState:function(){return{title:this.title_editor.serialize(),details:this.details_editor.serialize()}},restoreState:function(e){this.title_editor.doc.fromJSON(e.title);this.details_editor.doc.fromJSON(e.details)}});exports.LinkSelectorModal=o.extend({onLoad:function(){this._super.apply(this,arguments);i.send("showSearchInput",{searchPlaceholderText:this.interface_strings.search_placeholder,
searchFocus:true,searchCancelButton:false});this.cleanUpCallback=this.close.bind(this);t.registerOneTimeMessageHandler("addLinkSelectorPressed",this.cleanUpCallback)},onUnload:function(){t.removeOneTimeMessageHandler("addLinkSelectorPressed",this.cleanUpCallback)}});exports.LinkSelector=r.LinkSelector.extend({__init__:function(e){var t=this;this._super(e);this._handleAddLink=function(e){t.submit(e)}},show:function(e){this.bindAddLinkHandler();this.toolbar.createModal("load_link_selector").onClose(this.cancel.bind(this)).show();this.active=true;this.key=e||""},bindAddLinkHandler:function(){t.removeOneTimeMessageHandler("addLinkSelectorPressed",this._handleAddLink);t.registerOneTimeMessageHandler("addLinkSelectorPressed",this._handleAddLink)},cleanUpModal:function(){if(n.isMobileWeb()&&this.isActive()){i.send("hideSearchInput")}},submit:function(e){if(this._onSubmitCallback){this._onSubmitCallback({text:e.text,url:e.url})}},cancel:function(){if(this._onCancelCallback){setTimeout(this._onCancelCallback.bind(this,this.key),0);
}},hide:function(){this.cleanUpModal();this._super()}});exports.activeEditor=null});define("unified_view/qtext2/editor",["shared/polyfills","shared/core/component","shared/Class","qtext2/util","shared/onload","interface/settings","qtext2/ui","third_party/autosize","unified_view/qtext2/editor/mobile","webnode2"],function Bi(require,exports,e){var t=require("shared/core/component").Component,i=require("shared/Class").Class,n=require("qtext2/util").Util,s=require("shared/onload"),o,r=require("interface/settings"),a=r.pageIsMobile,d=require("qtext2/ui"),l=require("third_party/autosize"),c,u=d.PhotoSearch;if(a){o=require("unified_view/qtext2/editor/mobile").LinkSelector}else{c=require("webnode2").interactionMode}var h=d.LinkSelector.extend({__init__:function(e,t,i){var n=this;this._super(e);this.$selector=t;this.$wrapper=i;this.$selector.afterResultWasSelectedCallback=this.submit.bind(this);this.$selector.setEscKeyDown(function(e){var t=n.key+n.$selector.query;if(e.keyCode==27||t==="@"&&(e.keyCode==8||e.keyCode==13)){
n.cancel(t);e.preventDefault()}})},show:function(e,t,i){this.key=e||"";var s=this.$wrapper.parent().get(0),o=n.getContainerOffset(s);t-=o.left;i-=o.top+5;this.$selector.setQuery("");this.$wrapper.css("position","absolute").css("left",t).css("top",i).removeClass("hidden");this.active=true;this.$selector.focus()},hide:function(){this._super();this.$wrapper.addClass("hidden")},submit:function(e,t,i){if(this._onSubmitCallback){this._onSubmitCallback(e.data)}},cancel:function(e){if(this._onCancelCallback){this._onCancelCallback(e);return false}}});var f=i.extend({__init__:function(e){this._listeners={};this.$node=e;this.$node.on("blur",this.trigger.bind(this,"blur"));this.$node.on("keydown",this.trigger.bind(this,"keydown"));this.$node.on("keydown",this.trigger.bind(this,"meaningfulChange"));l(this.$node.get(0))},on:function(e,t){this._listeners[e]=this._listeners[e]||[];this._listeners[e].push(t)},trigger:function(e){if(this._listeners[e]){this._listeners[e].forEach(function(e){e()})}},focus:function(){
this.$node.focus();this.trigger("focus")},getLength:function(){return this.$node.val().length},isEmpty:function(){return this.getLength()===0},isOnlyWhiteSpace:function(){return this.$node.val().trim().length==0},toJSON:function(){return{is_plaintext:true,text:this.$node.val()}},hasChanged:function(e){return!n.jsonEqual(e,this.toJSON())},disable:function(){this.$node.attr("disabled",true)},enable:function(){this.$node.attr("disabled",false)},clear:function(){this.$node.val("")},destroy:function(){this.clear()}});exports.Editor=t.extend({onLoad:function(){this._editorReady=false;var e=this;var t=function(){window.require.ensure("qtext2/base",function(){e._onLoad();e._editorReady=true})};if(!this.shouldDelayOnLoad()){t()}else{s.execAfterLoadDelayed(t)}},shouldDelayOnLoad:function(){if(!r.delayQTextOnLoad){return false}var e=r.controller;var t=r.action;if(a){if(e=="modal"&&t=="index"){return false}}else{if(e=="question"&&t=="draft"||e=="board"&&t=="add"){return false}}return true},_onLoad:function(){
if(this.is_plaintext){this._setupPlainTextEditor()}else{this._setupRichTextEditor()}this._setupEventListeners();if(c){c.bindInteractionMode(this.unsafe$id("@doc").children())}this.counter=this.child("counter");if(this.counter){this.counter.updateCounter(this.doc.getLength())}this.$id("@fake_editor").on("click",this.hideFakeEditor.bind(this))},onUnload:function(){this.doc.destroy()},disabledCommands:function(){return this.disabled_commands},_setupPlainTextEditor:function(){this.doc=new f(this.$id("@doc"))},_setupRichTextEditor:function(){var e=require;var t=e("qtext2/base").Doc;this.doc=new t(this.content_json);this.toolbar=this.child("toolbar");this.doc.disableCommands(this.disabledCommands());if(a){this.doc.setLinkSelector(new o(this))}else{this.doc.setLinkSelector(new h(this,this.child("link_selector"),this.unsafe$id("@link_selector_wrapper")));if(this.photo_search_enabled&&this.child("photo_search")){this.doc.setPhotoSearch(new u(this,this.child("photo_search"),this.unsafe$id("@photo_search_wrapper"),this.unsafe$id("@file")));
}}if(this.disabledCommands().indexOf("image")==-1){var i=new d.ImageUploader(this,this.doc,this.$id("@drop_zone").get(0),this.$id("@file").get(0),this.interface_strings);this.doc.setImageUploader(i)}this.unsafe$id("@doc").append(this.doc.node);this.doc.node.setAttribute("placeholder",this.interface_strings.placeholder);this._setupToolbar();if(this.focusOnLoad){this.focus();this.focusOnLoad=false}},_setupToolbar:function(){var e=this;if(!this.toolbar){return}this.toolbar.on("click",function(t){if(t=="image"){if(e.photo_search_enabled&&e.child("photo_search")){e.doc.photoSearch.toggle()}else{e.unsafe$id("@file").click()}}else if(t=="link_hide"){e.toolbar.showBar(1)}else if(t=="overflow_show"){e.toolbar.showBar(2)}else if(t=="overflow_hide"){e.toolbar.showBar(1)}else{e.doc.handleCommand(t)}});this.toolbar.on("imageUpload",function(t){e.doc.insertImages(t)});this.doc.on("focus",function(){e.toolbar.makeActive(e.doc)});this.toolbar.makeActive(this.doc)},_setupEventListeners:function(){var e=this;
if(e._onEditorReady){e._onEditorReady()}this.doc.on("focus",function(){if(e.counter){e.counter.show()}if(e._onFocus){e._onFocus()}e.$id("@editor").addClass("focused")});this.doc.on("blur",function(){if(e.counter){e.counter.hide()}if(e._onBlur){e._onBlur()}e.$id("@editor").removeClass("focused")});this.doc.on("meaningfulChange",function(){e._updateCounter();e.reportMeaningfulChange()});this._trackTypingState()},_updateCounter:function(){if(!this.counter){return}var e=0;this.doc.children.forEach(function(t){t.children.forEach(function(t){if(!t.hasModifier("math")){e+=t.getLength()}})});this.counter.updateCounter(e);if(this._lengthChangeCallback){this._lengthChangeCallback(e>this.length_limit)}},_trackTypingState:function(){var e=this,t=10*1e3,i=55*1e3,n=3*1e3,s="empty",o=0,r=0,a;var d=function(){var l,c,u=(new Date).getTime();if(e.isOnlyWhiteSpace()||e.typingStopped){l="empty"}else{if(o<u-t){l="paused"}else{l="typing"}if(r<u-i){c=true}}if(l!=s){c=true}if(c&&e._onTypingStateChange){e._onTypingStateChange(l);
s=l;r=u}if(a){clearTimeout(a);a=null}if(l=="typing"||l=="paused"){a=setTimeout(d,n)}};this.doc.on("keydown",function(){o=(new Date).getTime();e.typingStopped=false;d()})},setFocusCallback:function(e){this._onFocus=e},setEditorReadyCallback:function(e){if(this._editorReady){e();return}this._onEditorReady=e},setBlurCallback:function(e){this._onBlur=e},setMeaningfulChangeCallback:function(e){this._onMeaningfulChange=e},reportMeaningfulChange:function(){if(this._onMeaningfulChange){this._onMeaningfulChange()}},setTypingStateCallback:function(e){this._onTypingStateChange=e},setLengthChangeCallback:function(e){this._lengthChangeCallback=e},isInteractive:function(){return true},isEmpty:function(){return this.doc.isEmpty()&&!this.doc.linkSelector.isActive()},isOnlyWhiteSpace:function(){return this.doc.isOnlyWhiteSpace()},stopTyping:function(){this.typingStopped=true},fixEditorButtons:function(){if(this.toolbar){this.toolbar.fix()}},focus:function(){if(this.doc){this.doc.focus()}else{this.focusOnLoad=true;
}},hideFakeEditor:function(){this.$id("@fake_editor").addClass("hidden");this.$id("@editor").removeClass("hidden");this.focus();this.fixEditorButtons()},serialize:function(){return this.doc.toJSON()},hasChanged:function(e){return this.doc.hasChanged(e)},disable:function(){this.doc.disable();this.$id("@editor").addClass("disabled")},enable:function(){this.doc.enable();this.$id("@editor").removeClass("disabled")},clear:function(){this.doc.clear()}})});define("app/view/question/lookup_bar_details",["shared/polyfills","unified_view/qtext2/editor","app/view/site_header/logged_in"],function Fi(require,exports,e){var t=require("unified_view/qtext2/editor").Editor,i=require("app/view/site_header/logged_in").LoggedInSiteHeaderContext;exports.AskBarDetails=t.extend({onLoad:function(){this._super.apply(this,arguments);var e=this;e.context=e.getContext(i);e.setLengthChangeCallback(function(t){e.context.set("question_details_over_limit",t);e.context.set("question_details_text_serialized",e.serialize());
e.context.set("question_details_is_empty",e.isOnlyWhiteSpace())});e.context.on("question_details_in_focus",function(t,i){if(i){e.focus()}});e.context.on("question_details_cleared",function(t,i){if(i){e.clear();e.context.set("question_details_is_empty",true)}})}})});define("app/view/question/merge/_merge",["shared/polyfills","webnode2","interface/jquery"],function Ui(require,exports,e){var t=require("webnode2").Component,$=require("interface/jquery")._jQuery;exports.QuestionMergeCandidates=t.extend({onLoad:function(){var e=this;e.$insertionEl=e.$id("@insert_candidate");e.$showAllLinkEl=e.$id("@show_all_link");e.$showAllLinkEl.click(function(t){t.preventDefault();e.$id("@candidates .candidate").removeClass("hidden");e.$showAllLinkEl.addClass("hidden")})},selectQID:function(e){var t=this;var i;if(this.improvedFlow){i=t.$id("@candidates input[type=radio][value="+e+"]")}else{i=t.$id("@candidates input[type=checkbox][value="+e+"]")}if(i.length){i.map(function(){var e=$(this),i=$("label[for='"+e.attr("id")+"']");
e.prop("checked",true);e.change();i.insertAfter(t.$insertionEl);i.removeClass("hidden")})}else{t.serverCall("get_checkbox_content").kwargs({qid:e}).contentFor(t.$insertionEl,{parentCid:t.cid}).success(function(){t.$insertionEl.children().map(function(){$(this).insertAfter(t.$insertionEl)})}).send()}},getSelectedQIDs:function(){var e=[];var t;if(this.improvedFlow){t="@candidates input[type=radio]:checked:not(:disabled)"}else{t="@candidates input[type=checkbox]:checked:not(:disabled)"}this.$id(t).map(function(){e.push(parseInt(this.value))});return e}});exports.QuestionMergeCanonicalPicker=t.extend({onLoad:function(){var e=this;e.$radios=e.$id("@picker input[type=radio]");e.$radios.change(function(t){e.$radios.map(function(){var e=$(this),t=$("label[for='"+e.attr("id")+"']");t.toggleClass("selected",e.is(":checked"));t.toggleClass("not_selected",!e.is(":checked"))})})},getSelectedQID:function(){var e=this.$id("@picker input[type=radio]:checked");if(e){return parseInt(e.val())}}});exports.OriginallyAnsweredBanner=t.extend({
onLoad:function(){var e=this;e.$id("@remove").click(function(t){t.preventDefault();e.serverCall("remove_banner").liveMutate().send()})}})});define("app/view/question/merge/modal",["shared/polyfills","shared/window_manager","view/modal","shared/util"],function ji(require,exports,e){var t=require("shared/window_manager"),i=require("view/modal"),n=require("shared/util");exports._QuestionMergeModal=i.MultiStep.extend({onSubmitSuccess:function(e,i,n,s){var o=this;var r=25e3;var a=1e3;if(this.improvedFlow){t.navigateTo(e);return}if(s<r){setTimeout(function(){o.serverCall("answer_has_moved").kwargs({qids:i,canonical_qid:n,time_so_far:s+a}).success(function(s){if(s){o.onSubmitSuccess(e,i,n,s)}else{t.navigateTo(e)}}).send()},a)}else{o.serverCall("log_timeout_before_answers_moved").kwargs({time_taken:s+a}).send();t.navigateTo(e)}},getCallBacks:function(){var e=this;return{QuestionMergeModalSelectorStep:{getStepData:function(){var t=e.data_cache[e.key];var i=e.child("candidates").getSelectedQIDs();
i.push(t.qid);return n.extend(t,{selectedQIDs:i})},onSubmit:function(){if(e.child("candidates").getSelectedQIDs().length){e._loadNext()}}},QuestionMergeModalMultipleLockedStep:{isLastStep:true,onSubmit:function(){e.disableSubmit();var t=e.data_cache.QuestionMergeModalSelectorStep;var i=t.selectedQIDs;e.serverCall("submit").kwargs({qids:i}).success(function(){e._closeModal()}).send()}},QuestionMergeModalCanonicalStep:{isLastStep:true,onSubmit:function(){var t=e.child("picker").getSelectedQID(),i=e.data_cache.QuestionMergeModalSelectorStep;if(t){e.disableSubmit();var n=i.selectedQIDs;e.serverCall("submit").kwargs({qids:n,canonical_qid:t}).success(function(i){e.onSubmitSuccess(i,n,t,0)}).liveMutate().send()}}}}}})});define("app/view/question/merge/selector",["shared/polyfills","view/selector"],function Hi(require,exports,e){var t=require("view/selector").Selector;exports.QuestionMergeESSelector=t.extend({resultWasSelected:function(e){var t=this;t.parent().child("candidates").selectQID(e.data.qid);
t.setQuery("")},getExtraKwargs:function(){return{ignore_qids:this.parent().child("candidates").getSelectedQIDs()}}})});define("app/view/question/not_helpful",["shared/polyfills","webnode2"],function Qi(require,exports,e){var t=require("webnode2").Component;exports.CollapseAnswerLink=t.extend({onLoad:function(){var e=this;this.$id("@undo_not_collapsible").click(function(t){e.serverCall("undo_not_collapsible").kwargs({aid:e.aid}).liveMutate().send();return false});this.$id("@make_uncollapsible").click(function(t){e.serverCall("make_uncollapsible").kwargs({aid:e.aid}).liveMutate().send();return false})}})});define("app/view/question/question_add",["shared/polyfills","app/view/topic_selector","shared/events/index"],function Wi(require,exports,e){var t=require("app/view/topic_selector").TopicSelector,i=require("shared/events/index");exports.AddQuestionTopicTempSelector=t.extend({addIgnoreOid:function(e){if(e){this.ignore_tids.push(e)}},maybeAddTopic:function(e,t){if(!t){return}if(this.ignore_tids.indexOf(e)!=-1){
return}this.addIgnoreOid(e);this.emitEvent({type:i.Types.QUESTION_TOPIC_SELECTION_ADD,payload:{editor:this.getDvar("_questionTopicsEditor"),name:t}})},topicWasSelected:function(e,t){this.maybeAddTopic(e,t);this.setQuery("");this.blur()},createTopicWasSelected:function(e){this.maybeAddTopic(null,e);this.setQuery("");this.blur()}})});define("app/view/question/suggested_answer",["shared/polyfills","webnode2"],function Vi(require,exports,e){var t=require("webnode2").Component;exports.AnswerSuggestedEditDiscardButtonInline=t.extend({onLoad:function(){var e=this;this.$id("@submit").click(function(){e.serverCall("discard_suggested_edit").kwargs({aid:e.aid}).liveMutate().send();return false})}})});define("app/view/question/wanted_answer",["shared/polyfills","webnode2","interface/jquery","w2.dialog","view/modal","shared/events/index","shared/action_log","view/selector","shared/cookies","view/paged_list"],function zi(require,exports,e){var t=require("webnode2").Component,$=require("interface/jquery")._jQuery,i=require("w2.dialog").Dialog,n=require("view/modal").Base,s=require("shared/events/index"),o=require("shared/action_log").ActionableComponent,r=require("view/selector").Selector,a=require("shared/cookies");
exports.WantedAnswerDecline=t.extend({onLoad:function(){var e=this;this.$id("@ignore").click(function(){if(e.allow_reason){e.showIgnoreReasonDialog()}else{e.serverCall("decline").liveMutate().send()}return false})},showIgnoreReasonDialog:function(){this._dialog=this.dialog().title("Decline Request").load("decline_dialog")}});exports.DeclineRequestDialog=t.extend({onLoad:function(){var e=this;this.editor=this.child("editor");this.editor.focus();this.$id("@give").click(function(){var t="";if(!e.editor.isOnlyWhiteSpace()){t=e.editor.serialize()}e.serverCall("decline").kwargs({reason:t}).liveMutate().success(function(){i.dialogFor(e).close_()}).send();return false});this.$id("@close").click(function(){i.dialogFor(e).close_();return false})}});exports.A2AFiltersListContentItem=t.extend({onLoad:function(){var e=this;e.$id("@filter_item").click(function(t){var i=t.currentTarget;e.parent().$(".A2AFiltersListContentItem").removeClass("nav_item_selected");$(i).addClass("nav_item_selected");var n=e.parent().parent().parent().ge("@suggestions_list");
var s=e.parent().parent();if(s.is_editing){return}$(n).addClass("working");e.serverCall("filtered_list").kwargs({tid:e.tid}).contentFor($(n)).success(function(){$(n).removeClass("working")}).send()})}});exports.WantedAnswerSelector=r.extend({onLoad:function(){this._super.apply(this,arguments);this.ignore_uid_select={}},resultWasSelected:function(e,t,i){var n=e.data.uid;if(this.ignore_uid_select[n]){return}this.ignore_uid_select[n]=true;this.updateResultItem(i);a.setQfeedLog(this,"AskToAnswer");a.setTlog({type:"AskToAnswer",qid:this.qid});var s=function(){delete this.ignore_uid_select[n];this.revertSelectedRow(i)}.bind(this);this.serverCall("ask_to_answer").liveMutate().kwargs({to_uid:n}).success(function(e){if(e.result==="failed"){s()}}).error(s).send()},resultsDidChange:function(){this.ignore_uid_select={}},updateResultItem:function(e){e.children(".name_sig").addClass("hidden");e.children(".name_sig.is_active").removeClass("hidden");e.children(".request_button").addClass("is_active")},
revertSelectedRow:function(e){e.children(".name_sig.hidden").removeClass("hidden");e.children(".name_sig.is_active").addClass("hidden");e.children(".request_button").removeClass("is_active")}});exports.WantedAnswerSuggestions=t.extend({onLoad:function(){this.child("selector").focus()},a2aHeaderCountClicked:function(){this.$id("@a2a_suggestions").hide();this.$id("@outstanding_requests").show()},a2aHeaderTitleClicked:function(){this.$id("@a2a_suggestions").show();this.$id("@outstanding_requests").hide()}});exports.AskToAnswerModal=n.extend({a2aHeaderCountClicked:function(){var e=this.child("wanted_answer_suggestions");e.$("#@a2a_suggestions").hide();e.$("#@outstanding_requests").show()},a2aHeaderTitleClicked:function(){var e=this.child("wanted_answer_suggestions");e.$("#@a2a_suggestions").show();e.$("#@outstanding_requests").hide()}});exports.AskToAnswerHeader=t.extend({onLoad:function(){var e=this;this.$id("@title_link").click(function(t){e.titleClicked();return false});this.$id("@count_link").click(function(t){
e.countClicked();return false})},countClicked:function(){this.$id("@count").toggle();this.$id("@count_link").toggle();this.$id("@title").toggle();this.$id("@title_link").toggle();this.parent().a2aHeaderCountClicked()},titleClicked:function(){this.$id("@count").toggle();this.$id("@count_link").toggle();this.$id("@title").toggle();this.$id("@title_link").toggle();this.parent().a2aHeaderTitleClicked()}});exports.AskToAnswerModalLink=t.extend({onLoad:function(){var e=this;this.$id("@create_modal_link").click(function(t){t.preventDefault();e.modal("load_inner")})}});exports.AskedBy=t.extend({onLoad:function(){this._super.apply(this,arguments);var e=this;this.$id("@modal_link").click(function(){e.modal("load_inner");return false})}});exports.AnswerAttributionSection=t.extend({onLoad:function(){var e=this;this.$id("@modal_link").click(function(){e.modal("load_inner");return false})}});exports.WantedAnswersSuggestionsPagedList=require("view/paged_list").PagedList.extend({onLoad:function(){this._super.apply(this,arguments);
this.container=$(".modal_wrapper")}});exports.WantedAnswerWithCreditQuestionListItem=o.extend({onLoad:function(){var e=this;this._super.apply(this,arguments);this.handleEvent(s.Types.QUESTION_CANT_ANSWER_STATE,function(t){if(t.payload.qid==e.qid){var i=t.payload.state=="passed";e.$id("@item").toggleClass("cant_answer",i)}})}})});define("app/view/quora_meets_bagel",["shared/polyfills","webnode2"],function Gi(require,exports,e){var t=require("webnode2").Component;exports.QMBPage=t.extend({onLoad:function(){var e=this;e.$("%@qmb_button").click(function(t){var i=t.target.id;e.serverCall("take_qmb_action").kwargs({which_action:i}).success(function(){window.location.reload()}).send();return false})}})});define("unified_view/action_bar/overflow_menu/base",["shared/polyfills","shared/core/component","interface/settings","shared/client_tracker","shared/cookies","w2.modal"],function Ki(require,exports,e){var t=require("shared/core/component").Component,i=require("interface/settings").pageIsMobile,n=require("shared/client_tracker"),s=require("shared/cookies");
if(i){var o=require("mobile_app2/client"),r=require("mobile_app2/messages"),a=require("mobile_app2/app/view/common")}else{var d=require("w2.modal").ModalWithCallBacks}exports.Item=t.extend({onLoad:function(){if(!i){this.desktopOnLoad()}},desktopOnLoad:function(){this.$id("@overflow_menu_item").on("click",this.selectItem.bind(this))},selectItem:function(){if(this.qfeed_log_action){s.setQfeedLog(this,this.qfeed_log_action);n.track(this.qfeed_log_action,null,this)}this.onSelectAction();return this.close_on_click},onSelectAction:function(){},getActionSheetItemData:function(){return{index:this.index,label:this.label,is_destructive:this.is_destructive}},invokeRichTextEditor:function(e){o.invokeRichTextEditor(e,{onSucceed:function(){if(e.broadcast_key){o.broadcastReload(e.broadcast_key)}}})}});exports.WithServerCall=exports.Item.extend({onSelectAction:function(){this.serverCall("selected").success(function(e){if(i){if(e&&e.url){r.send("openURL",{url:e.url})}}else{if(e.url){document.location=e.url;
}}}).send()}});exports.WithLink=exports.Item.extend({desktopOnLoad:function(){var e=this;this.$id("@overflow_menu_item").on("click",function(t){e.onSelectAction(t)})},onSelectAction:function(){if(!i){document.location=this.url}else{var e={url:this.url};if(this.target){e.target=this.target}r.send("openURL",e)}}});exports.WithModal=exports.WithLink.extend({onSelectAction:function(e){if(i){this._super.apply(this,arguments)}else{e.preventDefault();var t=new d(this,{});t.load("load_modal")}}});exports.Toggleable=exports.Item.extend({onToggledOff:function(){if(this.one_way){return}if(this.qfeed_log_action_on_disable){s.setQfeedLog(this,this.qfeed_log_action_on_disable)}if(this.tlog_action_context&&this.tlog_action_on_disable){var e={type:this.tlog_action_on_disable};e[this.tlog_action_context]=this.oid;s.setTlog(e)}if(this.with_server_call){this.makeServerCall("on_toggled_off")}},onToggledOn:function(){if(this.qfeed_log_action_on_enable){s.setQfeedLog(this,this.qfeed_log_action_on_enable)}if(this.tlog_action_context&&this.tlog_action_on_enable){
var e={type:this.tlog_action_on_enable};e[this.tlog_action_context]=this.oid;s.setTlog(e)}if(this.with_server_call){this.makeServerCall("on_toggled_on")}},makeServerCall:function(e){var t=this;t.serverCall(e).liveMutate().success(function(){if(i){if(t.broadcast_key){o.broadcastReload(t.broadcast_key)}if(t.should_reload){r.send("reload")}}}).send()},onSelectAction:function(){if(this.is_on){this.onToggledOff()}else{this.onToggledOn()}}});exports.ToggleableWithConfirmation=exports.Toggleable.extend({onToggledOn:function(){var e=this;var t=e._super;var n=function(){t.apply(e)};if(this.should_show_on_toggled_on){if(i){a.showConfirm({title:this.modal_kwargs.on_toggled_on_title,message:this.modal_kwargs.on_toggled_on_message,callback:n})}else{this.createModal("load_modal").onSubmit(n).kwargs(this.modal_kwargs).show()}}else{n()}},onToggledOff:function(){var e=this;var t=e._super;var n=function(){t.apply(e)};if(this.should_show_on_toggled_off){if(i){a.showConfirm({title:this.modal_kwargs.on_toggled_off_title,
message:this.modal_kwargs.on_toggled_off_message,callback:n})}else{this.createModal("load_modal").onSubmit(n).kwargs(this.modal_kwargs).show()}}else{n()}}})});define("app/view/reading_list",["shared/polyfills","webnode2","unified_view/action_bar/overflow_menu/base","shared/events/index"],function Ji(require,exports,e){var t=require("webnode2").Component,i=require("unified_view/action_bar/overflow_menu/base").Item,n=require("shared/events/index");exports.MarkAsReadButton=t.extend({onLoad:function(){var e=this;e.$id("@read_later").click(function(t){t.preventDefault();e.serverCall("unmark_as_read_later").liveMutate().send();return false})}});exports.RemoveReadingListItem=i.extend({onSelectAction:function(){this.serverCall("remove_bookmark").send()}});exports.ReadLaterSort=t.extend({onLoad:function(){var e=this;var t=e.$id("@new");var i=e.$id("@old");t.click(function(){e.emitEvent({type:n.Types.READING_LIST_VIEW_STATE,payload:{reverse:false}});t.removeClass("inactive");t.addClass("active");i.removeClass("active");
i.addClass("inactive")});i.click(function(){e.emitEvent({type:n.Types.READING_LIST_VIEW_STATE,payload:{reverse:true}});t.addClass("inactive");t.removeClass("active");i.addClass("active");i.removeClass("inactive")})}});exports.ReadingListContents=t.extend({onLoad:function(){var e=this;this.handleEvent(n.Types.READING_LIST_VIEW_STATE,function(t){if("reverse"in t.payload){e.showSpinner()}})},showSpinner:function(){this.$id("@spinner").removeClass("hidden")}});exports.ReadingListMain=t.extend({onLoad:function(){this.emitEvent({type:n.Types.READING_LIST_VIEW_STATE,payload:{reverse:this.reverse_order}});var e=this;this.handleEvent(n.Types.READING_LIST_VIEW_STATE,function(t){if("reverse"in t.payload){e.updateResults(t.payload.reverse)}})},updateURL:function(e){var t="";if(e){t+="&order=desc"}if(t.length>0){t="?"+t.substring(1)}window.history.pushState(null,null,"/bookmarked_answers"+t)},updateResults:function(e){this.updateURL(e);var t=this.$id("@read_later_list");this.$id("@spinner").removeClass("hidden");
t.css("opacity",.5);this.serverCall("load_reading_list").contentFor(t).kwargs({reverse_order:e}).success(function(){t.css("opacity",1)}).send()}})});define("app/view/settings",["shared/polyfills","webnode2","view/inline_editor","shared/events/index","app/view/share/connect","shared/window_manager","w2.modal","w2.dialog","w2.rpc","view/modal","fx"],function Xi(require,exports,e){var t=require("webnode2").Component,i=require("view/inline_editor").InlineEditor,n=require("shared/events/index"),s=require("app/view/share/connect").SocialConnector,o=require("shared/window_manager"),r=require("w2.modal"),a=require("w2.dialog").Dialog,d=require("w2.rpc").rpcToURL,l=require("view/modal").Base,c=require("fx");exports.CallbackModal=l.extend({onSubmit:function(){this._super.apply(this,arguments);r.Modal.modalFor(this).executeOnSubmitCallBack()}});exports.SettingsAccountEmailOption=t.extend({onLoad:function(){var e=this;this.$id("@add_another_email_link").click(function(t){e.$id("@add_another_email_row").toggleClass("hidden");
e.$id("@add_email_input_row").toggleClass("hidden");e.$id("@new_email").focus();return false});this.$id("@add_another_email").click(function(){var t=e.$id("@new_email").val();if(!t){return false}e.serverCall("add_email").kwargs({email:t}).liveMutate().send();return false})}});var u=exports.SettingsOption=t.extend({onLoad:function(e){var t=this;this.$id("@view_option_link").click(function(){t.serverCall("check_reauth").success(function(){t.expandOption()}).send();return false});if(this.auto_open_url_hash&&e){if(o.getHash().substr(0,30)=="#"+this.auto_open_url_hash){this.expandOption();var i=this.$id("@option_content").css("background-color","#E0E0E0");c.highlight(i,1500)}}},expandOption:function(){this.$id("@view_option").toggleClass("hidden");this.$id("@option_content").toggleClass("hidden")}});exports.AdultSettingsOptionToggle=t.extend({onLoad:function(){var e=this;this.$id("@no_adult_content").click(function(){e.serverCall("no_adult_content").liveMutate().send();return false});this.$id("@allow_adult_content").click(function(){
e.serverCall("allow_adult_content").liveMutate().send();return false})}});exports.UserDisclaimerDialogEditor=i.extend({onLoad:function(){var e=this;this._super.apply(this,arguments);this.$id("@inline_editor_cancel").click(function(){a.dialogFor(e).close_();return false});this.$id("@inline_editor_submit").click(function(){var t=a.openerFor(e);if(t.attachDisclaimer==="function"){a.openerFor(e).user_has_set_disclaimer=true;a.openerFor(e).attachDisclaimer()}a.dialogFor(e).close_();return false})}});exports.ChangePasswordOption=u.extend({onLoad:function(){this._super.apply(this,arguments);this.clear_passwords=function(){this.$id("@new_password").val("");this.$id("@confirm_password").val("")};var e=this;this.$id("@change_password_submit").click(function(){if(e.$id("@new_password").val()!==e.$id("@confirm_password").val()){e.$id("@password_and_confirmation_mismatch").removeClass("hidden");e.$id("@password_changed").addClass("hidden");return false}e.$id("@password_and_confirmation_mismatch").addClass("hidden");
d("/settings/change_password_POST").kwargs({new_password:e.$id("@new_password").val()}).success(function(t){e.clear_passwords();if(t[0]){e.$id("@password_changed").removeClass("hidden")}else{e.$id("@password_changed").addClass("hidden")}}).send();return false})}});exports.RemoveDisclaimerOption=u.extend({onLoad:function(){var e=this;this._super.apply(this,arguments);this.$id("@remove_disclaimer_submit").click(function(){e.serverCall("remove_disclaimer").send();return false})}});exports.BlogConnectDialogContents=t.extend({onLoad:function(){var e=this;this.$("#@url, #@uname, #@pwd").focus(function(){e.$id("@blog_not_supported").hide()});this.$("#@url, #@uname, #@pwd").keydown(function(t){if(t.keyCode==13){e.submitForm()}});this.$id("@url").blur(function(){e.$id("@wordpress_login_help").hide();var t=e.$id("@url").val();if(t.match("wordpress")){e.$id("@wordpress_login_help").show()}});this.$id("@close").click(function(){a.dialogFor(e).close_();return false});this.$id("@connect").click(this.submitForm.bind(this));
},submitForm:function(){var e=this;var t=this.$id("@url").val(),i=this.$id("@uname").val(),s=this.$id("@pwd").val();if(t&&i&&s){this.serverCall("validate_blog").kwargs({url:t,name:i,pwd:s}).liveMutate().success(function(t){var i=t[0],s=t[1];if(!i){e.$id("@blog_not_supported").show().text(s)}else{e.emitEvent({type:n.Types.WORDPRESS_CONNECT_SUCCESS,payload:{}});a.dialogFor(e).close_()}}).send()}}});exports.WordpressConnect=t.extend({onLoad:function(){this._super.apply(this,arguments);this.$id("@wordpress_connect_button").on("click",this.connectWordpress.bind(this));this.$id("@wordpress_disconnect_button").on("click",this.disconnectWordpress.bind(this))},connectWordpress:function(){this._dialog=this.dialog().title(this.dialog_title).close(null).load("set_dialog_contents")},disconnectWordpress:function(){this.serverCall("wordpress_disconnect").liveMutate().send()}});exports.GoogleConnect=t.extend({onLoad:function(){var e=this;this.$id("@google_disconnect_button").click(function(){e.serverCall("disconnect_google").liveMutate().send();
return false})}});exports.LinkedinConnect=t.extend({onLoad:function(){var e=this;this.$id("@linkedin_disconnect_button").click(function(){e.serverCall("disconnect_linkedin").liveMutate().send();return false})}});exports.LinkedinConnectButton=s.extend({onLoad:function(){this.$id("@linkedin_connect_button").click(this.connectLinkedin.bind(this))}});exports.LinkedinPublicProfileLink=t.extend({onLoad:function(){var e=this;this.serverCall("get_profile_info").kwargs({li_uid:this.liUid}).success(function(t){if(t===null){e.$id("@linkedin_link").text("").attr("href","#")}else{e.$id("@linkedin_link").text(t.first_name+" "+t.last_name).attr("href",t.url)}}).send()}});exports.ConfirmEmailModal=l.extend({onSubmit:function(){var e=this;e.serverCall("resend_email_confirmation").success(function(){e._closeModal()}).liveMutate().send()}});exports.RemoveEmailModal=l.extend({onSubmit:function(){var e=this;e.serverCall("remove_email").success(function(){e._closeModal()}).liveMutate().send()}});exports.EmailAddressRow=t.extend({
onLoad:function(){var e=this;this.$id("@confirm_email").click(function(){e.modal("load_inner_confirm_email");return false});this.$id("@make_primary").click(function(){return e._serverCallHelper("set_primary_email")});this.$id("@delete_email_icon").click(function(){e.modal("load_inner_remove_email");return false})},_serverCallHelper:function(e){this.serverCall(e).kwargs({email:this.email}).liveMutate().send();return false}});exports.ResetPassword=t.extend({onLoad:function(){var e=this;this.$id("@reset_email_submit").click(function(t){var i=e.$id("@email_input").val();if(!i){return false}e.emailRequest("/settings/send_reset_password_email_POST",i);return false});this.$id("@reset_password_form_tag").submit(function(t){var i=e.$id("@reset_password_code").val();var n=e.$id("@new_password").val();var s=e.$id("@confirm_password").val();var o=e.$id("@password_confirmation_mismatch");if(n!==s){o.removeClass("hidden");return false}else{o.addClass("hidden")}if(!n){return false}e.passwordRequest("/settings/reset_password_POST",i,n);
return false});o.replaceURL("/settings/reset_password")},emailRequest:function(e,t){var i=this;d(e).kwargs({email:t}).success(function(e){i.$id("@email_input").val("");i.$id("@reset_email_conf").removeClass("hidden");i.$id("@reset_email_form").addClass("hidden")}).send();return false},passwordRequest:function(e,t,i){d(e).kwargs({code:t,new_password:i}).success(function(e){if(e){o.navigateTo("/?__pmsg__=password_changed")}else{o.navigateTo("/settings/reset_password?__pmsg__=password_change_error")}}).send();return false}});exports.MutedRowToggle=t.extend({onLoad:function(){var e=this;this.$id("@unmute").click(function(){e.serverCall("unmute").kwargs({oid:e.oid}).liveMutate().send()});this.$id("@mute").click(function(){e.serverCall("mute").kwargs({oid:e.oid}).liveMutate().send()})}})});define("app/view/share/form",["shared/polyfills","webnode2","app/view/share/connect","tooltip","facebook"],function Yi(require,exports,e){var t=require("webnode2").Component,i=require("app/view/share/connect").SocialConnector,n=require("tooltip"),s=require("facebook");
var o={_state:{},get:function(e){return this._state[e]},set:function(e,t){this._state[e]=t}};var r=exports.ShareCheckboxBase=i.extend({contextProperty:null,onLoad:function(){var e=this;this.list_item=this.$id("@share_checkbox_list_item");this.checkbox=this.$id("@checkbox");this.action_link=this.$id("@action_link");this.message_preview=this.$id("@message_preview");this.message_preview_text=this.$id("@message_preview_text");this.label_clickable=this.$id("@label_clickable");if(!this.is_disabled){var t=o.get(this.contextProperty);this.list_item.toggleClass("is_not_checked",!t);this.checkbox.prop("checked",t)}this.checkbox.on("change",function(){var t=e.isChecked();if(t&&e.needs_action){e.remedyDisabled();e.checkbox.prop("checked",false);return}e.logCheckboxChangedJS(t);e.list_item.toggleClass("is_not_checked",!t);o.set(e.contextProperty,t)});this.label_clickable.on("click",function(){e.checkbox.click()});this.action_link.on("click",function(){if(e.is_disabled){e.remedyDisabled()}else{e.editText();
}return false})},logCheckboxChangedJS:function(e){this.serverCall("log_checkbox_changed_js").kwargs({is_checked:e,share_info:this.share_info}).send()},isChecked:function(){return this.checkbox.prop("checked")},remedyDisabled:function(){},beginEditingText:function(){}});var a=exports.ShareCheckboxTwitter=r.extend({contextProperty:"shareToTwitter",remedyDisabled:function(){this.connectTwitter()}});exports.ShareCheckboxTwitterCompact=a.extend({onLoad:function(){this._super.apply(this,arguments);n.attach(this.list_item,this.default_text)},remedyDisabled:function(){var e=this;this.connectTwitter(function(){e.checkbox.prop("checked",true)})}});exports.ShareCheckboxFacebook=r.extend({contextProperty:"shareToFacebook",remedyDisabled:function(){var e=this;s.maybePromptToPublish(e.fbUid,function(t,i,n){e.serverCall("connect_facebook").kwargs({fb_uid:t,access_token:i,expires_secs:n}).liveMutate().send()},function(){e.child("fb_different_account").show()})}});exports.ShareForm=t.extend({getValues:function(){
var e=this.child("checkbox_fb");var t=this.child("checkbox_tw");return{fb:e&&e.isChecked(),tw:t&&t.isChecked()}}});exports.ShareFormMessageEditor=t.extend({onLoad:function(){this.$editor=this.$id("@editor");this.focus()},focus:function(){this.$editor.focus()},isOnlyWhiteSpace:function(){return this.$editor.val().trim()===""},getText:function(){return this.$editor.val()},serialize:function(){return{html:this.$editor.val(),data:{}}}})});define("app/view/share/modal",["shared/polyfills","interface/jquery","w2.modal","shared/events/index","app/view/share/connect","view/modal","shared/window_manager","shared/action_log","shared/cookies"],function Zi(require,exports,e){var $=require("interface/jquery")._jQuery,t=require("w2.modal"),i=require("shared/events/index"),n=require("app/view/share/connect").socialConnectorBase,s=require("view/modal").Base,o=require("shared/window_manager"),r=require("shared/action_log"),a=require("shared/cookies");exports.ShareFormModal=s.extend($.extend({},n,{onLoad:function(){
var e=this;e.results=[];e.shortURLCopyField=e.$id("@short_url_copy_field");e.linkedinCheckbox=e.$id("@linkedin_checkbox");e.linkedinConnectLink=e.$id("@linkedin_connect_link");e.wordpressCheckbox=e.$id("@wordpress_checkbox");e.wordpressConnectLink=e.$id("@wordpress_connect_link");e.boardCheckbox=e.$id("@board_checkbox");e.boardSelectorContainer=e.$id("@board_selector_container");e.boardSelector=e.child("board_selector");e.sendCheckbox=e.$id("@send_checkbox");e.multiSelectorContainer=e.$id("@multi_selector_container");e.child("selector").whenOnSavedResultsChanged(function(t){e.updateResults(t)});if(typeof window.history.pushState=="function"){if(!o.isParamInURL("share")){window.history.pushState(null,"",o.addParamToURL(""+window.location,"share","1"))}}if(e.isChecked(e.boardCheckbox)){e.boardSelectorContainer.show()}if(e.isChecked(e.sendCheckbox)){e.multiSelectorContainer.show()}e.linkedinCheckbox.click(function(){if(!e.isChecked(e.linkedinCheckbox)){e.disableSubmitIfNecessary();return}if(e.liUid){
e.enableSubmit();return}e.connectLinkedin(e.checkLinkedin.bind(e));return false});e.linkedinConnectLink.click(function(){e.connectLinkedin(e.checkLinkedin.bind(e));return false});e.wordpressCheckbox.click(function(){if(!e.isChecked(e.wordpressCheckbox)){e.disableSubmitIfNecessary();return}if(e.wordpressConnected){e.enableSubmit();return}e.connectWordpress()});e.wordpressConnectLink.click(function(){e.connectWordpress();return false});e.handleEvent(i.Types.WORDPRESS_CONNECT_SUCCESS,e.checkWordpress.bind(e));e.boardCheckbox.change(function(){if(!e.isChecked(e.boardCheckbox)){e.boardSelectorContainer.hide();e.disableSubmitIfNecessary()}else{e.boardSelectorContainer.show();e.enableSubmit()}});e.sendCheckbox.click(function(){if(!e.isChecked(e.sendCheckbox)){e.multiSelectorContainer.hide();e.disableSubmitIfNecessary();return}e.multiSelectorContainer.show()});e.shortURLCopyField.click(function(){$(this).select()});this._super.apply(this,arguments);e.disableSubmitIfNecessary()},onClose:function(){
this._closeModal();if(this.originalUrl&&typeof window.history.pushState=="function"){window.history.pushState(null,"",this.originalUrl)}return false},onSubmit:function(){var e=this;if(e.boardSelector&&!!e.boardSelector.selected_board){e.boardInfo.bid=e.boardSelector.selected_board.bid;e.boardInfo.name=e.boardSelector.selected_board.name;e.boardInfo.is_submission=e.boardSelector.selected_board.is_submission}else if(e.isChecked(e.boardCheckbox)){e.boardCheckbox.click()}var i=e.checkboxValues();i.send=e.isChecked(e.sendCheckbox);if(!e.atLeastOneChecked(i)){e.disableSubmit();return false}var n=t.Modal.openerFor(e);for(var s in i){if(i[s]===true){var o="Share"+s[0].toUpperCase()+s.slice(1);a.setQfeedLog(n,o);a.setTlog({type:o})}}a.setQueryLog(n,"BoardPost");r.logSecondaryAction("Share",e.share_target);e.disableSubmit();e.serverCall("dialog_submit_controller").kwargs({checkboxes:i,message:e.child("message_editor").serialize(),board_info:e.boardInfo,send_recipients:e.results}).success(function(t){
e._closeModal()}).error(function(){e._closeModal()}).liveMutate().send()},regexUrl:/((?:https?:\/\/)?[a-zA-Z0-9](?:[-a-zA-Z0-9]*\.)+[a-zA-Z]{2,}(?:\/[^\/\s]+)*\/?)(?:\s|$)/gi,tweetLength:function(e){if(!e){return 0}var t=e.length;var i=[];e.replace(this.regexUrl,function(e,t){i.push(t)});t-=i.join("").length;$.each(i,function(e,i){t+=i.match(/https:/)?23:22});t+=23;return t},checkboxValues:function(){var e=this;var t={};$.each(e.shareChannels,function(){t[this]=e.isChecked(e.$id("@"+this+"_checkbox"))});return t},atLeastOneChecked:function(e){var t=false;$.each(e,function(e,i){t=t||i});return t},uncheckAll:function(){var e=this;$.each(e.shareChannels,function(){e.$id("@"+this+"_checkbox").prop("checked",false)});e.disableSubmit()},disableSubmitIfNecessary:function(){var e=this.checkboxValues();if(!this.atLeastOneChecked(e)&&this.results.length===0){this.disableSubmit()}},connectWordpress:function(){var e=this;e._dialog=e.dialog().title(e.wordpress_connect_title).close().load("connect_wordpress");
this._closeModal()},checkWordpress:function(){this.wordpressCheckbox.prop("checked",true);this.wordpressCheckbox.prop("disabled",false);this.wordpressConnectLink.hide();this.wordpressConnected=true;this.enableSubmit()},checkLinkedin:function(){var e=this;e.linkedinCheckbox.prop("checked",true);e.linkedinCheckbox.prop("disabled",false);e.linkedinConnectLink.hide();e.liUid=true;e.enableSubmit()},updateResults:function(e){this.results=e;if(this.results.length>0||this.atLeastOneChecked(this.checkboxValues())){this.enableSubmit()}else{this.disableSubmit()}},isChecked:function(e){return e.prop("checked")}}))});define("input_validate",["shared/polyfills","webnode2"],function en(require,exports,e){var t=require("webnode2").Component;exports.InputValidator=t.extend({init:function(){this._super.apply(this,arguments);this.isValid=null},onLoad:function(){var e=this.input(),t=this,i;e.bind("change blur",function(){var n=e.val();if(n!==i){i=n;t.validate()}});this._managerComponent().__validators=this._managerComponent().__validators||[];
this._managerComponent().__validators.push(this)},input:function(){var e=this.parent();if(e.$!==undefined){return e.$("#"+this.id)}else{return e.unsafe$id(this.id)}},_managerComponent:function(){return this.parent()},validate:function(e){var t=this;e=e||{};var i=this.input().val();if(!i){this.showErrorOnComponent(".@incomplete");this.hideAllErrors();this.isValid=null}else{this.hideAllErrors();var n=setTimeout(function(){t.$(".@asking_server").show()},150);var s={value:this.input().val()};var o=this.additional_kwargs();for(var r in o){s[r]=o[r]}this.serverCall("validate").kwargs(s).success(function(i){clearTimeout(n);t.hideAllErrors();if(i.valid){t.isValid=true;if(i.message){t.setWidth(t.$id("@valid_message"));t.$id("@valid_message").text(i.message)}if(t.$(".@valid").text()){t.showErrorOnComponent(".@valid")}t.hideAllErrors();t.input().removeClass("error");if(typeof e.valid=="function"){e.valid(i.message)}}else{t.isValid=false;if(i.message){t.setWidth(t.$id("@invalid_message"));t.$id("@invalid_message").text(i.message);
t.invalidMessage=i.message}t.hideAllErrors();t.showErrorOnComponent(".@invalid");if(typeof e.invalid=="function"){e.invalid(i.message)}}}).send()}},additional_kwargs:function(){return{}},populate_if_valid:function(e,t){var i=this;this.serverCall("validate").kwargs({value:e}).success(function(n){if(n.valid){i.isValid=true;t.val(e)}}).send()},setWidth:function(e){var t=parseInt(this.input().width())-4;if(t>0){e.css("width",t+"px")}},hideAllErrors:function(){this.$(".@invalid").hide();this.$(".@valid").hide();this.$(".@incomplete").hide();this.$(".@asking_server").hide();this.input().removeClass("input_validation_error");this.$("textarea").removeClass("input_validation_error")},showErrorOnComponent:function(e){this.$(e).show();this.input().addClass("input_validation_error");this.$("textarea").addClass("input_validation_error")}});exports.InputValidator.validate=function(e,t){t=t||{};if(e.__validators&&e.__validators.length){e.__validators[0].validate(t)}else{if(typeof t.valid=="function"){
t.valid()}}}});define("app/view/signup_validation",["shared/polyfills","input_validate","unified_view/signup/_signup"],function tn(require,exports,e){var t=require("input_validate").InputValidator,i=require("unified_view/signup/_signup").SignupContext;exports.SignupValidator=t.extend({onLoad:function(){this._super.apply(this,arguments);this.signupContext=this.getContext(i);if(this.signupContext){this.signupContext.get("validators")[this.id]=this}}})});define("app/view/site_header",["shared/polyfills","shared/core/component","shared/events/index"],function nn(require,exports,e){var t=require("shared/core/component").Component,i=require("shared/events/index");exports.NonMemberSiteHeaderBase=t.extend({onLoad:function(){var e=this;this.handleEvent(i.Types.SITE_HEADER_SEARCH_FOCUSED,function(t){e.$id("@header").toggleClass("search_focused",t.payload.focused)})}})});define("app/view/site_header/logged_out",["shared/polyfills","webnode2","shared/events/index"],function sn(require,exports,e){var t=require("webnode2").Component,i=require("shared/events/index");
exports.LoggedOutSiteHeader=t.extend({onLoad:function(){var e=this;this.handleEvent(i.Types.SITE_HEADER_SEARCH_FOCUSED,function(t){e.$id("@header").toggleClass("search_focused",t.payload.focused)});e.$id("@signup").click(function(){e.serverCall("show_signup_wall_if_not_logged_in").liveMutate().send();return false});e.$id("@login").click(function(){window.loginIntent=true;e.serverCall("show_signup_wall_if_not_logged_in").liveMutate().send();return false})}})});define("app/view/static",["shared/polyfills","webnode2","interface/jquery"],function on(require,exports,e){var t=require("webnode2").Component,$=require("interface/jquery")._jQuery;exports.JobsMain=t.extend({onLoad:function(){var e=this;$(".expand_link").click(function(t){t.preventDefault();var i=$(this).attr("id").split("_").pop();e.$id("@expand_"+i).toggleClass("hidden")});$.easing.easeOutExpo=function(e,t,i,n,s){return t==s?i+n:n*(-Math.pow(2,-10*t/s)+1)+i};$(".jobs_listing_button").click(function(t){t.preventDefault();var i=e.$id("@careers");
if(i.length){$("html, body").animate({scrollTop:i.offset().top-100},2500,"easeOutExpo")}});$(".splash_arrow").click(function(t){t.preventDefault();var i=e.$id("@mission");if(i.length){$("html, body").animate({scrollTop:i.offset().top-100},1e3)}})}});exports.FeedbackTopicSelector=t.extend({onLoad:function(){var e=this;e.$id("@topic_selector").on("change",function(t){t.preventDefault();var i=parseInt($(this).val());e.serverCall("choose_selector").kwargs({feedback_type:i}).contentFor(e.$id("@faq_selector"),{parentCid:e.cid}).send()})}});exports.SuggestedFAQ=t.extend({onLoad:function(){var e=this;e.$id("@need_help_button").on("click",function(){$(this).hide();e.$id("@general_form").removeClass("hidden")})}});exports.GeneralForm=t.extend({onLoad:function(){var e=this;e.logged_in=this.logged_in;e.clicked=false;this.child("upload_form").success(this.uploadSuccess.bind(this)).failure(this.uploadFailure.bind(this));e.$id("@submit_button").on("click",function(t){if(e.clicked){return}e.clicked=true;
t.preventDefault();e.$id("@submit_button").addClass("disabled");var i=e.$id("@name").val();var n=e.$id("@email").val();var s=e.$id("@profile").val();var o=e.$id("@photo_key").val();var r=e.$id("@editor").val();var a=e.$id("@appeal_selector").val();var d=e.$id("@appeal_content").val();var l=document.referrer;e.serverCall("submit_feedback").kwargs({feedback_type:e.feedback_type,msg:r,referrer:l,name:i,email:n,profile:s,photo_key:o,target:e.target,appeal:a,appeal_content:d}).success(function(t){if(t&&t.redirect){setTimeout(function(){window.location.href="/"},2e3)}else{e.clicked=false;e.$id("@submit_button").removeClass("disabled")}}).liveMutate().send()})},uploadSuccess:function(e){this.$id("@photo_key").val(e.photo_key);this.serverCall("upload").kwargs({photo_key:e.photo_key,target:this.target}).contentFor(this.$id("@iframe"),{parentCid:this.cid}).send()},uploadFailure:function(){$(".drop_zone").removeClass("drag_and_hover");this.child("drag_and_drop_form").$id("@form_title").removeClass("drag_and_hover");
this.child("upload_form").hideSpinner()}});exports.JobListingMain=t.extend({onLoad:function(){this.$id("@apply_button").on("click",this.onClickApplyNow.bind(this))},onClickApplyNow:function(){var e=this;if(e.pixel_url){var t=new XMLHttpRequest;t.onreadystatechange=function(){window.location.href=e.apply_url};t.open("GET",e.pixel_url,true);t.send(null)}else{window.location.href=e.apply_url}return false}})});define("app/view/suggestions",["shared/polyfills","shared/action_log"],function rn(require,exports,e){var t=require("shared/action_log");exports.FollowSuggestionCard=t.ActionableComponent.extend({onLoad:function(){this._super.apply(this,arguments);var e=this,t=false,i=e.$id("@actionable").parent();i.mouseleave(function(){if(t===true){i.fadeOut();e.serverCall("follow").liveMutate().send()}});e.$id("@follow").on("click",function(i){i.preventDefault();e.$id("@follow").toggle();e.$id("@unfollow").toggle();t=true});e.$id("@unfollow").on("click",function(i){i.preventDefault();e.$id("@follow").toggle();
e.$id("@unfollow").toggle();t=false})}})});define("app/view/survey/question_page",["shared/polyfills","webnode2","interface/jquery"],function an(require,exports,e){var t=require("webnode2").Component,$=require("interface/jquery")._jQuery;exports.Survey=t.extend({onLoad:function(){var e=this;e.bindSurveyDismissHandler();e.bindSurveySubmitHandler();e.serverCall("show_card").send()},bindSurveySubmitHandler:function(){var e=this;this.$id("@submit_form").on("click",function(){var t=e.$id("@survey_form").find("input[type='radio']:checked").val();var i=$(this).parents(".Survey");var n=e.$id("@response_input").val();if(typeof t!=="undefined"){e.serverCall("submit_survey").kwargs({selected_option:t,response_text:n}).success(function(){e.$id("@survey_wrapper").addClass("hidden");e.$id("@feedback").removeClass("hidden");i.hide()}).send()}})},bindSurveyDismissHandler:function(){var e=this;this.$id("@dismiss").on("click",function(){e.$id("@survey").fadeOut(800);e.serverCall("dismiss_survey").send()});
}})});define("app/view/thanks",["shared/polyfills","webnode2"],function dn(require,exports,e){var t=require("webnode2").Component;exports.ThanksLink=t.extend({onLoad:function(){var e=this;this.$id("@thanks_link").click(function(){e.serverCall("send_thanks").liveMutate().send();return false})}})});define("app/view/thread",["shared/polyfills","view/inline_editor"],function ln(require,exports,e){var t=require("view/inline_editor").InlineEditor;exports.ThreadMessageInlineEditor=t.extend({ajax_callback:function(e){this.editor.clear();this._latestSavedState=null}})});define("app/view/threaded_comments",["shared/polyfills","webnode2","interface/jquery","shared/debounce","shared/prettyprint","shared/w2.context","shared/window_manager","shared/mathify","shared/logging"],function cn(require,exports,e){var t=require("webnode2").Component,$=require("interface/jquery")._jQuery,i=require("webnode2"),n=require("shared/debounce").debounce,s=require("shared/prettyprint").prettyPrint,o=require("shared/w2.context"),r=require("shared/window_manager").isInHash,a=require("shared/mathify").renderMath,d=require("shared/logging");
var l=o.Context.extend({initialProperties:function(){return{expanded:false,visible:true,showReplyBox:false}}});exports.TCommentListWrapper=t.extend({onLoad:function(){this.tcommentContext=this.getContext(l);if(this.isSingleFeaturedComment()){this.actionBarContext=this.getContext(o.ActionBar)}this.moreLink=this.$id("@comment_list_more_link");this.collapsedLink=this.$id("@collapsed_link");this.isMoreLinkActive=true;this.isFirstExpand=true;this.offset=this.initial_limit;if(this.moreLink){this.moreLink.on("click",this.handleMoreLinkClick.bind(this))}if(this.tcommentContext){this.tcommentContext.on("expanded",this.handleVisible.bind(this))}if(this.isSingleFeaturedComment()&&this.actionBarContext){this.actionBarContext.set("pageFeaturedCommentsLink",this.moreLink)}var e=this.is_root||this.tcommentContext&&this.tcommentContext.get("expanded");this.handleVisible(null,e)},isSingleFeaturedComment:function(){return this.is_root&&this.initial_limit==1&&this.featured_comment_id},handleMoreLinkClick:function(){
if(this.isMoreLinkActive){this.isMoreLinkActive=false;this.pageComment()}},handleVisible:function(e,t){this.$id("@comment_list_wrapper").toggleClass("hidden",!t);if(t&&this.lazy_load_children){this.loadChildren()}if(t&&this.$id("@first_level_placeholder").length){this.loadAllFirstLevel()}},pageComment:function(){var e=this;this.moreLink.addClass("hidden");if(this.isFirstExpand&&this.isSingleFeaturedComment()){d.log("comments_toggled",{comment_type:"answer",object_id:this.object_id})}this.serverCall("page_comment").kwargs({object_id:this.object_id,reply_to_id:this.reply_to_id,level:this.level,offset:this.offset,limit:this.getNextPageLimit(),featured_comment_id:this.featured_comment_id}).success(function(){e.moreLink.removeClass("hidden");e.isMoreLinkActive=true;e.offset=e.getNextPageLimit();if(e.offset===null||e.offset>=e.num_children){e.moreLink.addClass("hidden");e.collapsedLink.removeClass("hidden")}if(e.isFirstExpand&&e.isSingleFeaturedComment()&&e.actionBarContext){e.actionBarContext.set("featuredCommentsPaged",true);
e.actionBarContext.set("showComments",true)}e.isFirstExpand=false}).error(function(){e.moreLink.removeClass("hidden");e.isMoreLinkActive=false}).contentFor(this.$id("@comment_list_first_level_placeholder_"+this.offset),{parentCid:this.cid}).sendOnlyOnce()},getNextPageLimit:function(){if(this.isFirstExpand){return this.offset+this.offsetStep}else{return this.offset+this.nextOffsetStep}},loadChildren:function(){if(!this.lazy_load_children){return}this.lazy_load_children=false;this.serverCall("load_child_list").kwargs({object_id:this.object_id,reply_to_id:this.reply_to_id,level:this.level}).contentFor(this.$id("@comment_list_placeholder"),{parentCid:this.cid}).send()},loadAllFirstLevel:function(){var e=this;if(this.first_level_all_loaded){return}this.first_level_all_loaded=true;this.serverCall("load_all_first_level").kwargs({object_id:this.object_id,reply_to_id:this.reply_to_id,level:this.level,featured_comment_id:this.featured_comment_id}).contentFor(this.$id("@first_level_placeholder"),{
parentCid:this.cid}).send().success(function(t){e.$id("@comment_list_more_link").toggleClass("hidden",false)})}});exports.TComment=t.extend({contextConstructor:function(){return l},parentComment:function(){return this.parent().parent().parent()},onLoad:function(){this.tcommentContext=this.getContext(l);this.loadReplyBox();this.$id("@delete_link").on("click",this.deleteComment.bind(this));this.tcommentContext.on("expanded",this.handleExpand.bind(this));this.tcommentContext.on("visible",this.handleVisible.bind(this));this.tcommentContext.set("expanded",this.force_expanded);this.tcommentContext.set("visible",true);this.expandOnNotif();a(this.$id("@comment"));s()},loadReplyBox:function(){if(this.deleted){return}this.serverCall("get_reply_box").contentFor(this.$id("@reply_box_wrapper").get(0),{parentCid:this.cid,useLoadingSpinner:false}).send({batched:true})},addNotifHighlight:function(e){e.addClass("highlighter");var t=false;var i=function(){var t=e.offset().top;var i=t+e.height();var n=$(window).scrollTop();
var s=n+$(window).height();return i>=n&&t<=s};var n=i();var s=function(){t=true};$(window).scroll(s);var o=setInterval(function(){if(t){var r=i();if(n&&!r){e.removeClass("highlighter");clearInterval(o);$(window).unbind("scroll",s)}n=r;t=false}},500)},expandOnNotif:function(){if(r("comment"+this.id)){var e=this;while(!e.is_root){e.tcommentContext.set("expanded",true);e=e.parentComment()}this.addNotifHighlight(this.$id("@comment_highlight_wrapper"))}},deleteComment:function(e){var t=this;e.preventDefault();this.dialog().title(this.delete_dialog_title).cancel(null,this.delete_dialog_cancel_button_text).ok(function(){t.serverCall("delete_comment").kwargs({cid:t.id,oid:t.object_id}).liveMutate().send()},this.delete_dialog_title).html(this.delete_dialog_message)},handleExpand:function(e,t){this.$id("@comment_inner").toggleClass("expanded",t)},handleVisible:function(e,t){this.$id("@comment").toggleClass("hidden",!t)}});exports.TCommentReplyBox=t.extend({onLoad:function(){var e=this;this.isSubmittingComment=false;
this.editor=this.child("editor");if(this.editor){this.editor.setMeaningfulChangeCallback(n(this.save_draft.bind(this),1e3,{maxWait:6e4}))}this.isInitialLoad=true;this.tcommentContext=this.getContext(l);this.tcommentContext.on("showReplyBox",function(t,i){e.$id("@reply_box").toggleClass("hidden",!i);if(i){e.maybeFocusEditor()}});this.$id("@add_comment_link").on("click",function(t){t.preventDefault();e.addComment()});this.tcommentContext.set("showReplyBox",false);this.$id("@reply_box").on("focusout",function(){if(e.editor.isEmpty()){e.tcommentContext.set("showReplyBox",false)}})},maybeFocusEditor:function(){var e=this;setTimeout(function(){if(e.editor){e.editor.focus()}},0)},addComment:function(){var e=this;this.tcommentContext.set("showReplyBox",false);if(this.editor.isOnlyWhiteSpace()){return}var t=this.editor.serialize();this.isSubmittingComment=true;this.serverCall("add_comment").kwargs({oid:this.object_id,comment:t,reply_to_id:this.reply_to_id}).success(function(t){e.tcommentContext.set("expanded",true);
e.editor.clear();e.isSubmittingComment=false}).error(function(){e.isSubmittingComment=false}).liveMutate().sendOnlyOnce()},save_draft:function(){if(!this.isSubmittingComment){if(this.isInitialLoad){this.isInitialLoad=false;return}this.serverCall("save_draft").kwargs({content:this.editor.serialize(),window_id:i.windowId,draft_space:this.draft_space}).send()}}});exports.TCommentAddRoot=t.extend({onLoad:function(){var e=this;this.editor=this.child("editor");if(this.editor){this.editor.setMeaningfulChangeCallback(n(this.save_draft.bind(this),1e3,{maxWait:6e4}))}this.isSubmittingComment=false;this.$addRootLink=this.$id("@add_root_link");this.$addRootLink.on("click",function(t){t.preventDefault();e.addComment()})},addComment:function(){var e=this;if(this.editor.isOnlyWhiteSpace()){return}this.isSubmittingComment=true;this.serverCall("add_comment").kwargs({oid:this.object_id,comment:this.editor.serialize()}).success(function(t){e.editor.clear();e.isSubmittingComment=false}).error(function(){e.isSubmittingComment=false;
}).liveMutate().sendOnlyOnce()},save_draft:function(){if(!this.isSubmittingComment){this.serverCall("save_draft").kwargs({content:this.editor.serialize(),window_id:i.windowId,draft_space:this.draft_space}).send()}}});exports.TCommentRepliesCollapsed=t.extend({onLoad:function(){var e=this;this.tcommentContext=this.getContext(l);this.tcommentContext.on("expanded",function(t,i){e.setHidden(i)});this.$id("@show_child_link").on("click",function(t){t.preventDefault();e.tcommentContext.set("expanded",true)});this.setHidden(this.tcommentContext.get("expanded"))},setHidden:function(e){this.$id("@show_child_link_wrapper").toggleClass("hidden",e)}});exports.AnswerTCommentRepliesCollapsedInFeed=exports.TCommentRepliesCollapsed.extend({onLoad:function(){var e=this;e.actionBarContext=e.getContext(o.ActionBar);e.$id("@show_child_link").on("click",function(t){e.actionBarContext.set("featuredCommentExpanded",true);e.serverCall("load_featured_comments").kwargs({object_id:e.object_id,comment_id:e.id}).contentFor(e.ge("@show_child_link_wrapper"),{
parentCid:e.cid}).success(function(){e.$id("@show_child_link_wrapper").addClass("background")}).send();t.preventDefault()})}});exports.TCommentActionBar=t.extend({onLoad:function(){var e=this;this.tcommentContext=this.getContext(l);this.tcommentContext.on("showReplyBox",function(t,i){e.toggleActionBar(i)});this.toggleActionBar(e.tcommentContext.get("showReplyBox"));this.$id("@comment_downvote").on("click",function(t){t.preventDefault();e.vote(false,false)});this.$id("@comment_upvote").on("click",function(t){t.preventDefault();e.vote(true,false)});this.$id("@comment_downvote_cancel").on("click",function(t){t.preventDefault();e.vote(false,true)});this.$id("@comment_upvote_cancel").on("click",function(t){t.preventDefault();e.vote(true,true)});this.$id("@show_reply_box_link").focus(this.startEditing.bind(this));this.$id("@show_reply_box_link").on("click",function(t){t.preventDefault();e.startEditing()});this.$id("@show_reply_box_link").on("mousedown",function(t){t.preventDefault();e.startEditing();
})},toggleActionBar:function(e){this.$id("@action_bar").toggleClass("hidden",e)},vote:function(e,t){this.serverCall("comment_vote").kwargs({oid:this.object_id,cid:this.id,is_upvote:e,cancel:t}).liveMutate().sendOnlyOnce()},startEditing:function(){this.tcommentContext.set("showReplyBox",true)}});exports.TCommentStandalone=t.extend({onLoad:function(){this.$id("@change_log_toggle").on("click",this.toggleCommentLog.bind(this))},toggleCommentLog:function(e){e.preventDefault();this.$id("@comment_log").toggleClass("hidden");this.$id("@view_label").toggleClass("hidden")}});exports.DeleteCommentButton=t.extend({onLoad:function(){var e=this;this.$id("@delete").click(function(t){e.deleteComment();return false})},deleteComment:function(){this.serverCall("delete").liveMutate().send()}})});define("app/view/topic",["shared/polyfills","webnode2","shared/cookies","view/dialog","tooltip","shared/w2.context","shared/action_log","settings"],function un(require,exports,e){var t=require("webnode2").Component,i=require("shared/cookies"),n=require("view/dialog"),s=require("tooltip"),o=require("shared/w2.context"),r=require("shared/action_log"),a=require("settings").interface_strings;
exports.TopicAliases=t.extend({onLoad:function(){var e=this;var t=this.addAliasSubmit.bind(this);this.$id("@topic_alias_add").click(t);this.$id("@topic_alias_add_form").submit(t);this.$id("@show_alias_link").click(function(t){t.preventDefault();e.$id("@add_topic_alias").show();e.$id("@show_alias").hide();e.$id("@topic_alias_input").focus()})},get_value:function(){return this.$id("@topic_alias_input").val()},addAliasSubmit:function(){this._request(this.get_value());return false},_request:function(e){var t=this;if(!this.tid||!e){return false}this.serverCall("add_topic_alias").kwargs({tid:this.tid,alias:e}).success(function(){t.$id("@topic_alias_input").val("");t.$id("@topic_alias_input").focus()}).liveMutate().send()}});exports.TopicAlias=t.extend({onLoad:function(){var e=this;this.$id("@topic_alias_remove").click(function(){e.dialog().title(e.dialog_title).cancel().ok(function(){e._request()}).text(e.dialog_contents);return false})},_request:function(){if(!this.tid||!this.alias){return false;
}this.serverCall("remove_topic_alias").kwargs({tid:this.tid,alias:this.alias}).liveMutate().send()}});exports.TopicDelete=t.extend({onLoad:function(){var e=this;this.$id("@delete_topic_link").click(function(){e.showDialog(true);return false});this.$id("@undelete_topic_link").click(function(){e.showDialog(false);return false})},getKwargs:function(e){return{tid:this.tid,comment:e.serialize()}},showDialog:function(e){var t=this.title;var i=e?"delete_topic":"undelete_topic";var n=e?"delete_dialog":"undelete_dialog";var s=this;s.dialog().title(t).ok(function(e){var t=e.dialogComponent.child("editor");if(t.isOnlyWhiteSpace()){return false}s.serverCall(i).kwargs(s.getKwargs(t)).liveMutate().send()},a.ok).cancel(null,a.cancel).load(n)}});exports.TopicFollowButton=t.extend({onLoad:function(){var e=this.follow.bind(this);var t=this.unfollow.bind(this);this.$id("@follow").click(e);this.$id("@unfollow").click(t);if(this.tooltip){s.attach(this.$id("@follow"),this.tooltip_text)}},follow:function(e){i.setQfeedLog(this,"TopicFollow");
i.setQueryLog(this,"TopicFollow");i.setTlog({type:"TopicFollow",tid:this.tid});r.logSecondaryAction("TopicFollow",{type:"topic",tid:this.tid});this.serverCall("follow").kwargs({tid:this.tid}).liveMutate().send();e.preventDefault()},unfollow:function(e){this.serverCall("unfollow").kwargs({tid:this.tid}).liveMutate().send();e.preventDefault()}});exports.AdultTopicFollowButton=n.DialogLink.extend({onLoad:function(){var e=this;this._super.apply(this,arguments);this.$id("@link").click(function(){e.serverCall("follow").liveMutate().send();return false})}});exports.TopicNameLinkBase=t.extend({onLoad:function(){var e=this;this.$id("@link").mousedown(function(){i.setQfeedLog(e,"TopicClickthrough");i.setQueryLog(e,"TopicClickthrough")})}});exports.HoverTopicMenuMuteLink=t.extend({onLoad:function(){this.hoverMenuContext=this.getContext(o.HoverMenu);this.$link=this.$id("@link");var e=this;this.$link.on("click",function(){var t=e.$link.hasClass("topic_muted");if(t){e.serverCall("unmute").liveMutate().send();
}else{if(e.hoverMenuContext){e.hoverMenuContext.set("hidden",true)}e.serverCall("mute").liveMutate().send()}return false})}});exports.TopicTrendingIndicator=t.extend({onLoad:function(){s.attach(this.$id("@trending"),this.tooltipText)}})});define("app/view/topic/edit_topic_modal",["shared/polyfills","webnode2","shared/events/index"],function hn(require,exports,e){var t=require("webnode2").Component,i=require("shared/events/index");exports.EditTopicsList=t.extend({onLoad:function(){var e=this;this.handleEvent(i.Types.TOPIC_LIST_REMOVE,function(t){e.removeTid(t.payload.tid)})},removeTid:function(e){this.serverCall("remove").kwargs({tid:e}).liveMutate().send()}});exports.EditTopicsLink=t.extend({onLoad:function(){var e=this;this.$id("@edit_topics").click(function(t){e.modal("load_modal");t.preventDefault()})}});exports.TopicRow=t.extend({onLoad:function(){var e=this;this.$id("@remove_topic").on("click",function(t){t.preventDefault();e.emitEvent({type:i.Types.TOPIC_LIST_REMOVE,payload:{tid:e.tid
}})})}})});define("view/reorderable_list",["shared/polyfills","webnode2","shared/events/index","tooltip","interface/jquery"],function fn(require,exports,e){var t=require("webnode2").Component,i=require("shared/events/index"),n=require("tooltip"),$=require("interface/jquery")._jQuery;var s=document.createElement("div");var o="webkitTransition"in s.style?"webkitTransition":"transition";var r="webkitTransform"in s.style?"webkitTransform":"transform";var a=r==="webkitTransform"?"-webkit-transform":"transform";var d="webkitUserSelect"in s.style?"webkitUserSelect":"userSelect";s.style[r]="translateZ(0)";var l=s.style[r]?"translateZ(0) ":"";var c=s.style[r]?"translateZ(1px) ":"";function u(e){var t=e.style[r];if(t){return{value:t,original:t}}if(window.getComputedStyle){var i=window.getComputedStyle(e).getPropertyValue(a);if(i&&i!=="none"){return{value:i,original:""}}}return{value:"",original:""}}function h(e){var t=e.ownerDocument&&e.ownerDocument.defaultView&&e.ownerDocument.defaultView.getComputedStyle&&e.ownerDocument.defaultView.getComputedStyle(e,null),i=t&&t.getPropertyValue("height")||"";
if(i&&i.indexOf(".")>-1){i=parseFloat(i)+parseInt(t.getPropertyValue("padding-top"))+parseInt(t.getPropertyValue("padding-bottom"))+parseInt(t.getPropertyValue("border-top-width"))+parseInt(t.getPropertyValue("border-bottom-width"))}else{i=e.offsetHeight}return i}function f(){if(window.getSelection){if(window.getSelection().empty){window.getSelection().empty()}else if(window.getSelection().removeAllRanges){window.getSelection().removeAllRanges()}}else if(document.selection){document.selection.empty()}}exports.ReorderableList=t.extend({onLoad:function(){this.pageRoots=$(".Standard2ColLayout").add($(".ContentPageFeed").parent());var e=this;this.handleEvent(i.Types.REORDERABLE_LIST_ITEM_UPDATE,function(){if(e.is_editing){e.detach();e.attach()}e.showErrorOnLiveUpdate()});this.handleEvent(i.Types.REORDERABLE_LIST_ITEM_ACTIVE,function(){if(e.$id("@wrapper").hasClass("is_editing")){e.resetActiveState()}})},isOnDragActive:false,enableLocalUpdate:true,onStartSectionMousedownCallback:null,onEndSectionMousedownCallback:null,
onStartSubsectionMousedownCallback:null,onEndSubsectionMousedownCallback:null,onStartSectionMousemoveCallback:null,onEndSectionMousemoveCallback:null,onStartSubsectionMousemoveCallback:null,onEndSubsectionMousemoveCallback:null,onStartSectionMouseupCallback:null,onEndSectionMouseupCallback:null,onStartSubsectionMouseupCallback:null,onEndSubsectionMouseupCallback:null,setToDefaultView:function(){this.target.node.style[d]="";this.target.node.style[o]="";this.target.node.style[r]=this.target.baseTransform.original;this.target.node.style.zIndex="";document.body.removeChild(this.targetNodeClone);this.targetNodeClone=null;this.target.node.style.visibility="";for(var e=0;e<this.sectionNodesContainer.length;e++){var t=this.sectionNodes[e][0];t.style.height="";t.style[r]="";t.style[o]="";for(var i=0;i<this.sectionNodesContainer[e].nodes.length;i++){var n=this.sectionNodesContainer[e].nodes[i];n.node.style[r]=n.baseTransform.original;n.node.style[o]=""}}this.pageRoots.removeClass("unselectable");f();
this.removeMouseHandlers()},attach:function(){this.ReorderableList=this.$id("@wrapper")[0];this.otherNodes=[];var e=[];this.sectionNodes=this.$id("@wrapper").find(".ReorderableListBranch").each(function(){e.push($(this).parent())});this.sectionNodes=e;for(var t=0;t<this.sectionNodes.length;t++){var i=this.sectionNodes[t].find(".ReorderableListContents .drag_icon");for(var n=0;n<i.length;n++){var s=i[n];var o=$(s).closest(".ReorderableListItem").parent();var r={startSectionIndex:t,startSubsectionIndex:s,node:o};$(s).on("mousedown",r,this._onSubsectionMousedown.bind(this))}}},detach:function(){if(this.sectionNodes){for(var e=0;e<this.sectionNodes.length;e++){var t=this.sectionNodes[e].find(".ReorderableListContents .drag_icon");for(var i=0;i<t.length;i++){var n=t[i];$(n).off("mousedown")}}}},updatePosition:function(e,t){this.latestPosition=t;var i=document.body;var n=i.scrollTop;if(n!=i.scrollTop){this.startPosition.y+=n-i.scrollTop}if(this.latestPosition.time-this.previousPosition.time>100){
this.previousPosition=this.latestPosition}},removeMouseHandlers:function(){if(this.mouseHandlersAttached){this.mouseHandlersAttached=false;$(window).off("mousemove");$(window).off("mouseup")}},_onMousedown:function(e){var t=e.data.node[0];this.startSectionIndex=e.data.startSectionIndex;this.startSubsectionIndex=e.data.startSubsectionIndex;this.target={node:t,baseTransform:u(t),height:t.offsetHeight};this.zero=this.target.node.offsetTop+this.target.height/2;this.sectionNodesContainer=[];for(var i=0;i<this.sectionNodes.length;i++){var n;var s=[];var r=this.sectionNodes[i][0];if(this.target.node!==r){r.style[o]=a+" 0.2s ease-in-out"}var d=this.sectionNodes[i].find(".ReorderableListContents .ReorderableListItem");for(var l=0;l<d.length;l++){var c=d.eq(l)[0].parentNode;if(this.target.node!==c){c.style[o]=a+" 0.2s ease-in-out"}n=c.offsetTop;s.push({node:c,baseTransform:u(c),pos:n+(n<this.zero?c.offsetHeight:0)-this.zero})}n=r.offsetTop;this.sectionNodesContainer.push({nodes:s,posRelative:n+(n<this.zero?r.offsetHeight:0)-this.zero,
pos:r.getBoundingClientRect().top+window.pageYOffset-r.clientTop,height:h(r)})}var f={x:e.pageX,y:e.pageY,time:e.timeStamp};this.startTransformPosition=e.clientY;this.startPosition=this.previousPosition=this.latestPosition=f;this.targetNodeClone=this.target.node.cloneNode(true);this.target.node.style.visibility="hidden";var p=this.target.node.getBoundingClientRect();this.targetNodeClone.style.position="fixed";this.targetNodeClone.style.top=p.top+"px";this.targetNodeClone.style.left=p.left+"px";this.targetNodeClone.style["background-color"]="#fff";document.body.appendChild(this.targetNodeClone)},_onSectionMousedown:function(e){if(typeof this.onStartSectionMousedownCallback==="function"){this.onStartSectionMousedownCallback()}this._onMousedown(e);if(typeof this.onEndSectionMousedownCallback==="function"){this.onEndSectionMousedownCallback(this.target.node,this.targetNodeClone)}this._onSectionMousemove(e);if(!this.mouseHandlersAttached){this.mouseHandlersAttached=true;$(window).on("mousemove",this._onSectionMousemove.bind(this));
$(window).on("mouseup",this._onSectionMouseup.bind(this))}},_onSubsectionMousedown:function(e){if(typeof this.onStartSubsectionMousedownCallback==="function"){this.onStartSubsectionMousedownCallback()}this._onMousedown(e);if(typeof this.onEndSubsectionMousedownCallback==="function"){this.onEndSubsectionMousedownCallback(this.targetNodeClone,this.startSectionIndex)}this._onSubsectionMousemove(e);if(!this.mouseHandlersAttached){this.mouseHandlersAttached=true;$(window).on("mousemove",this._onSubsectionMousemove.bind(this));$(window).on("mouseup",this._onSubsectionMouseup.bind(this))}},_onMousemove:function(e){this.isOnDragActive=true;this.updatePosition(e,{x:e.pageX,y:e.pageY,time:e.timeStamp});this.transformY=e.clientY;this.scrollIfNearEdge(this.transformY);this.pageRoots.addClass("unselectable");var t=this.transformY-this.startTransformPosition;this.target.node.style[r]="translate(0, "+t+"px) "+c+this.target.baseTransform.value;this.targetNodeClone.style[r]=this.target.node.style[r]},_onSectionMousemove:function(e){
if(typeof this.onStartSectionMousemoveCallback==="function"){this.onStartSectionMousemoveCallback()}this._onMousemove(e);var t=this.getTotalMovement();var i=this.target.node.offsetHeight;for(var n=0;n<this.sectionNodesContainer.length;n++){var s=this.sectionNodesContainer[n];var o=this.sectionNodes[n][0];var a=0;if(s.posRelative<0&&t.y<0&&s.posRelative>t.y){a=i}else if(s.posRelative>0&&t.y>0&&s.posRelative<t.y){a=-i}if(a){o.style[r]="translate(0,"+a+"px) "+l}else{o.style[r]=""}}if(typeof this.onEndSectionMousemoveCallback==="function"){this.onEndSectionMousemoveCallback()}},_onSubsectionMousemove:function(e){if(typeof this.onStartSubsectionMousemoveCallback==="function"){this.onStartSubsectionMousemoveCallback()}this._onMousemove(e);var t=this.getTotalMovement();var i=this.target.height;for(var n=0;n<this.sectionNodesContainer.length;n++){if(this.latestPosition.y>this.sectionNodesContainer[n].pos&&this.latestPosition.y<(this.sectionNodesContainer[n+1]?this.sectionNodesContainer[n+1].pos:Infinity)){
this.endSectionIndex=n;if(n!==this.startSectionIndex){this.sectionNodes[n][0].style.height=this.sectionNodesContainer[n].height+this.target.height+"px"}else{this.sectionNodes[n][0].style.height=this.sectionNodesContainer[n].height+"px"}}else{if(n===this.startSectionIndex){this.sectionNodes[n][0].style.height=this.sectionNodesContainer[n].height-this.target.height+"px"}else{this.sectionNodes[n][0].style.height=this.sectionNodesContainer[n].height+"px"}}}for(n=0;n<this.sectionNodesContainer.length;n++){var s=this.sectionNodesContainer[n];for(var o=0;o<s.nodes.length;o++){var a=0;var d=s.nodes[o];if(d.pos<0&&t.y<0&&d.pos>t.y){a+=i}else if(d.pos>0&&t.y>0&&d.pos<t.y){a+=-i}if(this.latestPosition.y>s.pos&&n>this.startSectionIndex){a+=i;this.zero=this.target.node.offsetTop+this.target.height/2;var c=d.node.offsetTop;if(t.y>0){d.pos=c+(c<this.zero?d.offsetHeight:0)-this.zero+i}else if(t.y<0){d.pos=c+(c<this.zero?d.offsetHeight:0)-this.zero-i}for(var u=0;u<this.sectionNodes.length;u++){this.sectionNodesContainer[u].pos=this.sectionNodes[u][0].getBoundingClientRect().top+window.pageYOffset-this.sectionNodes[u][0].clientTop;
}}d.node.style[r]=a?"translate(0,"+a+"px) "+l+d.baseTransform.value:d.baseTransform.original}}if(typeof this.onEndSubsectionMousemoveCallback==="function"){this.onEndSubsectionMousemoveCallback()}},_onMouseup:function(){this.isOnDragActive=false;$("html, body").stop()},_onSectionMouseup:function(){if(typeof this.onStartSectionMouseupCallback==="function"){this.onStartSectionMouseupCallback()}this._onMouseup();var e=this.getTotalMovement();var t;if(e.y<0){for(t=0;t<this.sectionNodesContainer.length;t++){if(this.sectionNodesContainer[t].posRelative>e.y){this.endSectionIndex=t;if(this.enableLocalUpdate){this.target.node.parentNode.insertBefore(this.target.node,this.sectionNodes[this.endSectionIndex])}break}}}else{for(t=this.sectionNodesContainer.length-1;t>=0;t--){if(this.sectionNodesContainer[t].posRelative<e.y){if(this.startSectionIndex===t+1){this.endSectionIndex=t+1}else{this.endSectionIndex=t}if(this.enableLocalUpdate){this.target.node.parentNode.insertBefore(this.target.node,this.sectionNodes[t+1]?this.sectionNodes[t+1]:null);
}break}}}this.removeMouseHandlers();if(!this.enableLocalUpdate){var i=this.targetNodeClone.getBoundingClientRect().left;this.targetNodeClone.style[r]="";this.targetNodeClone.style.position="absolute";this.targetNodeClone.style.left=i;var n;var s=$(window).scrollTop();if(this.endSectionIndex!==0){if(e.y<0){n=this.sectionNodes[this.endSectionIndex-1][0];s+=n.getBoundingClientRect().bottom}else{n=this.sectionNodes[this.endSectionIndex][0];s+=n.getBoundingClientRect().bottom}}this.targetNodeClone.style.top=s+"px"}if(typeof this.onEndSectionMouseupCallback==="function"){this.onEndSectionMouseupCallback(this.target.node,this.targetNodeClone,this.endSectionIndex,this.startSectionIndex)}},_onSubsectionMouseup:function(){this.removeMouseHandlers();if(typeof this.onStartSubsectionMouseupCallback==="function"){this.onStartSubsectionMouseupCallback(this.target.node,this.endSubsectionIndex,this.startSubsectionIndex)}this._onMouseup();var e;var t=this.sectionNodesContainer[this.endSectionIndex].nodes;
var i=this.getTotalMovement();if(t.length===0){if(this.enableLocalUpdate){this.sectionNodes[this.endSectionIndex].querySelector("div.nested_contents").firstChild.appendChild(this.target.node)}this.endSubsectionIndex=0}else{if(i.y<0){if(t[t.length-1].pos+this.target.height>i.y){if(this.localUpdate){this.sectionNodes[this.endSectionIndex].querySelector("div.nested_contents").firstChild.insertBefore(this.target.node,t[t.length-1].node.nextSibling)}this.endSubsectionIndex=t.length}for(e=0;e<t.length;e++){if(t[e].pos>i.y){this.endSubsectionIndex=e;if(this.localUpdate){this.sectionNodes[this.endSectionIndex].querySelector("div.nested_contents").firstChild.insertBefore(this.target.node,t[e].node)}break}}}else{if(t[0].pos>i.y){if(this.localUpdate){this.sectionNodes[this.endSectionIndex].querySelector("div.nested_contents").firstChild.insertBefore(this.target.node,t[0].node)}this.endSubsectionIndex=0}for(e=t.length-1;e>=0;e--){if(t[e].pos<i.y){if(this.endSectionIndex===this.startSectionIndex&&e+1!==this.startSubsectionIndex){
this.endSubsectionIndex=e}else{this.endSubsectionIndex=e+1}if(this.localUpdate){this.sectionNodes[this.endSectionIndex].querySelector("div.nested_contents").firstChild.insertBefore(this.target.node,t[e+1]?t[e+1].node:null)}break}}}}if(!this.enableLocalUpdate){var n=this.targetNodeClone.getBoundingClientRect().left;this.targetNodeClone.style[r]="";this.targetNodeClone.style.position="absolute";this.targetNodeClone.style.left=n;var s;var o=$(window).scrollTop();if(this.endSubsectionIndex===0||this.sectionNodesContainer[this.endSectionIndex].nodes.length===0){s=$(this.sectionNodes[this.endSectionIndex])[0];o+=s.getBoundingClientRect().top}else if(i.y<0){s=this.sectionNodesContainer[this.endSectionIndex].nodes[this.endSubsectionIndex-1].node;o+=s.getBoundingClientRect().bottom}else{if(this.endSectionIndex!==this.startSectionIndex){s=this.sectionNodesContainer[this.endSectionIndex].nodes[this.endSubsectionIndex-1].node}else{s=this.sectionNodesContainer[this.endSectionIndex].nodes[this.endSubsectionIndex].node;
}o+=s.getBoundingClientRect().bottom}this.targetNodeClone.style.top=o+"px"}if(typeof this.onEndSubsectionMouseupCallback==="function"){this.onEndSubsectionMouseupCallback(this.target.node,this.targetNodeClone,this.endSubsectionIndex,this.startSubsectionIndex,this.endSectionIndex,this.startSectionIndex)}},scrollIfNearEdge:function(e){if(this.isOnDragActive){if(e+50>$(window).height()){$("html, body").stop().animate({scrollTop:$(document).height()},6e3,"linear")}else if(e<100){$("html, body").stop().animate({scrollTop:0},6e3,"linear")}else{$("html, body").stop()}}},getTotalMovement:function(){return{x:this.latestPosition.x-this.startPosition.x,y:this.latestPosition.y-this.startPosition.y}}});exports.ReorderableListContents=t.extend({onLoad:function(){if(this.separator_tooltip_content){n.attach(this.$id("@separator"),this.separator_tooltip_content)}}});exports.ReorderableListItem=t.extend({onLoad:function(){var e=this;this.emitEvent({type:i.Types.REORDERABLE_LIST_ITEM_UPDATE,payload:{}});e.$id("@remove").click(function(){
e.remove();return false});e.$id("@item").mousedown(function(){e.emitEvent({type:i.Types.REORDERABLE_LIST_ITEM_ACTIVE,payload:{}});$(this).addClass("active").focus()})},remove:function(){this.serverCall("remove").liveMutate().send()}})});define("app/view/topic/faq",["shared/polyfills","webnode2","interface/jquery","shared/events/index","view/selector","view/reorderable_list","view/modal","shared/action_log"],function pn(require,exports,e){var t=require("webnode2").Component,$=require("interface/jquery")._jQuery,i=require("shared/events/index"),n=require("view/selector").WithServerCallMessageMixin,s=require("view/reorderable_list").ReorderableList,o=require("view/reorderable_list").ReorderableListContents,r=require("view/reorderable_list").ReorderableListItem,a=require("view/modal").Base,d=require("shared/action_log"),l=d.ActionableComponent;exports.TopicFaqMainListWrapper=l.extend({onLoad:function(){this._super.apply(this,arguments);this.$id("@actionable").off("mousedown");this.$id("@actionable").off("click");
}});exports.TopicFaqSubPageMainList=s.extend({onLoad:function(){this._super.apply(this,arguments);if(this.user_can_edit){this.setEditLink();this.update();this.bindClickHandler();this.updateToc()}this.updateFixable();var e=this;this.handleEvent(i.Types.REORDERABLE_LIST_TOGGLE_EDIT,function(){e.toggleEditMode()});this.handleEvent(i.Types.TOPIC_FAQ_HIGHLIGHT_QUESTION,function(t){if(!e.is_editing){return}var i=["div[sid='",t.payload.section_id,"']","[oid='",t.payload.qid,"']"].join("");$(i).addClass("highlighted")})},enableLocalUpdate:false,resetActiveState:function(){this.$id("@wrapper").find(".active").removeClass("active")},update:function(){if(this.is_editing){this.$id("@wrapper").addClass("is_editing");this.attach()}else{this.$id("@wrapper").removeClass("is_editing");this.detach()}this.resetActiveState()},showErrorOnLiveUpdate:function(){if(this.isOnDragActive){this.isOnDragActive=false;$("html, body").stop();var e=this;this.serverCall("show_error_on_liveupdate").send().success(function(){
setTimeout(function(){e.detach();e.attach()},0)})}},toggleEditMode:function(){this.is_editing=!this.is_editing;this.update();this.resetActiveState();this.updateFixable()},editLinkClickCallback:function(){},onEndSectionMousedownCallback:function(e,t){$(t).addClass("dragging_node node_clone_section on_drag");e.style.height=$(t).outerHeight()+"px"},onEndSubsectionMousedownCallback:function(e,t){$(e).addClass("dragging_node node_clone on_drag");if(t<1){$(e).addClass("primary_section")}else{$(e).addClass("sec_section")}},onEndSubsectionMouseupCallback:function(e,t,i,n,s,o){$(t).removeClass("on_drag");$(t).addClass("on_release");if(i===n&&s===o){this.setToDefaultView();return}e=e.firstChild;var r=e.getAttribute("sid");var a=this.sectionNodes[s][0].firstChild.getAttribute("sid");var d=this;if(s===o){this.serverCall("move_question_in_section").kwargs({section_id:parseInt(a),qid:parseInt(e.getAttribute("oid")),new_pos:i}).liveMutate().send().success(function(){d.setToDefaultView()}).error(function(){
d.setToDefaultView();setTimeout(function(){d.detach();d.attach()})})}else{this.serverCall("move_question_across_section").kwargs({section_id:parseInt(a),old_section_id:parseInt(r),qid:parseInt(e.getAttribute("oid")),new_pos:i}).liveMutate().send().success(function(){d.setToDefaultView()}).error(function(){d.setToDefaultView();setTimeout(function(){d.detach();d.attach()})})}},onEndSectionMouseupCallback:function(e,t,i,n){$(t).removeClass("on_drag");$(t).addClass("on_release");if(i<1||i===n){this.setToDefaultView();return}e=e.firstChild;if(i!=n){var s=this;this.serverCall("move_section").kwargs({section_id:parseInt(e.getAttribute("sid")),tid:s.tid,new_pos:i}).liveMutate().send().success(function(){s.setToDefaultView()})}},updateFixable:function(){},setEditLink:function(){},bindClickHandler:function(){},updateToc:function(){}});exports.TopicFaqMainListEditLink=l.extend({onLoad:function(){this._super.apply(this,arguments);var e=this;this.$id("@edit").on("click",function(t){t.preventDefault();
e.toggleMainListEditMode()});this.$id("@done").on("click",function(t){t.preventDefault();e.toggleMainListEditMode()})},toggleMainListEditMode:function(){this.emitEvent({type:i.Types.REORDERABLE_LIST_TOGGLE_EDIT,payload:{}})}});exports.TopicFaqContents=o.extend({onLoad:function(){this._super.apply(this,arguments);this.emitEvent({type:i.Types.REORDERABLE_LIST_ITEM_UPDATE,payload:{}});var e=this;document.addEventListener("mousedown",function(){e.emitEvent({type:i.Types.REORDERABLE_LIST_ITEM_ACTIVE,payload:{}})},true);this.handleEvent(i.Types.TOPIC_FAQ_VIEW_MORE,function(){e.$id("@contents_wrapper").addClass("show_hidden_items")})}});exports.TopicSection=t.extend({onLoad:function(){this.handleEvent(i.Types.REORDERABLE_LIST_TOGGLE_EDIT,this.focusSelector.bind(this))},focusSelector:function(){this.child("selector").$input.focus()}});exports.RecentlyAddedQuestionHighlighter=t.extend({onLoad:function(){this.emitEvent({type:i.Types.TOPIC_FAQ_HIGHLIGHT_QUESTION,payload:{section_id:this.section_id,
qid:this.highlight_question}})}});exports.TopicSectionEmptyState=t.extend({onLoad:function(){var e=this;this.$id("@add_question").on("click",function(t){t.preventDefault();e.emitEvent({type:i.Types.REORDERABLE_LIST_TOGGLE_EDIT,payload:{}})})}});var c=false;exports.TopicFaqViewMoreLabel=t.extend({onLoad:function(){var e=this;e.$id("@view_more").click(function(t){c=true;t.preventDefault();e.expand()});if(c){e.expand()}},expand:function(){this.emitEvent({type:i.Types.TOPIC_FAQ_VIEW_MORE,payload:{}});this.$id("@view_more").removeClass("view_mode_only");this.$id("@view_more").addClass("hidden")}});exports.TopicSectionQuestionItem=r.extend({remove:function(){this.modal("remove")}});exports.TopicFaqRemoveQuestionWarning=a.extend({onSubmit:function(){var e=this;e.serverCall("remove").liveMutate().success(function(){e._closeModal()}).sendOnlyOnce()}});exports.TopicFaqQuestionSelector=n.extend({onLoad:function(){var e=this;e._super.apply(e,arguments);e.questionMarkInserted=false},resultsServerCallHandler:function(){
this._super.apply(this,arguments);this.$input.focus()},createNewQuestion:function(){var e=this;if(e.hasPendingServerCall()){return}d.logPrimaryAction("WebTopicFaqMainListWrapperQuestionAdd",e.impression_target);e.makeServerCall(e.serverCall("create_new_question").kwargs({input_text:e.query}).liveMutate())},addExistingQuestion:function(e){var t=this;if(t.hasPendingServerCall()){return}t.makeServerCall(t.serverCall("add_existing_question").kwargs({qid:e}).liveMutate())},maybeInsertQuestionMark:function(){if(this.query==="?"&&this.questionMarkInserted){this.setQuery("");this.questionMarkInserted=false;return}if(!this.query){this.questionMarkInserted=false;return}if(this.questionMarkInserted){return}if(this.query.match(/[?]$/)===null){this.questionMarkInserted=true;this.setQuery(this.query+"?")}},queryDidChange:function(){this._super.apply(this,arguments);this.maybeInsertQuestionMark()},resultWasSelected:function(e){switch(e.ty){case"question":this.addExistingQuestion(e.data.qid);break;case"create_question":
this.createNewQuestion();break}},updateServerMessage:function(e,t){if(e){if(!this.faq_is_empty){this.setQuery("")}}else{if(t&&t["message"]){this.$id("@server_message_title").text(t["message"]["title"]);if(t["message"]["note"]){this.$id("@server_message_note").text(t["message"]["note"])}return true}}return false}})});define("app/view/topic/flag",["shared/polyfills","view/dialog"],function gn(require,exports,e){var t=require("view/dialog");exports.EnableFAQFlagOverflowDialog=t.AddCommentDialog.extend({submitServerCall:function(e){var t=this;this.serverCall("dialog_submit_controller").kwargs(e).success(function(e){window.location.href=e;t.close()}).send()}})});define("app/view/topic/leaderboard",["shared/polyfills","webnode2","shared/window_manager"],function mn(require,exports,e){var t=require("webnode2").Component,i=require("shared/window_manager");exports.HideFromProfileLink=t.extend({onLoad:function(){var e=this;e.$id("@hide_from_profile").click(function(t){e.serverCall("hide_from_profile").success(function(){
e.$("%@link").toggleClass("hidden")}).send();t.preventDefault()});e.$id("@show_on_profile").click(function(t){e.serverCall("show_on_profile").success(function(){e.$("%@link").toggleClass("hidden")}).send();t.preventDefault()})}});exports.LeaderboardStatus=t.extend({onLoad:function(){var e=this;e.$id("@refresh_link").click(function(t){t.preventDefault();e.refreshLeaderboard()})},refreshLeaderboard:function(){var e=this;e.serverCall("refresh_leaderboard").kwargs({tid:e.tid}).success(function(){e.$id("@refresh_link").addClass("completed").text("Refreshing completed. (Reloading the page)");i.reload()}).error(function(){e.$id("@refresh_link").addClass("completed").text("Refreshing failed! Reload to retry.")}).send();e.$id("@refresh_link").addClass("completed").text("Refreshing started...")}});exports.AddToBlacklistMVW=t.extend({onLoad:function(){var e=this;e.$id("@add_link").click(function(t){t.preventDefault();e.update(false)});e.$id("@remove_link").click(function(t){t.preventDefault();e.update(true);
})},update:function(e){var t=this;t.serverCall("update").kwargs({tid:t.tid,is_removal:e}).success(function(){if(e===true){t.$id("@remove_link").addClass("completed").text("Removed")}else{t.$id("@add_link").addClass("completed").text("Added")}}).send()}})});define("app/view/topic/location",["shared/polyfills","webnode2"],function vn(require,exports,e){var t=require("webnode2").Component;exports.TopicLocationPreview=t.extend({onLoad:function(){var e=this;this.$id("@enlarge_map").click(function(){e.$id("@enlarge_map").hide();e.$id("@wrapper").css("height","auto");e.$id("@wrapper").css("width","auto");e.$id("@wrapper").removeClass("mask");e.$id("@content").removeClass("mask_content");e.$id("@content").css("top","0px");e.child("topicmap").child("picker").toggleControls(true);return false})}})});define("app/view/topic/merge",["shared/polyfills","webnode2","app/view/topic_selector","settings"],function _n(require,exports,e){var t=require("webnode2").Component,i=require("app/view/topic_selector").TopicSelector,n=require("settings").interface_strings;
exports.TopicMergeSelector=i.extend({topicWasSelected:function(e){var t=function(t){var i=t.dialogComponent.child("editor");if(i.isOnlyWhiteSpace()){return false}this.serverCall("merge").kwargs({to_tid:e,from_tid:this.from_tid,comment:i.serialize()}).liveMutate().send()}.bind(this);this.dialog().title(this.topic_merge_text).ok(t,n.ok).cancel(null,n.cancel).load("merge_dialog")}});exports.TopicMergeUnmerge=t.extend({onLoad:function(){var e=this;if(!this.is_locked_for_user){this.$id("@show_merge").click(function(){e.$id("@merge").removeClass("hidden");e.$id("@show_merge").addClass("hidden");e.child("selector").focus();return false})}}});exports.TopicUnmergeLink=t.extend({onLoad:function(){var e=this;this.$id("@unmerge").click(function(){e.serverCall("unmerge_topic").kwargs({tid:e.tid}).liveMutate().send();return false})}})});define("app/view/topic/topic_create",["shared/polyfills","webnode2","shared/window_manager","w2.dialog","view/selector"],function wn(require,exports,e){var t=require("webnode2").Component,i=require("shared/window_manager"),n=require("w2.dialog").Dialog,s=require("view/selector").Selector,o=require("view/selector").NavigateToResultUrlSelectorMixin;
exports.TopicNavigateSelector=s.extend(o);exports.TopicCreateMain=t.extend({onLoad:function(){var e=this;this.submitted=false;this.$id("@fake_editor").click(function(){e.$id("@fake_editor_row").hide();e.$id("@editor_row").show();e.child("editor").focus();return false});this.$id("@create").click(function(){var t=e.getTopicName();if(!t||/^\s+$/.test(t)||e.submitted){return false}e.submitted=true;var n=e.child("editor").serialize();e.serverCall("create_topic").kwargs({topic_name:t,about:n}).success(function(e){if(i.sameDomainURL(e)){document.location=e}}).liveMutate().send()});this.$id("@cancel").click(function(){e.cancelClicked();return false})},getTopicName:function(){return this.child("selector").query},cancelClicked:function(){}});exports.TopicCreateDialog=exports.TopicCreateMain.extend({cancelClicked:function(){n.dialogFor(this).close_()}})});define("app/view/topic/topic_list",["shared/polyfills","webnode2","tooltip"],function bn(require,exports,e){var t=require("webnode2").Component,i=require("tooltip");
exports.TopicListItem=t.extend({onLoad:function(){var e=this;i.attach(this.$id("@remove_topic"),this.remove_tooltip_text);this.$id("@remove_topic").click(function(t){e.serverCall("remove_topic").liveMutate().send();t.preventDefault()});this.$id("@remove_topic").hover(function(){e.$id("@topic_list_item").addClass("hover")},function(){e.$id("@topic_list_item").removeClass("hover")})}});exports.QuestionTopicHorizontalList=t.extend({onLoad:function(){var e=this;e.$id("@modal_link").on("click",function(t){e.modal("load_inner");t.preventDefault()})}})});define("app/view/topic/topic_ontology",["shared/polyfills","webnode2"],function yn(require,exports,e){var t=require("webnode2").Component;exports.AddTopicParent=t.extend({onLoad:function(){var e=this;this.$id("@existing_link").click(function(t){t.preventDefault();e.$id("@existing_link").addClass("hidden");e.$id("@existing").removeClass("hidden");e.child("parent_selector").focus()})}});exports.AddTopicChildren=t.extend({onLoad:function(){var e=this;
this.$id("@existing_link").click(function(t){t.preventDefault();e.$id("@existing_link").addClass("hidden");e.$id("@existing").removeClass("hidden");e.child("child_selector").focus()})}});exports.OrganizeChildItem=t.extend({onLoad:function(){var e=this;e.$id("@remove").click(function(t){t.preventDefault();e.serverCall("remove_topic").liveMutate().send()})},toggleInstruction:function(){this.$id("@instruction").toggleClass("hidden")}});exports.ManageParentTopicsLink=t.extend({onLoad:function(){var e=this;e.$id("@link").click(function(t){t.preventDefault();e.modal("load")})}})});define("app/view/topic/topic_redesign",["shared/polyfills","webnode2","shared/events/index"],function Cn(require,exports,e){var t=require("webnode2").Component,i=require("shared/events/index");exports.TopicPhotoCard=t.extend({onLoad:function(){var e=this;e.$id("@card").click(function(t){e.onCardClick();return false})},onCardClick:function(){this.isSelected=!this.isSelected;if(this.isSelected){this.select()}else{this.deselect();
}},select:function(){this.$id("@card").addClass(this.selectClass);this.emitEvent({type:i.Types.TOPICS_GRID_ADD,payload:{tid:this.tid}})},deselect:function(){this.$id("@card").removeClass(this.selectClass);this.emitEvent({type:i.Types.TOPICS_GRID_REMOVE,payload:{tid:this.tid}})}})});define("app/view/tumblr",["shared/polyfills","webnode2"],function xn(require,exports,e){var t=require("webnode2").Component;exports.TumblrCallbackPage=t.extend({onLoad:function(){if(window.opener){if(this.url){window.opener.$(window.opener.document).trigger("tumblr_oauth_approved",this.url);window.close()}else{alert(this.error_message)}}}})});define("app/view/tutorial",["shared/polyfills","webnode2"],function kn(require,exports,e){var t=require("webnode2").Component;exports.GoToWritepageNotif=t.extend({onLoad:function(){var e=this;window.setTimeout(function(){e.serverCall("send_notif").send()},e.delay*1e3)}})});define("app/view/user",["shared/polyfills","webnode2","interface/jquery","shared/window_manager","tooltip","shared/cookies","view/dialog","shared/events/index","settings","view/modal"],function Sn(require,exports,e){
var t=require("webnode2").Component,$=require("interface/jquery")._jQuery,i=require("shared/window_manager"),n=require("tooltip"),s=require("shared/cookies"),o=require("view/dialog"),r=require("shared/events/index"),a=require("settings"),d=require("view/modal").Base,l=a.interface_strings;exports.AcceptSuggestedSigButton=t.extend({onLoad:function(){var e=this;this.$id("@accept").on("click",function(t){e.accept(t)})},accept:function(e){e.preventDefault();this.serverCall("accept").liveMutate().sendOnlyOnce()}});exports.DiscardSuggestedSigButton=t.extend({onLoad:function(){var e=this;this.$id("@discard").on("click",function(t){e.discard(t)})},discard:function(e){e.preventDefault();this.serverCall("discard").liveMutate().sendOnlyOnce()}});exports.ReviewSuggestedSigButton=t.extend({onLoad:function(){this.$id("@review").click(this.review.bind(this))},review:function(e){e.preventDefault();e.stopPropagation();this.modal("get_editor")}});exports.UserTopicSig=t.extend({onLoad:function(){var e=this;
this.$id("@view").click(function(){e.toggleSuggestion();return false});if(this.isFlagged){var t;if(this.isNotHelpful){t=this.not_helpful_tooltip}else if(this.isNotStandalone){t=this.not_standalone_tooltip}n.attach(this.$id("@sig"),t)}},toggleSuggestion:function(){this.$id("@view").toggle()}});exports.UserStatusMain=t.extend({onLoad:function(){this.admin_log_list=this.$id("@admin_log_scroll_context");this.admin_log_list.on("mouseover",function(){document.body.style.overflowY="hidden"});this.admin_log_list.on("mouseout",function(){document.body.style.overflowY="auto"});this.$(".inline_editor_create").on("click",function(){$(".admin_qtext").addClass("visible")});this.$(".inline_editor_cancel_button").on("click",function(){$(".admin_qtext").removeClass("visible")})}});exports.SigSelectionModal=d.extend({onLoad:function(){var e=this;e.input=e.$id("@input");e.input.on("input",function(){var t=parseInt(e.max_length)-e.input.val().length;if(t<=e.warning_length){e.$id("@limit").text(t)}else{e.$id("@limit").text("");
}});var t=e.input.val();e.input.focus();e.input.val("");e.input.val(t);var i=parseInt(e.max_length)-e.input.val().length;if(i<=e.warning_length){e.$id("@limit").text(i)}else{e.$id("@limit").text("")}e._super.apply(e,arguments)},onSubmit:function(){this.submitSig()},submitSig:function(){var e=this;this.serverCall("update_sig").kwargs({to_uid:this.to_uid,tid:this.tid,sig:this.input.val()}).liveMutate().send();e._closeModal()}});exports.TopicSigSelectionModal=exports.SigSelectionModal.extend({submitSig:function(){var e=this;var t=this.$id("@checkbox").is(":checked");this.serverCall("update_sig").kwargs({to_uid:this.to_uid,tid:this.tid,sig:this.input.val(),experienced:t}).liveMutate().send();e._closeModal()}});exports.TopicSelectionForQuestionModal=exports.TopicSigSelectionModal.extend({submitSig:function(){var e=this;var t=this.$id("@checkbox").is(":checked");this.serverCall("update_sig").kwargs({to_uid:this.to_uid,tid:this.tid,sig:this.input.val(),experienced:t}).success(function(){e.modal("load_multi_topic_selection_modal_for_question");
}).liveMutate().send()},onCancel:function(){this.modal("load_multi_topic_selection_modal_for_question")}});exports.UserBioSelectionModal=d.extend({onLoad:function(){var e=this;e._super.apply(e,arguments);e.input=e.$id("@input");var t=e.input.val();e.input.on("input",function(){var t=parseInt(e.max_length)-e.input.val().length;if(t<=e.warning_length){e.$id("@limit").text(t)}else{e.$id("@limit").text("")}});this.input.focus();this.input.val("");this.input.val(t);var i=parseInt(e.max_length)-e.input.val().length;if(i<=e.warning_length){e.$id("@limit").text(i)}else{e.$id("@limit").text("")}},onSubmit:function(){var e=this;this.serverCall("update_sig").kwargs({sig:this.input.val()}).success(function(){e._closeModal()}).liveMutate().send()}});exports.UserBioInMultiTopicBioModal=exports.UserBioSelectionModal.extend({onSubmit:function(){var e=this;this.serverCall("update_sig").kwargs({sig:this.input.val()}).success(function(){e.modal("load_multi_topic_selection_modal_for_question")}).send()},onCancel:function(){
this.modal("load_multi_topic_selection_modal_for_question")},onClose:function(){this.modal("load_multi_topic_selection_modal_for_question")}});exports.SuggestedTopicModal=d.extend({onLoad:function(){var e=this;e.input=this.$id("@input");e.text=e.input.val();e.canEdit=e.viewer==e.uid;e.input.on("input",function(){var t=parseInt(e.max_length)-e.input.val().length;if(t<=e.warning_length){e.$id("@limit").text(t)}else{e.$id("@limit").text("")}});e.input.focus();e.input.val("");e.input.val(this.text);var t=parseInt(e.max_length)-e.input.val().length;if(t<=e.warning_length){e.$id("@limit").text(t)}else{e.$id("@limit").text("")}e._super.apply(this,arguments)},acceptSig:function(){var e=this;var t=this.$id("@checkbox").is(":checked");this.serverCall("accept").liveMutate().kwargs({experienced:t}).success(function(){e._closeModal()}).send()},discardSig:function(){this.serverCall("discard").liveMutate().send()},onSubmit:function(){if(this.canEdit&&this.input.val()==this.text){this.acceptSig()}else{
this.submitSig()}},submitSig:function(){var e=this;var t=this.$id("@checkbox").is(":checked");this.serverCall("update_sig").liveMutate().kwargs({viewer:this.viewer,sig:this.input.val(),experienced:t}).success(function(){e._closeModal()}).send();return false},onCancel:function(){this.discardSig();this._closeModal()},onClose:function(){this._closeModal()}});exports.QuestionUserSigEditLink=exports.UserSigEditLinkDialog=exports.TopicSigEditLinkDialog=t.extend({onLoad:function(){var e=this;this.$id("@link").click(function(){e.showDialog();return false})},showDialog:function(){this.modal("get_editor");return false}});exports.LinkBioListItem=t.extend({onLoad:function(){var e=this;if(e.tid===0){this.$id("@link").on("click",function(){e.showDialog();return false})}else{this.$id("@link").on("click",function(){e.modal("load_modal");return false})}},showDialog:function(){this.modal("get_editor");return false}});exports.QuestionTopicSigEditLink=t.extend({onLoad:function(){var e=this;this.$id("@link").on("click",function(){
e.modal("load_modal");return false})}});exports.QuestionBioListItem=t.extend({onLoad:function(){var e=this;this.handleEvent(r.Types.QUESTION_BIO_TOPIC_SELECT,function(t){if(t.payload.qid==e.qid&&t.payload.uid==e.uid&&t.payload.tid==e.tid){return}e.unselect()});this.$id("@bio_list_item").on("click",this.select.bind(this))},select:function(){this.emitEvent({type:r.Types.QUESTION_BIO_TOPIC_SELECT,payload:{qid:this.qid,tid:this.tid,uid:this.uid}});this.$id("@bio_list_item").addClass("selected");this.child("radio").select()},unselect:function(){this.$id("@bio_list_item").removeClass("selected");this.child("radio").unselect()}});exports.SetTopicForQuestionLinkSpan=t.extend({select:function(){this.$id("@radio").prop("checked",true);this.serverCall("set_bio").liveMutate().send()},unselect:function(){this.$id("@radio").prop("checked",false)}});exports.ProfileBioListItem=t.extend({onLoad:function(){if(this.isFlagged){var e;if(this.isNotHelpful){e=this.not_helpful_tooltip}else if(this.isNotStandalone){
e=this.not_standalone_tooltip}n.attach(this.$id("@sig"),e)}}});exports.ProfilePhoto=t.extend({toggleSuggestion:function(){}});exports.WantedAnswerDialog=o.Dialog.extend({onLoad:function(e){this._super.apply(this,arguments);this.child("question_selector").focus();this.setSuccessCallback(function(e){if(e){i.navigateTo(e)}})},getPars:function(){var e=this.child("question_selector").getQid();var t=this.child("question_selector").qValue;return{qid:e,text:t}}});exports.UserFollowLink=t.extend({onLoad:function(){var e=this;this.$id("@follow_user").click(function(t){e.follow();t.preventDefault()});this.$id("@unfollow_user").click(function(t){e.unfollow();t.preventDefault()})},follow:function(){s.setQfeedLog(this,"UserFollow");s.setQueryLog(this,"UserFollow");s.setTlog({type:"UserFollow",uid:this.uid});this.serverCall("follow_user").liveMutate().send()},unfollow:function(){s.setQfeedLog(this,"UserUnfollow");s.setQueryLog(this,"UserUnfollow");s.setTlog({type:"UserUnfollow",uid:this.uid});this.serverCall("unfollow_user").liveMutate().send();
}});exports.UserSig=t.extend({onLoad:function(){var e=this;this.$id("@view").click(function(){e.toggleSuggestion();return false})},toggleSuggestion:function(){this.$id("@view").toggle()}});exports.BatchRevertControls=t.extend({onLoad:function(){var e=this;this.$("#@select_all_word").click(function(){e.toggleCheckboxes();if(e.$("#@select_all_word").text()=="Select All"){e.$("#@select_all_word").html("Select None")}else{e.$("#@select_all_word").html("Select All")}return false});this.$("#@revert").click(function(){e.batchRevert();return false})},batchRevert:function(){var e=this;var t=[];this.$(".user_log_operations_to_revert input:checked").each(function(e){t.push($(this).attr("name"))});if(t.length===0){return false}this._dialog=this.dialog().title(this.dialog_title).cancel(null,l.cancel).ok(function(i){var n=i.dialogComponent;var s=n.child("editor");if(s.isOnlyWhiteSpace()){return}var o=s.serialize();e.serverCall("batch_revert").kwargs({revert_strings:t,comment:o}).liveMutate().send()}).load("batch_revert_dialog");
return false},toggleCheckboxes:function(){var e=this.$(".user_log_operations_to_revert .pagedlist_hidden input:not(:disabled)").length;var t=this.$(".user_log_operations_to_revert input:not(:disabled)").length-e;var i=this.$(".user_log_operations_to_revert input:checked").length;if(t!=i){this.$("input:not(:disabled)").prop("checked",true);this.$(".user_log_operations_to_revert .pagedlist_hidden input").each(function(e){$(this).prop("checked",false)})}else{this.$("input:not(:disabled)").prop("checked",false)}},getKwargs:function(e,t){return{revert_strings:e,comment:t.serialize()}}});exports.UnconfirmedEmailBlockedEditor=t.extend({onLoad:function(){var e=this;this.$id("@resend").click(function(){e.serverCall("resend_email_confirmation").send();return false})}})});define("app/view/user/content",["shared/polyfills","interface/jquery","app/view/topic_selector","shared/window_manager","webnode2"],function En(require,exports,e){var $=require("interface/jquery")._jQuery,t=require("app/view/topic_selector").TopicSelector,i=require("shared/window_manager"),n=require("webnode2").Component;
exports.UserContentFilter=n.extend({onLoad:function(){var e=this;this.$id("@filter_links a").click(function(){var t=$(this);if(t.hasClass("selected")){return false}var n=t.attr("value");var s={};s[e.data_key]=n;var o=i.makeUpdatedURL(s);i.navigateTo(o);return false})}});exports.UserContentFilterTopics=n.extend({onLoad:function(){var e=this;this.$id("@all_topics").click(function(){if(!e.$id("@all_topics").hasClass("selected")){e.clearChosenTopic()}return false});this.$id("@remove_chosen_topic").click(function(){e.clearChosenTopic();return false})},clearChosenTopic:function(){var e={};e[this.data_key]=null;var t=i.makeUpdatedURL(e);i.navigateTo(t)}});exports.UserContentFilterTopicSelector=t.extend({topicWasSelected:function(e,t,n,s,o){if(!t){return}var r={};r["topic"]=o.data.topic_routing_name;var a=i.makeUpdatedURL(r);i.navigateTo(a)}})});define("app/view/user/profile",["shared/polyfills","webnode2","shared/window_manager","tooltip","view/editable_list"],function Tn(require,exports,e){var t=require("webnode2").Component,i=require("shared/window_manager"),n=require("tooltip"),s=require("view/editable_list").EditableList;
exports.ProfileNameAndSigEditor=t.extend({onLoad:function(){var e=this;if(i.getHash().substr(0,9)=="#editname"){this.toggleEditor();this.showNameEditor();this.$id("@name").focus()}this.$id("@edit").click(function(){e.toggleEditor();e.$id("@bio").focus();return false});this.$id("@edit_name").click(function(){e.showNameEditor();return false});this.$id("@done").click(function(){e.hideNameEditor();e.toggleEditor();return false});this.$id("@update").click(function(){var t=e.$id("@name").val();var i=e.$id("@bio").val();e.serverCall("update").kwargs({name:t,bio:i}).success(function(t){if(!t){e.toggleEditor()}else{e.$id("@name").addClass("input_validation_error");e.$id("@error").text(t+".").show()}}).liveMutate().send();return false})},showNameEditor:function(){this.$id("@edit_name").hide();this.$id("@view_name").hide();this.$id("@name_input").show()},hideNameEditor:function(){this.$id("@edit_name").show();this.$id("@view_name").show();this.$id("@name_input").hide()},toggleEditor:function(){this.$id("@view").toggle();
this.$id("@edit_view").toggle();this.$id("@error").text("").hide();this.$id("@name").removeClass("input_validation_error")}});exports.VerificationBadge=t.extend({onLoad:function(){n.attach(this.$id("@badge"),this.tooltip_text)}});exports.NGProfileNameEditor=t.extend({onLoad:function(){this.$id("@update").click(this.updateName.bind(this));this.$id("@edit").click(this.toggleEditor.bind(this));this.$id("@cancel").click(this.toggleEditor.bind(this))},toggleEditor:function(){this.$id("@initial").toggleClass("hidden");this.$id("@editor").toggleClass("hidden");return false},updateName:function(){var e=this.$id("@name").val();this.serverCall("update").kwargs({name:e}).success(this.toggleEditor.bind(this)).liveMutate().send();return false}});exports.ProfileExperienceList=s.extend({onLoad:function(){var e=this;e._super.apply(e,arguments);e.$id("@modal_link").on("click",function(t){t.preventDefault();e.createModal("load_modal").show()})}})});define("app/view/user/setup_",["shared/polyfills","webnode2","shared/events/index"],function $n(require,exports,e){
var t=require("webnode2").Component,i=require("shared/events/index");var n=false;exports.ChecklistStep=t.extend({onLoad:function(){var e=this;var t=e.should_show_x;this.$id("@step_link").click(function(i){i.preventDefault();if(n){return}n=true;e._dialog=e.dialog().opt("width",500).opt("left","50%").opt("dialogClass","dialog_nux").opt("showXButton",t).title(e.dialog_title).load("get_step_dialog").close(e.onDialogClose.bind(e))});this.handleEvent(i.Types.NUX_DIALOG_STANDALONE_DONE,function(){if(e._dialog){e._dialog.close_()}})},onDialogClose:function(){n=false;this.serverCall("mark_dialog_step_complete").send()}});exports.ChecklistLinkStep=t.extend({onLoad:function(){var e=this;this.$id("@step_link").click(function(){e.serverCall("log_link_click").send()})}})});define("app/view/user/subscribe",["shared/polyfills","webnode2","view/modal"],function Ln(require,exports,e){var t=require("webnode2").Component,i=require("view/modal").Base;exports.UserSubscribeLink=t.extend({onLoad:function(){var e=this;
e.button=e.$id("@user_subscribe_button");e.button.click(function(t){if(e.isSubscribing){e.serverCall("unsubscribe").kwargs({subscribed_uid:e.uid,from_hovercard:e.getDvar("hovermenu_parent")}).liveMutate().send()}else{e.modal("load_inner",{kwargs:{should_show_subscribe:e.canSubscribe(),subscribe_to_uid:e.uid}})}t.preventDefault()})},canSubscribe:function(){return!this.button.hasClass("unsubscribe_button")}});exports.SubscribeConfirmModal=i.extend({onSubmit:function(){this.serverCall("change_subscription").kwargs({from_hovercard:this.getDvar("hovermenu_parent")}).liveMutate().success(this._closeModal.bind(this)).send()}})});define("app/view/user/topics",["shared/polyfills","shared/events/index","view/modal","app/view/topic_selector","app/view/topic/edit_topic_modal"],function Mn(require,exports,e){var t=require("shared/events/index"),i=require("view/modal").Base,n=require("app/view/topic_selector").AddTopicSelector,s=require("app/view/topic/edit_topic_modal").EditTopicsList;exports.EditKnowsAboutTopicsModal=i.extend({
onLoad:function(){this._super.apply(this,arguments);this.topicsChanged=false;var e=this;this.handleEvent(t.Types.PROFILE_TOPICS_UPDATED,function(){e.topicsChanged=true})},_closeModal:function(){this._super.apply(this,arguments);if(this.topicsChanged){window.location.reload()}}});exports.KnowsAboutTopicsList=s.extend({removeTid:function(){this._super.apply(this,arguments);this.emitEvent({type:t.Types.PROFILE_TOPICS_UPDATED,payload:{}})}});exports.EditKnowsAboutTopicsModalSelector=n.extend({topicWasSelected:function(){this._super.apply(this,arguments);this.emitEvent({type:t.Types.PROFILE_TOPICS_UPDATED,payload:{}})},createTopicWasSelected:function(){this._super.apply(this,arguments);this.emitEvent({type:t.Types.PROFILE_TOPICS_UPDATED,payload:{}})}})});define("unified_view/switch",["shared/polyfills","shared/core/component"],function Dn(require,exports,e){var t=require("shared/core/component").Component;exports.Switch=t.extend({onLoad:function(){this.getSwitch().on("click",this.handleClick.bind(this));
},handleClick:function(){var e=this.getSwitch();if(e.hasClass("on")){this.toggleOff(e)}else{this.toggleOn(e)}this.toggleOnOffClasses(e)},toggleOnOffClasses:function(e){e.toggleClass("on").toggleClass("off")},toggleOff:function(e){this.serverCall("off").kwargs(this.kwargs).liveMutate().error(function(){e.removeClass("on").addClass("off")}).send()},toggleOn:function(e){this.serverCall("on").kwargs(this.kwargs).liveMutate().error(function(){e.addClass("on").removeClass("off")}).send()},getSwitch:function(){return this.$id("@switch")}})});define("app/view/user_settings/notifications",["shared/polyfills","webnode2","gating","unified_view/switch"],function An(require,exports,e){var t=require("webnode2").Component,i=require("gating"),n=require("unified_view/switch").Switch;exports.DesktopPushGroupWrapper=t.extend({onLoad:function(){this.maybeLoadInner()},maybeLoadInner:function(){var e=this;if("serviceWorker"in window.navigator&&i.desktop_push_notifs){window.navigator.serviceWorker.ready.then(function(t){
t.pushManager.getSubscription().then(function(t){var i=!!t;e.loadInnerComponent(i)})})}},loadInnerComponent:function(e){this.serverCall("fetch_toggled_component").kwargs({is_subscribed:e}).contentFor(this.$id("@desktop_push_group")).send()}});exports.DesktopPushToggle=n.extend({onLoad:function(){this._super.apply(this,arguments)},toggleOff:function(e){var t=this;window.navigator.serviceWorker.ready.then(function(e){e.pushManager.getSubscription().then(function(e){var i=t.getDeviceToken(e.endpoint);e.unsubscribe();t.serverCall("off").kwargs({device_token:i}).send()}).catch(function(e){})})},toggleOn:function(e){var t=this;window.navigator.serviceWorker.ready.then(function(e){e.pushManager.subscribe({userVisibleOnly:true}).then(function(e){var i=t.getDeviceToken(e.endpoint);t.serverCall("on").kwargs({device_token:i}).send()}).catch(function(e){})})},getDeviceToken:function(e){var t=e.split("/");return t[t.length-1]}})});define("app/view/user_settings/settings",["shared/polyfills","webnode2"],function In(require,exports,e){
var t=require("webnode2").Component;exports.SettingsRow=t.extend({onLoad:function(){var e=this;e.selectorId="#"+e.selectorId;this.$(e.selectorId).on("click",function(){e.optionSelected()})},optionSelected:function(){this.serverCall("settings_toggle").liveMutate().send()}})});define("app/view/user_stats",["shared/polyfills","webnode2","interface/jquery","shared/events/index","view/hover_menu"],function qn(require,exports,e){var t=require("webnode2").Component,$=require("interface/jquery")._jQuery,i=require("shared/events/index"),n=require("view/hover_menu").HoverMenu;exports.StatsMain=t.extend({onLoad:function(){this.handleEvent(i.Types.USER_STATS_SHOW,this.show.bind(this));var e=this;this.handleEvent(i.Types.USER_STATS_UPDATE_ATTRIBUTES,function(t){e.updateAttributes(t.payload)})},show:function(){this.$id("@stats_main").removeClass("fade_in")},updateGraph:function(e){if(!e){e=this.content_type}this.child("graphs_section").updateGraphs(e,this.interval_type,this.oid)},updateContentList:function(){
this.serverCall("render_new_content_list_wrapper").args(this.content_type,this.interval_type).contentFor(this.$id("@stats_side")).send()},updateAttributes:function(e){var t=false,i=false;if("oid"in e&&this.oid!=e.oid){this.oid=e.oid;t=true;if(this.content_type===4){this.updateGraph(e.content_type);return}}if("interval_type"in e){e.interval_type=parseInt(e.interval_type);if(this.interval_type!=e.interval_type){this.interval_type=e.interval_type;t=true;i=true}}if("content_type"in e){e.content_type=parseInt(e.content_type);if(this.content_type!=e.content_type){this.content_type=e.content_type;t=true;i=true}}if(t){this.updateGraph()}if(i){this.updateContentList()}}});exports.Filter=n.extend({registerClickHandlers:function(){var e=this;this._super.apply(this,arguments);this.$("%@option").click(function(t){e.updateAttributes($(t.target).attr("name"));e.$id("@link").text($(t.target).text());$(t.target).parent().siblings().removeClass("selected");$(t.target).parent().addClass("selected");t.preventDefault();
})},updateAttributes:function(){}});exports.FilterIntervalType=exports.Filter.extend({updateAttributes:function(e){this.emitEvent({type:i.Types.USER_STATS_UPDATE_ATTRIBUTES,payload:{interval_type:e}})}});exports.FilterContentType=exports.Filter.extend({updateAttributes:function(e){this.emitEvent({type:i.Types.USER_STATS_UPDATE_ATTRIBUTES,payload:{content_type:e}})}});exports.TabbedStatsNavController=t.extend({onLoad:function(){var e=this;this.$(".tabbed_nav_wrapper .content_type_tab").click(function(t){t.preventDefault();var n=$(this).attr("id");$(".tabbed_nav_wrapper .content_type_tab").removeClass("active");$(this).addClass("active");$("#"+n).addClass("active");e.emitEvent({type:i.Types.USER_STATS_UPDATE_ATTRIBUTES,payload:{content_type:n}})})}});exports.ContentListWrapper=t.extend({onLoad:function(){var e=this.$id("@content_list_wrapper"),t=e.outerHeight(),n=$(window).height(),s=e.offset().top,o=n-s-32;if(o>t){e.css("height",o)}this.emitEvent({type:i.Types.USER_STATS_SHOW,payload:{}});
}});exports.ContentListItem=t.extend({onLoad:function(){var e=this;this.$id("@content_external_link").click(function(e){e.stopPropagation()});this.$id("@link").click(function(){if(!e.$id("@link").hasClass("is_active")){e.$(".is_active").removeClass("is_active");e.$id("@link").addClass("is_active")}if($(".StatsMain").hasClass("full_width_stats")){$("html, body").animate({scrollTop:0},1e3)}e.emitEvent({type:i.Types.USER_STATS_UPDATE_ATTRIBUTES,payload:{oid:e.oid,content_type:e.content_type}})});if($(".StatsMain").hasClass("full_width_stats")){e.$(".ContentListWrapper").click(function(){if(e.$(".ContentListItem.PagedListItem").hasClass("is_active")){e.$(".ContentListWrapper").addClass("selected_item")}else{e.$(".ContentListWrapper").removeClass("selected_item")}})}}});exports.RSGraph=t.extend({onLoad:function(){var e=new Rickshaw.Color.Palette({scheme:this.colors});var t=this.getHeight();var i=this.width;for(var n in this.data_json){this.data_json[n].color=e.color()}if($(".StatsMain").hasClass("full_width_stats")){
t=300;i=960}var s=new Rickshaw.Graph({element:this.$id("@rsgraph").get(0),series:this.data_json,width:i,height:t,renderer:"bar",stroke:true,min:this.min,max:this.max,xmin:this.xmin,xmax:this.xmax,interpolation:"step-after"});s.render();var o=new Rickshaw.Graph.Axis.Y({graph:s,tickFormat:this.ypercent?function(e){return(e*100).toFixed(1)+"%"}:null});if($(".StatsMain").hasClass("full_width_stats")){o=new Rickshaw.Graph.Axis.Y({graph:s,element:this.$id("@y_axis").get(0)})}o.render();var r=new Rickshaw.Graph.Axis.Time({graph:s});r.render();var a=new Rickshaw.Graph.HoverDetail({graph:s})},getHeight:function(){var e=$(window).height(),t=$(".graphs").offset().top,i=e-t-32;if(i>this.height){return i}else{return this.height}}});exports.Graphs=t.extend({onLoad:function(){var e=this;var t=window.location.hash;this.metrics.forEach(function(t){e.child("headsup_section").$("#@"+t).click(function(i){var n=$(i.target);if(!n.hasClass("heads_up_item")){n=n.parents(".heads_up_item")}if(!n.hasClass("is_active")){
n.siblings(".is_active").removeClass("is_active");n.addClass("is_active")}if(e.active_metric!=t){e.$(".stats_graph").hide();e.child("stats_graphs").$("#@graph_"+t).fadeIn(500);e.active_metric=t}i.preventDefault();return false})});this.metrics.forEach(function(i){if("#"+i==t){e.child("headsup_section").$("#@"+i).click()}})},updateGraphs:function(e,t,i){var n=this;$(".heads_up_item").first().addClass("is_active");this.serverCall("render_new_graphs").args(e,t,i).contentFor(this.$id("@graphs"),{parentCid:this.cid,useLoadingSpinner:false}).send();this.serverCall("get_new_counts").args(e,t,i).success(function(e){e.forEach(function(e){if(e[1]===null){n.child("headsup_section").$("#@"+e[0]).hide()}else{n.child("headsup_section").$("#@"+e[0]).show();n.child("headsup_section").$("#@"+e[0]+">.big_num").text(e[1]);n.child("headsup_section").$("#@"+e[0]+">.num_label").text(e[2])}$(".heads_up_item").first().addClass("is_active")})}).send()}})});define("app/view/vc",["shared/polyfills","webnode2","interface/jquery","settings"],function Nn(require,exports,e){
var t=require("webnode2").Component,$=require("interface/jquery")._jQuery,i=require("settings").interface_strings;exports.RevertDialog=t.extend({onLoad:function(){this.shortcutKeyListener();this.radioChangeListener()},radioChangeListener:function(){var e=this;e.$("input:radio").change(function(){e.$("input:radio").each(function(){if($(this).prop("checked")){e.$(".content").html(e.$(this).val())}})})},shortcutKeyListener:function(){var e=this;e.$(document).keypress(function(t){if(t.which==49||t.which==50||t.which==51||t.which==52){if(t.which==49){e.$("#spam").prop("checked",true)}else if(t.which==50){e.$("#tos").prop("checked",true)}else if(t.which==51){e.$("#vandalism").prop("checked",true)}else if(t.which==52){e.$("#other").prop("checked",true)}e.$("input:radio").each(function(){if($(this).prop("checked")){e.$(".content").html(e.$(this).val())}})}})},validateReason:function(){return true}});exports.OperationRevert=t.extend({onLoad:function(){var e=this;e.$id("@operation_revert").click(function(){
e.dialog().title(e.dialog_title).ok(function(t){var i=t.dialogComponent.child("editor");e.serverCall("revert_revision").kwargs(e.getKwargs(i)).liveMutate().send()},e.ok_text).cancel(null,i.cancel).load("revert_dialog");return false})},getKwargs:function(e){return{oid:this.oid,comment:e.serialize()}}});exports.AddQuestionRedirectRevertLink=t.extend({onLoad:function(){var e=this;e.$id("@revert").click(function(t){t.preventDefault();e.dialog().title(e.dialog_title).ok(function(t){var i=t.dialogComponent.child("editor");e.serverCall("revert").kwargs({to_qid:e.to_qid,from_qid:e.from_qid,comment:i.serialize()}).liveMutate().send()},e.ok_text).cancel(null,i.cancel).load("revert_dialog")})}})});define("app/view/write",["shared/polyfills","webnode2","view/fixable2","view/modal","shared/window_manager"],function On(require,exports,e){var t=require("webnode2").Component,i=require("view/fixable2"),n=require("view/modal").Base,s=require("shared/window_manager");exports.WriteMain=t.extend({onLoad:function(){
var e=this;var t=this.$id("@left_col_inner");var n=this.$id("@left_col");if(!e.notifBanner){if(n.length>0&&t.length>0){i.makeFixable(t,{min_height:n.outerHeight()+n.offset().top,min_width:990})}}}});exports.WritePageBatchActionLink=t.extend({onLoad:function(){var e=this;this.$id("@confirmation_dialogue").on("click",function(t){e.modal("load_inner");return false})}});exports.WritePageBatchActionConfirmationModal=n.extend({onSubmit:function(){this.removeAll()},removeAll:function(){var e=this;this.serverCall("remove_all").liveMutate().success(function(t){e._closeModal();s.reload()}).send()}});exports.WritingListReminderSidebar=t.extend({onLoad:function(){this.serverCall("track_impression").send()}});exports.WritingListReminderButton=t.extend({onLoad:function(){var e=this;e.$id("@writing-list-reminder-complete").on("click",function(){e.serverCall("complete_answer_later_deck").send()})}});exports.WritingListReminderDismiss=t.extend({onLoad:function(){this.$id("@writing-list-reminder-dismiss").click(this.dismiss.bind(this));
},dismiss:function(e){this.serverCall("dismiss_answer_later_deck").liveMutate().send();e.preventDefault();e.stopPropagation()}})});define("app/view/zapdos/card",["shared/polyfills","webnode2"],function Rn(require,exports,e){var t=require("webnode2").Component;exports.CardButton=t.extend({onLoad:function(){var e=this;e.$id("@card-button-link").click(e.onClick.bind(e))},onClick:function(e){e.preventDefault();var t=this;if(t.redirectUrl){window.location.href=t.redirectUrl}else if(t.uiToHideId){t.$("#"+t.uiToHideId).hide()}t.serverCall("click").send();return false}})});define("swfobject",["shared/polyfills","settings","shared/onload"],function Pn(require,exports,e){var t=require("settings");var i=require("shared/onload");var Pn=null;var n=function(){if(Pn==null)Pn=function(){var e="undefined",t="object",i="Shockwave Flash",n="ShockwaveFlash.ShockwaveFlash",s="application/x-shockwave-flash",o="SWFObjectExprInst",r="onreadystatechange",a=window,d=document,l=navigator,c=false,u=[M],h=[],f=[],p=[],g,m,v,_,w=false,b=false,y,C,x=true,k=function(){
var o=typeof d.getElementById!=e&&typeof d.getElementsByTagName!=e&&typeof d.createElement!=e,r=l.userAgent.toLowerCase(),u=l.platform.toLowerCase(),h=u?/win/.test(u):/win/.test(r),f=u?/mac/.test(u):/mac/.test(r),p=/webkit/.test(r)?parseFloat(r.replace(/^.*webkit\/(\d+(\.\d+)?).*$/,"$1")):false,g=!+"1",m=[0,0,0],v=null;if(typeof l.plugins!=e&&typeof l.plugins[i]==t){v=l.plugins[i].description;if(v&&!(typeof l.mimeTypes!=e&&l.mimeTypes[s]&&!l.mimeTypes[s].enabledPlugin)){c=true;g=false;v=v.replace(/^.*\s+(\S+\s+\S+$)/,"$1");m[0]=parseInt(v.replace(/^(.*)\..*$/,"$1"),10);m[1]=parseInt(v.replace(/^.*\.(.*)\s.*$/,"$1"),10);m[2]=/[a-zA-Z]/.test(v)?parseInt(v.replace(/^.*[a-zA-Z]+(.*)$/,"$1"),10):0}}else{if(typeof a.ActiveXObject!=e){try{var _=new ActiveXObject(n);if(_){v=_.GetVariable("$version");if(v){g=true;v=v.split(" ")[1].split(",");m=[parseInt(v[0],10),parseInt(v[1],10),parseInt(v[2],10)]}}}catch(w){}}}return{w3:o,pv:m,wk:p,ie:g,win:h,mac:f}}(),S=function(){if(!k.w3){return}if(typeof d.readyState!=e&&d.readyState=="complete"||typeof d.readyState==e&&(d.getElementsByTagName("body")[0]||d.body)){
E()}if(!w){if(typeof d.addEventListener!=e){d.addEventListener("DOMContentLoaded",E,false)}if(k.ie&&k.win){d.attachEvent(r,function(){if(d.readyState=="complete"){d.detachEvent(r,arguments.callee);E()}});if(a==top){(function(){if(w){return}try{d.documentElement.doScroll("left")}catch(e){setTimeout(arguments.callee,0);return}E()})()}}if(k.wk){(function(){if(w){return}if(!/loaded|complete/.test(d.readyState)){setTimeout(arguments.callee,0);return}E()})()}L(E)}}();function E(){if(w){return}try{var e=d.getElementsByTagName("body")[0].appendChild(H("span"));e.parentNode.removeChild(e)}catch(t){return}w=true;var i=u.length;for(var n=0;n<i;n++){u[n]()}}function T(e){if(w){e()}else{u[u.length]=e}}function L(t){if(typeof a.addEventListener!=e){a.addEventListener("load",t,false)}else{if(typeof d.addEventListener!=e){d.addEventListener("load",t,false)}else{if(typeof a.attachEvent!=e){Q(a,"onload",t)}else{if(typeof a.onload=="function"){var i=a.onload;a.onload=function(){i();t()}}else{a.onload=t}}}
}}function M(){if(c){D()}else{A()}}function D(){var i=d.getElementsByTagName("body")[0];var n=H(t);n.setAttribute("type",s);var o=i.appendChild(n);if(o){var r=0;(function(){if(typeof o.GetVariable!=e){var t=o.GetVariable("$version");if(t){t=t.split(" ")[1].split(",");k.pv=[parseInt(t[0],10),parseInt(t[1],10),parseInt(t[2],10)]}}else{if(r<10){r++;setTimeout(arguments.callee,10);return}}i.removeChild(n);o=null;A()})()}else{A()}}function A(){var t=h.length;if(t>0){for(var i=0;i<t;i++){var n=h[i].id;var s=h[i].callbackFn;var o={success:false,id:n};if(k.pv[0]>0){var r=j(n);if(r){if(W(h[i].swfVersion)&&!(k.wk&&k.wk<312)){z(n,true);if(s){o.success=true;o.ref=I(n);s(o)}}else{if(h[i].expressInstall&&q()){var a={};a.data=h[i].expressInstall;a.width=r.getAttribute("width")||"0";a.height=r.getAttribute("height")||"0";if(r.getAttribute("class")){a.styleclass=r.getAttribute("class")}if(r.getAttribute("align")){a.align=r.getAttribute("align")}var d={};var l=r.getElementsByTagName("param");var c=l.length;
for(var u=0;u<c;u++){if(l[u].getAttribute("name").toLowerCase()!="movie"){d[l[u].getAttribute("name")]=l[u].getAttribute("value")}}N(a,d,n,s)}else{O(r);if(s){s(o)}}}}}else{z(n,true);if(s){var f=I(n);if(f&&typeof f.SetVariable!=e){o.success=true;o.ref=f}s(o)}}}}}function I(i){var n=null;var s=j(i);if(s&&s.nodeName=="OBJECT"){if(typeof s.SetVariable!=e){n=s}else{var o=s.getElementsByTagName(t)[0];if(o){n=o}}}return n}function q(){return!b&&W("6.0.65")&&(k.win||k.mac)&&!(k.wk&&k.wk<312)}function N(t,i,n,s){b=true;v=s||null;_={success:false,id:n};var r=j(n);if(r){if(r.nodeName=="OBJECT"){g=R(r);m=null}else{g=r;m=n}t.id=o;if(typeof t.width==e||!/%$/.test(t.width)&&parseInt(t.width,10)<310){t.width="310"}if(typeof t.height==e||!/%$/.test(t.height)&&parseInt(t.height,10)<137){t.height="137"}d.title=d.title.slice(0,47)+" - Flash Player Installation";var l=k.ie&&k.win?"ActiveX":"PlugIn",c="MMredirectURL="+a.location.toString().replace(/&/g,"%26")+"&MMplayerType="+l+"&MMdoctitle="+d.title;if(typeof i.flashvars!=e){
i.flashvars+="&"+c}else{i.flashvars=c}if(k.ie&&k.win&&r.readyState!=4){var u=H("div");n+="SWFObjectNew";u.setAttribute("id",n);r.parentNode.insertBefore(u,r);r.style.display="none";(function(){if(r.readyState==4){r.parentNode.removeChild(r)}else{setTimeout(arguments.callee,10)}})()}P(t,i,n)}}function O(e){if(k.ie&&k.win&&e.readyState!=4){var t=H("div");e.parentNode.insertBefore(t,e);t.parentNode.replaceChild(R(e),t);e.style.display="none";(function(){if(e.readyState==4){e.parentNode.removeChild(e)}else{setTimeout(arguments.callee,10)}})()}else{e.parentNode.replaceChild(R(e),e)}}function R(e){var i=H("div");if(k.win&&k.ie){i.innerHTML=e.innerHTML}else{var n=e.getElementsByTagName(t)[0];if(n){var s=n.childNodes;if(s){var o=s.length;for(var r=0;r<o;r++){if(!(s[r].nodeType==1&&s[r].nodeName=="PARAM")&&!(s[r].nodeType==8)){i.appendChild(s[r].cloneNode(true))}}}}}return i}function P(i,n,o){var r,a=j(o);if(k.wk&&k.wk<312){return r}if(a){if(typeof i.id==e){i.id=o}if(k.ie&&k.win){var d="";for(var l in i){
if(i[l]!=Object.prototype[l]){if(l.toLowerCase()=="data"){n.movie=i[l]}else{if(l.toLowerCase()=="styleclass"){d+=' class="'+i[l]+'"'}else{if(l.toLowerCase()!="classid"){d+=" "+l+'="'+i[l]+'"'}}}}}var c="";for(var u in n){if(n[u]!=Object.prototype[u]){c+='<param name="'+u+'" value="'+n[u]+'" />'}}a.outerHTML='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"'+d+">"+c+"</object>";f[f.length]=i.id;r=j(i.id)}else{var h=H(t);h.setAttribute("type",s);for(var p in i){if(i[p]!=Object.prototype[p]){if(p.toLowerCase()=="styleclass"){h.setAttribute("class",i[p])}else{if(p.toLowerCase()!="classid"){h.setAttribute(p,i[p])}}}}for(var g in n){if(n[g]!=Object.prototype[g]&&g.toLowerCase()!="movie"){B(h,g,n[g])}}a.parentNode.replaceChild(h,a);r=h}}return r}function B(e,t,i){var n=H("param");n.setAttribute("name",t);n.setAttribute("value",i);e.appendChild(n)}function F(e){var t=j(e);if(t&&t.nodeName=="OBJECT"){if(k.ie&&k.win){t.style.display="none";(function(){if(t.readyState==4){U(e)}else{setTimeout(arguments.callee,10);
}})()}else{t.parentNode.removeChild(t)}}}function U(e){var t=j(e);if(t){for(var i in t){if(typeof t[i]=="function"){t[i]=null}}t.parentNode.removeChild(t)}}function j(e){var t=null;try{t=d.getElementById(e)}catch(i){}return t}function H(e){return d.createElement(e)}function Q(e,t,i){e.attachEvent(t,i);p[p.length]=[e,t,i]}function W(e){var t=k.pv,i=e.split(".");i[0]=parseInt(i[0],10);i[1]=parseInt(i[1],10)||0;i[2]=parseInt(i[2],10)||0;return t[0]>i[0]||t[0]==i[0]&&t[1]>i[1]||t[0]==i[0]&&t[1]==i[1]&&t[2]>=i[2]?true:false}function V(i,n,s,o){if(k.ie&&k.mac){return}var r=d.getElementsByTagName("head")[0];if(!r){return}var a=s&&typeof s=="string"?s:"screen";if(o){y=null;C=null}if(!y||C!=a){var l=H("style");l.setAttribute("type","text/css");l.setAttribute("media",a);y=r.appendChild(l);if(k.ie&&k.win&&typeof d.styleSheets!=e&&d.styleSheets.length>0){y=d.styleSheets[d.styleSheets.length-1]}C=a}if(k.ie&&k.win){if(y&&typeof y.addRule==t){y.addRule(i,n)}}else{if(y&&typeof d.createTextNode!=e){y.appendChild(d.createTextNode(i+" {"+n+"}"));
}}}function z(e,t){if(!x){return}var i=t?"visible":"hidden";if(w&&j(e)){j(e).style.visibility=i}else{V("#"+e,"visibility:"+i)}}function G(t){var i=/[\\\"<>\.;]/;var n=i.exec(t)!=null;return n&&typeof encodeURIComponent!=e?encodeURIComponent(t):t}var K=function(){if(k.ie&&k.win){window.attachEvent("onunload",function(){var e=p.length;for(var t=0;t<e;t++){p[t][0].detachEvent(p[t][1],p[t][2])}var i=f.length;for(var n=0;n<i;n++){F(f[n])}for(var s in k){k[s]=null}k=null;for(var o in Pn){Pn[o]=null}Pn=null})}}();return{registerObject:function(e,t,i,n){if(k.w3&&e&&t){var s={};s.id=e;s.swfVersion=t;s.expressInstall=i;s.callbackFn=n;h[h.length]=s;z(e,false)}else{if(n){n({success:false,id:e})}}},getObjectById:function(e){if(k.w3){return I(e)}},embedSWF:function(i,n,s,o,r,a,d,l,c,u){var h={success:false,id:n};if(k.w3&&!(k.wk&&k.wk<312)&&i&&n&&s&&o&&r){z(n,false);T(function(){s+="";o+="";var f={};if(c&&typeof c===t){for(var p in c){f[p]=c[p]}}f.data=i;f.width=s;f.height=o;var g={};if(l&&typeof l===t){
for(var m in l){g[m]=l[m]}}if(d&&typeof d===t){for(var v in d){if(typeof g.flashvars!=e){g.flashvars+="&"+v+"="+d[v]}else{g.flashvars=v+"="+d[v]}}}if(W(r)){var _=P(f,g,n);if(f.id==n){z(n,true)}h.success=true;h.ref=_}else{if(a&&q()){f.data=a;N(f,g,n,u);return}else{z(n,true)}}if(u){u(h)}})}else{if(u){u(h)}}},switchOffAutoHideShow:function(){x=false},ua:k,getFlashPlayerVersion:function(){return{major:k.pv[0],minor:k.pv[1],release:k.pv[2]}},hasFlashPlayerVersion:W,createSWF:function(e,t,i){if(k.w3){return P(e,t,i)}else{return undefined}},showExpressInstall:function(e,t,i,n){if(k.w3&&q()){N(e,t,i,n)}},removeSWF:function(e){if(k.w3){F(e)}},createCSS:function(e,t,i,n){if(k.w3){V(e,t,i,n)}},addDomLoadEvent:T,addLoadEvent:L,getQueryParamValue:function(e){var t=d.location.search||d.location.hash;if(t){if(/\?/.test(t)){t=t.split("?")[1]}if(e==null){return G(t)}var i=t.split("&");for(var n=0;n<i.length;n++){if(i[n].substring(0,i[n].indexOf("="))==e){return G(i[n].substring(i[n].indexOf("=")+1))}}}return"";
},expressInstallCallback:function(){if(b){var e=j(o);if(e&&g){e.parentNode.replaceChild(g,e);if(m){z(m,true);if(k.ie&&k.win){g.style.display="block"}}if(v){v(_)}}b=false}}}}()};var s=function(e,t){n();return Pn[e].apply(Pn,t)};exports.embedSWF=function(){var e=arguments;i.execAfterLoadDelayed(function(){s("embedSWF",e)})};exports.removeSWF=function(){return s("removeSWF",arguments)};i.execAfterLoadDelayed(function(){n()})});define("flash",["shared/polyfills","webnode2","shared/errors","swfobject"],function Bn(require,exports,e){var t=require("webnode2").Component,i=require("shared/errors"),n=require("swfobject"),s=require("webnode2").FlashClient={};exports.FlashClient=t.extend({onLoad:function(e){if(e){s.onInit=this.delayedFn(this.onFlashInit);s.onComplete=this.onComplete.bind(this);try{n.embedSWF(this.swf_url,this.$id("@flash").attr("id"),"1","1","10.0.0",null,this.flash_vars,{allowScriptAccess:"always"},{allowscriptaccess:"always"})}catch(t){i.report(new Error("Error in swfobject library: "+t));
}}},delayedFn:function(e){var t=this;return function(){var i=arguments;setTimeout(function(){e.apply(t,i)},1)}},onFlashInit:function(){try{this.getSwf().init(this.so,this.cp,this.fc)}catch(e){i.report(new Error("Unable to call onFlashInit(): "+e))}},onComplete:function(){},getSwf:function(){return this.$id("@flash").get(0)}})});define("google_",["shared/polyfills","webnode2"],function Fn(require,exports,e){var t=require("webnode2").Component;exports.GoogleConnectCallbackPage=t.extend({onLoad:function(){if(window.opener&&window.opener.document){if(this.access_token&&this.user_data){window.opener.$(window.opener.document).trigger("google_oauth_approved",{accessToken:this.access_token,userData:this.user_data})}window.close()}else{if(typeof localStorage!=="undefined"){localStorage.setItem("googloginresult",JSON.stringify({accessToken:this.access_token,userData:this.user_data}))}window.close()}}})});define("shared/inline_css",["shared/polyfills","shared/cookies"],function Un(require,exports,e){
var t=require("shared/cookies");var i=function(e){window.requestAnimationFrame(function(){var t=document.getElementsByClassName(e),i;while(t.length){i=t[0];i.parentElement.removeChild(i)}})};var n=function(e,n,s,o){i(e);if(n&&s){t.setCookie(n,s,{expires:o})}};exports.loadStyleSheet=function(e,t,i,s,o){var r=document.createElement("link");r.setAttribute("rel","stylesheet");r.setAttribute("type","text/css");r.setAttribute("href",e);r.setAttribute("id","onLoadCss");r.onload=function(){n(t,i,s,o)};document.head.appendChild(r)};exports.applyStyleSheet=function(e,t,i,s,o){var r=document.getElementById("async_css");if(window.Q.css_loaded){n(t,i,s,o)}else{r.addEventListener("load",function(){n(t,i,s,o)})}}});define("shared/skyfall",["shared/polyfills","shared/logging","settings","shared/errors"],function jn(require,exports,e){var t=require("shared/logging"),i=require("settings"),n=require("shared/errors"),s={};exports.logMarker=function(e,t){var s=i.request_id;if(!t){t=r()}if(!d(t)){n.logJsError("skyfall#logMarker","value for a marker must be a number: "+e+" "+t);
return}a(s,"marker",e,t)};var o=exports.logRange=function(e,t){var s=i.request_id;if(!t.startTime||!t.endTime){n.logJsError("skyfall#logRange","value must have startTime and endtime");return}a(s,"range",e,t)};exports.logRangeStart=function(e,t){if(!t){t=r()}if(!d(t)){n.logJsError("skyfall#logRangeStart","value for a rangeStart must be a number.");return}s[e]=t};exports.logRangeEnd=function(e,t){if(!t){t=r()}if(!d(t)){n.logJsError("skyfall#logRangeEnd","value for a rangeEnd must be a number.");return}var i=s[e];if(i){n.logJsError("skyfall#logRangeEnd","logRangeStart was not called for this metric: "+e);return}o(e,{startTime:i,endTime:t});delete s[e]};exports.logMeta=function(e,t){var n=i.request_id;a(n,"meta",e,t)};exports.logResourceTiming=function(){var e=i.request_id;if(window.performance&&window.performance.getEntriesByType){a(e,"resourceTiming","resourceTiming",window.performance.getEntriesByType("resource"))}};function r(){if(window.performance&&window.performance.now&&window.performance.timing){
return window.performance.timing.navigationStart+window.performance.now()}else{return Date.now()}}function a(e,i,n,s){t.log("skyfall",{request_id:e,metric_type:i,metric_name:n,value:s})}function d(e){return!isNaN(parseFloat(e))&&isFinite(e)}});define("unified_view/a2a",["shared/polyfills","shared/core/component","settings","unified_view/modal"],function Hn(require,exports,e){var t=require("shared/core/component").Component,i=require("settings"),n=require("unified_view/modal").ModalBase,s=i.pageIsMobile;exports.A2AHeader=t.extend({onLoad:function(){if(this.scroll_to_self){var e=this.$id("@header_other").prop("offsetTop");if(e){if(s){window.scrollTo(0,e-75)}else{window.scrollTo(0,e+80)}}}}});exports.StartSessionModal=n.extend({onLoad:function(){this._super.apply(this,arguments);this.input=this.$id("@input")},onSubmit:function(e){var t=this.input.val();var i=this;if(!t){return}i.serverCall("start_session").kwargs({description:t}).success(function(){i.close()}).error(function(){i.close()}).liveMutate().send();
}});exports.StopSessionModal=n.extend({onLoad:function(){this._super.apply(this,arguments)},onSubmit:function(e){var t=this;t.serverCall("stop_session").success(function(){t.close()}).error(function(){t.close()}).liveMutate().send()}});exports.AskQuestionSelfServe=t.extend({onLoad:function(){this.$id("@add_question_button").on("click",this.openSessionModal.bind(this));if(this.taking_questions){this.openSessionModal()}},openSessionModal:function(){this.createModal("open_modal").kwargs({host_uid:this.host_uid}).show()}});exports.UserTakingQuestionRow=t.extend({onLoad:function(){this.$id("@ask_button").on("click",this.openSessionModal.bind(this));if(this.taking_questions){this.openSessionModal()}},openSessionModal:function(){this.createModal("open_modal").kwargs({host_uid:this.host_uid}).show()}})});define("unified_view/util",["shared/polyfills"],function Qn(require,exports,e){exports.positionForElement=function(e){var t=0;var i=0;var n=e.offsetWidth;var s=e.offsetHeight;while(e&&!isNaN(e.offsetLeft)&&!isNaN(e.offsetTop)){
t+=e.offsetLeft-e.scrollLeft;i+=e.offsetTop-e.scrollTop;e=e.offsetParent}return{left:t,top:i,width:n,height:s}}});define("sticky",["shared/polyfills","sticky","shared/debounce","interface/jquery"],function Wn(require,exports,e){var t=require("shared/debounce").debounce,$=require("interface/jquery")._jQuery,i="sticky",n=[],s=false;exports.add=function(e){if(!e.elem||!e.container){return}var t=$(e.elem),o=$(e.container),a=$.extend({top:0,bottom:0},e.offsets),d=t.css("position");t.addClass(i);var l=t.outerHeight(true);t.removeClass(i);var c=$("<div>").css({height:0,margin:0,padding:0,clear:"both",display:"block"});t.before(c);n.push({elem:t,sentinelElem:c,container:o,origPadding:parseInt(o.css("padding-bottom")),origPos:d,curPos:d,offsets:a,height:l});if(!s){s=true;r()}};exports.remove=function(e){for(var t=0;t<n.length;++t){var i=n[t];if(i.elem[0]===$(e)[0]){n.splice(t,1);o(i,i.origPos);break}}};var o=function(e,t){if(t!=e.curPos){e.curPos=t;e.elem.css("position",t);var n=e.elem.outerHeight(true);
if(t=="fixed"){e.sentinelElem.css("height",n);e.elem.addClass(i)}else{e.sentinelElem.css("height",0);e.elem.removeClass(i);e.height=n}}};var r=t(function(){var e=$(window),t=e.scrollTop()+e.height();for(var i=0;i<n.length;++i){var s=n[i];if(!s.elem.is(":visible")){continue}var a=s.container.offset().top+s.height+s.offsets.top,d=s.sentinelElem.offset().top+s.height-s.offsets.bottom;if(t>=a&&t<=d){o(s,"fixed")}else{o(s,s.origPos)}}window.requestAnimationFrame(r)},100)});define("unified_view/action_bar/base",["shared/polyfills","shared/core/component","shared/w2.context","shared/perf","interface/settings","unified_view/util","view/hover_menu","sticky","shared/window_manager"],function Vn(require,exports,e){var t=require("shared/core/component").Component,i=require("shared/w2.context"),n=require("shared/perf"),s=require("interface/settings"),o=require("unified_view/util");if(s.pageIsMobile){var r=require("mobile_app2/client"),a=require("mobile_app2/messages")}else{var d=require("view/hover_menu");
var l=require("sticky");var c=require("shared/window_manager")}exports.ActionBarWeb=t.extend({contextConstructor:function(){return i.ActionBar},onLoad:function(){this.overflowMenuShown=false;this.overflowMenuMovedToBody=false;this.overflowMenuLoaded=!this.lazy_loaded;this.$overflowLinkElem=this.unsafe$id("@overflow_link");this.$overflowMenuElem=this.unsafe$id("@overflow_menu");this.$actionBarElem=this.unsafe$id("@action_bar");this.$overflowMenuContentsElem=this.$id("@overflow_menu_contents");this.actionBarContext=this.getContext(i.ActionBar);this.overflowMenu=new d.ToggleableMenu({$linkElem:this.$overflowLinkElem,$menuElem:this.$overflowMenuElem,loadFunction:this.loadOverflowMenu.bind(this),alignment:"right",clickOpen:true,shouldAttachToBody:false});if(this.is_sticky){this.actionBarContext.on("commentsElem",this.maybeEnableSticky.bind(this));this.actionBarContext.on("updateSticky",this.updateSticky.bind(this))}this.userPerceivedAction=null},loadOverflowMenu:function(){var e=this;if(this.overflowMenuLoaded){
return}this.userPerceivedAction=n.startUserPerceived({vcon:this.__vcon,method:"load_menu"});this.overflowMenuLoaded=true;this.serverCall("load_menu").disableDefaultUserPerceivedLogging().contentFor(this.$overflowMenuContentsElem.get(0),{parentCid:this.cid}).success(function(){if(e.overflowMenu.shown===true&&e.userPerceivedAction){n.finishAction(e.userPerceivedAction);e.userPerceivedAction=null}}).send()},maybeEnableSticky:function(){if(!this.is_sticky){return}var e=this.actionBarContext.get("commentsElem");var t=this.actionBarContext.get("showComments");if(e&&!t){l.add({elem:this.$actionBarElem,container:this.$actionBarElem.parent().parent(),offsets:this.sticky_offsets})}else{l.remove(this.$actionBarElem)}},updateSticky:function(){if(!this.is_sticky){return}this.maybeEnableSticky();c.scrollIntoView(this.$actionBarElem)}});exports.ActionBarMobile=t.extend({contextConstructor:function(){return i.ActionBar},onLoad:function(){this.overflowMenuLoaded=!this.lazy_loaded;this.overflowMenuLoading=false;
this.overflowMenuShown=false;this.overflowMenuShownPending=false;this.$overflowMenuContentsElem=this.$id("@overflow_menu_contents");this.$overflowLinkElem=this.$id("@overflow_link");this.$overflowLinkElem.on("click",this.showMenu.bind(this));if(this.lazy_loaded){this.loadOverflowMenu()}this.userPerceivedAction=null},loadOverflowMenu:function(){if(this.overflowMenuLoading||this.overflowMenuLoaded){return}if(!this.$overflowMenuContentsElem.get(0)){return}this.overflowMenuLoading=true;this.serverCall("load_menu").disableDefaultUserPerceivedLogging().contentFor(this.$overflowMenuContentsElem.get(0),{parentCid:this.cid}).success(this.maybeShowMenu.bind(this)).send({batched:true})},enterLoadingState:function(){a.send("showLoadingView")},exitLoadingState:function(){a.send("hideLoadingView")},maybeShowMenu:function(){this.overflowMenuLoaded=true;this.overflowMenuLoading=false;if(!this.overflowMenuShownPending){return}this.overflowMenuShownPending=false;this.exitLoadingState();this.showMenu()},showMenu:function(){
if(!this.userPerceivedAction){this.userPerceivedAction=n.startUserPerceived({vcon:this.__vcon,method:"load_menu"})}if(!this.overflowMenuLoaded){this.overflowMenuShownPending=true;this.enterLoadingState();this.loadOverflowMenu();return}if(this.overflowMenuShown){return}this.overflowMenuShown=true;var e=[];var t=-1;var i=this.getActionSheetItemsData();for(var s=0;s<i.length;s++){var d=i[s];e[d.index]=d.label;if(d.is_destructive){t=d.index}}if(!r.supportsDestructiveActionSheetButtons()){t=-1}var l={title:this.title,buttonTitles:e,destructiveButtonIndex:t,position:o.positionForElement(this.$overflowLinkElem.get(0))};a.send("showActionSheet",l,function(e){this.overflowMenuShown=false;var t=parseInt(e.buttonIndex,10);if(t<0){return}setTimeout(this.selectOverflowItem.bind(this,t),100)}.bind(this));if(this.userPerceivedAction){n.finishAction(this.userPerceivedAction);this.userPerceivedAction=null}},getActionSheetItemsData:function(){var e=this.children();var t=[];for(var i=0;i<e.length;i++){var n=e[i];
if(n.getActionSheetItemData){t.push(n.getActionSheetItemData())}if(n.getActionSheetItemsData){Array.prototype.push.apply(t,n.getActionSheetItemsData())}}return t},selectOverflowItem:function(e){var t=this.children();for(var i=0;i<t.length;i++){var n=t[i];if(n.getActionSheetItemData){var s=n.getActionSheetItemData();if(s.index==e){return n.selectItem()}}else if(n.selectOverflowItem){return n.selectOverflowItem(e)}}}})});define("unified_view/action_bar/_action_bar",["shared/polyfills","unified_view/action_bar/base","shared/events/index","shared/util","shared/scroll_animation_handler"],function zn(require,exports,e){var t=require("unified_view/action_bar/base"),i=require("shared/events/index"),n=require("shared/util").firstScrollingParent,s=require("shared/scroll_animation_handler");exports.Question=t.ActionBarWeb.extend({onLoad:function(){this._super.apply(this,arguments);var e=this;this.handleEvent(i.Types.QUESTION_EDITING_STATE,function(t){if(t.payload.qid!=e.oid){return}if(t.payload.state=="edit"){
e.$actionBarElem.addClass("hidden")}else if(t.payload.state=="cancel"){e.$actionBarElem.removeClass("hidden")}else if(t.payload.state=="request"){e.$actionBarElem.removeClass("hidden")}})}});exports.Answer=t.ActionBarWeb.extend({onLoad:function(){var e=this;e._super.apply(e,arguments)}});exports.AnswerInModal=exports.Answer.extend({onLoad:function(){this._super.apply(this,arguments);var e=n(this.$actionBarElem.get(0));s.add(e,this.update.bind(this));this.$actionBarElem.css("margin-bottom",0)},maybeEnableSticky:function(){if(!this.is_sticky){return}var e=this.actionBarContext.get("commentsElem");var t=this.actionBarContext.get("showComments");if(e&&!t){this.stickyEnabled=true;this.update()}else{this.stickyEnabled=false;this.$actionBarElem.css("position","static");this.$actionBarElem.removeClass("sticky")}},updateSticky:function(){if(!this.is_sticky){return}this.maybeEnableSticky();var e=this.$actionBarElem.parent(),t=e.offset().top,i=window.scrollY+window.innerHeight;if(t>i){var n=this.$modalOverlay.scrollTop(),s=t-window.scrollY,o=n+s,r=Math.min(500,Math.abs(o-n*.5));
this.$modalOverlay.animate({scrollTop:o},r)}},update:function(){if(!this.stickyEnabled){return}var e=this.$actionBarElem.parent(),t=this.$actionBarElem.outerHeight(true),i=e.offset().top+t,n=window.scrollY+window.innerHeight;if(n<=i){this.$actionBarElem.css("position","fixed");this.$actionBarElem.addClass("sticky")}else{this.$actionBarElem.css("position","static");this.$actionBarElem.removeClass("sticky")}}})});define("unified_view/action_bar/answer",["shared/polyfills","shared/core/component","shared/events/index"],function Gn(require,exports,e){var t=require("shared/core/component").Component,i=require("shared/events/index");exports.ReadMoreActionItem=t.extend({onLoad:function(){this.$id("@link").on("click",this.handleClick.bind(this))},handleClick:function(e){e.preventDefault();this.emitEvent({type:i.Types.ANSWER_READ_MORE,payload:{aid:this.aid}})}});exports.AskQuestionPromptExtraItem=t.extend({onLoad:function(){var e=this;this.handleEvent(i.Types.ANSWER_VOTE_STATE,function(t){if(t.payload.aid==e.aid){
if(t.payload.state==null){e.$id("@wrapper").addClass("hidden")}else if(t.payload.state=="upvoted"){e.$id("@wrapper").removeClass("hidden")}}})}})});define("unified_view/action_bar/blog",["shared/polyfills","shared/core/component","interface/settings"],function Kn(require,exports,e){var t=require("shared/core/component").Component,i=require("interface/settings");if(i.pageIsMobile){var n=require("mobile_app2/messages")}exports.AddPostActionItem=t.extend({onLoad:function(){this.$id(this.link_id).on("click",this.handleClick.bind(this))},handleClick:function(e){e.preventDefault();if(this.editor_kwargs.is_qtext2){this.createModal("load_editor_modal").kwargs({bid:this.bid}).onSubmit(function(){n.send("reload")}).show()}else{n.send("invokeRichTextEditor",this.editor_kwargs)}}})});define("unified_view/action_bar/overflow_menu/answer",["shared/polyfills","interface/settings","shared/events/index","unified_view/action_bar/overflow_menu/base","w2.modal"],function Jn(require,exports,e){var t=require("interface/settings").pageIsMobile,i=require("shared/events/index"),n=require("unified_view/action_bar/overflow_menu/base");
if(t){var s=require("mobile_app2/messages")}else{var o=require("w2.modal").ModalWithCallBacks}exports.EditBio=n.WithServerCall.extend({onSelectAction:function(){if(t){s.send("openURL",{target:"modal",url:this.url})}else{var e=new o(this,{});e.load("selected")}}});exports.ChooseCredential=n.WithServerCall.extend({onSelectAction:function(){this.createModal("selected").kwargs({aid:this.aid}).show()}});exports.Downvote=n.Toggleable.extend({onToggledOn:function(){this.emitEvent(i.helpers.addAnswerDownvote(this.aid));this._super.apply(this,arguments)},onToggledOff:function(){this.emitEvent(i.helpers.removeAnswerDownvote(this.aid));this._super.apply(this,arguments)}})});define("unified_view/action_bar/overflow_menu/comment",["shared/polyfills","interface/settings","unified_view/action_bar/overflow_menu/base"],function Xn(require,exports,e){var t=require("interface/settings").pageIsMobile,i=require("unified_view/action_bar/overflow_menu/base");if(t){var n=require("mobile_app2/messages")}exports.CopyLink=i.WithServerCall.extend({
onSelectAction:function(){n.send("shareCopyURL",{url:this.share_url});this._super.apply(this,arguments)}})});define("unified_view/action_bar/overflow_menu/profile",["shared/polyfills","unified_view/action_bar/overflow_menu/base","interface/settings","settings"],function Yn(require,exports,e){var t=require("unified_view/action_bar/overflow_menu/base"),i=require("interface/settings").pageIsMobile,n=require("settings").interface_strings;if(i){var s=require("mobile_app2/messages"),o=require("mobile_app2/app/view/common")}exports.BlockUser=t.Toggleable.extend({onToggledOff:function(){var e=this,t=e._super;this.createModal("load_unblock_modal").onSubmit(function(){t.apply(e)}).kwargs({target_uid:this.target_uid}).show()},onToggledOn:function(){var e=this,t=e._super;this.createModal("load_block_modal").onSubmit(function(){t.apply(e)}).kwargs({target_uid:this.target_uid}).show()}});exports.Logout=t.Item.extend({onSelectAction:function(){var e=this;o.showAlert({title:e.dialog_title,message:e.dialog_message,
callback:function(t){if(t.buttonIndex===0){e.logout()}},cancelButtonTitle:e.dialog_title,otherButtonTitles:[n.cancel]})},logout:function(){this.serverCall("logout").success(function(){s.send("disableAutoSignIn");s.send("loginStateChanged",{isLoggedIn:false})}).send()}})});define("unified_view/privacy",["shared/polyfills","shared/core/component","interface/settings"],function Zn(require,exports,e){var t=require("shared/core/component").Component,i=require("interface/settings").pageIsMobile;if(i){var n=require("mobile_app2/messages")}exports.ToggleQuestionPrivacyJSMixin={loadConfirmationDialog:function(e){this.createModal("confirm_dialog_contents").kwargs({to_privacy:this.to_privacy,acted_inconsistent_qids:e.acted_inconsistent_qids}).onSubmit(this._setPrivacyUNSAFE.bind(this,{qid:this.qid,to_privacy:this.to_privacy,all_inconsistent_qids:e.all_inconsistent_qids})).show()},loadEmailConfirmationDialog:function(){var e=this;e.createModal("email_confirmation_dialog_contents").onSubmit(function(){
e.serverCall("resend_email_confirmation").send()}).show()},_setPrivacyUNSAFE:function(e){this.serverCall("set_privacy").kwargs(e).liveMutate().success(function(){if(i){n.send("reload")}}).send()},trySetPrivacy:function(){var e=this;e.serverCall("try_set_privacy").kwargs({qid:e.qid,to_privacy:e.to_privacy}).success(function(t){if(i){if(!t){n.send("reload")}}if(t&&"response"in t){if(t.response=="privacy_change_needs_confirmation"){e.loadConfirmationDialog(t)}else if(t.response=="privacy_change_needs_email_confirmation"){e.loadEmailConfirmationDialog()}}}).liveMutate().send();return false}};exports.ToggleQuestionPrivacyMixin=t.extend(exports.ToggleQuestionPrivacyJSMixin);exports.QuestionAnonLink=exports.ToggleQuestionPrivacyMixin.extend({onLoad:function(){var e=this;this.$id("@set_privacy").on("click",function(t){t.preventDefault();e.trySetPrivacy()})}})});define("unified_view/action_bar/overflow_menu/question",["shared/polyfills","unified_view/action_bar/overflow_menu/base","shared/events/index","unified_view/privacy"],function es(require,exports,e){
var t=require("unified_view/action_bar/overflow_menu/base"),i=require("shared/events/index"),n=require("unified_view/privacy");exports.PrivacyToggle=t.Toggleable.extend(n.ToggleQuestionPrivacyJSMixin).extend({onToggledOn:function(){this.trySetPrivacy()},onToggledOff:function(){this.trySetPrivacy()}});exports.Downvote=t.Toggleable.extend({onToggledOn:function(){this.emitEvent(i.helpers.addQuestionDownvote(this.qid));this._super.apply(this,arguments)}});exports.EditMenu=t.Item.extend({onSelectAction:function(){this.child("menu").showMenu()}});exports.ToggleEditQuestionItem=t.Item.extend({onSelectAction:function(){this.emitEvent({type:i.Types.QUESTION_EDITING_STATE,payload:{qid:this.qid,state:"edit"}})}});exports.DisclaimerQuestion=t.Toggleable.extend({onToggledOn:function(){this.emitEvent(i.helpers.inlineEditorDisclaimer("answer",this.qid))}});exports.CantAnswer=t.Toggleable.extend({onToggledOn:function(){this._super.apply(this,arguments);this.emitEvent(i.helpers.addQuestionCantAnswer(this.qid));
}})});define("unified_view/action_bar/overflow_menu/shared",["shared/polyfills","interface/settings","shared/events/index","unified_view/action_bar/overflow_menu/base","shared/client"],function ts(require,exports,e){var t=require("interface/settings").pageIsMobile,i=require("shared/events/index"),n=require("unified_view/action_bar/overflow_menu/base");if(t){var s=require("mobile_app2/client");var o=require("shared/client");var r=require("mobile_app2/messages")}exports.AddModerationFlagWrapper=n.Item.extend({desktopOnLoad:function(){},onSelectAction:function(){if(this.one_click_report){this.serverCall("one_click_report").liveMutate().send()}else{r.send("openURL",{target:"modal",url:this.url})}}});exports.NativeShare=n.Item.extend({onSelectAction:function(){var e=this;var t=function(t,i){switch(i){case 0:r.send("openURL",t.quora_message_data);break;case 1:r.send("shareCopyURL",t.copy_data);e.serverCall("share_log_copy_link").kwargs({data:t}).send();break;case 2:r.send("openURL",t.share_to_blog_data);
break}};var i=o.isAndroidApp()?t:function(){};s.showNativeShareSheet(this.share_data,i)}});exports.EditItemMobile=n.Item.extend({onSelectAction:function(){if(this.editor_kwargs.is_qtext2){this.createModal("load_editor_modal").kwargs({oid:this.oid}).onSubmit(function(e){if(e.next_url){r.send("openURL",{url:e.next_url})}}).show()}else{this.invokeRichTextEditor(this.editor_kwargs)}}});exports.EditItemWeb=n.Item.extend({onLoad:function(){this._super();this.$labelElem=this.$id("@contents");this.bindEditorEvents()},bindEditorEvents:function(){var e=this;this.handleEvent(i.Types.INLINE_EDITOR_STATE,function(t){if(t.payload.contentType!=e.content_type){return}if(t.payload.oid!=e.oid){return}if(t.payload.state=="cancel"){e.setToggled(false)}else if(t.payload.state=="submit"){e.setToggled(false)}else if(t.payload.state=="submitted"){e.setToggled(false)}else if(t.payload.state=="edit"){e.setToggled(true)}})},onSelectAction:function(){if(this.toggled){this.emitEvent(i.helpers.inlineEditorCancel(this.content_type,this.oid));
}else{this.emitEvent(i.helpers.inlineEditorEdit(this.content_type,this.oid))}},setToggled:function(e){this.toggled=e;this.updateLabel()},toggle:function(){this.setToggled(!this.toggled)},updateLabel:function(){var e=!this.toggled?this.label:this.alternate_label;this.$labelElem.text(e)}});exports.SuggestionsPendingItemWeb=exports.EditItemWeb.extend({bindEditorEvents:function(){var e=this;this.handleEvent(i.Types.INLINE_EDITOR_STATE,function(t){if(t.payload.contentType!=e.content_type){return}if(t.payload.oid!=e.oid){return}if(t.payload.state=="submit"){e.toggle()}else if(t.payload.state=="toggle"){e.toggle()}else if(t.payload.state=="cancel"){e.setToggled(false)}else if(t.payload.state=="edit"){e.setToggled(true)}})},onSelectAction:function(){this.emitEvent(i.helpers.inlineEditorToggle(this.content_type,this.oid))}});exports.AddComment=n.Item.extend({onSelectAction:function(){if(this.editor_kwargs.is_qtext2){this.createModal("load_editor_modal").kwargs({oid:this.oid,comment_type:this.comment_type
}).onSubmit(function(e){if(e.next_url){r.send("openURL",{url:e.next_url})}}).show()}else{this.invokeRichTextEditor(this.editor_kwargs)}}})});define("unified_view/action_bar/question",["shared/polyfills","shared/core/component","shared/events/index","shared/cookies","shared/action_log","interface/settings"],function is(require,exports,e){var t=require("shared/core/component").Component,i=require("shared/events/index"),n=require("shared/cookies"),s=require("shared/action_log"),o=require("interface/settings").pageIsMobile;if(o){var r=require("mobile_app2/client"),a=require("mobile_app2/messages")}exports.AddAnswerEditorWrapper=t.extend({onLoad:function(){var e=this;e.editorLoaded=!e.lazy_loaded;e.$editorWrapper=e.$id("@add_answer_editor_wrapper");e.handleEvent(i.Types.ANSWER_TOGGLE_EDITOR,function(t){if(t.payload.bundle!=e.getDvar("__writeMultiFeedBundle")){return}if(t.payload.qid==e.qid){e.toggleEditor()}})},toggleEditor:function(){if(!this.editorLoaded||o){this.loadEditor()}else if(this.$editorWrapper.hasClass("hidden")){
this.$editorWrapper.removeClass("hidden")}else{this.$editorWrapper.addClass("hidden")}},loadEditor:function(){if(o){this.loadEditorMobile()}else{this.loadEditorDesktop()}},loadEditorMobile:function(){var e=this;e.trackQuestionState();if(this.editor_kwargs.is_qtext2){this.createModal("load_editor_modal").kwargs({qid:e.qid}).onSubmit(function(t){n.setTlog({type:"AddAnswer"});n.setQfeedLog(e,"AddAnswer");s.logPrimaryAction("MobileEditorAddAnswer",e.getDvar("impression_target"));s.logSecondaryAction("MobileEditorAddAnswer",null);a.send("openURL",{url:t.next_url})}).show()}else{r.invokeRichTextEditor(e.editor_kwargs,{onSucceed:function(){n.setTlog({type:"AddAnswer"});n.setQfeedLog(e,"AddAnswer");r.broadcastReload(e.editor_kwargs.broadcast_key);s.logPrimaryAction("MobileEditorAddAnswer",e.getDvar("impression_target"));s.logSecondaryAction("MobileEditorAddAnswer",null)},onCancel:function(){r.broadcastReload(e.editor_kwargs.broadcast_key)}})}},loadEditorDesktop:function(){var e=this;e.$editorWrapper.removeClass("hidden");
e.serverCall("load_add_answer_editor").contentFor(e.$editorWrapper.get(0)).success(function(){e.editorLoaded=true}).send()},trackQuestionState:function(){this.serverCall("track_question_state").kwargs({qid:this.qid}).send()}})});define("unified_view/action_bar/shared",["shared/polyfills","shared/core/component","shared/w2.context"],function ns(require,exports,e){var t=require("shared/core/component").Component,i=require("shared/w2.context");exports.CommentsActionItem=t.extend({onLoad:function(){this.actionBarContext=this.getContext(i.ActionBar);this.$linkElem=this.$id(this.link_id);this.$linkElem.on("mouseenter",this.loadComments.bind(this));this.$linkElem.on("click",this.toggleComments.bind(this))},loadComments:function(){this.actionBarContext.set("loadComments",true)},toggleComments:function(e){e.preventDefault();var t=this.actionBarContext.get("showComments");this.actionBarContext.set("showComments",!t)}});exports.CommentsExtraItem=t.extend({onLoad:function(){this.actionBarContext=this.getContext(i.ActionBar);
this.$defaultCommentsElem=this.$id(this.wrapper_id);this.$featuredCommentElem=this.$id(this.featured_comment_wrapper_id);if(this.featured_comment_id){this.$currentWrapperElem=this.$featuredCommentElem}else{this.$currentWrapperElem=this.$defaultCommentsElem}this.fetched=false;this.isFirstToggle=true;this.actionBarContext.set("commentsElem",this.$currentWrapperElem);this.actionBarContext.on("loadComments",this.loadComments.bind(this));this.actionBarContext.on("showComments",this.toggleComments.bind(this))},loadComments:function(){if(this.fetched){return}this.fetched=true;if(this.featured_comment_id&&this.actionBarContext.get("featuredCommentExpanded")){return}this.fetchComments()},fetchComments:function(){this.serverCall("fetch_comments").contentFor(this.$defaultCommentsElem.get(0),{parentCid:this.parent().cid}).send()},toggleComments:function(e,t){if(this.isFirstToggle&&this.featured_comment_id){this.isFirstToggle=false;if(!this.actionBarContext.get("featuredCommentExpanded")){this.$currentWrapperElem=this.$defaultCommentsElem;
this.actionBarContext.set("commentsElem",this.$defaultCommentsElem);this.$id("@featured_comment_container").toggleClass("hidden",true)}else if(!this.actionBarContext.get("featuredCommentsPaged")){var i=this.actionBarContext.get("pageFeaturedCommentsLink");if(i){this.actionBarContext.set("featuredCommentsPaged",true);i.click();return}}}this.$currentWrapperElem.toggleClass("hidden",!t);this.actionBarContext.set("updateSticky",true)}})});define("unified_view/action_bar/user",["shared/polyfills","shared/core/component","interface/settings","shared/client"],function ss(require,exports,e){var t=require("shared/core/component").Component,i=require("interface/settings");if(i.pageIsMobile){var n=require("mobile_app2/client"),s=require("mobile_app2/messages"),o=require("shared/client")}exports.SendMessageActionItem=t.extend({onLoad:function(){var e=this;e.$id("@message_link").on("click",function(t){t.preventDefault();if(e.editor_kwargs.is_qtext2){e.createModal("load_editor_modal").kwargs(e.editor_kwargs.kwargs).onSubmit(function(e){
if(e.next_url){s.send("openURL",{url:e.next_url})}}).show()}else{n.invokeRichTextEditor(e.editor_kwargs,{onSucceed:function(){n.markPageAsDirty("/inbox");n.reloadDirtyPages();if(o.isIOSApp()){s.send("dismissModal")}}})}})}})});define("unified_view/answer/credibility",["shared/polyfills","shared/core/component","shared/events/index"],function os(require,exports,e){var t=require("shared/core/component").Component,i=require("shared/events/index");exports.CredibilitySection=t.extend({onLoad:function(){var e=this;this.handleEvent(i.Types.ANSWER_VOTE_STATE,function(t){if(t.payload.aid==e.aid){var i=t.payload.state=="upvoted";e.$id("@credibility_facts").toggleClass("hidden",i);e.$id("@credibility_facts_upvoted").toggleClass("hidden",!i)}})}});exports.CredibleVoterFact=t.extend({onLoad:function(){var e=this;this.$id("@social_voter_modal").on("click",function(t){t.preventDefault();e.createModal("load_social_voter_modal").kwargs({aid:e.aid}).show()})}})});define("unified_view/button/ads",["shared/polyfills","unified_view/button/abstract"],function rs(require,exports,e){
var t=require("unified_view/button/abstract").Button;exports.LearnMoreButton=t.extend({onPressed:function(){var e=this;e.win=window.open(e.ad_url,"_blank");e.win.focus()}})});define("unified_view/button/downvote",["shared/polyfills","unified_view/button/abstract","shared/cookies","shared/events/index"],function as(require,exports,e){var t=require("unified_view/button/abstract").TwoStateButton,i=require("shared/cookies"),n=require("shared/events/index");exports.Answer=t.extend({onLoad:function(){var e=this;this._super.apply(this,arguments);this.handleEvent(n.Types.ANSWER_VOTE_STATE,function(t){if(t.payload.aid==e.aid){var i=t.payload.state=="downvoted";e.switchState(i)}})},onUnpressed:function(){this.emitEvent(n.helpers.removeAnswerDownvote(this.aid));this._super.apply(this,arguments)},onPressed:function(){i.setQfeedLog(this,"AnswerDownvote");i.setTlog({type:"AnswerVoteDown",aid:this.aid});this.emitEvent(n.helpers.addAnswerDownvote(this.aid));this._super.apply(this,arguments)}});exports.BlogPost=t.extend({
onPressed:function(){i.setTlog({type:"BoardItemVoteDown",board_item_id:this.biid});this._super.apply(this,arguments)}});exports.Question=t.extend({onLoad:function(){var e=this;this._super.apply(this,arguments);this.handleEvent(n.Types.QUESTION_VOTE_STATE,function(t){if(t.payload.qid==e.qid){var i=t.payload.state=="downvoted";e.switchState(i)}})},onPressed:function(){i.setQfeedLog(this,"QuestionDownvote");i.setTlog({type:"QuestionDownvote",qid:this.qid});this.emitEvent(n.helpers.addQuestionDownvote(this.qid));this._super.apply(this,arguments)},onUnpressed:function(){this.emitEvent(n.helpers.removeQuestionDownvote(this.qid));this._super.apply(this,arguments)}})});define("unified_view/button/follow",["shared/polyfills","unified_view/button/abstract","shared/cookies","shared/w2.context","interface/settings"],function ds(require,exports,e){var t=require("unified_view/button/abstract").TwoStateButton,i=require("shared/cookies"),n=require("shared/w2.context").ActionBar,s=require("interface/settings").pageIsMobile;
if(s){var o=require("mobile_app2/client")}exports.Topic=t.extend({onPressed:function(){i.setTlog({type:"TopicFollow",tid:this.tid});i.setQfeedLog(this,"TopicFollow");this._super.apply(this,arguments)},onUnpressed:function(){i.setTlog({type:"TopicUnfollow",tid:this.tid});i.setQfeedLog(this,"TopicUnfollow");this._super.apply(this,arguments)}});exports.Question=t.extend({onLoad:function(){var e=this;e._super.apply(this,arguments);e.actionBarContext=this.getContext(n);if(s){e.reaskBroadcastKey=o.getBroadcastKey("question",this.qid,"reasked");e.followBroadcastKey=o.getBroadcastKey("question",this.qid,"following");o.registerMessageHandler(e.reaskBroadcastKey,function(t){if(t.state==="yes"){e.switchState(true)}})}if(e.actionBarContext){if(e.actionBarContext.get("toggleRAD")){e.$id("@nub").addClass("is_active")}e.actionBarContext.on("toggleRAD",function(t,i){if(i===true){e.$id("@nub").addClass("is_active")}else{setTimeout(function(){e.$id("@nub").removeClass("is_active")},160)}})}},onPressed:function(){
i.setTlog({type:"QuestionFollow",qid:this.qid});if(this.actionBarContext){this.actionBarContext.set("toggleRAD",true)}this.$id("@nub").addClass("is_active");if(s){o.broadcastKeyUpdate(this.followBroadcastKey,"yes")}this._super.apply(this,arguments)},onUnpressed:function(){i.setTlog({type:"QuestionUnfollow",qid:this.qid});if(this.actionBarContext){this.actionBarContext.set("toggleRAD",false)}this.$id("@nub").removeClass("is_active");if(s){o.broadcastKeyUpdate(this.followBroadcastKey,"no")}this._super.apply(this,arguments)}});exports.User=t.extend({onPressed:function(){i.setTlog({type:"UserFollow",uid:this.uid});i.setQfeedLog(this,"UserFollow");this._super.apply(this,arguments)},onPressedKwargs:function(){return{from_hovercard:this.getDvar("hovermenu_parent")}},onUnpressed:function(){i.setTlog({type:"UserUnfollow",uid:this.uid});i.setQfeedLog(this,"UserUnfollow");this._super.apply(this,arguments)},onUnpressedKwargs:function(){return{from_hovercard:this.getDvar("hovermenu_parent")}}});exports.Blog=t.extend({
onPressed:function(){i.setTlog({type:"BoardFollow",bid:this.bid});this._super.apply(this,arguments)}});exports.Session=t.extend({})});define("unified_view/button/network",["shared/polyfills","unified_view/button/abstract","interface/settings","shared/client"],function ls(require,exports,e){var t=require("unified_view/button/abstract").Button,i=require("interface/settings").pageIsMobile;if(i){var n=require("mobile_app2/client");var s=require("mobile_app2/messages");var o=require("shared/client")}exports.ActivationButton=t.extend({onPressed:function(){this.serverCall("press").success(this.onPressedSuccess.bind(this)).liveMutate().send()},onPressedSuccess:function(e){if(!i){document.location="/"}else if(o.isMobileWeb()){s.send("openURL",{url:"/"})}else if(o.isNativeApp()&&e.supportsSwitch){n.updateConfig(e.subdomain,e.language);s.send("dismiss")}else{s.send("reload")}}})});define("unified_view/button/notif",["shared/polyfills","unified_view/button/abstract","shared/window_manager","interface/settings"],function cs(require,exports,e){
var t=require("unified_view/button/abstract").Button,i=require("shared/window_manager"),n=require("interface/settings").pageIsMobile;if(n){var s=require("mobile_app2/client"),o=require("mobile_app2/messages")}exports.Next=t.extend({onLoad:function(){if(!n){this._super.apply(this,arguments)}else{this.onLoadMobile()}},onLoadMobile:function(){var e=this;if(!e.nextId){return}o.send("setPageAction",{rightTextButton:{title:e.text,callback:function(){o.send("setPageAction",{noRightButtons:true});s.broadcastKeyUpdate(s.getBroadcastKey("notification",e.nextId,"read_state"),"seen");s.broadcastMessageToWebViews("notifRead");o.send("setCanonicalURL",{url:e.nextUrl});e.serverCall("track_click").success(function(){o.send("reload")}).send()}}})},onClick:function(){var e=this;this.serverCall("track_click").liveMutate().success(function(){if(e.nextUrl){i.navigateTo(e.nextUrl)}}).send()}})});define("unified_view/button/pause_ad",["shared/polyfills","unified_view/button/abstract","shared/events/index"],function us(require,exports,e){
var t=require("unified_view/button/abstract").TwoStateButton,i=require("shared/events/index");exports.Ad=t.extend({onLoad:function(){var e=this;this._super.apply(this,arguments);this.handleEvent(i.Types.ADS_MANAGER_TABLE_SORT,function(t){e.$id("@button").on("click",function(t){t.preventDefault();e.onClick()})})}});exports.Campaign=t.extend({onLoad:function(){var e=this;this._super.apply(this,arguments);this.handleEvent(i.Types.ADS_MANAGER_TABLE_SORT,function(t){e.$id("@button").on("click",function(t){t.preventDefault();e.onClick()})})},onClick:function(){this.dirtyURL();var e=this.pressed;if(e){this.onUnpressed()}else{this.onPressed();this.switchState(!e)}},onUnpressed:function(){var e=this;e.createModal("load_enable_campaign_workflow_modal").show()}})});define("unified_view/button/pin",["shared/polyfills","unified_view/button/abstract","shared/cookies"],function hs(require,exports,e){var t=require("unified_view/button/abstract").TwoStateButton,i=require("shared/cookies");exports.Topic=t.extend({
onPressed:function(){i.setTlog({type:"PinFollow",oid:this.oid});i.setQfeedLog(this,"PinFollow");this._super.apply(this,arguments)},onUnpressed:function(){i.setTlog({type:"PinFollow",oid:this.oid});i.setQfeedLog(this,"PinUnfollow");this._super.apply(this,arguments)}})});define("unified_view/button/prize",["shared/polyfills","unified_view/button/abstract"],function fs(require,exports,e){var t=require("unified_view/button/abstract").Button;exports.PrizeCollectButton=t.extend({onPressed:function(){this.createModal("load_modal").kwargs({application_id:this.application_id}).show()}});exports.PrizeChooseWinnerButton=t.extend({onPressed:function(){this.createModal("load_modal").kwargs({prize_id:this.prize_id}).show()}})});define("unified_view/button/upvote",["shared/polyfills","unified_view/button/abstract","shared/cookies","shared/events/index","shared/w2.context","settings"],function ps(require,exports,e){var t=require("unified_view/button/abstract").TwoStateButton,i=require("shared/cookies"),n=require("shared/events/index"),s=require("shared/w2.context").ActionBar,o=require("settings");
exports.Answer=t.extend({onLoad:function(){var e=this;this._super.apply(this,arguments);this.actionBarContext=this.getContext(s);this.handleEvent(n.Types.ANSWER_VOTE_STATE,function(t){if(t.payload.aid==e.aid){var i=t.payload.state=="upvoted";e.switchState(i)}})},loadComments:function(){this.actionBarContext.set("loadComments",true)},onPressedKwargs:function(){var e=null;var t=this.getDvar("feed_story_hash");if(t){e=t}else if(o.trail){e=JSON.parse(o.trail).args[0]}return{feed_story_hash:e}},onUnpressed:function(){this.emitEvent(n.helpers.removeAnswerUpvote(this.aid));this._super.apply(this,arguments)},onPressed:function(){this.emitEvent(n.helpers.addAnswerUpvote(this.aid));i.setQfeedLog(this,"AnswerUpvote");i.setTlog({type:"AnswerVoteUp",aid:this.aid});this._super.apply(this,arguments)}});exports.BlogPost=t.extend({onPressed:function(){i.setQfeedLog(this,"BoardItemUpvote");i.setTlog({type:"BoardItemUpvote",board_item_id:this.biid});this._super.apply(this,arguments)}})});define("unified_view/button/writing_list",["shared/polyfills","unified_view/button/abstract","shared/cookies"],function gs(require,exports,e){
var t=require("unified_view/button/abstract").TwoStateButton,i=require("shared/cookies");exports.WritingList=t.extend({onPressed:function(){i.setTlog({type:"QuestionAnswerLater",oid:this.oid});i.setQfeedLog(this,"QuestionAnswerLater");this._super.apply(this,arguments)},onUnpressed:function(){i.setTlog({type:"UnmarkQuestionAnswerLater",oid:this.oid});i.setQfeedLog(this,"UnmarkQuestionAnswerLater");this._super.apply(this,arguments)}})});define("unified_view/captcha",["shared/polyfills","shared/core/component","shared/recaptcha","shared/w2.context"],function ms(require,exports,e){var t=require("shared/core/component").Component,i=require("shared/recaptcha"),n=require("shared/w2.context").CaptchaInput;var s=exports.AllCaptchaInstances=[];exports.CaptchaInput=t.extend({onLoad:function(){var e=this;s.push(e);e._isGrecaptchaReady=false;e.captchaContext=e.getContext(n);e.captchaContext.set("present",true);e.captchaContext.on("sync",function(t,i){var n=e.getCaptchaResponse();e.captchaContext.set("captchaResponse",n);
e.captchaContext.set("isCaptchaFilled",n!=="");if(i===true){e.maybeAddValidationText()}});e.renderedId=null;e.tryToRender();e.$id("@captcha_loading").removeClass("hidden")},onUnload:function(){var e=s.indexOf(this);if(e!==-1){s.splice(e,1)}},getCaptchaResponse:function(){return grecaptcha.getResponse(this.renderedId)},tryToRender:function(){var e=this;i.onInit(function(){e.$id("@captcha_loading").addClass("hidden");var t=function(){e.captchaContext.set("sync",true)};var i=e.$id("@captcha");var n=i.get()[0];e.renderedId=grecaptcha.render(n.id,{sitekey:e.recaptcha_key,theme:"light",callback:t,"expired-callback":t});e.captchaContext.set("captchaResponse","")})},maybeAddValidationText:function(){var e=this;i.onInit(function(){var t=e.getCaptchaResponse();if(t===""){e.$id("@captcha_validation_text").text(e.missing_captcha_text)}else{e.$id("@captcha_validation_text").text("")}})}})});define("unified_view/carousel",["shared/polyfills","shared/core/component","shared/events/index","interface/jquery"],function vs(require,exports,e){
var t=require("shared/core/component").Component,i=require("shared/events/index"),$=require("interface/jquery")._jQuery;exports.Carousel=t.extend({onLoad:function(){var e=this;e.handleCheckDismissAll();e.container=$(e.$id("@container").get(0));e.distance=0;e.oldScrollLeft=0;e.newScrollLeft=0;e.$id("@right_arrow").on("click",function(t){t.preventDefault();e.scrollCarousel("right")});e.$id("@left_arrow").on("click",function(t){t.preventDefault();e.scrollCarousel("left")})},scrollCarousel:function(e){var t=this;var i=t.getScrollAmount();var n=300;if(e=="right"){t.distance+=i}else{t.distance-=i;if(t.distance<0){t.distance=0}}t.container.animate({scrollLeft:t.distance},n,function(){t.newScrollLeft=$(this).scrollLeft();if(t.oldScrollLeft==t.newScrollLeft){t.distance=t.oldScrollLeft}t.oldScrollLeft=t.newScrollLeft})},getScrollAmount:function(){return 486},handleCheckDismissAll:function(){var e=this;e.handleEvent(i.Types.CAROUSEL_CHECK_DISMISS_ALL,function(t){if(e.suggestions.indexOf(t.payload.oid)==-1){
return}e.carouselWrapper=e.$id("@carousel").get(0);if(e.carouselWrapper.children.length){return}e.emitEvent({type:i.Types.CAROUSEL_DISMISS_ALL,payload:{story_oid:e.story_oid}})})}});exports.CarouselItem=t.extend({onLoad:function(){var e=this;e.carouselItemWrapper=$(e.$id("@carousel_item").get(0)).parent();e.$id("@dismiss").on("click",function(t){t.preventDefault();e.dismissCarouselItem()})},dismissCarouselItem:function(){var e=this;e.carouselItemWrapper.addClass("hidden");e.serverCall("dismiss").liveMutate().success(function(){e.carouselItemWrapper.remove();e.emitEvent({type:i.Types.CAROUSEL_CHECK_DISMISS_ALL,payload:{oid:e.oid}})}).send()}});exports.PileOnA2ACarousel=exports.Carousel.extend({onLoad:function(){var e=this;e._super.apply(e,arguments);this.handleEvent(i.Types.PILE_ON_REQUEST_MADE,function(t){e.scrollCarousel("right")})},getScrollAmount:function(){return 366}})});define("unified_view/cf",["shared/polyfills","shared/cf","shared/core/component"],function _s(require,exports,e){
var t=require("shared/cf"),i=require("shared/core/component").Component;exports.CFInput=i.extend({onLoad:function(){t.init(this.hidden_input_id,this.javascript_key)}})});define("unified_view/character_counter",["shared/polyfills","shared/core/component"],function ws(require,exports,e){var t=require("shared/core/component").Component;exports.CharacterCounter=t.extend({updateCounter:function(e){var t=this,i=t.$id("@counter");t.left=parseInt(t.limit)-e;i.text(t.left);i.toggleClass("warning",t.left<=t.warning_limit);t.updateVisibility()},updateVisibility:function(){if(this.left<this.visible_on){this.show()}else{this.hide()}},show:function(){if(this.left<this.visible_on){this.$id("@counter").removeClass("fade_out")}},hide:function(){if(this.left>=0){this.$id("@counter").addClass("fade_out")}}})});define("unified_view/components",["shared/polyfills","shared/core/component","interface/settings","interface/rpc"],function bs(require,exports,e){var t=require("shared/core/component").Component,i=require("interface/settings"),n=require("interface/rpc").atLeastOneServerCallIsSent;
exports.JSTest=t.extend({onLoad:function(){var e=this;setTimeout(function(){if(n()){return}e.serverCall("noop").send()},2e3);if(i.pageIsMobile){var t=(new Date).getTime();window.addEventListener("unload",function(){var e=(new Date).getTime();var n=i.windowId;var s=new Image;s.src="/api/time_on_site?start="+t+"&end="+e+"&wid="+n})}}})});define("unified_view/cookie_warning",["shared/polyfills","shared/core/component"],function ys(require,exports,e){var t=require("shared/core/component").Component;exports._CookieBanner=t.extend({onLoad:function(){var e=this;e.$id("@dismiss").on("click",function(){e.serverCall("dismiss").success(function(){e.onDismiss()}).send()})},onDismiss:function(){var e=this;e.$id("@banner").addClass("hidden")}})});define("unified_view/credential",["shared/polyfills","shared/core/component","interface/settings","unified_view/modal","settings","shared/events/index","shared/client","view/hover_menu"],function Cs(require,exports,e){var t=require("shared/core/component").Component,i=require("interface/settings").pageIsMobile,n=require("unified_view/modal").ModalBase,s=require("unified_view/modal").FormModal,o=require("settings").interface_strings,r=require("shared/events/index"),a=require("shared/client");
if(i){var d=require("mobile_app2/client"),l=require("mobile_app2/app/view/common"),c=require("mobile_app2/messages")}else{var u=require("view/hover_menu")}exports.CredentialsModal=n.extend({onLoad:function(){var e=this;e._super.apply(e,arguments);if(!i){e.handleEvent(r.Types.CREDENTIAL_ADD_FORM_VISIBILITY,function(){e.$id("@wrapper").toggleClass("hidden")})}}});exports.ChooseCredentialModal=exports.CredentialsModal.extend({onSubmit:function(){if(i){var e=this;if(e.$id("@edit_wrapper").hasClass("hidden")){e.toggleNavigationButton(true)}else{e.toggleNavigationButton(false)}this.$id("@choose_wrapper").toggleClass("hidden");this.$id("@edit_wrapper").toggleClass("hidden")}else{this._super.apply(this,arguments)}},toggleNavigationButton:function(e){var t=this,i=o.edit;if(e){i=t.choose_text}if(a.isNativeApp()){c.send("setPageAction",{rightTextButton:{title:i}})}else{t.$id("@nav").text(i)}}});exports.CredentialsListItemBase=t.extend({onLoad:function(){if(i){this.onLoadMobile()}else{this.onLoadDesktop();
}},onLoadMobile:function(){},onLoadDesktop:function(){var e=this;if(!e.is_viewer){return}e.editWrapperLoaded=false;e.serverCall("get_edit_wrapper").contentFor(e.$id("@edit_wrapper_inner").get(0)).success(function(){e.child("form").registerOnSubmitSuccess(function(){e.toggleState()});e.$id("@edit_wrapper .toggle_link").on("click",function(t){e.toggleState();t.preventDefault()});e.editWrapperLoaded=true}).send({batched:true});e.$id("@view_wrapper .toggle_link").on("click",function(t){e.toggleState();t.preventDefault();t.stopPropagation()})},toggleState:function(){this.$id("@view_wrapper").toggleClass("hidden");this.$id("@edit_wrapper").toggleClass("hidden");if(this.editWrapperLoaded===true){if(!this.$id("@edit_wrapper").hasClass("hidden")){this.child("form").autofocusField()}}}});exports.ChooseCredentialListItem=exports.CredentialsListItemBase.extend({onLoadMobile:function(){var e=this;if(!e.is_viewer){return}e.$id("@list_item").on("click",function(){if(!e.$id("@list_item").hasClass("is_checked")){
e.emitCredentialChosen()}});e.handleEvent(r.Types.CREDENTIAL_CHOSEN,function(t){if(t.payload.credential_id==e.credential_id){e.$id("@list_item").addClass("is_checked");e.setCredentialOnQuestion()}else{e.$id("@list_item").removeClass("is_checked")}})},onLoadDesktop:function(){var e=this;e._super.apply(e,arguments);e.$id("@view_wrapper").on("click",function(){if(!e.$id("@list_item").hasClass("is_checked")){e.emitCredentialChosen()}});e.handleEvent(r.Types.CREDENTIAL_CHOSEN,function(t){if(t.payload.credential_id==e.credential_id){e.setCredentialOnQuestion();e.$id("@list_item").addClass("is_checked");e.$id("@radio").get(0).checked=true}else{e.$id("@list_item").removeClass("is_checked");e.$id("@radio").get(0).checked=false}})},emitCredentialChosen:function(){var e=this;e.emitEvent({type:r.Types.CREDENTIAL_CHOSEN,payload:{credential_id:e.credential_id}})},setCredentialOnQuestion:function(){var e=this;e.serverCall("set_credential_on_question").kwargs({qid:e.qid,credential_id:e.credential_id}).liveMutate().send();
}});exports.EditCredentialListItem=exports.CredentialsListItemBase.extend({onLoadMobile:function(){var e=this;if(!e.is_viewer){return}e.$id("@list_item").on("click",function(){e.createModal("load_modal").kwargs({category:e.category,credential_id:e.credential_id}).show()})}});exports.AddCredentialListItem=exports.CredentialsListItemBase.extend({onLoadDesktop:function(){var e=this;e._super.apply(e,arguments);e.$id("@view_wrapper").on("click",function(t){e.toggleState();t.preventDefault();t.stopPropagation()})}});exports.AddCredentialsModal=s.extend({onLoad:function(){var e=this;e._super.apply(e,arguments);e.child("form").registerOnSubmitFailure(function(){if(i){l.showAlert({title:e.dialog_title,message:e.dialog_message,cancelButtonTitle:o.ok})}});e.handleEvent(r.Types.CREDENTIAL_DELETED,function(t){if(t.payload.credential_id==e.credential_id){e.submit();e.close()}})}});exports.AddCredentialsModalLink=t.extend({onLoad:function(){if(i){this.onLoadMobile()}},onLoadMobile:function(){var e=this;
e.$id("@create_modal_link").on("click",function(t){t.preventDefault();d.showActionSheet({title:e.action_sheet_title,buttonTitles:e.action_sheet_options,destructiveButtonIndex:-1,callback:function(t){if(t!==4){var i=e.action_sheet_options[t];e.loadModal(i)}}})})},loadModal:function(e){this.createModal("load_modal").kwargs({category:e,aid:this.aid}).show()}});exports.LifeExperienceExamples=t.extend({onLoad:function(){var e=this,t=0;e.interval=setInterval(function(){e.$id("@example").get(0).textContent=e.examples[t];e.$id("@example").removeClass("animate_out");e.$id("@example").addClass("animate_in");setTimeout(function(){e.$id("@example").removeClass("animate_in");e.$id("@example").addClass("animate_out")},2800);if(t==e.examples.length-1){t=0}else{t++}},3e3)},onUnload:function(){clearInterval(this.interval)}});exports.AddCredentialDropdown=t.extend({onLoad:function(){var e=this;e.overflowMenu=new u.ToggleableMenu({$linkElem:this.unsafe$id("@add_link"),$menuElem:this.unsafe$id("@overflow_menu"),
loadFunction:function(){},alignment:"left",clickOpen:true,useCssPositioning:true});if(!e.default_category){e.serverCall("get_add_forms").contentFor(e.$id("@add_forms").get(0)).send({batched:true})}e.$id("@overflow_menu .js_category_link").on("click",function(){var t=this.getAttribute("data-category");e.emitEvent({type:r.Types.CREDENTIAL_ADD_FORM_VISIBILITY,payload:{category:t}});e.serverCall("log_open_add_edit").kwargs({category:t}).send()});e.handleEvent(r.Types.CREDENTIAL_ADD_FORM_VISIBILITY,function(){e.$id("@add_link").toggleClass("hidden")})}});exports.AddCredentialDropdownForms=t.extend({onLoad:function(){var e=this;e.handleEvent(r.Types.CREDENTIAL_ADD_FORM_VISIBILITY,function(t){var i=t.payload.category;e.$id("@wrapper_"+i).toggleClass("hidden");e.child("form_"+i).autofocusField()});e.categories.forEach(function(t){e.child("form_"+t).registerOnSubmitSuccess(function(){e.child("form_"+t).clearForm();e.emitCredentialAddFormVisibility(t)});e.$id("@wrapper_"+t+" .toggle_link").on("click",function(i){
e.child("form_"+t).clearForm();e.emitCredentialAddFormVisibility(t);i.preventDefault()})})},emitCredentialAddFormVisibility:function(e){this.emitEvent({type:r.Types.CREDENTIAL_ADD_FORM_VISIBILITY,payload:{category:e}})}});exports.CredentialModalLink=t.extend({onLoad:function(){var e=this;e.$id("@modal_link").on("click",function(t){t.preventDefault();e.createModal("load_modal").kwargs(e.getKwargs()).show()})},getKwargs:function(){return{}}});exports.EditCredentialsModalLink=exports.CredentialModalLink.extend({getKwargs:function(){return{target_uid:this.target_uid}}});exports.ChooseCredentialModalLink=exports.CredentialModalLink.extend({getKwargs:function(){return{target_uid:this.target_uid,qid:this.qid,aid:this.aid}}});exports.EditCredentialModalLink=exports.CredentialModalLink.extend({getKwargs:function(){return{target_uid:this.target_uid,category:this.category}}});exports.DeleteCredentialLink=t.extend({onLoad:function(){if(i){this.onLoadMobile()}else{this.onLoadDesktop()}},onLoadMobile:function(){
var e=this;e.$id("@link").on("click",function(t){t.preventDefault();l.showAlert({title:e.dialog_title,message:e.dialog_message,cancelButtonTitle:o.cancel,otherButtonTitles:[e.dialog_button_text],callback:function(t){if(t.buttonIndex==1){e.deleteCredential();e.emitEvent({type:r.Types.CREDENTIAL_DELETED,payload:{credential_id:e.credential_id}})}}})})},onLoadDesktop:function(){var e=this;e.$id("@link").on("click",function(t){t.preventDefault();if(window.confirm(e.dialog_title_message)){e.deleteCredential()}})},deleteCredential:function(){var e=this;e.serverCall("delete_credential").kwargs({credential_id:e.credential_id}).liveMutate().send()}});exports.EditDefaultCredentialModal=n.extend({onLoad:function(){var e=this;e._super.apply(e,arguments);e.child("form").registerOnSubmitSuccess(function(){e.submit();e.close()});e.$id("@list_item .toggle_link").on("click",function(t){t.preventDefault();e.submit();e.close()})}});exports.CredentialEUXTooltip=t.extend({onLoad:function(){var e=this;if(a.isNativeApp()){
d.registerMessageHandler("pageShow",function(){e.serverCall("record_view").send()})}else{e.serverCall("record_view").send()}e.$id("@dismiss_link").on("click",function(t){t.preventDefault();e.closeTooltip()});e.$id("@button_wrapper").on("click",function(t){t.preventDefault();e.closeTooltip()})},closeTooltip:function(){var e=this;e.serverCall("dismiss").send();e.$id("@tooltip").addClass("animate_out");setTimeout(function(){e.$id("@tooltip").addClass("hidden")},150)}});exports.RemoveAllCredentialsPrompt=t.extend({onLoad:function(){var e=this;e.$id("@dismiss_link").on("click",function(t){t.preventDefault();e.serverCall("dismiss").send();e.$id("@wrapper").addClass("hidden")});e.$id("@delete_all_link").on("click",function(t){t.preventDefault();if(i){l.showAlert({title:e.dialog_title,message:e.dialog_message,cancelButtonTitle:o.cancel,otherButtonTitles:[e.dialog_button_text],callback:function(){e.deleteAllCredentials()}})}else{if(window.confirm(e.dialog_title_message)){e.deleteAllCredentials();
window.location.reload()}}})},deleteAllCredentials:function(){this.serverCall("delete_all").liveMutate().send()}})});define("shared/datetime",["shared/polyfills","settings"],function xs(require,exports,e){var t=require("settings");var i=exports.SECOND=1e3;var n=exports.MINUTE=60*i;var s=exports.HOUR=60*n;var o=exports.DAY=24*s;var r={en:{monthNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],timeAbbrevs:["d","h","m","s"],justNow:"just now",yesterday:"yesterday",agoTemplate:"{time} ago",dayMonthTemplate:"{day} {month}",dayMonthYearTemplate:"{day} {month} {year}"},es:{monthNames:["ene.","feb.","mar.","abr.","may.","jun.","jul.","ago.","sept.","oct.","nov.","dic."],timeAbbrevs:["d","h","m","s"],justNow:"ahora mismo",yesterday:"ayer",agoTemplate:"Hace {time}",dayMonthTemplate:"{day} {month}",dayMonthYearTemplate:"{day} {month} {year}"}};var a=function(){return r[t.interfaceLanguage]};var d=function(e,t){return e.replace(/\{([^{}]*)\}/g,function(e,i){return t[i];
})};var l=function(e,t){var r=new Array(4);var d=[o,s,n,i];var l=a().timeAbbrevs;var c;for(c=0;c<r.length;++c){r[c]=Math.floor(e/d[c]);e-=r[c]*d[c]}var u=0;while(u<r.length&&!r[u]){++u}var h=r.length-1;while(h>=0&&d[h]<t){--h}var f="";for(c=u;c<=h;++c){f+=r[c].toString()+l[c];if(c<h){f+=" "}}return f};exports.dayStr=function(e){var t=new Date(e/1e3);return d(a().dayMonthYearTemplate,{day:t.getDate().toString(),month:a().monthNames[t.getMonth()],year:t.getFullYear()})};exports.timestampStr=function(e,r){var c=new Date;var u=new Date(e/1e3);var h=c.getTime()-u.getTime();var f;if(h<0){if(h>=-2*i){return a().justNow}else{return u.toLocaleDateString(t.interfaceLanguage,{weekday:"short",year:"numeric",month:"short",day:"numeric"})}}if(r){f=l(h,r);if(f){return d(a().agoTemplate,{time:f})}}if(h<n){return a().justNow}if(h<s){var p=Math.floor(c.getTime()/n)-Math.floor(u.getTime()/n);f=p.toString()+a().timeAbbrevs[2];return d(a().agoTemplate,{time:f})}if(h<12*s||h<o&&c.getDate()==u.getDate()){var g=Math.floor(c.getTime()/s)-Math.floor(u.getTime()/s);
f=g.toString()+a().timeAbbrevs[1];return d(a().agoTemplate,{time:f})}var m=new Date;m.setDate(c.getDate()-1);if(h<2*o&&u.getDate()==m.getDate()){return a().yesterday}if(h<31*o&&c.getMonth()==u.getMonth()){var v=Math.floor(c.getTime()/o)-Math.floor(u.getTime()/o);f=v.toString()+a().timeAbbrevs[0];return d(a().agoTemplate,{time:f})}if(u.getFullYear()==c.getFullYear()){return d(a().dayMonthTemplate,{day:u.getDate().toString(),month:a().monthNames[u.getMonth()]})}return d(a().dayMonthYearTemplate,{day:u.getDate().toString(),month:a().monthNames[u.getMonth()],year:u.getFullYear()})}});define("unified_view/datetime_",["shared/polyfills","shared/core/component","shared/datetime"],function ks(require,exports,e){var t=require("shared/core/component").Component;var i=require("shared/datetime");exports.DateTimeComponent=t.extend({onLoad:function(){this.$timespanElem=this.$id("@datespan");if(this.js_disp){this.updateDisplayStr()}if(this.js_update_interval){var e=this.js_update_interval+Math.floor(Math.random()*this.js_update_interval*.1);
setInterval(this.updateDisplayStr.bind(this),e)}},updateDisplayStr:function(){if(this.date_only){this.$timespanElem.html(i.dayStr(this.epoch_us))}else{this.$timespanElem.html(i.timestampStr(this.epoch_us,this.granularity))}}})});define("unified_view/download_csv",["shared/polyfills","shared/core/component"],function Ss(require,exports,e){var t=require("shared/core/component").Component;exports.DownloadCSV=t.extend({onLoad:function(){var e=this;this.$id("@download_link").on("click",function(t){t.preventDefault();e.downloadData()})},createCSV:function(){var e,t;var i="";if(this.print_all_keys){for(e=0;e<this.data.length;e++){for(var n in this.data[e]){if(this.header.indexOf(n)==-1){this.header.push(n)}}}}for(e=0;e<this.data.length;e++){var s=[];for(t=0;t<this.header.length;t++){var o=this.data[e][this.header[t]];if(o===undefined){s.push(o);continue}o=String(o);if(/[,"\n]/.test(o)){s.push('"'+o.replace(/"/g,'""')+'"')}else{s.push(o)}}i+=s.join(",")+"\n"}return i},downloadData:function(){var e=this.createCSV();
var t=this.header.join(",")+"\n";var i=document.createElement("a");var n=this.file_name===undefined?"data":this.file_name;i.setAttribute("href","data:text/csv;charset=utf-8,"+encodeURIComponent(t)+encodeURIComponent(e));i.setAttribute("download",n+".csv");i.click()}})});define("unified_view/feed/explanation",["shared/polyfills","shared/core/component"],function Es(require,exports,e){var t=require("shared/core/component").Component;exports.FeedExplanationLink=t.extend({onLoad:function(){this.$id("@feed_explanation_link").on("click",this.showFeedExplanationModal.bind(this))},showFeedExplanationModal:function(){this.createModal("show_feed_explanation_modal").kwargs({story_view:this.story_view}).show()}})});define("unified_view/feed/feedback",["shared/polyfills","shared/core/component","interface/settings"],function Ts(require,exports,e){var t=require("shared/core/component").Component,i=require("interface/settings").pageIsMobile;if(i){var n=require("mobile_app2/app/view/common")}exports.UnfollowOrMuteTopic=t.extend({
onLoad:function(){this.$id("@unfollow_topic").on("click",this.unfollow.bind(this));this.$id("@mute_topic").on("click",this.mute.bind(this))},unfollow:function(e){e.preventDefault();this.serverCall("unfollow_topic").liveMutate().send()},mute:function(e){e.preventDefault();this.serverCall("mute_topic").liveMutate().send()}});exports.MuteUserModalLink=t.extend({onLoad:function(){var e=this;var t=function(){e.serverCall("toggle_mute_for_user").liveMutate().send()};e.$id("@mute_user").on("click",function(s){s.preventDefault();if(i){if(e.modal_kwargs.is_muted){n.showConfirm({title:e.modal_kwargs.unmute_title,message:e.modal_kwargs.unmute_message,callback:t})}else{n.showConfirm({title:e.modal_kwargs.mute_title,message:e.modal_kwargs.mute_message,callback:t})}}else{e.createModal("toggle_mute_user_modal").onSubmit(t).show()}})}})});define("unified_view/feed/modal",["shared/polyfills","shared/core/component","shared/client_tracker","shared/cookies"],function $s(require,exports,e){var t=require("shared/core/component").Component,i=require("shared/client_tracker"),n=require("shared/cookies");
exports.OneClickOverlay=t.extend({onLoad:function(){var e=this;e.$id("@link").on("click",function(){i.track(e.qfeed_log_action,null,e);n.setQfeedLog(e,e.qfeed_log_action)})}})});define("unified_view/form",["shared/polyfills","shared/core/component","interface/settings","shared/w2.context","shared/client"],function Ls(require,exports,e){var t=require("shared/core/component").Component,i=require("interface/settings").pageIsMobile,n=require("shared/w2.context"),s,o,r;if(i){s=require("shared/client");o=require("mobile_app2/client");r=require("mobile_app2/messages")}exports.Form=t.extend({onLoad:function(){var e=this;e.autofocusField();if(e.should_render_submit_button){e.$id("@submit").on("click",function(t){t.preventDefault();e.submitForm()})}},autofocusField:function(){var e=this;var t=function(){e.children().forEach(function(t){if(t.getFieldId){if(t.getFieldId()==e.field_id_to_autofocus){t.whenOnLoaded(function(){t.focusField()})}}})};if(e.field_id_to_autofocus){if(i){o.registerMessageHandler("pageReadyComplete",function(){
t()})}else{t()}}},getServerCallKwargsFromForm:function(){var e={};this.children().forEach(function(t){if(t.getFieldId){var i=t.getFieldId();e[i]=t.getValue()}});return e},validateForm:function(){var e=true;this.children().forEach(function(t){if(t.isSubmittable){if(t.isSubmittable()){t.removeRequiredIndicator()}else{t.addRequiredIndicator();e=false}}});return e},clearForm:function(){this.children().forEach(function(e){if(e.clearValue){e.clearValue()}})},submitForm:function(){if(this.validateForm()){this._submitForm()}else{this.onSubmitFailure()}},_submitForm:function(){var e=this;e.$id("@submit").addClass("is_disabled");e.serverCall("submit").kwargs(e.getServerCallKwargsFromForm()).success(e.onSubmitSuccess()).liveMutate().send()},registerOnSubmitSuccess:function(e){this._callbackSuccess=e},registerOnSubmitFailure:function(e){this._callbackFailure=e},onSubmitSuccess:function(){if(this._callbackSuccess){this._callbackSuccess()}if(this.should_clear_form_after_submitting){this.clearForm()}},
onSubmitFailure:function(){if(this._callbackFailure){this._callbackFailure()}}});exports.FormField=t.extend({onLoad:function(){var e=this;e.$field=e.$id("@"+e.field_id);e.$field.on("keydown",function(){e.removeRequiredIndicator()})},getFieldId:function(){return this.field_id},focusField:function(){this.$field.focus();if(i){if(s.isAndroidApp()){r.send("showKeyboard")}}},getValue:function(){return this.$field.get(0).value},setValue:function(e){this.$field.get(0).value=e},clearValue:function(){this.setValue("")},isValid:function(){return this.$field.get(0).value.length>0},addRequiredIndicator:function(){this.$field.addClass("required_indicator");if(!i){this.$id("@error_tooltip").removeClass("hidden")}},removeRequiredIndicator:function(){this.$field.removeClass("required_indicator");if(!i){this.$id("@error_tooltip").addClass("hidden")}},isSubmittable:function(){if(this.required){return this.isValid()}else{return true}}});exports.FormFieldSelect=exports.FormField.extend({setValue:function(e){
this.$field.get(0).value=e[0]},clearValue:function(){var e=this.options[this.default_selection];if(e){return this.setValue(e)}}});exports.FormFieldCheckbox=exports.FormField.extend({onLoad:function(){this._super.apply(this,arguments);if(i){var e=this;e.$id("@label").on("click",function(){if(e.$id("@wrapper").hasClass("is_checked")){e.$field.get(0).checked=false}else{e.$field.get(0).checked=true}e.$id("@wrapper").toggleClass("is_checked")})}},getValue:function(){return this.$field.get(0).checked},setValue:function(e){if(e=="true"||e=="checked"){this.$field.get(0).setAttribute("checked")}else{this.$field.get(0).removeAttribute("checked")}},clearValue:function(){this.setValue(false)}});exports.FormFieldTopicSelector=exports.FormField.extend({contextConstructor:function(){return n.FormFieldTopicSelector},onLoad:function(){this._super.apply(this,arguments);var e=this;e.$value=e.$id("@value");e.formFieldTopicSelectorContext=e.getContext(n.FormFieldTopicSelector);e.formFieldTopicSelectorContext.on("topicName",function(t,i){
if(i){e.setInput(i)}});e.$id("@remove_topic").on("click",function(t){t.preventDefault();e.clearInput()})},setInput:function(e){var t=this;var i=document.createElement("span");i.className="TopicName";i.textContent=e;t.$field.get(0).appendChild(i);t.$field.removeClass("hidden");t.$id("@remove_topic").removeClass("hidden");t.$id("@selector").addClass("hidden");setTimeout(function(){t.setValue(t.formFieldTopicSelectorContext.get("tid"))},100)},clearInput:function(){var e=this;e.$field.addClass("hidden");e.$id("@remove_topic").addClass("hidden");e.$id("@selector").removeClass("hidden");e.$field.get(0).innerHTML="";e.setValue("")},focusField:function(){this.child("selector").focus()},getValue:function(){return parseInt(this.$value.get(0).value)},setValue:function(e){this.$value.get(0).value=e},clearValue:function(){this.clearInput()},isValid:function(){var e=this.getValue();return e&&e!==""},addRequiredIndicator:function(){this.$id("@selector").addClass("required_indicator")},removeRequiredIndicator:function(){
this.$id("@selector").removeClass("required_indicator")}})});define("unified_view/home/logged_out_feed",["shared/polyfills","unified_view/toggle"],function Ms(require,exports,e){var t=require("unified_view/toggle");exports.LoggedOutMultifeedBundle=t.ToggleBase.extend({onLoad:function(){this._super.apply(this,arguments);var e=this;this.$id("@view_more").on("click",function(){e.$id("@view_more").text(e.loading_text)})}})});define("unified_view/lazy",["shared/polyfills","shared/core/component","interface/rpc"],function Ds(require,exports,e){var t=require("shared/core/component").Component,i=require("interface/rpc").rpc,n=require("shared/core/component").parseVcon;exports.LazyComponent=t.extend({onLoad:function(){var e=this;var t=e.$id("@wrapper").get()[0];if(t){i("/api/rerender_component_POST").contentFor(t,{parentCid:e.parent().cid}).kwargs({serialized_component:e.serialized_component,vcon:n(e)}).send({batched:true})}}})});define("unified_view/mobile_debug",["shared/polyfills","shared/core/component","shared/cookies","shared/keystrokes"],function As(require,exports,e){
var t=require("shared/core/component").Component,i=require("shared/cookies"),n=require("shared/keystrokes"),s,o;var r=t.extend({toggle:function(){var e=this;if(e.has_cookie){i.setCookie(e.cookie_key,null)}else{i.setCookie(e.cookie_key,1)}window.location.reload()}});exports.ToggleMobileButton=r.extend({onLoad:function(){var e=this;s=e;e.$id("@toggle").on("click",function(t){e.toggle();t.preventDefault();t.stopPropagation();return false})}});exports.ToggleTabletButton=r.extend({onLoad:function(){var e=this;o=e;e.$id("@toggle").on("click",function(t){e.toggle();t.preventDefault();t.stopPropagation();return false})}});n.on([77,48,77,48],function(){if(s){s.toggle()}});n.on([84,48,84,48],function(){if(o){o.toggle()}})});define("unified_view/multifeed/_multifeed",["shared/polyfills","shared/core/component","settings","unified_view/toggle","shared/events/index","view/hover_menu"],function Is(require,exports,e){var t=require("shared/core/component").Component,i=require("settings"),n=i.pageIsMobile,s=require("unified_view/toggle"),o=require("shared/events/index");
if(n){var r=require("mobile_app2/client")}else{var a=require("view/hover_menu")}exports.Bundle=t;exports.ExpandableBundle=s.ToggleBase;exports.QuestionsInTopicHeader=t.extend({onLoad:function(){var e=this;if(n){e.$id("@bundle_action").on("click",function(){e.showActionSheet()})}e.handleEvent(o.Types.KNOWS_ABOUT_ADD_TOPIC,function(t){if(t.payload.tid==e.tid){e.addKnowsAboutTopic()}});e.handleEvent(o.Types.KNOWS_ABOUT_REMOVE_TOPIC,function(t){if(t.payload.tid==e.tid){e.removeKnowsAboutTopic()}})},addKnowsAboutTopic:function(){var e=this;e.serverCall("add_knowsabout_topic").kwargs({tid:e.tid}).liveMutate().send()},removeKnowsAboutTopic:function(){var e=this;e.serverCall("remove_knowsabout_topic").kwargs({tid:e.tid}).liveMutate().send()},showActionSheet:function(){var e=this;r.showActionSheet({buttonTitles:e.actionSheetTitles,destructiveButtonIndex:0,callback:function(t){if(e.is_knows_about_topic){if(t==0){e.emitEvent({type:o.Types.KNOWS_ABOUT_REMOVE_TOPIC,payload:{tid:e.tid}})}else{return}
}else{if(t==0){e.emitEvent({type:o.Types.KNOWS_ABOUT_ADD_TOPIC,payload:{tid:e.tid}})}else if(t==1){e.emitEvent({type:o.Types.MULTIFEED_BUNDLE_REMOVE,payload:{tid:e.tid}})}else{return}}}})}});exports.QuestionsInTopic=exports.ExpandableBundle.extend({onLoad:function(){this._super.apply(this,arguments);var e=this;this.handleEvent(o.Types.MULTIFEED_BUNDLE_REMOVE,function(t){if(t.payload.tid==e.tid){e.hideBundle()}})},hideBundle:function(){this.$id("@normal_state").addClass("hidden");this.$id("@removed_state").removeClass("hidden");this.serverCall("hide_bundle").kwargs({tid:this.tid}).send()}});exports.QuestionsInTopicWebOverflowLink=t.extend({onLoad:function(){var e=this;this.overflowMenu=new a.ToggleableMenu({$linkElem:this.unsafe$id("@bundle_action"),$menuElem:this.unsafe$id("@overflow_menu"),loadFunction:function(){},alignment:"right",clickOpen:true,shouldAttachToBody:true});e.$id("@remove_knowsabout_topic").on("click",function(){e.emitEvent({type:o.Types.KNOWS_ABOUT_REMOVE_TOPIC,payload:{
tid:e.tid}})});e.$id("@add_knowsabout_topic").on("click",function(){e.emitEvent({type:o.Types.KNOWS_ABOUT_ADD_TOPIC,payload:{tid:e.tid}})});e.$id("@hide_topic_bundle").on("click",function(){e.emitEvent({type:o.Types.MULTIFEED_BUNDLE_REMOVE,payload:{tid:e.tid}})})}});exports.AmaSelfServeQuestions=exports.Bundle.extend({onLoad:function(){this._super.apply(this,arguments);var e=this;var t=e.$id("@start_button");if(t){t.on("click",function(){e.createModal("open_session_modal").show()})}}});exports.AmaSelfServeBundleHeader=t.extend({onLoad:function(){var e=this;var t=e.$id("@stop_button");if(t){t.on("click",function(){e.createModal("close_session_modal").show()})}}})});define("unified_view/multifeed/view_tracker",["shared/polyfills","shared/core/component","shared/Class","shared/errors","interface/settings","shared/client","shared/debounce","shared/viewport"],function qs(require,exports,e){var t=require("shared/core/component"),i=require("shared/Class").Class,n=require("shared/errors"),s=require("interface/settings").pageIsMobile,o=require("shared/client"),r=require("shared/debounce").throttle,a=require("shared/viewport"),d;
if(s){d=require("mobile_app2/client")}var l=1e3;var c=new Date;var u=i.extend({__init__:function(){this.throttledLogViews=r(this.logViews.bind(this),l);if(o.isNativeApp()){d.registerMessageHandler("tick",this.throttledLogViews)}else{document.addEventListener("scroll",this.throttledLogViews);document.addEventListener("mousemove",this.throttledLogViews)}this.trackedComponentCids=[];this.alreadyLoggedCids={}},trackComponent:function(e,t){var i=this;if(!t){t=0}if(!e.getViewableElement){n.logJsError("ViewTracker","Component "+e.cid+" must implement getViewableElement");return}if(!e.onEnterView){n.logJsError("ViewTracker","Component "+e.cid+" must implement onEnterView");return}var s=new Date-c;var o=Math.max(0,t-s);setTimeout(function(){i.delayedTrackComponent(e)},o)},delayedTrackComponent:function(e){this.trackedComponentCids.push(e.cid);if(!o.isNativeApp()){this.throttledLogViews()}},logViews:function(){for(var e=0;e<this.trackedComponentCids.length;e++){var i=this.trackedComponentCids[e];if(!this.alreadyLoggedCids[i]){
var n=t._safeGetComponentByCID(i);var s=this.isComponentVisible(n);if(s){n.onEnterView();this.alreadyLoggedCids[i]=true}}}},isComponentVisible:function(e){var t=e.getViewableElement();return a.isElementInViewport(t)}});exports.viewTracker=new u});define("unified_view/multifeed/story",["shared/polyfills","shared/core/component","shared/events/index","shared/logging","interface/settings","unified_view/multifeed/view_tracker","shared/window_manager","fx"],function Ns(require,exports,e){var t=require("shared/core/component"),i=require("shared/core/component").Component,n=require("shared/events/index"),s=require("shared/logging"),o=require("interface/settings").pageIsMobile,r=require("unified_view/multifeed/view_tracker").viewTracker,a=require("shared/window_manager"),d;if(!o){d=require("fx")}exports.FeedStory=i.extend({onLoad:function(){this.initiallyVisible=r.isComponentVisible(this);this.waitUntilImpressionLogMs=2e3;this.setDvar("feed_story_hash",this.qfeed_log_hash);this.setDvar("feed_story_position",this.position);
this.setDvar("bundle_position",this.bundle_position);this.setDvar("feed_story_initial",this.initiallyVisible);this.setDvar("feed_ty",this.feed_ty);this.setDvar("feed_page",this.feed_page);this.setDvar("focus_ty",this.focus_ty);this.setDvar("page_data",this.page_data);this.setDvar("enable_feed_logging",true);r.trackComponent(this,this.waitUntilImpressionLogMs);if(this.scroll_to_top){var e=this.$id("@item");var t=e.offset().top;t-=a.headerOffset+20;window.scroll(0,t);if(!o){d.highlight(e.get(0),2e3)}}},onEnterView:function(){var e={hash:this.qfeed_log_hash,initially_visible:this.initiallyVisible,position:this.position,bundle_position:this.bundle_position};s.log("feed_impression",{request_data:[e],__js_data__:this.__js_init})},getViewableElement:function(){return t.getLiveDomElement(this.cid)}});exports.AnswerFeedStory=exports.FeedStory.extend({onLoad:function(){var e=this;this._super.apply(this,arguments);e.answerFeedbackLoaded=false;e.handleEvent(n.Types.ANSWER_VOTE_STATE,function(t){if(t.payload.aid==e.aid){
if(t.payload.state=="downvoted"){e.showAnswerDownvoteFeedback()}else{e.hideAnswerDownvoteFeedback()}}})},showAnswerDownvoteFeedback:function(){var e=this;e.$id("@item").addClass("hidden");e.$id("@answer_feedback").removeClass("hidden");if(e.answerFeedbackLoaded===false){e.serverCall("load_downvote_feedback").contentFor(e.$id("@answer_feedback"),{parentCid:e.cid}).success(function(){e.answerFeedbackLoaded=true}).send()}},hideAnswerDownvoteFeedback:function(){this.$id("@item").removeClass("hidden");this.$id("@answer_feedback").addClass("hidden")}});exports.QuestionFeedStory=exports.FeedStory.extend({onLoad:function(){var e=this;this._super.apply(this,arguments);e.questionFeedbackLoaded=false;e.handleEvent(n.Types.QUESTION_VOTE_STATE,function(t){if(t.payload.qid==e.qid){if(t.payload.state=="downvoted"){e.showQuestionDownvoteFeedback()}else{e.hideQuestionDownvoteFeedback()}}});this.handleEvent(n.Types.QUESTION_CANT_ANSWER_STATE,function(t){if(t.payload.qid==e.qid){var i=t.payload.state=="passed";
e.$id("@item").toggleClass("cant_answer",i)}})},showQuestionDownvoteFeedback:function(){var e=this;e.$id("@item").addClass("hidden");e.$id("@question_feedback").removeClass("hidden");if(e.questionFeedbackLoaded===false){e.serverCall("load_downvote_feedback").contentFor(e.$id("@question_feedback"),{parentCid:e.cid}).success(function(){e.questionFeedbackLoaded=true}).send()}},hideQuestionDownvoteFeedback:function(){this.$id("@item").removeClass("hidden");this.$id("@question_feedback").addClass("hidden")}})});define("unified_view/multifeed/write",["shared/polyfills","shared/core/component","settings"],function Os(require,exports,e){var t=require("shared/core/component").Component,i=require("settings"),n=i.pageIsMobile;exports.EditKnowsAboutTopicsSection=t.extend({onLoad:function(){var e=this;if(!n){e.$id("@add_topics_link").on("click",function(){e.createModal("load_modal").show()})}}})});define("unified_view/network/invite",["shared/polyfills","shared/events/index","interface/settings","unified_view/modal","interface/modal","shared/core/component"],function Rs(require,exports,e){
var t=require("shared/events/index"),i=require("interface/settings"),n=require("unified_view/modal").ModalBase,s=require("interface/modal"),o=require("shared/core/component").Component;if(i.pageIsMobile){var r=require("mobile_app2/messages")}exports.InviteModalLink=o.extend({onLoad:function(){var e=this;e.$id("@link").on("click",function(){e.createModal("load_modal").show()})}});exports.InviteFormBase=o.extend({onLoad:function(){var e=this;this.handleEvent(t.Types.NETWORK_INVITE_USER,function(t){if(t.payload.uid){e.setToUser(t.payload.uid)}else if(t.payload.email){e.performInviteActionToEmail(t.payload.email)}})},setToUser:function(e){this.serverCall("perform_invite_existing_user_action").kwargs({invitee_uid:e}).success(this.onSuccessfulInvite.bind(this)).liveMutate().send()},onSuccessfulInvite:function(){if(i.pageIsMobile){s.handleClose(this)}else{if(this.child("selector")){this.child("selector").setQuery("")}}},performInviteActionToEmail:function(e){this.serverCall("perform_invite_action").kwargs({
email:e}).success(this.onSuccessfulInvite.bind(this)).liveMutate().send()}});exports.InviteModal=n.extend({onUnload:function(){if(i.pageIsMobile){r.send("hideSearchInput")}}})});define("unified_view/network/join",["shared/polyfills","shared/core/component","shared/events/index","unified_view/modal","interface/settings"],function Ps(require,exports,e){var t=require("shared/core/component").Component,i=require("shared/events/index"),n=require("unified_view/modal").ModalBase,s=require("interface/settings").pageIsMobile;if(s){var o=require("mobile_app2/messages")}exports.SwitchableWithLoginForms=t.extend({onLoad:function(){var e=this;this.handleEvent(i.Types.NETWORK_BETA_LOGIN_FORM_STATE,function(t){if(t.payload.showLogin){e.showLoginForm()}else{e.showNonLoginForm()}})},showLoginForm:function(){this.$id("@non_login_form").addClass("hidden");this.$id("@login_form").removeClass("hidden")},showNonLoginForm:function(){this.$id("@non_login_form").removeClass("hidden");this.$id("@login_form").addClass("hidden");
}});exports.LoggedOutMainBase=t.extend({onLoad:function(){var e=this;if(s&&e.setPageScrollable){var t=require("mobile_app2/messages");t.send("setPageProperties",{scrollable:true});this.$id("@link").on("click",function(){t.send("setPageProperties",{scrollable:false})})}}});exports.PublicRequestForm=t.extend({onLoad:function(){var e=this;if(s){e.$email=e.child("email").$id("@email");e.$name=e.child("name").$id("@name");e.$bio=e.child("bio").$id("@bio")}else{e.$email=e.$id("@email");e.$name=e.$id("@name");e.$bio=e.$id("@bio")}e.handleEvent(i.Types.NETWORK_BETA_WAITLIST_FORM_STATE,function(t){if(t.payload.email){e.$email.val(t.payload.email)}if(t.payload.name){e.$name.val(t.payload.name)}e.showLoginAttemptFailedDescription();e.updateButton()});e.$email.on("input",function(){e.updateButton()});e.$name.on("input",function(){e.updateButton()});e.$bio.on("input",function(){e.updateButton()});e.$id("@submit").on("click",function(){e.sendRequest()});e.$id("@login").on("click",function(){e.showLoginForm();
});e.$id("@login2").on("click",function(){e.showLoginForm()})},showLoginForm:function(){this.emitEvent({type:i.Types.NETWORK_BETA_LOGIN_FORM_STATE,payload:{showLogin:true}})},showLoginAttemptFailedDescription:function(){this.$id("@login_attempt_failed").removeClass("hidden")},updateButton:function(){var e=this;if(e.$email.val().length>0&&e.$name.val().length>0&&e.$bio.val().length>0){e.$id("@submit").removeClass("disabled")}else{e.$id("@submit").addClass("disabled")}},sendRequest:function(){var e=this;var t=e.$email.val(),i=e.$name.val(),n=e.$bio.val();e.serverCall("request").kwargs({email:t,name:i,bio:n}).contentFor(e.$id("@request_form_content")).send()}});exports.EmailRequestInlineFeedback=t.extend({onLoad:function(){var e=this;this.$id("@login").on("click",function(){e.emitEvent({type:i.Types.NETWORK_BETA_LOGIN_FORM_STATE,payload:{showLogin:false}})})}});var r=exports.LoggedInJoinSiloPromptLink=t.extend({onLoad:function(){var e=this;e.setLinkHandler();if(e.should_show_modal_on_load){
e.showModal()}},setLinkHandler:function(){var e=this;e.$id("@link").on("click",function(){e.showModal()})},showModal:function(){var e=this;if(s){e.emitEvent({type:i.Types.NETWORK_JOIN_MODAL,payload:{showModal:true}})}else{e.createModal("load_desktop").show()}}});exports.MobileAppLoggedInJoinSiloPromptPageAction=r.extend({setLinkHandler:function(){var e=this;e.setModalLinkState(false);e.handleEvent(i.Types.NETWORK_JOIN_MODAL,function(t){if(t.payload.modalShown){e.setModalLinkState(true)}else if(t.payload.modalDismissed){e.setModalLinkState(false)}})},setModalLinkState:function(e){o.send("setPageAction",{rightTextButton:{title:this.join_text,callback:this.showModal.bind(this),disabled:e}})}});exports.DesktopLoggedInJoinSiloModal=n.extend({onLoad:function(){var e=this;e._super.apply(e,arguments);e.handleEvent(i.Types.NETWORK_JOIN_MODAL,function(t){if(!t.payload.showModal){if(t.payload.hasBeenMarkedAsDecideLater){e.close()}else{e.onClose()}}})},onClose:function(){var e=this;e.serverCall("mark_as_decide_later").success(function(){
e.close()}).send()}});exports.MobileLoggedInJoinSiloModalWrapper=t.extend({onLoad:function(){var e=this;e.$id("@background").on("click",function(){e.dismissModal(true)});e.handleEvent(i.Types.NETWORK_JOIN_MODAL,function(t){if(t.payload.showModal){e.showModal()}else if(t.payload.hideModal){e.dismissModal(!t.payload.hasBeenMarkedAsDecideLater)}})},showModal:function(){var e=this;e.$id("@wrapper").addClass("show");var t=e.$id("@modal_wrapper");if(!t.html().length){e.serverCall("load_modal").contentFor(t).send()}e.emitEvent({type:i.Types.NETWORK_JOIN_MODAL,payload:{modalShown:true}})},_hideWrapper:function(){var e=this;e.$id("@wrapper").addClass("animate_out");setTimeout(function(){e.$id("@wrapper").removeClass("show");e.$id("@wrapper").removeClass("animate_out")},200);e.emitEvent({type:i.Types.NETWORK_JOIN_MODAL,payload:{modalDismissed:true}})},dismissModal:function(e){var t=this;if(e){t.serverCall("mark_as_decide_later").success(function(){t._hideWrapper()}).send()}else{t._hideWrapper()}}
});exports.MobileLoggedInJoinSiloModal=t.extend({onLoad:function(){var e=this;e.$id("@close").on("click",function(){e.emitEvent({type:i.Types.NETWORK_JOIN_MODAL,payload:{hideModal:true,hasBeenMarkedAsDecideLater:false}})})}});exports.LoggedInJoinSiloPrompt=t.extend({onLoad:function(){var e=this;e.serverCall("mark_as_shown").send();e.$id("@decide_later").on("click",function(){e.serverCall("mark_as_decide_later").success(function(){e.dismissModal()}).send()});e.$id("@mark_as_do_not_know").on("click",function(){e.serverCall("mark_as_do_not_know").success(function(){e.dismissModal()}).send()})},dismissModal:function(){this.emitEvent({type:i.Types.NETWORK_JOIN_MODAL,payload:{hideModal:true,hasBeenMarkedAsDecideLater:true}})}})});define("interface/oauth",["shared/polyfills","interface/settings","shared/google_","shared/facebook","settings"],function Bs(require,exports,e){var t=require("interface/settings"),i=t.pageIsMobile,n=require("shared/google_"),s=require("shared/facebook"),o=require("settings");
if(i){var r=require("mobile_app2/messages")}var a=false;function d(e){return e&&e!=="False"&&e!=="false"}function l(e,t,i){return function(n){if(n.provider!==e){return}if(n.provider==="google"){if(a){return}if(n.success!==undefined){a=true}}if(d(n.success)){n.success=true;t(n)}else{i(n)}}}exports.googleOnLoad=function(e,t,n){if(i){var s=e.mobile_data;if(s.success!==null){if(d(s.success)){var o={target:"signup",provider:s.provider,success:s.success,access_token:s.access_token};r.send("showLoadingView");t(o)}else{var a="failed in googleOnLoad";n(a)}}}};exports.googleConnect=function(e,t,s){a=false;if(i){var d=e.mobile_data;if(d.supports_new_oauth){var c=l("google",t,s);r.send("showOauthConnectDialog",{provider:"google",url:d.url,scope:d.scope,perms:d.perms},c)}else{r.send("showGoogleConnectDialog",{url:d.url,scope:d.scope,perms:d.perms})}}else{var u=function(e){if(a){return}if(e.success!==undefined){a=true}if(e&&e.error===undefined){if(e.status.method==="AUTO"&&e.num_sessions===1||e.status.method==="PROMPT"){
t(e);return}}if(e.error&&e.error!=="immediate_failed"){s()}};var h={callback:u,clientid:o.googleClientId,cookiepolicy:o.googleCookiePolicy,scope:e.web_data.scope};if(e.web_data.prompt_ota_install){h.apppackagename=o.androidAppPackageName}n.onInit(function(){window.gapi.auth.setToken(null);window.gapi.auth.signIn(h)})}};exports.facebookConnect=function(e,t,n){if(i){var o=l("facebook",t,n);if(e.supports_new_oauth){r.send("showOauthConnectDialog",{provider:"facebook",perms:e.perms},o)}else{r.send("showFacebookConnectDialog",{perms:e.perms})}}else{var a=function(e){if(e&&e.status=="connected"){t(e.authResponse)}else{n()}};s.onInit(function(){FB.login(a,{scope:e.perms})})}}});define("unified_view/signup/facebook",["shared/polyfills","unified_view/signup/_signup","interface/oauth","shared/facebook","settings"],function Fs(require,exports,e){var t=require("unified_view/signup/_signup").SignupContext,i=require("interface/oauth"),n=require("shared/facebook"),s=require("unified_view/signup/_signup").SignupActionableComponent;
exports.SignupFacebookConnectButton=s.extend({onLoad:function(){this._super.apply(this,arguments);this.signupContext=this.getContext(t);this.$id("@facebook_connect_button").on("click",this.clicked.bind(this));n.load()},clicked:function(){this.serverCall("log_click_to_scribe").kwargs({button_type:"facebook"}).send();i.facebookConnect(this,this.onConnectSucceeded.bind(this),this.onConnectFailed.bind(this));if(require("settings").instance.includes("test")){document.addEventListener("facebook_ui_test_event",function(e){var t={userID:e.detail.fb_uid,accessToken:e.detail.fb_access_token,expiresIn:e.detail.expires,use_test_signup:e.detail.use_test_signup};this.onConnectSucceeded(t)}.bind(this))}},onConnectSucceeded:function(e){this.signupContext.set("facebookOauthData",e)},onConnectFailed:function(){}})});define("unified_view/signup/google",["shared/polyfills","unified_view/signup/_signup","settings","interface/oauth","shared/window_manager","shared/google_","shared/core/component","interface/settings"],function Us(require,exports,e){
var t=require("unified_view/signup/_signup").SignupContext,i=require("settings"),n=require("interface/oauth"),s=require("shared/window_manager"),o=require("unified_view/signup/_signup"),r=require("shared/google_"),a=o.SignupActionableComponent,d=require("shared/core/component").Component,l=require("interface/settings").pageIsMobile;if(l){var c=require("mobile_app2/app/view/common");var u=require("mobile_app2/messages")}window.loginInProgress=false;exports.SignupGoogleConnectButton=a.extend({onLoad:function(){this._super.apply(this,arguments);this.signupContext=this.getContext(t);this.$id("@google_connect_button").on("click",this.onClick.bind(this));n.googleOnLoad(this,this.onConnectSuceeded.bind(this),this.onConnectFailed.bind(this))},onClick:function(){this.serverCall("log_click_to_scribe").kwargs({button_type:"google"}).send();n.googleConnect(this,this.onConnectSuceeded.bind(this),this.onConnectFailed.bind(this));if(require("settings").instance.includes("test")){document.addEventListener("google_ui_test_event",function(e){
var t={access_token:e.detail.access_token,use_test_signup:true};this._setGoogleOauthDataOnConnectSucceeded(t)}.bind(this))}},_setGoogleOauthDataOnConnectSucceeded:function(e){this.signupContext.set("googleOauthData",e)},onConnectSuceeded:function(e){if(l){if(require("settings").instance.includes("test")){e.access_token="fake.google";e.use_test_signup=true}if(!e.access_token){e.access_token=this.mobile_data.access_token}}this._setGoogleOauthDataOnConnectSucceeded(e)},onConnectFailed:function(e){if(l){this.onConnectFailedMobile(e)}else{this.onConnectFailedWeb()}},onConnectFailedWeb:function(){this.serverCall("render_google_connect_failed_message").send()},onConnectFailedMobile:function(e){var t=this;c.showAlert({title:this.mobile_data.error_title,message:this.mobile_data.error_message});var i="";try{i=JSON.stringify(e)}catch(n){i=""+n}t.serverCall("log_google_oauth_failure").kwargs({data_or_error:i}).send()}});exports.GoogleAutoLoginWeb=d.extend({onLoad:function(){var e=this;if(!e.viewer){
r.onInit(function(){window.gapi.auth.authorize({immediate:true,client_id:i.googleClientId,cookiepolicy:i.googleCookiePolicy,scope:e.scopes},e.signInCallback.bind(e))})}},signInCallback:function(e){if(e&&e.error===undefined){this.onLogin(e)}},onLogin:function(e){if(window.loginInProgress===true){return}window.loginInProgress=true;this.serverCall("try_auto_login").kwargs({access_token:e.access_token}).success(function(e){if(e&&i.pageMode==="post_reload"){s.reload()}window.loginInProgress=false}).error(function(){window.loginInProgress=false}).except(function(){window.loginInProgress=false}).send()}});exports.GoogleAutoLoginMobile=d.extend({onLoad:function(){var e=this;this.requestedGoogleAPI=false;if(!e.viewer){r.onInit(function(){window.gapi.auth.authorize({immediate:true,client_id:i.googleClientId,cookiepolicy:i.googleCookiePolicy,scope:e.scopes},e.signInCallback.bind(e))})}},signInCallback:function(e){if(e&&e.error===undefined){this.serverCall("try_auto_login").kwargs({access_token:e.access_token
}).success(this.onLogin.bind(this)).send()}},onLogin:function(e){if(e){var t=function(){u.send("loginStateChanged",{isLoggedIn:true})};var i={name:"login_redirect_url",value:this.redirect_url,options:{expires:1}};u.send("setCookie",i,t)}}})});define("unified_view/network/login",["shared/polyfills","unified_view/signup/_signup","shared/events/index","unified_view/signup/facebook","unified_view/signup/google"],function js(require,exports,e){var t=require("unified_view/signup/_signup").BaseSignupForm,i=require("shared/events/index"),n=require("unified_view/signup/facebook").SignupFacebookConnectButton,s=require("unified_view/signup/google").SignupGoogleConnectButton;exports.LoginOnlyForm=t.extend({onLoad:function(){this._super.apply(this,arguments);var e=this;e.$id("@cancel_login").on("click",function(){e.emitEvent({type:i.Types.NETWORK_BETA_LOGIN_FORM_STATE,payload:{showLogin:false}})})}});exports.LoginFacebookConnectButton=n.extend({onConnectSucceeded:function(e){var t=e;var n=this;t.onFailure=function(e){
n.emitEvent({type:i.Types.NETWORK_BETA_WAITLIST_FORM_STATE,payload:{email:e.facebookOauthData.email,name:e.facebookOauthData.name}});n.emitEvent({type:i.Types.NETWORK_BETA_LOGIN_FORM_STATE,payload:{showLogin:false}})};this.signupContext.set("facebookOauthData",t)}});exports.LoginGoogleConnectButton=s.extend({_setGoogleOauthDataOnConnectSucceeded:function(e){var t=e;var n=this;t.onFailure=function(e){n.emitEvent({type:i.Types.NETWORK_BETA_WAITLIST_FORM_STATE,payload:{email:e.googleOauthData.email,name:e.googleOauthData.name}});n.emitEvent({type:i.Types.NETWORK_BETA_LOGIN_FORM_STATE,payload:{showLogin:false}})};this.signupContext.set("googleOauthData",t)}})});define("unified_view/network/signup",["shared/polyfills","unified_view/signup/_signup","shared/core/component","shared/events/index"],function Hs(require,exports,e){var t=require("unified_view/signup/_signup").BaseSignupForm,i=require("shared/core/component").Component,n=require("shared/events/index"),s=require("unified_view/signup/_signup").SignupContext;
exports.SignupWithCodeForm=t.extend({onLoad:function(){this._super.apply(this,arguments);var e=this;e.SignupContext=e.getContext(s);e.signupContext.set("emailSubmitButton",e.$id("@submit"));e.SignupContext.on("showEmailSignup",function(t,i){if(i){e.showEmailSignupForm()}else{e.hideEmailSignupForm()}});e.$id("@login").on("click",function(){e.emitEvent({type:n.Types.NETWORK_BETA_LOGIN_FORM_STATE,payload:{showLogin:true}})});e.$id("@cancel_signup_with_email").on("click",function(){e.SignupContext.set("showEmailSignup",false)})},showEmailSignupForm:function(){this.$id("@email_signup_form").removeClass("hidden");this.$id("@social_signup_form").addClass("hidden")},hideEmailSignupForm:function(){this.$id("@email_signup_form").addClass("hidden");this.$id("@social_signup_form").removeClass("hidden")}});exports.SignupWithEmailButton=i.extend({onLoad:function(){var e=this;e.SignupContext=e.getContext(s);this.$id("@button").on("click",function(){e.SignupContext.set("showEmailSignup",true)})}})});define("unified_view/network/switcher",["shared/polyfills","shared/core/component","interface/settings","shared/client"],function Qs(require,exports,e){
var t=require("shared/core/component").Component,i=require("interface/settings");if(i.pageIsMobile){var n=require("mobile_app2/client"),s=require("mobile_app2/messages"),o=require("shared/client")}exports.MobileNetworkSwitcherActionSheetSetter=t.extend({onLoad:function(){var e=this;e.$id("@link").on("click",function(t){t.preventDefault();n.showActionSheet({buttonTitles:e.actionSheetTitles,callback:function(t){if(t>=e.actionSheetTitles.length){return}e.maybeSwitchNetwork(t)}})})},maybeSwitchNetwork:function(e){var t=this.destinationData[e];if(o.isMobileWeb()){window.location=t.url}else if(t.is_member){n.updateConfig(t.subdomain,t.language)}else{s.send("openURL",{target:"modal",url:t.url})}}});exports.NativeSwitcherSetter=t.extend({onLoad:function(){s.send("updateSiloSwitcher",this.data)}})});define("unified_view/paged_list",["shared/polyfills","shared/core/component","interface/jquery","shared/debounce","shared/events/index","shared/scroll_animation_handler","shared/loading","interface/settings","shared/perf","shared/util","shared/w2.context","shared/viewport","fx","webnode2"],function unified_view_paged_list(require,exports,module){
var Component=require("shared/core/component").Component,coreComponent=require("shared/core/component"),jQuery=require("interface/jquery").jQuery,debounce=require("shared/debounce").debounce,events=require("shared/events/index"),scrollAnimationHandler=require("shared/scroll_animation_handler"),loading=require("shared/loading"),pageIsMobile=require("interface/settings").pageIsMobile,perf=require("shared/perf"),util=require("shared/util"),context=require("shared/w2.context"),viewport=require("shared/viewport"),fx,messages,client;if(pageIsMobile){messages=require("mobile_app2/messages");client=require("mobile_app2/client")}else{fx=require("fx")}exports.PagedList=Component.extend({spinner:null,resyncIndex:null,updatedHashesDuringResync:null,elementsToDelete:null,scrollHandler:null,pagingInProgress:false,onLoad:function(){this.$paged_list=this.$id("@paged_list");this.$wrapper=this.$id("@paged_list_wrapper");this.$container=this.$getContainer();this.$spinnerDisplayArea=this.$id("@spinner");this.$resyncButton=this.$id("@resync");
this.$resyncButtonWrapper=this.$id("@resync_wrapper");this.$resyncButton.on("click",this.resyncButtonPressed.bind(this));this.$moreButton=this.$id("@more");this.$moreButton.on("click",this.moreButtonPressed.bind(this));var e=this.getContext(context.HoverMenu);if(e){this.inHoverMenu=true;e.on("isShown",this.onVisiblityChange.bind(this));this.isVisible=e.get("isShown")}else{this.isVisible=true;this.inHoverMenu=false}this.setupPaging();this.maybeRetargetLinks();if(this.enable_mobile_hide_content){this.mapOverNodesBelowList(function(e){jQuery(e).addClass("paged_list_hidden_footer")})}if(pageIsMobile){client.registerMessageHandler("newStoriesButtonTapped",this.resyncButtonPressed.bind(this))}if(this.debug_show_resync){this.showResyncButton()}},onVisiblityChange:function(e,t){this.isVisible=t;if(!this.isVisible&&this.resyncIndex!==null){this.performResync()}if(this.scrollHandler){this.scrollHandler()}},$getContainer:function(){var e=util.firstScrollingParent(this.$wrapper.get(0));if(e===document.body){
e=window}return jQuery(e)},getContainerBottom:function(){return this.$container.height()+this.$container.scrollTop()},setScrollHandler:function(e){if(this.scrollHandler!==null){this.$container.off("scroll",this.scrollHandler)}if(e!==null){this.$container.on("scroll",e)}this.scrollHandler=e},setupPaging:function(){if(this.has_more){if(this.auto_paged){this.bindAutoPaging();this.showLoading()}else{this.hideLoading();this.$moreButton.removeClass("hidden")}}else{this.onPagingDone()}},calculateAutoPageHeight:function(){var e=this.getContainerBottom(),t=this.$wrapper.height(),i=(t-e)*.1+e-100,n=t-4e3;return Math.max(i,n)},bindAutoPaging:function(){var e=this,t=debounce(function(){var t=e.calculateAutoPageHeight();if(e.getContainerBottom()>=t&&e.isVisible){e.bindAutoPagePerfLogging();e.requestNextPage()}},200,{leading:true});e.setScrollHandler(t);t()},bindAutoPagePerfLogging:function(){var e=this,t=debounce(function(){if(e.getContainerBottom()>e.$wrapper.height()){e.setScrollHandler(null);e.startUserPerceivedAction();
}},50,{leading:true});e.setScrollHandler(t);t()},requestNextPage:function(e){var t=this;if(t.pagingInProgress){return}t.pagingInProgress=true;t.serverCall("get_next_page").kwargs({paged_list_parent_cid:t.parent().cid,client_hashes:t.hashes,force_cid:t.cid,domids_to_remove:t.hiddenComponentDomIds()}).success(function(i){t.pagingInProgress=false;t.appendPage(i,e)}).error(function(){t.pagingInProgress=false;t.onPagingDone(true)}).send()},hiddenComponentDomIds:function(){var e=[],t=this.elementsToDelete||[];for(var i=0;i<t.length;i++){e.push(t[i].id)}return e},startUserPerceivedAction:function(){if(!this.userPerceivedAction){this.userPerceivedAction=perf.startUserPerceived({vcon:this.__vcon,method:"get_next_page"})}},finishUserPerceivedAction:function(){this.startUserPerceivedAction();perf.finishAction(this.userPerceivedAction);this.userPerceivedAction=null},appendPage:function(data,highlight){var fragment=util.documentFragmentFromString(data.html),originalNumItems=this.hashes.length,W2,item;
this.has_more=data.has_more;this.hashes=this.hashes.concat(data.hashes);this.$wrapper.get(0).appendChild(fragment);if(!pageIsMobile){W2=require("webnode2")}eval(data.js);if(this.scrollHandler===null){this.finishUserPerceivedAction()}else{this.setScrollHandler(null)}this.removeComponentsToDelete();this.setupPaging();this.maybeRetargetLinks();this.handleModelUpdates(this.updatedHashesDuringResync);if(highlight&&!pageIsMobile){item=this.$wrapper.get(0).children[originalNumItems];if(originalNumItems!==0){fx.highlight(item,2e3)}}},showLoading:function(){if(pageIsMobile&&client.usesNativePagingIndicator()){client.showNextPageIndicator()}else{if(this.spinner===null){this.spinner=loading.createLoadingDotsElement();this.$spinnerDisplayArea.append(this.spinner)}this.$spinnerDisplayArea.removeClass("hidden")}},hideLoading:function(){if(pageIsMobile&&client.usesNativePagingIndicator()){client.hideNextPageIndicator()}else{this.$spinnerDisplayArea.addClass("hidden")}},onPagingDone:function(e){this.hideLoading();
if(e){this.$moreButton.removeClass("hidden");if(this.resyncIndex){window.location.href.reload()}}if(this.enable_mobile_hide_content){this.mapOverNodesBelowList(function(e){jQuery(e).removeClass("paged_list_hidden_footer")})}},handleModelUpdates:function(e){if(!e){return}if(this.elementsToDelete!==null){this.updatedHashesDuringResync=e;return}else{this.updatedHashesDuringResync=null}var t=firstNewItemIndex(this.hashes,e);if(t===null){this.hideResyncButton();return}else if(t>=this.hashes.length){if(this.has_more===false){this.has_more=true;this.setupPaging()}this.hideResyncButton();return}else{this.resyncIndex=t;if(this.resyncIndexIsBelowViewport()){this.performResync(false);return}else{this.showResyncButton();return}}},$getChildAtIndex:function(){var e=this.$wrapper.get(0),t=e.children[this.resyncIndex];return jQuery(t)},resyncIndexIsBelowViewport:function(){if(!this.isVisible){return true}if(this.resyncIndex===null){return false}var e=this.$getChildAtIndex(this.resyncIndex);return e.offset().top>this.getContainerBottom();
},performResync:function(e){if(this.resyncIndex===null){return}if(!pageIsMobile){this.emitEvent({type:events.Types.LIVENODE_LOADING_SPINNER,payload:{show:true}})}this.$paged_list.addClass("resyncing");this.markComponentsToDelete(this.resyncIndex);if(e){var t=this.$getChildAtIndex(this.resyncIndex);var i=0;if(this.$container.get(0)!==window){i=this.$container.offset().top}var n=200;var s=t.offset().top-i-n;this.$container.scrollTop(s)}this.resyncIndex=null;this.requestNextPage(true);this.hideResyncButton()},showResyncButton:function(){var e=this,t=e.$container.get(0);if(pageIsMobile){messages.send("updateNewStoriesButton",{visible:true,text:e.resync_button_text});return}if(e.inHoverMenu){return}e.$resyncButtonWrapper.removeClass("hidden");var i=function(i){var n,s,o;if(t===window){n=viewport.siteHeaderHeight();s=e.$wrapper.offset().top}else{n=0;s=0}o=s+e.$wrapper.height()-e.$resyncButton.height()*2;i+=n;if(i<s){e.$resyncButtonWrapper.css("position","absolute").css("top",0).css("width","100%");
}else if(o<i){e.$resyncButtonWrapper.css("position","absolute").css("top",o-s).css("width","100%")}else{e.$resyncButtonWrapper.css("position","fixed").css("top",n).css("width",e.$wrapper.width())}};e.resyncButtonScrollCallback=scrollAnimationHandler.add(t,i)},hideResyncButton:function(){if(!this.debug_show_resync){if(pageIsMobile){messages.send("updateNewStoriesButton",{visible:false});return}if(this.resyncButtonScrollCallback){this.$resyncButtonWrapper.addClass("hidden");this.$container.off("scroll",this.resyncButtonScrollCallback)}}},resyncButtonPressed:function(){this.performResync(true)},markComponentsToDelete:function(e){this.hashes=this.hashes.slice(0,e);var t=this.$wrapper.get(0),i=t.children,n,s;this.elementsToDelete=[];for(s=e;s<i.length;s++){n=i[s];this.elementsToDelete.push(n)}},removeComponentsToDelete:function(){var e=this.$wrapper.get(0),t=this.elementsToDelete||[],i,n,s;this.elementsToDelete=null;for(s=0;s<t.length;s++){i=t[s];n=coreComponent.getComponentFromElement(i);if(n){
coreComponent.unloadComponent(n.cid)}e.removeChild(i)}if(t){if(!pageIsMobile){this.emitEvent({type:events.Types.LIVENODE_LOADING_SPINNER,payload:{show:false}})}this.$paged_list.removeClass("resyncing")}},moreButtonPressed:function(){this.$moreButton.addClass("hidden");this.showLoading();this.requestNextPage()},maybeRetargetLinks:function(){if(this.retarget_links){this.unsafe$id('@paged_list_wrapper a:not([href^="#"])').each(function(){if(this.target!="feed_modal"){jQuery(this).attr("target","_blank")}})}},mapOverNodesBelowList:function(e){var t=this.$spinnerDisplayArea.get(0).nextSibling;while(t){e(t);if(t.nextSibling){t=t.nextSibling}else if(t.parentNode&&t.parentNode.id!="main_page_wrapper"){t=t.parentNode.nextSibling}else{break}}}});exports.InvisibleUpdater=Component.extend({onLoad:function(e){if(!e){this.parent().handleModelUpdates(this.hashes)}}});var firstNewItemIndex=exports.firstNewItemIndex=function(e,t){var i={},n;for(n=0;n<e.length;n++){i[e[n]]=true}for(n=0;n<t.length;n++){if(!i[t[n]]){
return n}}return null}});define("unified_view/notifications",["shared/polyfills","unified_view/paged_list","interface/settings"],function Ws(require,exports,e){var t=require("unified_view/paged_list").PagedList,i=require("interface/settings").pageIsMobile,n;if(i){n=require("mobile_app2/client")}exports.NotificationsListContentsBaseUnified=t.extend({resyncButtonPressed:function(){this._super.apply(this,arguments);this.serverCall("clear_notif_badge").send()}});exports.AllNotificationsListContentsUnified=exports.NotificationsListContentsBaseUnified.extend({onLoad:function(){this._super.apply(this,arguments);var e=this;if(i){n.registerMessageHandler("drawerHashBroadcast",function(t){var i=t.notifsHash;if(e.hashes[0]!=i){if(window.pageYOffset<300){e.resyncIndex=0;e.setScrollHandler(null);e.performResync()}else{e.handleModelUpdates([i])}}})}}})});define("unified_view/nux",["shared/polyfills","shared/core/component","unified_view/modal"],function Vs(require,exports,e){var t=require("shared/core/component").Component,i=require("unified_view/modal").ModalBase;
exports.NuxModal=i.extend({onLoad:function(){var e=this;e.submit=this.$id("@submit");e.next=this.$id("@next");e.skip=this.$id("@skip");e.title=this.$id("@modal_title");e.content=this.$id("@content");e.currentStep=-1;e.submit.addClass("hidden");this._super.apply(this);e.next.on("click",function(t){t.preventDefault();e.loadStepData()});e.skip.on("click",function(t){t.preventDefault();e.loadStepData()});e.loadStepData()},updateTitle:function(e){this.title.text(e)},showSkip:function(){this.skip.removeClass("hidden")},hideSkip:function(){this.skip.addClass("hidden")},showFinish:function(){this.next.addClass("hidden");this.submit.removeClass("hidden")},onSubmit:function(){this.close()},loadStepData:function(){var e=this;this.currentStep++;var t=this[this.step_order[this.currentStep]];e.serverCall(t.content).contentFor(e.content).liveMutate().success(function(){e.updateTitle(t.title);if(t.allow_skip){e.showSkip()}else{e.hideSkip()}if(e.currentStep==e.step_order.length-1){e.showFinish()}}).send();
}});exports.NuxLink=t.extend({onLoad:function(){this.$id("@create_dialog_link").on("click",this.loadModal.bind(this))},loadModal:function(){this.createModal("load_modal").show()}})});define("shared/stripeLoader",["shared/polyfills","settings","shared/util","shared/loadjs"],function zs(require,exports,e){var t=require("settings"),i=require("shared/util"),n=require("shared/loadjs").loadJS,s="https://js.stripe.com/v2/";exports.load=i.once(function(){n(s,function(){Stripe.setPublishableKey(t.stripePublishableKey)})})});define("unified_view/payment/_payment",["shared/polyfills","shared/core/component","shared/stripeLoader","interface/settings","interface/jquery"],function Gs(require,exports,e){var t=require("shared/core/component").Component,i=require("shared/stripeLoader"),n=require("interface/settings"),s,o=require("interface/jquery")._jQuery;if(n.pageIsMobile){s=require("mobile_app2/messages")}function r(e,t){var i;if(n.pageIsMobile){i="keyup paste change"}else{i="keydown paste change"}if(e){
e.on(i,function(i){setTimeout(function(){var i=e.val(),n=t(i);if(i!==n){e.val(n)}},1)})}}exports.PaymentMethod=t;exports.AddCardForm=t.extend({onLoad:function(){i.load();var e=this;e.$name=e.$id("@name");e.$number=e.$id("@number");e.$expiry=e.$id("@expiry");e.$cvc=e.$id("@cvc");e.$zip=e.$id("@zip");e.cardType=null;e.isSubmitting=false;r(e.$number,function(t){var i=Stripe.card.cardType(t);switch(i){case"Unknown":i=null;break;case"American Express":i="amex";break;case"Diners Club":i="diners";break;default:i=i.toLowerCase().replace(/\s+/g,"")}e._setCardType(i);var n=t.replace(/[^0-9]/g,"");if(i==="amex"){n=(n.slice(0,4)+" "+n.slice(4,10)+" "+n.slice(10,n.length)).trim()}else{n=(n.slice(0,4)+" "+n.slice(4,8)+" "+n.slice(8,12)+" "+n.slice(12,n.length)).trim()}return n});r(e.$expiry,function(e){var t=e.replace(/[^0-9]/g,"");if(e.slice(2,e.length)===" /"){return t[0]}if(t.length===1){if(t[0]!=="0"&&t[0]!=="1"||e.length===2&&t[0]==="1"&&(e[1]===" "||isNaN(e[1]))){t="0"+t}}if(t.length>1){t=t.slice(0,2)+" / "+t.slice(2,t.length);
}return t});r(e.$cvc,function(e){return e.replace(/[^0-9]/g,"")})},getExpiryMonth:function(){return this.$expiry.val().replace(/[^0-9]/g,"").slice(0,2)},getExpiryYear:function(){var e=this.$expiry.val();return e.replace(/[^0-9]/g,"").slice(2,e.length)},getEmail:function(){if(!this.$email.length){return}return this.$email.val()},submit:function(e){var t=this;if(!t.isSubmitting){t.isSubmitting=true;if(n.pageIsMobile){s.send("showLoadingView")}document.activeElement.blur();t._getStripeToken(function(i,o){t.serverCall("submit").kwargs({stripe_response:o,source_type:t.source_type,source_id:t.source_id}).success(function(i){var o;if(n.pageIsMobile){o=i.value}else{o=i}if(o){t.isSubmitting=false;e()}else{t.isSubmitting=false;if(n.pageIsMobile){s.send("hideLoadingView")}}}).error(function(){t.isSubmitting=false;if(n.pageIsMobile){s.send("hideLoadingView")}t.showServerError()}).liveMutate().send()})}},showServerError:function(){this.serverCall("show_error_pmsg").send()},_getStripeToken:function(e){
Stripe.card.createToken({name:this.$name.val(),number:this.$number.val(),exp_month:this.getExpiryMonth(),exp_year:this.getExpiryYear(),cvc:this.$cvc.val(),address_zip:this.$zip.val(),currency:"usd"},e)},_setCardType:function(e){if(this.cardType===e){return}if(this.cardType){this.$number.removeClass(this.cardType)}this.cardType=e;if(this.cardType){this.$number.addClass(this.cardType)}if(this.cardType==="amex"){this.$number.attr("maxlength","17")}else{this.$number.attr("maxlength","19")}}});exports.AddBankForm=t.extend({onLoad:function(){i.load();var e=this;e.$form=e.$id("@form");if(n.pageIsMobile){e.$name=e.child("name").$id("@name");e.$country=e.child("country").$id("@country")}else{e.$name=e.$id("@name");e.$country=e.$id("@country")}e.$routing_1_row=e.$id("@routing_1_row");if(n.pageIsMobile){e.$routing_1_label=e.child("routing_1").$id("@label");e.$routing_1=e.child("routing_1").$id("@routing_1")}else{e.$routing_1_label=e.$id("@routing_1_label");e.$routing_1=e.$id("@routing_1")}e.$routing_2_row=e.$id("@routing_2_row");
if(n.pageIsMobile){e.$routing_2_label=e.child("routing_2").$id("@label");e.$routing_2=e.child("routing_2").$id("@routing_2")}else{e.$routing_2_label=e.$id("@routing_2_label");e.$routing_2=e.$id("@routing_2")}e.$currency_row=e.$id("@currency_row");if(n.pageIsMobile){e.$currency=e.child("currency").$id("@currency")}else{e.$currency=e.$id("@currency")}e.$account_row=e.$id("@account_row");if(n.pageIsMobile){e.$account_label=e.child("account").$id("@label");e.$account=e.child("account").$id("@account")}else{e.$account_label=e.$id("@account_label");e.$account=e.$id("@account")}e.$us_tax_info=e.$id("@us_tax_info");e.taxFormShown=false;if(n.pageIsMobile){e.$dob=e.child("dob").$id("@dob");e.$address_line1=e.child("address_line1").$id("@address_line1");e.$address_city=e.child("address_city").$id("@address_city");e.$address_state=e.child("address_state").$id("@address_state");e.$address_postal_code=e.child("address_postal_code").$id("@address_postal_code");e.$ssn=e.child("ssn").$id("@ssn")}else{e.$dob=e.$id("@dob");
e.$address_line1=e.$id("@address_line1");e.$address_city=e.$id("@address_city");e.$address_state=e.$id("@address_state");e.$address_postal_code=e.$id("@address_postal_code");e.$ssn=e.$id("@ssn")}e.$i18n_verify=e.$id("@i18n_verify");e.verifyFormShown=false;if(n.pageIsMobile){e.$dob_year_first=e.child("dob_year_first").$id("@dob_year_first");e.$i18n_address_line1=e.child("i18n_address_line1").$id("@i18n_address_line1");e.$i18n_address_city=e.child("i18n_address_city").$id("@i18n_address_city");e.$i18n_address_state=e.child("i18n_address_state").$id("@i18n_address_state");e.$i18n_address_postal_code=e.child("i18n_address_postal_code").$id("@i18n_address_postal_code");e.$i18n_address_country=e.child("i18n_address_country").$id("@i18n_address_country")}else{e.$dob_year_first=e.$id("@dob_year_first");e.$i18n_address_line1=e.$id("@i18n_address_line1");e.$i18n_address_city=e.$id("@i18n_address_city");e.$i18n_address_state=e.$id("@i18n_address_state");e.$i18n_address_postal_code=e.$id("@i18n_address_postal_code");
e.$i18n_address_country=e.$id("@i18n_address_country")}e.$country.on("change",function(t){e.switchCountry(e.$country.val());if(e.countryCode==="US"){e.showVerifyForm(false);if(e.$account.val().length>0){e.showTaxForm(true)}e.$dob_year_first.val("");e.$i18n_address_line1.val("");e.$i18n_address_city.val("");e.$i18n_address_state.val("");e.$i18n_address_postal_code.val("")}else{e.showTaxForm(false);if(e.$account.val().length>0){e.showVerifyForm(true)}e.$ssn.val("");e.$dob.val("");e.$address_line1.val("");e.$address_city.val("");e.$address_state.val("");e.$address_postal_code.val("")}});r(e.$routing_1,function(t){e._fireOnEdit();return t.replace(/[^0-9]/g,"")});r(e.$routing_2,function(t){e._fireOnEdit();return t.replace(/[^0-9]/g,"")});r(e.$account,function(t){e._fireOnEdit();if(!e.taxFormShown&&e.countryCode==="US"&&e.$account.val().length>0){e.showTaxForm(true)}else if(!e.verifyFormShown&&e.countryCode!=="US"&&e.$account.val().length>0){e.showVerifyForm(true)}if(e.inputs().account_numbers_only){
return t.replace(/[^0-9]/g,"")}else{return t.replace(/\s/g,"")}});r(e.$ssn,function(e){var t=e.replace(/[^0-9]/g,"");t=t.slice(0,3)+"-"+t.slice(3,5)+"-"+t.slice(5,t.length);if(t.endsWith("--")){t=t.slice(0,t.length-2)}else if(t.endsWith("-")){t=t.slice(0,t.length-1)}return t});r(e.$dob,function(e){var t=e.replace(/[^0-9]/g,"");if(e.slice(-2)===" /"){t=t.slice(0,t.length-1)}var i=t.slice(0,2);var n=parseInt(i,10);if(n>12||i.length<2&&n>1){t="0"+t}var s=t.slice(2,4);var o=parseInt(s,10);if(o>31||s.length<2&&o>3){t=t.slice(0,2)+"0"+t.slice(2,t.length)}var r=t.slice(4,6);if(r.length==2&&r!="19"&&r!="20"){var a="19";if(parseInt(r,10)<16){a="20"}t=t.slice(0,4)+a+t.slice(4,t.length)}var d=t.slice(0,2);if(t.length>=2){d+=" / "+t.slice(2,4)}if(t.length>=4){d+=" / "+t.slice(4,t.length)}return d});r(e.$dob_year_first,function(e){var t=e.replace(/[^0-9]/g,"");if(e.slice(-2)===" /"){t=t.slice(0,t.length-1)}var i=t.slice(0,2);if(i.length==2&&i!="19"&&i!="20"){var n="19";if(parseInt(i,10)<16){n="20"}t=n+i+t.slice(4,t.length);
}var s=t.slice(4,6);var o=parseInt(s,10);if(o>12||s.length<2&&o>1){t=t.slice(0,4)+"0"+s+t.slice(6,t.length)}var r=t.slice(6,t.length);var a=parseInt(r,10);if(a>31||r.length<2&&a>3){t=t.slice(0,6)+"0"+r}var d=t.slice(0,4);if(t.length>=4){d+=" / "+t.slice(4,6)}if(t.length>=6){d+=" / "+t.slice(6,t.length)}return d});r(e.$address_state,function(e){return e.replace(/[^a-zA-Z]/g,"").toUpperCase()});r(e.$address_postal_code,function(e){return e.replace(/[^0-9]/g,"")});e.focus()},updateCurrencySelector:function(){var e=this;e.$currency.empty();var t=e.currencies[e.countryCode];o.each(t,function(t,i){e.$currency.append(o("<option></option>").attr("value",i).text(i))});if(t.length===1){e.$currency_row.addClass("hidden")}else{e.$currency_row.removeClass("hidden")}},onEdit:function(e){if(this._editCallbacks===undefined){this._editCallbacks=[]}this._editCallbacks.push(e)},focus:function(){if(!this.$routing_1_row.hasClass("hidden")){this.$routing_1.focus()}else{this.$account.focus()}},showTaxForm:function(e){
var t=this,i=333,s="swing";if(e&&!t.taxFormShown){t.taxFormShown=true;if(n.pageIsMobile){t.$us_tax_info.removeClass("hidden")}else{o("#"+t.$us_tax_info.attr("id")).animate({height:"show",opacity:"show"},i,s)}}else if(!e&&t.taxFormShown){t.taxFormShown=false;if(n.pageIsMobile){t.$us_tax_info.addClass("hidden")}else{o("#"+t.$us_tax_info.attr("id")).animate({height:"hide",opacity:"hide"},i,s)}}},showVerifyForm:function(e){var t=this,i=333,s="swing";if(e&&!t.verifyFormShown){t.verifyFormShown=true;if(n.pageIsMobile){t.$i18n_verify.removeClass("hidden")}else{o("#"+t.$i18n_verify.attr("id")).animate({height:"show",opacity:"show"},i,s)}}else if(!e&&t.verifyFormShown){t.verifyFormShown=false;if(n.pageIsMobile){t.$i18n_verify.addClass("hidden")}else{o("#"+t.$i18n_verify.attr("id")).animate({height:"hide",opacity:"hide"},i,s)}}},getRoutingNumber:function(){if(this.inputs().labels.routing_2){var e=this.inputs().routing_join_template;return e.replace("{1}",this.$routing_1.val()).replace("{2}",this.$routing_2.val());
}else if(this.inputs().labels.routing_1){return this.$routing_1.val()}},getBirthYear:function(){if(this.countryCode==="US"){var e=this.$dob.val();return e.replace(/[^0-9]/g,"").slice(4,e.length)}else{return this.$dob_year_first.val().replace(/[^0-9]/g,"").slice(0,4)}},getBirthMonth:function(){if(this.countryCode==="US"){return this.$dob.val().replace(/[^0-9]/g,"").slice(0,2)}else{return this.$dob_year_first.val().replace(/[^0-9]/g,"").slice(4,6)}},getBirthDay:function(){if(this.countryCode==="US"){return this.$dob.val().replace(/[^0-9]/g,"").slice(2,4)}else{return this.$dob_year_first.val().replace(/[^0-9]/g,"").slice(6,8)}},getSSN:function(){return this.$ssn.val().replace(/[^0-9]/g,"")},getAddressLine1:function(){if(this.countryCode==="US"){return this.$address_line1.val()}else{return this.$i18n_address_line1.val()}},getAddressCity:function(){if(this.countryCode==="US"){return this.$address_city.val()}else{return this.$i18n_address_city.val()}},getAddressState:function(){if(this.countryCode==="US"){
return this.$address_state.val()}else{return this.$i18n_address_state.val()}},getAddressPostalCode:function(){if(this.countryCode==="US"){return this.$address_postal_code.val()}else{return this.$i18n_address_postal_code.val()}},getAddressCountry:function(){if(this.countryCode==="US"){return"US"}else{return this.$i18n_address_country.val()}},submit:function(e){var t=this;if(!t.isSubmitting){t.isSubmitting=true;document.activeElement.blur();t._getStripeToken(function(i,n){t.serverCall("submit").kwargs({stripe_response:n,country:t.countryCode,name:t.$name.val(),birth_year:t.getBirthYear(),birth_month:t.getBirthMonth(),birth_day:t.getBirthDay(),address_line1:t.getAddressLine1(),address_city:t.getAddressCity(),address_state:t.getAddressState(),address_postal_code:t.getAddressPostalCode(),address_country:t.getAddressCountry(),ssn:t.getSSN()}).success(function(i){if(i){t.isSubmitting=false;e()}else{t.isSubmitting=false}}).error(function(){t.isSubmitting=false;t.showServerError()}).liveMutate().send();
})}},showServerError:function(){this.serverCall("show_error_pmsg").send()},inputs:function(e){var t=this.countryInputs[e||this.countryCode];if(!t.maxlength){t.maxlength={}}if(!t.placeholders){t.placeholders={}}return t},switchCountry:function(e){this.$form.removeClass("form_country_"+this.countryCode);this.countryCode=e;this.$form.addClass("form_country_"+this.countryCode);if(this.inputs().labels.routing_1){this.$routing_1_label.text(this.inputs().labels.routing_1);this.$routing_1.attr("maxlength",this.inputs().maxlength.routing_1||"");this.$routing_1.attr("placeholder",this.inputs().placeholders.routing_1||"");this.$routing_1_row.removeClass("hidden")}else{this.$routing_1_row.addClass("hidden")}if(this.inputs().labels.routing_2){this.$routing_2_label.text(this.inputs().labels.routing_2);this.$routing_2.attr("maxlength",this.inputs().maxlength.routing_2||"");this.$routing_2.attr("placeholder",this.inputs().placeholders.routing_2||"");this.$routing_2_row.removeClass("hidden")}else{this.$routing_2_row.addClass("hidden");
}this.$account_label.text(this.inputs().labels.account);if(n.pageIsMobile){this.$account.attr("type",this.inputs().account_numbers_only?"tel":"text")}this.$account.attr("maxlength",this.inputs().maxlength.account||"");this.$account.attr("placeholder",this.inputs().placeholders.account||"");this.focus();this.updateCurrencySelector();this.$i18n_address_country.val(this.countryCode).trigger("change")},_fireOnEdit:function(){if(this._editCallbacks!==undefined){while(this._editCallbacks.length>0){this._editCallbacks.pop()()}}},_getStripeToken:function(e){Stripe.bankAccount.createToken({country:this.countryCode,currency:this.$currency.val(),routing_number:this.getRoutingNumber(),account_number:this.$account.val(),name:this.$name.val(),account_holder_type:"individual"},e)}})});define("unified_view/payment/money",["shared/polyfills","shared/core/component"],function Ks(require,exports,e){var t=require("shared/core/component").Component;exports.MoneyAmountInput=t.extend({onLoad:function(){var e=this;
e.$amount=e.$id("@amount");e.$amount.on("keydown paste change",function(t){setTimeout(function(){e._filter()},1)});e.$amount.on("blur",function(t){e._filter(true)})},getValueInCents:function(){var e=this._cleanVal(true)[1];if(e.indexOf(".")===-1){e+="00"}else{e=e.replace(".","")}return parseInt(e)},_filter:function(e){var t=this._cleanVal(e),i=t[0],n=t[1],s=t[2];if(i!==n){var o=this.$amount.get()[0],r=o.selectionStart+s,a=o.selectionEnd+s;this.$amount.val(n);o.setSelectionRange(r,a)}},_cleanVal:function(e){var t=this.$amount.val(),i="",n=0,s=0,o=0;for(var r=0;r<t.length;r++){var a=t.charAt(r);if(this.allowCents&&a==="."){if(s===0){if(n===0){i+="0";n++;o++}i+=a;s++}}else if(!isNaN(a)){if(s>0){if(s!==3){i+=a;s++}}else{if(n<this.maxDollarNumbers){i+=a;n++}}}}if(e){while(s!==0&&s<3){i+="0";s++}}var d=i.length;i=i.replace(/^0+(?=\d)/,"");var l=d-i.length;if(l>0){n-=l;o-=l}return[t,i,o]}})});define("unified_view/pmsg",["shared/polyfills","shared/core/component","shared/toast"],function Js(require,exports,e){
var t=require("shared/core/component").Component,i=require("shared/toast").Toast;exports.PMsg=t.extend(i).extend({onLoad:function(){this.$container=this.$id("@container");this.show()}})});define("shared/prize_views",["shared/polyfills","interface/rpc","shared/debounce","shared/Class"],function Xs(require,exports,e){var t=require("interface/rpc").rpc,i=require("shared/debounce").debounce;var n=require("shared/Class").Class.extend({__init__:function(){var e=this;e.buffer={};this.debouncedFlush=i(function(){var i=Object.keys(e.buffer);if(i.length){t("/ajax/log_prize_views_POST").kwargs({prize_ids:i}).send();e.buffer={}}},400)},log:function(e){if(!this.buffer[e]){this.buffer[e]=true;this.debouncedFlush()}}});exports.logger=new n});define("unified_view/prize/_prize",["shared/polyfills","shared/core/component","shared/prize_views"],function Ys(require,exports,e){var t=require("shared/core/component").Component,i=require("shared/prize_views").logger;exports.PrizeQuestionPagePrompt=t.extend({onLoad:function(){
var e=this;if(this.should_log_view){i.log(this.prize_id)}e.$id("@opt_into_notifs").on("click",function(t){t.preventDefault();e.serverCall("opt_into_notifs").liveMutate().send()})},hide:function(){this.$id("@prompt").addClass("hidden")}});exports._PrizeCallToAction=t.extend({onLoad:function(){var e=this;e.$id("@force_login").on("click",function(t){t.preventDefault();e.serverCall("force_login").liveMutate().send()})}});exports.PrizeConditionsModalLink=t.extend({onLoad:function(){var e=this;e.$id("@link").on("click",function(t){t.preventDefault();e.createModal("load_modal").kwargs({prize_id:e.prize_id}).show()})}});exports.PrizeBadge=t.extend({onLoad:function(){if(this.beta_enabled){i.log(this.prize_id)}}});exports.PrizeAdminToolbar=t.extend({onLoad:function(){var e=this;e.$id("@submit").on("click",function(t){t.preventDefault();var i=e.$id("@score").val();e.serverCall("set_score_override").kwargs({score:i}).liveMutate().send()})}})});define("unified_view/prize/collect",["shared/polyfills","shared/core/component","interface/jquery","unified_view/modal","interface/settings","shared/client"],function Zs(require,exports,e){
var t=require("shared/core/component").Component,$=require("interface/jquery")._jQuery,i=require("unified_view/modal").ModalBase,n=require("interface/settings"),s=require("shared/client"),o,r,a;if(n.pageIsMobile){r=require("mobile_app2/client");o=require("mobile_app2/messages");a=require("mobile_app2/app/view/common")}exports.PrizeCollectModal=i.extend({onLoadMobile:function(){this._super.apply(this,arguments);var e=this;r.registerMessageHandler("dismissPrizeCollect",function(){e.close()});e.setMobileDoneButtonDisabled(true);e.child("prize_collect_form").child("picker").onToggleCell(function(){e.setMobileDoneButtonDisabled(false)})},onSubmit:function(){var e=this;e.child("prize_collect_form").submit(function(){e.close()})}});var d={collectPrizeServerCall:function(e,t){var i=this;if(i._collectPrizeServerCallIsSubmitting===undefined){i._collectPrizeServerCallIsSubmitting=true;if(n.pageIsMobile){o.send("showLoadingView")}i.serverCall("collect_prize").kwargs({deposit_method:e}).success(function(e){
if(n.pageIsMobile){o.send("hideLoadingView");a.showAlert({title:e.title,message:e.message,callback:function(){t()}})}else{t()}}).error(function(){i._collectPrizeServerCallIsSubmitting=undefined;if(n.pageIsMobile){o.send("hideLoadingView")}i._prizeCollectServerCallServerError()}).liveMutate().send()}},_prizeCollectServerCallServerError:function(){this.serverCall("show_prize_collect_error_pmsg").send()}};exports.PrizeCollectForm=t.extend(d).extend({onLoad:function(){var e=this;if(n.pageIsMobile){e.picker=e.child("picker")}else{e.$radios=e.$id("@picker input[type=radio]");e.$bank_radio=e.$id("@bank");e.$bank_details=e.$id("@bank_details");e.addBankForm=e.child("add_bank_form");var t=function(){e.$radios.map(function(){var e=$(this),t=$("label[for='"+e.attr("id")+"']").parent();t.toggleClass("selected",e.is(":checked"));t.toggleClass("not_selected",!e.is(":checked"))})};e.$radios.on("change",function(i){if(e.addBankForm){var n=333,s="swing";if(e.$bank_details.length){if(!e.$bank_radio.is(":checked")){
$("#"+e.$bank_details.attr("id")).animate({height:"hide",opacity:"hide"},n,s)}else{$("#"+e.$bank_details.attr("id")).animate({height:"show",opacity:"show"},n,s,function(){if(e.addBankForm){e.addBankForm.focus()}})}}}t()});if(e.addBankForm){e.addBankForm.onEdit(function(){t()})}}},getSelectedDepositMethod:function(){var e;if(n.pageIsMobile){var t=this.picker.checkedRadioIndex();if(t!==undefined){e=this.options[t]}}else{var i=this.$id("@picker input[type=radio]:checked");if(i){e=i.val()}}return e},submit:function(e){var t=this,i=t.getSelectedDepositMethod();if(i&&!t.isSubmitting){if(i==="bank"&&t.missing_bank){if(n.pageIsMobile){o.send("openURL",{url:"/prizes/collect?application_id="+t.application_id})}else{t.addBankForm.submit(function(){t.collectPrizeServerCall(i,e)})}}else{t.collectPrizeServerCall(i,e)}}}});exports.PrizeCollectBankMain=t.extend(d).extend({onLoad:function(){if(!n.pageIsMobile){return}var e=this;r.registerMessageHandler("dismissPrizeCollect",function(){o.send("dismiss")});
o.send("setPageAction",{rightTextButton:{title:n.interface_strings.done,callback:function(){e.submit()}}})},submit:function(){if(!n.pageIsMobile){return}var e=this;e.child("add_bank_form").submit(function(){e.collectPrizeServerCall("bank",function(){if(s.isMobileWeb()){o.send("openURL",{url:"/notifications"})}else{r.broadcastMessageToWebViews("dismissPrizeCollect")}})})}})});define("unified_view/prize/sponsor",["shared/polyfills","shared/core/component","unified_view/modal","interface/jquery"],function eo(require,exports,e){var t=require("shared/core/component").Component,i=require("unified_view/modal").ModalBase,n=require("interface/jquery")._jQuery;var s={showBuyCreditsModal:function(e,t){this.createModal("load_buy_credits_modal").kwargs({num_credits_required:e}).onSubmit(function(){if(t){t()}}).show()}};exports.NewPrizeForm=t.extend(s).extend({onLoad:function(){var e=this;e.$show_details_editor_link=e.$id("@show_details_editor_link");e.$details_editor_wrapper=e.$id("@details_editor_wrapper");
e.$default_amount=e.$id("@amount_"+e.default_amount_cents);e.$default_duration=e.$id("@duration_"+e.default_duration);e.$anonymous=e.$id("@anonymous");e.$submit=e.$id("@submit");e.$form_actions=e.$id("@form_actions");e.textEditor=e.child("text_editor");e.detailsEditor=e.child("details_editor");e.textTooLong=false;e.detailsTooLong=false;e.submitShown=false;e._isSubmitting=false;e.$show_details_editor_link.on("click",function(t){t.preventDefault();e.$show_details_editor_link.addClass("hidden");e.$details_editor_wrapper.removeClass("hidden");e.detailsEditor.focus()});e.textEditor.setMeaningfulChangeCallback(function(){e._maybeDisableSubmit();if(e.textEditor.isOnlyWhiteSpace()){e._toggleSubmitShown(false)}else{e._toggleSubmitShown(true)}});e.textEditor.setLengthChangeCallback(function(t){e.textTooLong=t;e._maybeDisableSubmit()});e.detailsEditor.setLengthChangeCallback(function(t){e.detailsTooLong=t;e._maybeDisableSubmit()});e.$submit.on("click",function(t){t.preventDefault();e.submit()})},getSelectedAmountCents:function(){
if(this.is_subscriber){return}var e=this.$id("@amount_picker input[type=radio]:checked");if(e){return parseInt(e.val())}},getSelectedDuration:function(){var e=this.$id("@duration_picker input[type=radio]:checked");if(e){return parseInt(e.val())}},getAnonymous:function(){if(!this.$anonymous.length){return true}return this.$anonymous.prop("checked")},reset:function(){this.textEditor.clear();this.detailsEditor.clear();this.$show_details_editor_link.removeClass("hidden");this.$details_editor_wrapper.addClass("hidden");this._toggleSubmitShown(false);if(!this.is_subscriber){this.$default_amount.prop("checked",true)}this.$default_duration.prop("checked",true)},isValid:function(){return!this.textEditor.isOnlyWhiteSpace()&&!this.textTooLong&&!this.detailsTooLong},submit:function(){var e=this;if(e._isSubmitting){return}if(!e.isValid()){return}e._toggleSubmitting(true);e.serverCall("submit").kwargs({text:e.textEditor.serialize(),details:e.detailsEditor.serialize(),amount_cents:e.getSelectedAmountCents(),
duration:e.getSelectedDuration(),anonymous:e.getAnonymous()}).success(function(t){e._toggleSubmitting(false);if(t.success){e.reset()}else{e.showBuyCreditsModal(t.num_credits_required,function(){e.submit()})}}).error(function(){e._toggleSubmitting(false)}).liveMutate().send()},_maybeDisableSubmit:function(){this.$submit.toggleClass("disabled",!this.isValid())},_toggleSubmitShown:function(e){var t=n("#"+this.$form_actions.attr("id")),i=166,s="swing";if(e){if(!this.submitShown){this.submitShown=true;t.animate({height:"show",opacity:"show"},i,s).css("overflow","visible")}}else{if(this.submitShown){this.submitShown=false;t.animate({height:"hide",opacity:"hide"},i,s).css("overflow","visible")}}},_toggleSubmitting:function(e){this._isSubmitting=e;if(this._isSubmitting){this.textEditor.disable();this.detailsEditor.disable();this.$id("@amount_picker input[type=radio]").attr("disabled",true);this.$id("@duration_picker input[type=radio]").attr("disabled",true)}else{this.textEditor.enable();this.detailsEditor.enable();
this.$id("@amount_picker input[type=radio]").attr("disabled",false);this.$id("@duration_picker input[type=radio]").attr("disabled",false)}}});exports.PrizesCreditBalance=t.extend(s).extend({onLoad:function(){var e=this;e.$id("@buy").on("click",function(t){t.preventDefault();e.showBuyCreditsModal()})}});exports.PrizesBuyCreditsModal=i.extend({onSubmit:function(){var e=this,t=e._super;e.child("buy_credits_form").submit(function(){t.apply(e,arguments)})}});exports.PrizesBuyCreditsForm=t.extend({onLoad:function(){var e=this;e.$radios=e.$id("@option_picker input[type=radio]");e.$radios.on("change",function(t){e.$radios.map(function(){var e=n(this),t=n("label[for='"+e.attr("id")+"']");t.toggleClass("selected",e.is(":checked"));t.toggleClass("not_selected",!e.is(":checked"))});e.updatePurchaseDetails()})},updatePurchaseDetails:function(){var e=this,t=e.$id("@purchase_details .purchase_details_item");t.map(function(){var t=n(this),i=parseInt(t.attr("id").split("_").slice(-1)[0]);t.toggleClass("hidden",i!==e.getSelectedNumCredits());
});if(!e.purchaseDetailsShown){e.purchaseDetailsShown=true;n("#"+e.$id("@purchase_details").attr("id")).animate({height:"show",opacity:"show"},166,"swing")}},getSelectedNumCredits:function(){var e=this.$id("@option_picker input[type=radio]:checked");if(e){return parseInt(e.val())}},submit:function(e){var t=this,i=t.child("add_card_form"),n=t.getSelectedNumCredits();if(t.isSubmitting){return}if(!n){return}function s(){t.serverCall("submit").kwargs({num_credits:n}).success(function(){e();t.isSubmitting=false}).error(function(){t.isSubmitting=false}).liveMutate().send()}t.isSubmitting=true;if(i){i.submit(function(){s()})}else{s()}}});exports.PrizeChooseWinnerModal=i.extend({onSubmit:function(){var e=this,t=e._super;e.child("choose_winner_form").submit(function(){t.apply(e,arguments)})}});exports.PrizeChooseWinnerForm=t.extend({getSelectedAppIDs:function(){var e=[];this.$id("@applications input[type=checkbox]:checked").map(function(){e.push(parseInt(this.value))});return e},submit:function(e){
var t=this;t.serverCall("submit").kwargs({prize_id:t.prize_id,winning_application_ids:t.getSelectedAppIDs()}).success(function(t){e()}).liveMutate().send()}})});define("unified_view/qtext",["shared/polyfills","interface/settings","shared/client_tracker","shared/core/component","shared/events/index","unified_view/toggle","shared/cookies","interface/jquery","shared/action_log","video"],function to(require,exports,e){var t=require("interface/settings"),i=require("shared/client_tracker"),n=require("shared/core/component").Component,s=require("shared/events/index"),o=require("unified_view/toggle"),r=require("shared/cookies"),a=require("interface/jquery")._jQuery,d=require("shared/action_log");exports.Expandable=o.ToggleBase.extend({onLoad:function(){this._super.apply(this,arguments);var e=this;this.handleEvent(s.Types.QTEXT_EXPANDABLE_STATE,function(t){if(!e.content_type){return}if(t.payload.content_type!=e.content_type){return}if(t.payload.oid!=e.oid){return}e.triggerSwitch()})},actualSwitch:function(){
if(!this.switchCompleted){if(this.obj_type){i.track(this.obj_type+"Expand",null,this);r.setQfeedLog(this,this.obj_type+"Expand")}d.logSecondaryAction("ContentExpand",null);if(!t.pageIsMobile){var e=a(this.$switchHide.get(0));var n=require("video");n.handleVideosBeforeSelectionHidden(e)}}if(this.css_truncation){this.$id("@wrapper").addClass("expanded");this.$id("@wrapper").removeClass("truncated")}else{this._super()}}});exports.Diff=n.extend({onLoad:function(){var e=this;e.$id("@more_link").on("click",function(){e.$id("@diff_snip").addClass("hidden");e.$id("@full_diff").removeClass("hidden");return false})}})});define("unified_view/qtext2/photo_search",["shared/polyfills","shared/core/component","shared/debounce"],function io(require,exports,e){var t=require("shared/core/component").Component,i=require("shared/debounce").debounce;exports.PhotoSearch=t.extend({onLoad:function(){this.hasInitialized=false},initSearchInput:function(){var e=this,t="",n=e.$id("@search");var s=i(function(){var i=n.val();
if(i!==t&&i.length>=3){e.getPhotos(i);t=i}},500);n.on("keydown",function(){s()})},initUploadLink:function(){var e=this;e.$id("@upload").on("click",function(t){t.preventDefault();if(e.$uploader){if(e.uploadCallback){e.uploadCallback()}e.$uploader.click()}})},setUploader:function(e){this.$uploader=e},makeActive:function(){this.$id("@search").focus();this.serverCall("log_action").kwargs({action_type:"open"}).send();if(this.hasInitialized===false){this.initSearchInput();this.initUploadLink();if(this.load_default_results){this.getPhotos()}this.hasInitialized=true}},getPhotos:function(e){var t=this;if(!e||e.length===0){e=t.default_query}t.clearPhotos();t.$id("@spinner").removeClass("hidden");t.serverCall("get_photos").kwargs({query:e}).success(function(e){t.$id("@spinner").addClass("hidden");t.renderPhotos(e)}).send()},renderEmptyState:function(){var e=this.$id("@empty_state");e.text(this.empty_msg);e.removeClass("hidden")},renderPhotos:function(e){var t=document.createDocumentFragment(),i=this;
if(e.length===0){i.renderEmptyState();return}e.forEach(function(e){var n=document.createElement("img");n.src=e[1];n.dataset.original=e[0];n.addEventListener("click",function(){if(i.selectCallback){i.selectCallback(n.dataset.original)}i.serverCall("log_action").kwargs({action_type:"insert_image"}).send()});t.appendChild(n)});this.$id("@container").get(0).appendChild(t)},clearPhotos:function(){var e=this.$id("@container").get(0),t=0;while(t<e.childNodes.length){if(e.childNodes[t].tagName=="IMG"){e.removeChild(e.childNodes[t])}else{++t}}this.$id("@empty_state").addClass("hidden")},setSelectCallback:function(e){this.selectCallback=e},setUploadCallback:function(e){this.uploadCallback=e}})});define("qtext2",["shared/polyfills","unified_view/qtext2/editor/mobile","unified_view/qtext2/toolbar"],function no(require,exports,e){var t=require("unified_view/qtext2/editor/mobile"),i=require("unified_view/qtext2/toolbar");exports.handleToolbarAction=function(e,t){if(i.activeToolbar){i.activeToolbar.trigger(e,t);
}};exports.handleRestoreState=function(e){t.activeEditor.restoreState(e)};exports.saveDraft=function(){t.activeEditor.saveDraft()};exports.clearDraft=function(){t.activeEditor.clearDraft()};exports.focus=function(){t.activeEditor.focus()}});define("qtext2/keys",["shared/polyfills","shared/Class"],function so(require,exports,e){var t=require("shared/Class").Class;var i=exports.isMac=/Mac/.test(window.navigator.platform);var n={8:"BACKSPACE",9:"TAB",13:"RETURN",27:"ESCAPE",35:"END",36:"HOME",37:"LEFT",38:"UP",39:"RIGHT",40:"DOWN",46:"DELETE",106:"*",107:"+",109:"-",110:".",111:"/",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"};var s=function(e){return[35,36,37,38,39,40].indexOf(e.which)!=-1};var o=function(e){return e.shiftKey&&e.which==16};var r=t.extend({__init__:function(e){e=e.toUpperCase();this.alt=/ALT-/.test(e);this.ctrl=/CTRL-/.test(e)||!i&&/CMD-/.test(e);this.meta=/META-/.test(e)||i&&/CMD-/.test(e);this.shift=/SHIFT-/.test(e);this.character=e.split("-").pop();
},toString:function(){var e="";if(this.alt){e+="ALT-"}if(this.ctrl){e+="CTRL-"}if(this.meta){e+="META-"}if(this.shift){e+="SHIFT-"}e+=this.character;return e}});var a=function(e){var t=n[e.which]||String.fromCharCode(e.which).toUpperCase(),i="";if(e.altKey){i+="ALT-"}if(e.ctrlKey){i+="CTRL-"}if(e.metaKey){i+="META-"}if(e.shiftKey){i+="SHIFT-"}i+=t;return i};var d=t.extend({__init__:function(){this._handlers=[]},on:function(e,t){var i=new r(e);if(i in this._handlers){throw new Error("Already attached handler for "+i)}this._handlers[i]=t},trigger:function(e){var t=a(e),i=this._handlers[t];if(i){return i(e)}return true}});exports.getShortcutHint=function(e){var t=new r(e),n="";if(i){if(t.meta){n+="&#x2318;"}if(t.ctrl){n+="^"}if(t.alt){n+="&#x2325;"}if(t.shift){n+="&#x21E7;"}}else{if(t.ctrl){n+="Ctrl-"}if(t.alt){n+="Alt-"}if(t.shift){n+="Shift-"}}return n+t.character[0]+t.character.slice(1).toLowerCase()};exports.isNavigation=s;exports.isOnlyShiftKey=o;exports.Hub=d;exports.SPECIAL_KEYS=n});
define("qtext2/shortcuts",["shared/polyfills","qtext2/keys","shared/util"],function oo(require,exports,e){var t=require("qtext2/keys"),i=require("shared/util").extend;var n={Backspace:"backspace",Delete:"delete",Return:"return","Alt-Return":"return","Ctrl-Return":"return","Shift-Return":"soft-return"," ":"space",Tab:"indent","Shift-Tab":"deindent","Cmd-B":"bold","Cmd-I":"italic","Cmd-U":"underline","Cmd-K":"link","Cmd-Shift-7":"ordered_list","Cmd-Shift-8":"unordered_list","Cmd-Shift-9":"quote","Cmd-Shift-K":"code","Cmd-Shift-L":"math","Cmd-Z":"undo","Cmd-Shift-Z":"redo"};if(t.isMac){i(n,{"Ctrl-H":"backspace","Ctrl-D":"delete","Ctrl-K":"delete-forward","Cmd-Backspace":"delete-backward","Ctrl-T":"transpose","Ctrl-Backspace":"backspace","Ctrl-Delete":"delete","Shift-Backspace":"backspace","Shift-Delete":"delete","Alt-Backspace":"delete-previous-word","Alt-Delete":"delete-next-word","Ctrl-U":"underline"})}else{i(n,{"Ctrl-Backspace":"delete-previous-word","Ctrl-Delete":"delete-next-word","Shift-Backspace":"backspace",
"Shift-Delete":"delete","Alt-Backspace":"backspace","Alt-Delete":"delete"})}exports.SHORTCUTS=n});define("qtext2/tooltip",["shared/polyfills","interface/jquery"],function ro(require,exports,e){var t=null,i,n,$=require("interface/jquery")._jQuery;var s=function(){if(i){return}i=$("<div>").addClass("qtext2_tooltip");$(document.body).append(i);n=$("<div>");i.append(n)};exports.show=function(e,o){s();e=$(e);var r=e.offset(),a=r.left+e.width()*.5;n.html(o);if(r.top<30){i.css("top",e.height()+20)}else{i.css("top",r.top-30)}i.css("left",Math.max(0,a-i.width()*.5));i.removeClass("hidden");clearTimeout(t);t=setTimeout(function(){i.addClass("visible")},500)};exports.hide=function(){if(i){clearTimeout(t);t=setTimeout(function(){i.removeClass("visible");i.addClass("hidden")},100)}}});define("unified_view/qtext2/toolbar",["shared/polyfills","shared/core/component","interface/jquery","interface/settings","shared/scroll_animation_handler","qtext2","qtext2/keys","qtext2/shortcuts","qtext2/util","qtext2/tooltip"],function ao(require,exports,e){
var t=require("shared/core/component").Component,$=require("interface/jquery")._jQuery,i=require("interface/settings").pageIsMobile,n=require("shared/scroll_animation_handler"),s=require("qtext2"),o=require("qtext2/keys"),r=require("qtext2/shortcuts").SHORTCUTS,a=require("qtext2/util").Util,d=require("qtext2/tooltip"),l;if(i){l=require("mobile_app2/messages")}var c=t.extend({onLoad:function(){this._barIdx=1},on:function(e,t){this._handlers=this._handlers||[];this._handlers[e]=t},trigger:function(e,t){if(this._handlers[e]){this._handlers[e](t)}},makeActive:function(e){this.showBar(1);this._doc=e;this._startUpdating();exports.activeToolbar=this},makeInactive:function(){this._doc=null;this._updating=false;exports.activeToolbar=null},showBar:function(e){if(this._barIdx<e){this._animation="up"}else if(this._barIdx>e){this._animation="down"}else{this._animation=""}this._barIdx=e},_startUpdating:function(){var e=this;this.currentState=null;if(this._updating){return}this._updating=true;var t=function(){
if(e._doc){e.update(e._doc.getToolbarState(e._barIdx),e._animation);e._animation=false;requestAnimationFrame(t)}};t()},update:function(e,t){if(a.jsonEqual(e,this.currentState)){return}this._update(e,t);this.currentState=e},_update:null});exports.Web=c.extend({onLoad:function(){this._super.apply(this,arguments);this.$linkInput=this.$id("@link_input");this.$linkSave=this.$id("@link_save");this.$isCitation=this.$id("@is_citation");this.buttons.forEach(this.bindButtonEvents.bind(this));this.bindLinkInput();this.fix()},bindButtonEvents:function(e){this._bindButtonClick(e);this._bindButtonTooltip(e)},_bindButtonClick:function(e){var t=e=="image"?"click":"touchstart mousedown";var i=this;this.$id("@"+e).on(t,function(){d.hide();i.trigger("click",e);return false})},_bindButtonTooltip:function(e){this.$id("@"+e).on("mouseenter",function(){var t=this.getAttribute("tooltip"),i;for(i in r){if(r[i]==e){t+=" ("+o.getShortcutHint(i)+")";break}}d.show(this,t)});this.$id("@"+e).on("mouseout",function(){
d.hide()})},bindLinkInput:function(){var e=this;this.$linkSave.on("click",function(){e._triggerLinkInput();return false});this.$linkInput.on("keydown",function(t){if(t.which==13){t.preventDefault();t.stopPropagation();e._triggerLinkInput()}else if(t.which==27){t.preventDefault();t.stopPropagation();e.$linkInput.val("");e._triggerLinkInput()}})},_triggerLinkInput:function(){this.trigger("linkInput",{url:this.$linkInput.val(),isCitation:this.$isCitation.prop("checked")});this.$linkInput.val("");this.$isCitation.prop("checked",false)},_update:function(e,t){var i=this,n,s=this.unsafe$id("@bar"+this._barIdx),o=i.unsafe$id("@storage"),r=s.children(".left"),a=i.unsafe$id("@scroller");s.find(".modifier").each(function(e,t){o.append(t)});e.forEach(function(e){if(e.name=="space"){r=s.children(".right")}else{n=i.unsafe$id("@"+e.name);if(e.disabled){n.removeClass("pressed");n.addClass("disabled")}else if(e.pressed){n.removeClass("disabled");n.addClass("pressed")}else{n.removeClass("disabled");n.removeClass("pressed");
}r.append(n);if(e.focused){n.focus()}}});if(t){a.addClass("animate")}else{a.removeClass("animate")}a.css("top",-this._barIdx*100+"%")},setLinkToolbarStatus:function(e,t){this.$linkInput.val(e);this.$isCitation.prop("checked",!!t);this.$linkSave.text(e?"Update":"Add")},fix:function(){var e=this.unsafe$id("@toolbar"),t=e.parent(),i=a.firstScrollingParent(e.get(0)),s=$(".SiteHeader").height();if($(".is_zen").length!==0||i!==document.body){s=0}var o=function(n){var o=t.offset().top-s;if(i===document.body){o-=n}else{o-=$(i).offset().top}var r=o+t.height()-e.height()*2;if(o<0&&r>0){e.css("position","fixed").css("top",s).css("left",t.offset().left).css("width",t.width()).css("-webkit-transform","translateZ(0)")}else{e.css("position","absolute").css("top",0).css("left",0).css("width","").css("-webkit-transform","")}};if(i===document.body){n.add(window,o)}else{n.add(i,o)}}});exports.activeToolbar=null;var u;exports.MobileWebShim=exports.Web.extend({onLoad:function(){this._super.apply(this);u=this;
},_bindButtonTooltip:function(e){},trigger:function(e,t){s.handleToolbarAction(e,t)},fix:function(){}});exports.updateMobileWebShim=function(e){if(u){var t=1;for(var i=0;i<e.buttons.length;i++){if(e.buttons[i].name=="link_input"){t=0;break}else if(e.buttons[i].name=="undo"){t=2;break}}u.showBar(t);u.update(e.buttons,e.animation)}};exports.Mobile=c.extend({_update:function(e,t){l.send("updateToolbar",{buttons:e,animation:t})}})});define("unified_view/question/prompt",["shared/polyfills","shared/core/component","interface/settings"],function lo(require,exports,e){var t=require("shared/core/component").Component,i=require("interface/settings").pageIsMobile;if(i){var n=require("mobile_app2/client"),s=require("mobile_app2/messages")}exports.QuestionMergedPrompt=t.extend({onLoad:function(){var e=this;if(!i){return}n.registerMessageHandler("questionsMerged",function(t){for(var i=0;i<t.qids.length;i++){if(t.qids[i]===e.qid){s.send("setCanonicalURL",{url:t.canonical_url});s.send("reload")}}})}});
});define("unified_view/question/rad",["shared/polyfills","shared/core/component","shared/w2.context","shared/cookies","shared/action_log","shared/events/index"],function co(require,exports,e){var t=require("shared/core/component").Component,i=require("shared/w2.context").ActionBar,n=require("shared/cookies"),s=require("shared/action_log"),o=require("shared/events/index");exports.RADToggle=t.extend({onLoad:function(){var e=this;e.actionBarContext=e.getContext(i);e.$id("@toggle").on("click",function(t){t.preventDefault();e.actionBarContext.set("toggleRAD",!e.actionBarContext.get("toggleRAD"))});e.actionBarContext.on("toggleRAD",function(t,i){if(i===true){e.$id("@toggle").addClass("is_active");e.$id("@nub").addClass("is_active")}else{e.$id("@toggle").removeClass("is_active");setTimeout(function(){e.$id("@nub").removeClass("is_active")},160)}})}});exports.RequestAnswersDrawer=t.extend({onLoad:function(){var e=this;e.actionBarContext=e.getContext(i);if(e.should_open_by_default){e.actionBarContext.set("toggleRAD",true);
}e.actionBarContext.on("toggleRAD",function(t,i){e.toggleDrawer(i)});e.$id("@close_button").on("click",function(t){t.preventDefault();e.$id("@drawer").removeClass("is_active");e.actionBarContext.set("toggleRAD",false)})},toggleDrawer:function(e){var t=this;if(e){t.showDrawer()}else{t.hideDrawer()}},showDrawer:function(){var e=this;if(e.$id("@drawer").hasClass("is_active")){return}if(e.animated){e.$id("@drawer").addClass("transitioning_in");setTimeout(function(){e.$id("@drawer").removeClass("transitioning_in");e.$id("@drawer").addClass("is_active")},200)}else{e.$id("@drawer").addClass("is_active")}},hideDrawer:function(){var e=this;if(!e.$id("@drawer").hasClass("is_active")){return}e.$id("@drawer").removeClass("is_active");if(e.animated){e.$id("@drawer").addClass("transitioning_out");setTimeout(function(){e.$id("@drawer").removeClass("transitioning_out")},200)}}});exports.RequestFromQuoraLink=t.extend({onLoad:function(){var e=this;e.$id("@request_answers_button").on("click",function(){if(e.$id("@request_answers_button").hasClass("is_active")){
e.unRequestAnswers()}else{e.requestAnswers()}})},requestAnswers:function(){var e=this;e.$id("@list_item").addClass("is_active");e.$id("@request_answers_button").addClass("is_active");e.serverCall("request_answers").error(function(){e.$id("@request_answers_button").removeClass("is_active")}).send();n.setTlog({type:"QuestionReask",qid:e.qid});n.setQfeedLog(e,"QuestionReask")},unRequestAnswers:function(){var e=this;e.$id("@list_item").removeClass("is_active");e.$id("@request_answers_button").removeClass("is_active");e.serverCall("unrequest_answers").error(function(){e.$id("@request_answers_button").addClass("is_active")}).send()}});exports.Suggestions=t.extend({onLoad:function(){var e=this;e.suggestionsLoaded=e.should_load_by_default;e.actionBarContext=e.getContext(i);if(e.actionBarContext.get("toggleRAD")){e.loadSuggestions()}e.actionBarContext.on("toggleRAD",function(t,i){if(i===true){e.loadSuggestions()}})},loadSuggestions:function(){var e=this;if(e.suggestionsLoaded===true){return}e.serverCall("get_suggestions_list").contentFor(e.$id("@suggestions_list").get(0),{
parentCid:e.cid}).success(function(){e.suggestionsLoaded=true}).send()}});exports.SuggestionListItem=s.ActionableComponent.extend({onLoad:function(){var e=this;e.$id("@request_button").on("click",function(){e.request()});e._super.apply(e,arguments)},request:function(){var e=this;e.renderRequested();e.serverCall("request").success(function(t){if(t=="failed"){e.renderDefault()}if(t=="reached"){e.renderDefault()}}).error(function(){e.renderDefault()}).liveMutate().send();n.setQfeedLog(e,"AskToAnswer");n.setTlog({type:"AskToAnswer",qid:e.qid});s.logPrimaryAction("AskToAnswer",{type:e.impression_type,hash:e.impression_hash})},renderRequested:function(){this.$id("@list_item").addClass("is_active");this.$id("@request_button").addClass("is_active")},renderDefault:function(){this.$id("@list_item").removeClass("is_active");this.$id("@request_button").removeClass("is_active")}});exports.PileOnSuggestionListItem=exports.SuggestionListItem.extend({request:function(){var e=this;e._super.apply(e,arguments);
this.emitEvent({type:o.Types.PILE_ON_REQUEST_MADE,payload:{}})}})});define("unified_view/question/text",["shared/polyfills","shared/core/component","shared/mathify","shared/prettyprint"],function uo(require,exports,e){var t=require("shared/core/component").Component,i=require("shared/mathify").renderMath,n=require("shared/prettyprint").prettyPrint;exports.QuestionText=t.extend({onLoad:function(){i(this.$id("@question_text"));n()}})});define("unified_view/settings/languages",["shared/polyfills","shared/core/component","unified_view/modal","interface/settings","shared/client"],function ho(require,exports,e){var t=require("shared/core/component").Component,i=require("unified_view/modal").ModalBase,n=require("interface/settings");if(n.pageIsMobile){var s=require("mobile_app2/client"),o=require("shared/client")}exports.LeaveModalLink=t.extend({onLoad:function(){var e=this;this.$id("@leave_link").on("click",function(){e.openModal()})},openModal:function(){var e=this;e.createModal("load_modal").kwargs({
nid:e.nid}).show()}});exports.MakeNetworkDefaultLink=t.extend({onLoad:function(){var e=this;e.$id("@make_default_link").on("click",function(){e.serverCall("set_default_network").liveMutate().send()})}});exports.LeaveNetworkModal=i.extend({onLoad:function(){this._super.apply(this,arguments)},onSubmit:function(e){var t=this;if(t.redirectUrl){if(o.isNativeApp()){s.updateConfig(t.redirectSubdomain,t.redirectLanguage)}else{window.location.href=t.redirectUrl}}t.serverCall("leave_network").kwargs({nid:t.nid}).success(function(){if(!t.redirectUrl){t.close()}}).liveMutate().send()}})});define("unified_view/settings/privacy",["shared/polyfills","shared/core/component","interface/settings","w2.modal","settings"],function fo(require,exports,e){var t=require("shared/core/component").Component,i=require("interface/settings").pageIsMobile;if(!i){var n=require("w2.modal").ModalWithCallBacks}else{var s=require("mobile_app2/app/view/common"),o=require("mobile_app2/messages"),r=require("settings").interface_strings;
}var a=t.extend({onLoad:function(e){if(i){this.mobileOnLoad()}else{this.desktopOnLoad(e)}},desktopOnLoad:function(){var e=this;this.$id("@check_reauth").on("click",function(t){e.serverCall("check_reauth").success(function(){e.showControl()}).send();t.preventDefault()})},showControl:function(){this.$id("@check_reauth").addClass("hidden");this.$id("@option_control").removeClass("hidden")},showAlert:function(e){var t=this;s.showAlert({title:t.dialog_title,message:t.dialog_message,callback:function(t){if(t.buttonIndex===0&&e){e()}},cancelButtonTitle:t.dialog_button_title,otherButtonTitles:[r.cancel]})}});exports.DeactivateAccountCell=a.extend({desktopOnLoad:function(){this._super.apply(this,arguments);var e=this;this.$id("@deactivate").on("click",function(){var t=new n(e,{});t.onSubmitCallBack(function(){e.deactivateAccount()});t.load("load_deactivate_account_modal")})},mobileOnLoad:function(){var e=this;this.$id("@deactivate").on("click",function(){e.showAlert(e.deactivateAccount.bind(e))});
},deactivateAccount:function(){this.serverCall("deactivate_account").success(function(){if(i){o.send("loginStateChanged",{isLoggedIn:false})}}).send()}});exports.DeleteAccountCell=a.extend({desktopOnLoad:function(){this._super.apply(this,arguments);var e=this;this.$id("@delete").on("click",function(){var t=new n(e,{});t.onSubmitCallBack(function(){e.deleteAccount()});t.load("load_delete_account_modal")})},mobileOnLoad:function(){var e=this;this.$id("@delete").on("click",function(){e.showAlert(e.deleteAccount.bind(e))})},deleteAccount:function(){var e=this;this.serverCall("delete_account").success(function(){if(i){s.showAlert({title:e.dialog_title,message:e.confirmation_dialog_message,callback:function(){o.send("loginStateChanged",{isLoggedIn:false})}})}}).send()}})});define("unified_view/signup/conversion_logging",["shared/polyfills","shared/core/component","shared/cookies","settings","interface/jquery"],function po(require,exports,e){var t=require("shared/core/component").Component,i=require("shared/cookies"),n=require("shared/core/component"),s=require("settings"),o=require("interface/jquery").jQuery;
exports.ConversionLogging=t.extend({onLoad:function(){var e=function(e){var t=e.currentTarget;var o=t.getAttribute("href");if(o&&o!="#"){var r=n.getComponentFromElement(t);var a=[];for(var d=0;d<3&&r&&r.__vcon;d++){a.push(r);r=r.parent()}var l=[];for(d=0;d<a.length;d++){l.push(a[d].__vcon[0])}var c=[];c.push(s.controller);c.push(s.action);c.push(window.location.pathname);var u=c.concat(l);if(JSON.stringify(u).length<400){i.setMessage("cl",u)}}};o("a").on("click",e)}})});define("unified_view/signup/oauth",["shared/polyfills","shared/core/component"],function go(require,exports,e){var t=require("shared/core/component").Component;exports.PermissionsMain=t.extend({onLoad:function(){var e=this;this.$id("@accept_button").on("click",function(){e.serverCall("authenticate_user").success(function(e){window.location=e.location}).send()})}})});define("third_party/smyte",["shared/polyfills","shared/onload"],function mo(require,exports,e){var t=require("shared/onload");exports.asyncInit=function(e,i,n){
t.execAfterLoadDelayed(function(){(function(e,t,i,n,s){e._smyte=e._smyte||[];n=t.createElement(i);n.async=1;n.src="//ping.smyte.com/p.js";s=t.getElementsByTagName(i)[0];s.parentNode.insertBefore(n,s)})(window,document,"script");_smyte.push(["_setClientKey",e]);_smyte.push(["_setSession",{id:i,actor:{id:n,type:"user"}}]);_smyte.push(["_log"])})}});define("unified_view/smyte",["shared/polyfills","shared/core/component","third_party/smyte"],function vo(require,exports,e){var t=require("shared/core/component").Component;exports.SmyteComponent=t.extend({onLoad:function(){require("third_party/smyte").asyncInit(this.api_key,this.session_id,this.uid)}})});define("unified_view/survey",["shared/polyfills","shared/core/component","unified_view/modal","shared/errors","interface/settings"],function _o(require,exports,e){var t=require("shared/core/component").Component,i=require("unified_view/modal").ModalBase,n=require("shared/errors"),s=require("interface/settings").pageIsMobile;exports.SurveyMobileLink=t.extend({
onLoad:function(){var e=this;e.$id("@mobile_link").on("click",function(){e.createModal("load_modal").kwargs({survey_id:e.survey_id,extra_data:e.extra_data}).show();e.$id("@mobile_link").addClass("hidden")});e.serverCall("mark_as_seen").kwargs({}).send()}});exports.SurveyMobileLinkLoggedOut=t.extend({onLoad:function(){var e=this;e.$id("@mobile_link").on("click",function(){e.createModal("load_modal").kwargs({survey_id:e.survey_id,extra_data:e.extra_data,uid:e.uid}).show();e.$id("@mobile_link").addClass("hidden")});e.serverCall("mark_as_seen").kwargs({}).send()}});exports.SurveyModalWrapper=i.extend({onLoad:function(){this.child("survey_in_modal").onSubmit(this.close.bind(this))}});exports.Survey=t.extend({onLoad:function(){var e=this;e.index=0;e.on_last_question=false;e.buttons_attached=[];if(e.num_of_questions==1){e.on_last_question=true}e._bindSurveyCellClickHandler();e.serverCall("mark_as_seen").kwargs({}).send()},onSubmit:function(e){this.__submitCallback=e},_bindSurveyCellClickHandler:function(){
var e=this;var t=this.children();for(var i=0;i<t.length;i++){var n=t[i];if(n.setResponseChangeCallback){n.setResponseChangeCallback(e._enableButton.bind(e))}}},_enableButton:function(e){var t=this;if(!t.buttons_attached[e]){t.buttons_attached.push(true);if(t.on_last_question){t.$id("@submit_button_"+e).removeClass("disabled");t.$id("@submit_button_"+e).on("click",function(){t._cleanupAndSubmit()})}else{t.$id("@next_button_"+e).removeClass("disabled");t.$id("@next_button_"+e).on("click",function(){t._handleNext()})}}},_showNextQuestion:function(){var e=this;e.$id("@question_"+e.index).addClass("hidden");e.index++;e.$id("@question_"+e.index).removeClass("hidden");if(e.index+1==e.num_of_questions){e.on_last_question=true}},_handleNext:function(){var e=this;e._recordResponse(false);e._showNextQuestion()},_cleanupAndSubmit:function(){var e=this;e.$id("@done_message").css("height",e.$id("@survey").css("height"));e.$id("@survey").addClass("survey_fade_out");setTimeout(function(){e.$id("@survey").addClass("hidden");
e.$id("@done_message").removeClass("hidden");setTimeout(function(){e.$id("@done_message").css("height",0);e.$id("@done_inner").addClass("hidden");e.$id("@done_message").addClass("collapse");e._recordResponse(true);setTimeout(function(){e.$id("@done_message").addClass("hidden");if(e.__submitCallback){e.__submitCallback()}},200)},2e3)},200)},_recordResponse:function(e){var t=this;var i=t.child("answer_section_"+t.index).getResponse();t.serverCall("record_response").kwargs({question_index:t.index,response:i,is_last_question:e}).liveMutate().send()}});exports.ResponseSection=t.extend({setResponseChangeCallback:function(e){var t=this;t.$id("@section").on("click",function(){e(t.index)})},getResponse:function(){var e=this.child("response_type");if(!e){n.logJsError("SurveyResponseSection","A ResponseSection should have a ResponseType in it.");return""}return e.getResponse()}});exports.ResponseType=t.extend({onLoad:function(){var e=this;e.selectedIndex=null;e.$id("@response .survey_cell.radio").on("click",function(t){
var i=t.currentTarget.dataset.index;if(e.selectedIndex!==null&&i!=e.selectedIndex){var n=e.getIdForSelection(e.selectedIndex);e.$id(n).removeClass("selected");e.$id(n).prop("checked",false)}var s=e.getIdForSelection(i);e.$id(s).addClass("selected");e.$id(s).prop("checked",true);e.selectedIndex=i})},getIdForSelection:function(e){if(s){return"@option-"+e}else{return"@value-"+e}},getResponse:function(){return this.$id("@value-"+this.selectedIndex).val()}});exports.FreeResponse=exports.ResponseType.extend({getResponse:function(){return this.$id("@response .free_response").val()}})});define("unified_view/translation",["shared/polyfills","shared/core/component","shared/keystrokes"],function wo(require,exports,e){var t=require("shared/core/component").Component;exports.TranslationInterfaceToggle=t.extend({onLoad:function(){this._state=false;this.setupKeyboardShortcut()},toggle:function(){var e=this;var t;var i=document.getElementsByClassName("translation_interface_info");if(!e._state){e._state=true;
for(t=0;t<i.length;t++){i[t].style.display="block"}}else{e._state=false;for(t=0;t<i.length;t++){i[t].style.display="none"}}},setupKeyboardShortcut:function(){require("shared/keystrokes").on([76,73,68,76,73,68],this.toggle.bind(this))}})});define("unified_view/write/writing_list",["shared/polyfills","shared/core/component","interface/settings","unified_view/modal"],function bo(require,exports,e){var t=require("shared/core/component").Component,i=require("interface/settings").pageIsMobile,n=require("unified_view/modal").ModalBase;if(i){var s=require("mobile_app2/app/view/common")}exports.RemoveAllWritingListLink=t.extend({onLoad:function(){var e=this;this.$id("@confirmation_dialogue").on("click",function(){if(i){var t=e.alert_data;t.callback=function(t){if(t.buttonIndex===0){e.serverCall("remove_all").liveMutate().send()}};s.showAlert(t)}else{e.showModal()}return false})},showModal:function(){this.createModal("load_modal").show()}});exports.RemoveAllWritingListConfirmationModal=n.extend({
onSubmit:function(){var e=this._super.bind(this);this.serverCall("remove_all").success(function(t){e(t)}).liveMutate().send()}})});define("unified_view/main",["shared/polyfills"],function yo(require,exports,e){true||require("unified_view/a2a");true||require("unified_view/action_bar/_action_bar");true||require("unified_view/action_bar/answer");true||require("unified_view/action_bar/base");true||require("unified_view/action_bar/blog");true||require("unified_view/action_bar/overflow_menu/answer");true||require("unified_view/action_bar/overflow_menu/base");true||require("unified_view/action_bar/overflow_menu/comment");true||require("unified_view/action_bar/overflow_menu/profile");true||require("unified_view/action_bar/overflow_menu/question");true||require("unified_view/action_bar/overflow_menu/shared");true||require("unified_view/action_bar/question");true||require("unified_view/action_bar/shared");true||require("unified_view/action_bar/user");true||require("unified_view/answer/credibility");
true||require("unified_view/button/abstract");true||require("unified_view/button/ads");true||require("unified_view/button/downvote");true||require("unified_view/button/follow");true||require("unified_view/button/network");true||require("unified_view/button/notif");true||require("unified_view/button/pause_ad");true||require("unified_view/button/pin");true||require("unified_view/button/prize");true||require("unified_view/button/upvote");true||require("unified_view/button/write_answer");true||require("unified_view/button/writing_list");true||require("unified_view/captcha");true||require("unified_view/carousel");true||require("unified_view/cf");true||require("unified_view/character_counter");true||require("unified_view/components");true||require("unified_view/cookie_warning");true||require("unified_view/credential");true||require("unified_view/datetime_");true||require("unified_view/download_csv");true||require("unified_view/feed/explanation");true||require("unified_view/feed/feedback");true||require("unified_view/feed/modal");
true||require("unified_view/form");true||require("unified_view/home/logged_out_feed");true||require("unified_view/lazy");true||require("unified_view/mobile_debug");true||require("unified_view/mobile_overlays");true||require("unified_view/modal");true||require("unified_view/multifeed/_multifeed");true||require("unified_view/multifeed/story");true||require("unified_view/multifeed/view_tracker");true||require("unified_view/multifeed/write");true||require("unified_view/network/invite");true||require("unified_view/network/join");true||require("unified_view/network/login");true||require("unified_view/network/signup");true||require("unified_view/network/switcher");true||require("unified_view/notifications");true||require("unified_view/nux");true||require("unified_view/paged_list");true||require("unified_view/payment/_payment");true||require("unified_view/payment/money");true||require("unified_view/pmsg");true||require("unified_view/privacy");true||require("unified_view/prize/_prize");true||require("unified_view/prize/collect");
true||require("unified_view/prize/sponsor");true||require("unified_view/qtext");true||require("unified_view/qtext2/editor");true||require("unified_view/qtext2/editor/mobile");true||require("unified_view/qtext2/photo_search");true||require("unified_view/qtext2/toolbar");true||require("unified_view/question/prompt");true||require("unified_view/question/rad");true||require("unified_view/question/text");true||require("unified_view/settings/languages");true||require("unified_view/settings/privacy");true||require("unified_view/signup/_signup");true||require("unified_view/signup/conversion_logging");true||require("unified_view/signup/facebook");true||require("unified_view/signup/google");true||require("unified_view/signup/oauth");true||require("unified_view/smyte");true||require("unified_view/survey");true||require("unified_view/switch");true||require("unified_view/toggle");true||require("unified_view/translation");true||require("unified_view/util");true||require("unified_view/write/writing_list");
});define("view/announcement",["shared/polyfills","webnode2"],function Co(require,exports,e){var t=require("webnode2").Component;exports.Announcement=t.extend({onLoad:function(){var e=this;this.$id("@close").click(function(){e.closeAnnouncement("x");return false});this.serverCall("track_announcement_view").send()},closeAnnouncement:function(e){this.serverCall("close_announcement").kwargs({closing_action:e}).liveMutate().send()}})});define("view/board_selector",["shared/polyfills","view/selector"],function xo(require,exports,e){var t=require("view/selector").Selector,i=require("view/selector").SelectorWithTypeaheadLogMixin;exports.BoardSelector=t.extend(i).extend({onLoad:function(){var e=this;this._super.apply(this,arguments);e.$input_wrapper=e.$id("@input_wrapper");e.$selected_board_wrapper=e.$id("@selected_board_wrapper");e.$new_board_name_wrapper=e.$id("@new_board_name_wrapper");e.$new_board_name=e.$id("@new_board_name");var t=function(t){t.preventDefault();t.stopPropagation();e.clear();
e.$input.focus()};e.$selected_board_wrapper.click(t);e.$new_board_name_wrapper.click(t)},shouldTypeaheadLog:function(e){var t=this.child("results");return!!e&&e.ty==="board"&&!!t.typeahead_log_data},resultWasSelected:function(e,t){this._super.apply(this,arguments);var i=this;if(e.ty==="board"){i.selected_board={name:null,bid:e.data.bid,is_submission:!!e.data.is_submission};i.serverCall("update_selected_board").kwargs({bid:e.data.bid}).contentFor(i.$selected_board_wrapper,{parentCid:i.cid}).success(function(){i.$wrapper.focusout();i.$input_wrapper.addClass("hidden");i.$new_board_name_wrapper.addClass("hidden");i.$selected_board_wrapper.removeClass("hidden")}).send()}else if(e.ty==="additem"){this.selected_board={name:i.query,bid:null,is_submission:false};i.$new_board_name.text(i.query);i.$wrapper.focusout();i.$input_wrapper.addClass("hidden");i.$selected_board_wrapper.addClass("hidden");i.$new_board_name_wrapper.removeClass("hidden")}else{console.assert(false)}},clear:function(){this.setQuery("");
this.$input_wrapper.removeClass("hidden");this.$selected_board_wrapper.addClass("hidden");this.$selected_board_wrapper.empty();this.$new_board_name_wrapper.addClass("hidden");this.$new_board_name.empty();this.selected_board=null}})});define("view/datetime_",["shared/polyfills","webnode2"],function ko(require,exports,e){var t=require("webnode2").Component,i=null,n={};exports.CountdownClock=t.extend({onLoad:function(){var e=this;var t=e.$id("@countdown");if(i===null){i=setInterval(function(){var e=true;for(var t in n){if(n.hasOwnProperty(t)){e=false;n[t]()}}if(e){clearInterval(i);i=null}},200)}n[e.cid]=function(){var i=Math.floor(Date.now()/1e3);var s=e.getTimeDifference(i);var o=Math.floor(s/60%60);var r=Math.floor(s/(60*60));var a=Math.floor(s%60);var d;if(e.should_pad_zeroes){var l=function(e){var t=e.toString();return t.length>1?t:"0"+t};o=l(o);a=l(a)}d=e.template.replace("{hrs}",r).replace("{mins}",o).replace("{secs}",a);if(e.text!==d){e.text=d;t.text(d)}if(e.hasExpired(i)){delete n[e.cid];
}}},onUnload:function(){delete n[this.cid]},getTimeDifference:function(e){return Math.max(this.expires_secs-e,0)},hasExpired:function(e){return e>this.expires_secs}});exports.TimeElapsedClock=exports.CountdownClock.extend({getTimeDifference:function(e){return Math.max(e-this.expires_secs,0)},hasExpired:function(e){return false}})});define("view/embed",["shared/polyfills","webnode2","interface/jquery"],function So(require,exports,e){var t=require("webnode2").Component,$=require("interface/jquery")._jQuery;exports.ExternalEmbed=t.extend({onLoad:function(e){var t=this;this.$id("@embed_logo").mouseover(function(){t.$id("@embed_logo").css({"background-position":"0 -20px"}).animate({right:"0px"},80)});this.$id("@external_embed_wrapper").on("mousedown",'a[href!="#"]',function(e){var t=$(e.currentTarget);t.attr("target","_blank")})}})});define("view/filter_nav_list",["shared/polyfills","webnode2","interface/jquery","shared/events/index","shared/window_manager"],function Eo(require,exports,e){var t=require("webnode2").Component,$=require("interface/jquery")._jQuery,i=require("shared/events/index"),n=require("shared/window_manager");
exports.FilterNavListItem=t.extend({onLoad:function(){var e=this;this.$id("@item").on("click",function(){var t=$(this);if(t.hasClass("selected")){return false}var i=t.attr("value");e.updateDataAndReloadList(e.data_key,i);return false})},updateDataAndReloadList:function(e,t){var i=n.parseURLParams(window.location.search.substring(1).replace(/\+/g,"%20"));i[e]=t;for(var s in i){if(i[s]==="all"||i[s]===""){delete i[s]}}var o=$.param(i);window.location=window.location.pathname+"?"+o}});exports.FilterMultipleValuesNavListBase=t.extend({onLoad:function(){var e=this;this.handleEvent(i.Types.FILTER_NAV_LIST_UPDATE,function(t){if(t.payload.key==e.data_key&&t.payload.remove){e.removeFilterFromKey(t.payload.remove)}})},updateDataAndReloadList:function(e){var t=$.param(e);window.location=window.location.pathname+"?"+t},addFilterToKey:function(e){var t=this.data_key;var i=n.parseURLParams(window.location.search.substring(1).replace(/\+/g,"%20"));var s=[];if(i[t]=="followed"){delete i[t]}if(i[t]){s=i[t].split(" ");
}if(s.length===0){i[t]=e}else{s.push(e);var o=s.join(" ");i[t]=o}this.updateDataAndReloadList(i)},removeFilterFromKey:function(e){var t=this.data_key;var i=n.parseURLParams(window.location.search.substring(1).replace(/\+/g,"%20"));var s=i[t].split(" ");var o=s.indexOf(e);if(o>-1){s.splice(o,1);var r=s.join(" ");i[t]=r}for(var a in i){if(i[a]==="all"||i[a]===""){delete i[a]}}this.updateDataAndReloadList(i)}});exports.FilterMultipleValuesNavListItemBase=t.extend({onLoad:function(){var e=this;this.$id("@remove").click(function(){e.emitEvent({type:i.Types.FILTER_NAV_LIST_UPDATE,payload:{key:e.data_key,remove:e.filter_value.toString()}});return false})}})});define("view/filterable_list",["shared/polyfills","webnode2"],function To(require,exports,e){var t=require("webnode2").Component;exports.FilterableList=t.extend({onLoad:function(){this.lastQuery=null;this.delay=100;var e=this;this.$id("@search").keyup(function(){var t=function(t){e.fetchResults(t)};setTimeout(t,e.delay,e.$id("@search").val());
});this.$id("@search_link").click(function(){e.$id("@search_link").hide();e.$id("@bullet").hide();e.$id("@search").show().focus();e.$id("@after_search").show().focus();e.$id("@search_row").show().focus();return false})},newQueryEntered:function(e){},fetchResults:function(e){var t=this;if(e!=this.$id("@search").val()){return}if(e==this.lastQuery){return}if(e&&e!==""&&e!=this.lastQuery){this.serverCall("search_results").kwargs({query:e}).contentFor(this.$id("@search_results"),{parentCid:this.cid,useLoadingSpinner:false}).success(function(){var e=t.$id("@search").val();if(e&&e!==""){t.$id("@search_results").show();t.$id("@default").hide()}else{t.$id("@search_results").hide();t.$id("@default").show()}}).send();this.lastQuery=e;this.newQueryEntered(e)}else if(e===""){this.$id("@search_results").hide();this.$id("@default").show()}}})});define("view/fixable_component",["shared/polyfills","webnode2","view/fixable2"],function $o(require,exports,e){var t=require("webnode2").Component,i=require("view/fixable2");
exports.FixableComponent=t.extend({onLoad:function(){var e=this.$id("@fixable_component");i.makeFixable(e.parent(),this.options);e.remove()}})});define("view/follower_list",["shared/polyfills","webnode2"],function Lo(require,exports,e){var t=require("webnode2").Component;exports.FollowerListModalLink=t.extend({onLoad:function(){var e=this;this.$id("@modal_link").click(function(){e.modal("load_inner",{kwargs:{object_id:e.object_id}});return false})}})});define("view/invisibleinfo",["shared/polyfills","webnode2","shared/keystrokes","interface/jquery"],function Mo(require,exports,e){var t=require("webnode2").Component,i=require("shared/keystrokes"),$=require("interface/jquery")._jQuery;exports.InfoToggle=t.extend({onLoad:function(){this._state=false;this.setupKeyboardShortcut()},toggle:function(){if(!this._state){this._state=true;$(".invisible_info").show()}else{this._state=false;$(".invisible_info").hide()}},setupKeyboardShortcut:function(){i.on([81,73,68,81,73,68],this.toggle.bind(this));
}})});define("view/link_selector",["shared/polyfills","view/selector"],function Do(require,exports,e){var t=require("view/selector").Selector,i=require("view/selector").SelectorWithTypeaheadLogMixin;exports.LinkSelector=t.extend(i).extend({onLoad:function(){this._super.apply(this,arguments);var e=this;e.$id("@input").keydown(function(){if(e._escKeyDown){return e._escKeyDown.apply(this,arguments)}});e.$id("@input").keyup(function(t){if(e._keyUp){return e._keyUp.apply(this,arguments)}})},setEscKeyDown:function(e){this._escKeyDown=e},setKeyUp:function(e){this._keyUp=e}})});define("view/notif",["shared/polyfills","webnode2"],function Ao(require,exports,e){var t=require("webnode2").Component;exports.NotifQuestionLink=t.extend({onLoad:function(){var e=this;this.$id("@link").click(function(){e.serverCall("link_clicked_callback").send()})}})});define("view/photo",["shared/polyfills","webnode2","shared/cookies"],function Io(require,exports,e){var t=require("webnode2").Component,i=require("shared/cookies");
exports.InlinePhotoEditor=t.extend({onLoad:function(){var e=this;this.$id("@x_photo").click(function(){e.dialog().title(e.dialog_title).cancel(null,e.close_button_text).ok(function(){e.serverCall("remove_photo").send()},e.dialog_button_text).html(e.dialog_message);return false});e.whenOnLoaded(function(){e.$id("@photo").hover(function(){e.$id("@edit").toggleClass("hidden");e.$id("@x_photo").toggleClass("hidden")})})}});exports.BoardPhoto=t.extend({onLoad:function(e){var t=this;this.$id("@link").mousedown(function(){i.setQfeedLog(t,"BoardClickthrough");i.setQueryLog(t,"BoardClickthrough")})}});exports.TopicPhoto=t.extend({onLoad:function(e){var t=this;this.$id("@link").mousedown(function(){i.setQfeedLog(t,"TopicClickthrough");i.setQueryLog(t,"TopicClickthrough")})}})});define("view/placepicker",["shared/polyfills","webnode2","interface/jquery","shared/loadjs","shared/util","shared/window_manager","settings"],function qo(require,exports,e){var t=require("webnode2").Component,$=require("interface/jquery")._jQuery,i=require("shared/loadjs").loadJS,n=require("shared/util"),s=require("shared/window_manager"),o=false,r=[],a=require("settings").interface_strings;
var d=n.once(function(){var e="//maps.googleapis.com/maps/api/js?sensor=false&libraries=places";i(e,function(){o=true;while(r.length){r.pop().call()}})});function l(e){if(o){e()}else{d();r.push(e)}}exports.PlacePicker=t.extend({onLoad:function(){l(this.onLoadBase.bind(this))},onLoadBase:function(){var e=this;this.address=this.default_location;this.initializeGoogleMaps();if(this.mutable===true){this.$id("@edit_map").click(function(){e.toggleEditor();return false});this.$id("@change_location").click(function(){if(e.place||e.marker){e.$id("@search_text_field").blur();var t,i;if(e.map.getBounds().contains(e.marker.getPosition())){t=e.marker.getPosition().lat();i=e.marker.getPosition().lng()}else{t=e.map.getCenter().lat();i=e.map.getCenter().lng()}if(!e.place){var n=new google.maps.LatLng(t,i);var s=new google.maps.Geocoder;s.geocode({location:n},function(t,i){if(i==google.maps.GeocoderStatus.OK&&t.length){var n=t[0];e.radius=e.computeRadius(n.geometry.viewport);e.setAddress(n.address_components);
}})}var o=$.trim(e.$id("@search_text_field").val());e.serverCall("place_changed").kwargs({radius:e.radius,reference:e.place&&e.place.reference||e.reference,lat:t,lng:i,viewport:{zoom:e.map.getZoom(),mapTypeId:e.map.getMapTypeId(),icon:e.place&&e.place.icon,tilt:e.map.getTilt(),heading:e.map.getHeading()},address:o.length?o:e.address}).success(function(){e.default_location.hasLocation=true}).send()}else{e.$id("@search_text_field").focus()}});this.$id("@edit").click(function(){e.toggleEditor();return false});this.$id("@add").click(function(){e.reinitializeMap();return false});this.$id("@clear").click(function(){e.dialog().title(e.dialog_title).cancel(null,a.cancel).ok(function(){e.serverCall("place_cleared").success(e.toggleEditor.bind(e)).send()},e.dialog_title).html(e.dialog_message);return false});this.$id("@close").click(function(){e.toggleEditor();e.initializeGoogleMaps();if(e.default_location.hasLocation===false){e.$id("@map_wrapper").hide()}return false});if(s.getHash().substr(0,13)=="#editlocation"){
this.reinitializeMap()}}},initializeGoogleMaps:function(){l(this.initializeGoogleMapsBase.bind(this))},initializeGoogleMapsBase:function(){var e=this;this.mapOptions={center:window.google&&google.maps&&new google.maps.LatLng(this.default_location.latitude,this.default_location.longitude),zoom:this.viewport&&this.viewport.zoom||7,mapTypeId:this.viewport&&this.viewport.mapTypeId||window.google&&google.maps&&google.maps.MapTypeId.ROADMAP||"roadmap",tilt:this.viewport&&this.viewport.tilt!==undefined&&this.viewport.zoom>=18?this.viewport.tilt:45,heading:this.viewport&&this.viewport.heading,streetViewControl:!this.mutable};var t=this.viewport&&this.viewport.icon;if(this.static_map===true){var i="//maps.googleapis.com/maps/api/staticmap?center="+encodeURIComponent(this.default_location.latitude+","+this.default_location.longitude)+"&zoom="+encodeURIComponent(this.mapOptions.zoom)+"&size="+encodeURIComponent(this.size.width+"x"+this.size.height)+"&maptype="+encodeURIComponent(this.mapOptions.mapTypeId)+"&markers="+encodeURIComponent("icon:"+t+"shadow:false|"+this.default_location.latitude+","+this.default_location.longitude)+"&sensor=false";
var n=$('<img src="'+i+'" />');this.$id("@map_canvas").replaceWith(n);return}this.map=new google.maps.Map(this.$id("@map_canvas").get(0),this.mapOptions);if(this.simple_view===true||this.mutable===true){this.toggleControls(false)}if(this.default_location.hasLocation!==false){this.updateMarker(t,this.mapOptions.center,this.default_text)}if(this.mutable===true){this.toggleDraggable(false)}if(this.mutable===true){var s=this.$id("@search_text_field").get(0);var o=new google.maps.places.Autocomplete(s);o.bindTo("bounds",this.map);google.maps.event.addListener(o,"place_changed",function(){if(e.infowindow){e.infowindow.close()}e.place=o.getPlace();if(e.place.geometry.viewport){e.map.fitBounds(e.place.geometry.viewport);e.radius=e.computeRadius(e.place.geometry.viewport)}else{e.map.setCenter(e.place.geometry.location);e.map.setZoom(17);e.radius=30}e.setAddress(e.place.address_components);e.updateMarker(e.place.icon,e.place.geometry.location)});google.maps.event.addListener(this.map,"click",function(t){
if(!e.getControlState()){return}var i=t.latLng;e.radius=e.computeRadius(e.map.getBounds());e.handleMarkerReposition(i);e.updateMarker(null,i)})}},setAddress:function(e){var t=this;this.address="";if(e){this.address=[e[0]&&e[0].short_name||"",e[1]&&e[1].short_name||"",e[2]&&e[2].short_name||""];if(this.address[1]==this.address[2]){this.address.splice(2,1)}if(this.address[0]==this.address[1]){this.address.splice(1,1)}var i="";$.each(this.address,function(e,n){i+=n;if(/^[0-9]+$/.test(n)){i+=" "}else if(e!=t.address.length-1){i+=", "}});this.address=i}},reinitializeMap:function(){var e=this;this.$id("@map_wrapper").show(0,function(){e.initializeGoogleMaps();e.toggleEditor();e.$id("@search_text_field").focus()})},toggleEditor:function(){this.$id("@view").toggle();this.$id("@editor").toggle();this.$id("@edit_map").toggle();this.toggleDraggable();this.toggleControls()},getControlState:function(){return!!this.mapOptions.mapTypeControl},toggleControls:function(e){l(this.toggleControlsBase.bind(this,e));
},toggleControlsBase:function(e){var t=e!==undefined?e:!this.getControlState();this.mapOptions.mapTypeControl=t;this.mapOptions.panControl=t;this.mapOptions.zoomControl=t;this.mapOptions.scaleControl=t;this.mapOptions.rotateControl=t;this.mapOptions.overviewMapControl=t;this.map.setOptions(this.mapOptions)},toggleDraggable:function(e){l(this.toggleDraggableBase.bind(this,e))},toggleDraggableBase:function(e){this.mapOptions.draggable=e!==undefined?e:!this.mapOptions.draggable;if(this.mapOptions.draggable){this.mapOptions.minZoom=undefined;this.mapOptions.maxZoom=undefined;if(this.marker){this.marker.setDraggable(true)}}else{this.mapOptions.minZoom=this.map.getZoom();this.mapOptions.maxZoom=this.map.getZoom();if(this.marker){this.marker.setDraggable(false)}}this.map.setOptions(this.mapOptions)},updateMarker:function(e,t){l(this.updateMarkerBase.bind(this,e,t))},updateMarkerBase:function(e,t){var i=this;if(this.marker){this.marker.setMap(null)}var n=new google.maps.MarkerImage(e||"//maps.gstatic.com/mapfiles/place_api/icons/geocode-71.png",new google.maps.Size(40,40),new google.maps.Point(0,0),new google.maps.Point(20,40),new google.maps.Size(40,40));
this.marker=new google.maps.Marker({clickable:true,draggable:this.mapOptions&&this.mapOptions.draggable,icon:n,map:this.map,position:t});google.maps.event.addListener(this.marker,"dragend",function(e){var t=e.latLng;i.handleMarkerReposition(t)});this.updateInfoWindow(t)},handleMarkerReposition:function(e){l(this.handleMarkerRepositionBase.bind(this,e))},handleMarkerRepositionBase:function(e){var t=this;this.place=null;window.setTimeout(function(){t.map.panTo(e)},1e4);var i=new google.maps.Geocoder;i.geocode({location:e},function(i,n){if(n==google.maps.GeocoderStatus.OK&&i.length){var s=i[0];t.radius=t.computeRadius(s.geometry.viewport);t.setAddress(s.address_components);t.updateInfoWindow(e)}})},updateInfoWindow:function(e){l(this.updateInfoWindowBase.bind(this,e))},updateInfoWindowBase:function(e){var t=this;if(this.infowindow){this.infowindow.close()}if(this.address&&this.address.length){this.infowindow=new google.maps.InfoWindow({content:this.address,position:e});google.maps.event.addListener(this.marker,"click",function(){
t.infowindow.open(t.map,t.marker)})}},computeRadius:function(e){var t=e.getNorthEast();var i=e.getSouthWest();var n=t.lat();var s=i.lat();return Math.floor(Math.abs(n-s)*111045/2)}})});define("view/privacy",["shared/polyfills","view/modal","w2.modal"],function No(require,exports,e){var t=require("view/modal").Base,i=require("w2.modal");exports.FirstAnonAnswerWarningDialog=t.extend({onSubmit:function(){this.serverCall("accept").send();this._super.apply(this,arguments);i.Modal.modalFor(this).executeOnSubmitCallBack()}})});define("view/repeat_offender",["shared/polyfills","webnode2","view/modal"],function Oo(require,exports,e){var t=require("webnode2").Component,i=require("view/modal").Base;exports.RepeatOffender=t.extend({onLoad:function(){this.modal("load_repeat_offender_modal",{closeOnBackgroundClick:false,closeOnEscape:false})}});exports.RepeatOffenderModal=i.extend({onLoad:function(){this._super.apply(this,arguments)},onSubmit:function(){var e=this;this.serverCall("mark_modal_as_read").liveMutate().success(function(){
e._closeModal()}).send()}})});define("view/suggested_edits",["shared/polyfills","webnode2","shared/events/index"],function Ro(require,exports,e){var t=require("webnode2").Component,i=require("shared/events/index");exports.SuggestedEditBar=t.extend({toggleButtons:function(){this.$id("@suggested_answer_buttons").toggleClass("hidden")}});exports.SuggestedEditButtons=t.extend({onLoad:function(){var e=this;e.$id("@view_original").click(function(){if(e.content_type){e.emitEvent(i.helpers.inlineEditorToggle(e.content_type,e.object_id))}else{e.parent().parent().toggleSuggestion()}return false});if(!e.content_type){return}e.$id("@edit_suggestion").on("click",function(){e.emitEvent(i.helpers.inlineEditorEdit(e.content_type,e.object_id));return false})}})});define("view/tooltip",["shared/polyfills","webnode2","tooltip"],function Po(require,exports,e){var t=require("webnode2").Component,i=require("tooltip");exports.TooltipComponent=t.extend({onLoad:function(){var e=this.$id("@tooltip");i.attach(e.parent(),this.options.contents,this.options);
e.remove()}})});define("view/user",["shared/polyfills","webnode2","view/hover_menu","tooltip","shared/cookies"],function Bo(require,exports,e){var t=require("webnode2").Component,i=require("view/hover_menu").HoverMenu,n=require("tooltip"),s=require("shared/cookies");exports.Name=i.extend({onLoad:function(e){var t=this;this._super.apply(this,arguments);this.$id("@name_link").mousedown(function(){s.setQfeedLog(t,"UserClickthrough");s.setQueryLog(t,"UserClickthrough")})}});exports.UserPhoto=t.extend({onLoad:function(e){var t=this;this.$id("@link").mousedown(function(){s.setQfeedLog(t,"UserClickthrough");s.setQueryLog(t,"UserClickthrough")})}});exports.TopWriterIcon=t.extend({onLoad:function(){n.attach(this.$id("@icon"),this.tooltip_text)}});exports.TopAskerIcon=t.extend({onLoad:function(){n.attach(this.$id("@icon"),this.tooltip_text)}})});define("view/voter_list",["shared/polyfills","webnode2"],function Fo(require,exports,e){var t=require("webnode2").Component;exports.VoterListModalLink=t.extend({
onLoad:function(){var e=this;this.$id("@modal_link").click(function(){e.modal("load_inner",{kwargs:{object_id:e.object_id}});return false})}})});require.whenReady(["shared/polyfills","third_party/json2","shared/log","shared/beforeunload","jquery","gating","third_party/jquery.migrate","datepicker","jquery.webnode2","w2.errors","init","facebook","twitter","shared/mathjax","login","network","view/captcha","view/reauth","unified_view/lazy_load_images","shared/links_logger","shared/service_worker_init","shared/client_tracker","shared/activity_metrics","shared/w2.timing"],function(){require("third_party/json2");require("shared/log");require("shared/beforeunload");require("jquery");if(require("gating").jquery_migrate){require("third_party/jquery.migrate")}require("datepicker");require("jquery.webnode2");require("w2.errors");require("init");require("facebook");require("twitter");require("shared/mathjax");require("login");require("network");require("view/captcha");require("view/reauth");require("unified_view/lazy_load_images");
require("shared/links_logger");require("shared/service_worker_init");require("shared/client_tracker").init();require("shared/activity_metrics").init();true||require("actions");true||require("app/view/activation/endorsement");true||require("app/view/activation/endorsement/endorse_by_topic");true||require("app/view/activation/endorsement/endorse_by_user");true||require("app/view/activation/endorsement/modal");true||require("app/view/activation/facebook");true||require("app/view/activation/profile_topics");true||require("app/view/activation/progress");true||require("app/view/activation/twitter");true||require("app/view/admin");true||require("app/view/ads");true||require("app/view/ama");true||require("app/view/ama/self_serve");true||require("app/view/answer");true||require("app/view/answer_wiki");true||require("app/view/ask");true||require("app/view/board");true||require("app/view/board/blog");true||require("app/view/board/create_box");true||require("app/view/board/follow_invite");true||require("app/view/board/item");
true||require("app/view/board/settings");true||require("app/view/board/submission");true||require("app/view/board/view_tracker");true||require("app/view/bug_report");true||require("app/view/comment");true||require("app/view/common");true||require("app/view/components");true||require("app/view/contact_importer");true||require("app/view/draft");true||require("app/view/embed");true||require("app/view/error");true||require("app/view/feed");true||require("app/view/feed/ama");true||require("app/view/feed/answer");true||require("app/view/feed/feedback");true||require("app/view/feed/modal");true||require("app/view/feed/question");true||require("app/view/funnel");true||require("app/view/growl");true||require("app/view/home");true||require("app/view/intro_to_quora");true||require("app/view/layout");true||require("app/view/link");true||require("app/view/linkedin_");true||require("app/view/login");true||require("app/view/manage");true||require("app/view/messages");true||require("app/view/moderation/appeal");
true||require("app/view/moderation/flag");true||require("app/view/navigation");true||require("app/view/network/selector");true||require("app/view/notifications");true||require("app/view/notifications/base");true||require("app/view/notifications/header");true||require("app/view/nux");true||require("app/view/nux/dialog");true||require("app/view/nux/existing_user");true||require("app/view/nux/find_friends");true||require("app/view/oauth");true||require("app/view/payment/payable");true||require("app/view/payment/receivable");true||require("app/view/people_selector");true||require("app/view/photo");true||require("app/view/pmsg/pmsg");true||require("app/view/post");true||require("app/view/prize/add_answer");true||require("app/view/query/filters");true||require("app/view/query/query");true||require("app/view/question");true||require("app/view/question/add_answer");true||require("app/view/question/answer_tag");true||require("app/view/question/ask_question");true||require("app/view/question/cant_answer");
true||require("app/view/question/disclaimer");true||require("app/view/question/lookup_bar");true||require("app/view/question/lookup_bar_details");true||require("app/view/question/merge/_merge");true||require("app/view/question/merge/modal");true||require("app/view/question/merge/selector");true||require("app/view/question/not_helpful");true||require("app/view/question/question_add");true||require("app/view/question/question_add");true||require("app/view/question/suggested_answer");true||require("app/view/question/wanted_answer");true||require("app/view/quora_meets_bagel");true||require("app/view/reading_list");true||require("app/view/settings");true||require("app/view/share");true||require("app/view/share/connect");true||require("app/view/share/form");true||require("app/view/share/modal");true||require("app/view/signup_validation");true||require("app/view/site_header");true||require("app/view/site_header/logged_in");true||require("app/view/site_header/logged_out");true||require("app/view/static");
true||require("app/view/suggestions");true||require("app/view/survey/question_page");true||require("app/view/thanks");true||require("app/view/thread");true||require("app/view/threaded_comments");true||require("app/view/topic");true||require("app/view/topic/edit_topic_modal");true||require("app/view/topic/faq");true||require("app/view/topic/flag");true||require("app/view/topic/leaderboard");true||require("app/view/topic/location");true||require("app/view/topic/merge");true||require("app/view/topic/topic_create");true||require("app/view/topic/topic_list");true||require("app/view/topic/topic_ontology");true||require("app/view/topic/topic_redesign");true||require("app/view/topic_selector");true||require("app/view/tumblr");true||require("app/view/tutorial");true||require("app/view/user");true||require("app/view/user/content");true||require("app/view/user/profile");true||require("app/view/user/setup_");true||require("app/view/user/subscribe");true||require("app/view/user/topics");true||require("app/view/user_settings/notifications");
true||require("app/view/user_settings/settings");true||require("app/view/user_stats");true||require("app/view/vc");true||require("app/view/write");true||require("app/view/zapdos/card");true||require("flash");true||require("google_");true||require("input_validate");true||require("shared/e2e");true||require("shared/action_log");true||require("shared/inline_css");true||require("shared/skyfall");true||require("tchannel_up");true||require("unified_view/main");true||require("view/announcement");true||require("view/board_selector");true||require("view/datetime_");true||require("view/dialog");true||require("view/editable_list");true||require("view/embed");true||require("view/filter_nav_list");true||require("view/filterable_list");true||require("view/fixable_component");true||require("view/follower_list");true||require("view/hover_menu");true||require("view/invisibleinfo");true||require("view/link_selector");true||require("view/livenode");true||require("view/modal");true||require("view/notif");true||require("view/paged_list");
true||require("view/photo");true||require("view/placepicker");true||require("view/pmsg");true||require("view/privacy");true||require("view/reorderable_list");true||require("view/repeat_offender");true||require("view/selector");true||require("view/suggested_edits");true||require("view/tooltip");true||require("view/upload");true||require("view/user");true||require("view/voter_list");if(window.log&&window.log.enabled){window.log("main","main is loaded.")}require("shared/w2.timing").logTime("mainScriptEnd")});define("shared/main-loaded",["shared/polyfills"],function Uo(require,exports,e){});define("third_party/rangy-core",["shared/polyfills"],function jo(require,exports,e){window["rangy"]=function(){var e="object",t="function",i="undefined";var n=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer","START_TO_START","START_TO_END","END_TO_START","END_TO_END"];var s=["setStart","setStartBefore","setStartAfter","setEnd","setEndBefore","setEndAfter","collapse","selectNode","selectNodeContents","compareBoundaryPoints","deleteContents","extractContents","cloneContents","insertNode","surroundContents","cloneRange","toString","detach"];
var o=["boundingHeight","boundingLeft","boundingTop","boundingWidth","htmlText","text"];var r=["collapse","compareEndPoints","duplicate","getBookmark","moveToBookmark","moveToElementText","parentElement","pasteHTML","select","setEndPoint","getBoundingClientRect"];function a(i,n){var s=typeof i[n];return s==t||!!(s==e&&i[n])||s=="unknown"}function d(t,i){return!!(typeof t[i]==e&&t[i])}function l(e,t){return typeof e[t]!=i}function c(e){return function(t,i){var n=i.length;while(n--){if(!e(t,i[n])){return false}}return true}}var u=c(a);var h=c(d);var f=c(l);function p(e){return e&&u(e,r)&&f(e,o)}var g={version:"1.2.3",initialized:false,supported:true,util:{isHostMethod:a,isHostObject:d,isHostProperty:l,areHostMethods:u,areHostObjects:h,areHostProperties:f,isTextRange:p},features:{},modules:{},config:{alertOnWarn:false,preferTextRange:false}};function m(e){window.alert("Rangy not supported in your browser. Reason: "+e);g.initialized=true;g.supported=false}g.fail=m;function v(e){var t="Rangy warning: "+e;
if(g.config.alertOnWarn){window.alert(t)}else if(typeof window.console!=i&&typeof window.console.log!=i){window.console.log(t)}}g.warn=v;if({}.hasOwnProperty){g.util.extend=function(e,t){for(var i in t){if(t.hasOwnProperty(i)){e[i]=t[i]}}}}else{m("hasOwnProperty not supported")}var _=[];var w=[];function b(){if(g.initialized){return}var e;var t=false,i=false;if(a(document,"createRange")){e=document.createRange();if(u(e,s)&&f(e,n)){t=true}e.detach()}var o=d(document,"body")?document.body:document.getElementsByTagName("body")[0];if(o&&a(o,"createTextRange")){e=o.createTextRange();if(p(e)){i=true}}if(!t&&!i){m("Neither Range nor TextRange are implemented")}g.initialized=true;g.features={implementsDomRange:t,implementsTextRange:i};var r=w.concat(_);for(var l=0,c=r.length;l<c;++l){try{r[l](g)}catch(h){if(d(window,"console")&&a(window.console,"log")){window.console.log("Init listener threw an exception. Continuing.",h)}}}}g.init=b;g.addInitListener=function(e){if(g.initialized){e(g)}else{_.push(e);
}};var y=[];g.addCreateMissingNativeApiListener=function(e){y.push(e)};function C(e){e=e||window;b();for(var t=0,i=y.length;t<i;++t){y[t](e)}}g.createMissingNativeApi=C;function x(e){this.name=e;this.initialized=false;this.supported=false}x.prototype.fail=function(e){this.initialized=true;this.supported=false;throw new Error("Module '"+this.name+"' failed to load: "+e)};x.prototype.warn=function(e){g.warn("Module "+this.name+": "+e)};x.prototype.createError=function(e){return new Error("Error in Rangy "+this.name+" module: "+e)};g.createModule=function(e,t){var i=new x(e);g.modules[e]=i;w.push(function(e){t(e,i);i.initialized=true;i.supported=true})};g.requireModules=function(modules){for(var e=0,t=modules.length,i,n;e<t;++e){n=modules[e];i=g.modules[n];if(!i||!(i instanceof x)){throw new Error("Module '"+n+"' not found")}if(!i.supported){throw new Error("Module '"+n+"' not supported")}}};var k=false;var S=function(e){if(!k){k=true;if(!g.initialized){b()}}};if(typeof window==i){m("No window found");
return}if(typeof document==i){m("No document found");return}if(a(document,"addEventListener")){document.addEventListener("DOMContentLoaded",S,false)}if(a(window,"addEventListener")){window.addEventListener("load",S,false)}else if(a(window,"attachEvent")){window.attachEvent("onload",S)}else{m("Window does not have required addEventListener or attachEvent method")}return g}();rangy.createModule("DomUtil",function(e,t){var i="undefined";var n=e.util;if(!n.areHostMethods(document,["createDocumentFragment","createElement","createTextNode"])){t.fail("document missing a Node creation method")}if(!n.isHostMethod(document,"getElementsByTagName")){t.fail("document missing getElementsByTagName method")}var s=document.createElement("div");if(!n.areHostMethods(s,["insertBefore","appendChild","cloneNode"]||!n.areHostObjects(s,["previousSibling","nextSibling","childNodes","parentNode"]))){t.fail("Incomplete Element implementation")}if(!n.isHostProperty(s,"innerHTML")){t.fail("Element is missing innerHTML property");
}var o=document.createTextNode("test");if(!n.areHostMethods(o,["splitText","deleteData","insertData","appendData","cloneNode"]||!n.areHostObjects(s,["previousSibling","nextSibling","childNodes","parentNode"])||!n.areHostProperties(o,["data"]))){t.fail("Incomplete Text Node implementation")}var r=function(e,t){var i=e.length;while(i--){if(e[i]===t){return true}}return false};function a(e){var t;return typeof e.namespaceURI==i||((t=e.namespaceURI)===null||t=="http://www.w3.org/1999/xhtml")}function d(e){var t=e.parentNode;return t.nodeType==1?t:null}function l(e){var t=0;while(e=e.previousSibling){t++}return t}function c(e){var t;return p(e)?e.length:(t=e.childNodes)?t.length:0}function u(e,t){var i=[],n;for(n=e;n;n=n.parentNode){i.push(n)}for(n=t;n;n=n.parentNode){if(r(i,n)){return n}}return null}function h(e,t,i){var n=i?t:t.parentNode;while(n){if(n===e){return true}else{n=n.parentNode}}return false}function f(e,t,i){var n,s=i?e:e.parentNode;while(s){n=s.parentNode;if(n===t){return s}s=n;
}return null}function p(e){var t=e.nodeType;return t==3||t==4||t==8}function g(e,t){var i=t.nextSibling,n=t.parentNode;if(i){n.insertBefore(e,i)}else{n.appendChild(e)}return e}function m(e,t){var i=e.cloneNode(false);i.deleteData(0,t);e.deleteData(t,e.length-t);g(i,e);return i}function v(e){if(e.nodeType==9){return e}else if(typeof e.ownerDocument!=i){return e.ownerDocument}else if(typeof e.document!=i){return e.document}else if(e.parentNode){return v(e.parentNode)}else{throw new Error("getDocument: no document found for node")}}function _(e){var t=v(e);if(typeof t.defaultView!=i){return t.defaultView}else if(typeof t.parentWindow!=i){return t.parentWindow}else{throw new Error("Cannot get a window object for node")}}function w(e){if(typeof e.contentDocument!=i){return e.contentDocument}else if(typeof e.contentWindow!=i){return e.contentWindow.document}else{throw new Error("getIframeWindow: No Document object found for iframe element")}}function b(e){if(typeof e.contentWindow!=i){return e.contentWindow;
}else if(typeof e.contentDocument!=i){return e.contentDocument.defaultView}else{throw new Error("getIframeWindow: No Window object found for iframe element")}}function y(e){return n.isHostObject(e,"body")?e.body:e.getElementsByTagName("body")[0]}function C(e){var t;while(t=e.parentNode){e=t}return e}function x(e,t,i,n){var s,o,r,a,d;if(e==i){return t===n?0:t<n?-1:1}else if(s=f(i,e,true)){return t<=l(s)?-1:1}else if(s=f(e,i,true)){return l(s)<n?-1:1}else{o=u(e,i);r=e===o?o:f(e,o,true);a=i===o?o:f(i,o,true);if(r===a){throw new Error("comparePoints got to case 4 and childA and childB are the same!")}else{d=o.firstChild;while(d){if(d===r){return-1}else if(d===a){return 1}d=d.nextSibling}throw new Error("Should not be here!")}}}function k(e){var t=v(e).createDocumentFragment(),i;while(i=e.firstChild){t.appendChild(i)}return t}function S(e){if(!e){return"[No node]"}if(p(e)){return'"'+e.data+'"'}else if(e.nodeType==1){var t=e.id?' id="'+e.id+'"':"";return"<"+e.nodeName+t+">["+e.childNodes.length+"]";
}else{return e.nodeName}}function E(e){this.root=e;this._next=e}E.prototype={_current:null,hasNext:function(){return!!this._next},next:function(){var e=this._current=this._next;var t,i;if(this._current){t=e.firstChild;if(t){this._next=t}else{i=null;while(e!==this.root&&!(i=e.nextSibling)){e=e.parentNode}this._next=i}}return this._current},detach:function(){this._current=this._next=this.root=null}};function T(e){return new E(e)}function L(e,t){this.node=e;this.offset=t}L.prototype={equals:function(e){return this.node===e.node&this.offset==e.offset},inspect:function(){return"[DomPosition("+S(this.node)+":"+this.offset+")]"}};function M(e){this.code=this[e];this.codeName=e;this.message="DOMException: "+this.codeName}M.prototype={INDEX_SIZE_ERR:1,HIERARCHY_REQUEST_ERR:3,WRONG_DOCUMENT_ERR:4,NO_MODIFICATION_ALLOWED_ERR:7,NOT_FOUND_ERR:8,NOT_SUPPORTED_ERR:9,INVALID_STATE_ERR:11};M.prototype.toString=function(){return this.message};e.dom={arrayContains:r,isHtmlNamespace:a,parentElement:d,getNodeIndex:l,
getNodeLength:c,getCommonAncestor:u,isAncestorOf:h,getClosestAncestorIn:f,isCharacterDataNode:p,insertAfter:g,splitDataNode:m,getDocument:v,getWindow:_,getIframeWindow:b,getIframeDocument:w,getBody:y,getRootContainer:C,comparePoints:x,inspectNode:S,fragmentFromNodeChildren:k,createIterator:T,DomPosition:L};e.DOMException=M});rangy.createModule("DomRange",function(e,t){e.requireModules(["DomUtil"]);var i=e.dom;var n=i.DomPosition;var s=e.DOMException;function o(e,t){return e.nodeType!=3&&(i.isAncestorOf(e,t.startContainer,true)||i.isAncestorOf(e,t.endContainer,true))}function r(e){return i.getDocument(e.startContainer)}function a(e,t,i){var n=e._listeners[t];if(n){for(var s=0,o=n.length;s<o;++s){n[s].call(e,{target:e,args:i})}}}function d(e){return new n(e.parentNode,i.getNodeIndex(e))}function l(e){return new n(e.parentNode,i.getNodeIndex(e)+1)}function c(e,t,n){var s=e.nodeType==11?e.firstChild:e;if(i.isCharacterDataNode(t)){if(n==t.length){i.insertAfter(e,t)}else{t.parentNode.insertBefore(e,n==0?t:i.splitDataNode(t,n));
}}else if(n>=t.childNodes.length){t.appendChild(e)}else{t.insertBefore(e,t.childNodes[n])}return s}function u(e){var t;for(var i,n=r(e.range).createDocumentFragment(),o;i=e.next();){t=e.isPartiallySelectedSubtree();i=i.cloneNode(!t);if(t){o=e.getSubtreeIterator();i.appendChild(u(o));o.detach(true)}if(i.nodeType==10){throw new s("HIERARCHY_REQUEST_ERR")}n.appendChild(i)}return n}function h(e,t,n){var s,o;n=n||{stop:false};for(var r,a;r=e.next();){if(e.isPartiallySelectedSubtree()){if(t(r)===false){n.stop=true;return}else{a=e.getSubtreeIterator();h(a,t,n);a.detach(true);if(n.stop){return}}}else{s=i.createIterator(r);while(o=s.next()){if(t(o)===false){n.stop=true;return}}}}}function f(e){var t;while(e.next()){if(e.isPartiallySelectedSubtree()){t=e.getSubtreeIterator();f(t);t.detach(true)}else{e.remove()}}}function p(e){for(var t,i=r(e.range).createDocumentFragment(),n;t=e.next();){if(e.isPartiallySelectedSubtree()){t=t.cloneNode(false);n=e.getSubtreeIterator();t.appendChild(p(n));n.detach(true);
}else{e.remove()}if(t.nodeType==10){throw new s("HIERARCHY_REQUEST_ERR")}i.appendChild(t)}return i}function g(e,t,i){var n=!!(t&&t.length),s;var o=!!i;if(n){s=new RegExp("^("+t.join("|")+")$")}var r=[];h(new v(e,false),function(e){if((!n||s.test(e.nodeType))&&(!o||i(e))){r.push(e)}});return r}function m(e){var t=typeof e.getName=="undefined"?"Range":e.getName();return"["+t+"("+i.inspectNode(e.startContainer)+":"+e.startOffset+", "+i.inspectNode(e.endContainer)+":"+e.endOffset+")]"}function v(e,t){this.range=e;this.clonePartiallySelectedTextNodes=t;if(!e.collapsed){this.sc=e.startContainer;this.so=e.startOffset;this.ec=e.endContainer;this.eo=e.endOffset;var n=e.commonAncestorContainer;if(this.sc===this.ec&&i.isCharacterDataNode(this.sc)){this.isSingleCharacterDataNode=true;this._first=this._last=this._next=this.sc}else{this._first=this._next=this.sc===n&&!i.isCharacterDataNode(this.sc)?this.sc.childNodes[this.so]:i.getClosestAncestorIn(this.sc,n,true);this._last=this.ec===n&&!i.isCharacterDataNode(this.ec)?this.ec.childNodes[this.eo-1]:i.getClosestAncestorIn(this.ec,n,true);
}}}v.prototype={_current:null,_next:null,_first:null,_last:null,isSingleCharacterDataNode:false,reset:function(){this._current=null;this._next=this._first},hasNext:function(){return!!this._next},next:function(){var e=this._current=this._next;if(e){this._next=e!==this._last?e.nextSibling:null;if(i.isCharacterDataNode(e)&&this.clonePartiallySelectedTextNodes){if(e===this.ec){(e=e.cloneNode(true)).deleteData(this.eo,e.length-this.eo)}if(this._current===this.sc){(e=e.cloneNode(true)).deleteData(0,this.so)}}}return e},remove:function(){var e=this._current,t,n;if(i.isCharacterDataNode(e)&&(e===this.sc||e===this.ec)){t=e===this.sc?this.so:0;n=e===this.ec?this.eo:e.length;if(t!=n){e.deleteData(t,n-t)}}else{if(e.parentNode){e.parentNode.removeChild(e)}else{}}},isPartiallySelectedSubtree:function(){var e=this._current;return o(e,this.range)},getSubtreeIterator:function(){var e;if(this.isSingleCharacterDataNode){e=this.range.cloneRange();e.collapse()}else{e=new le(r(this.range));var t=this._current;
var n=t,s=0,o=t,a=i.getNodeLength(t);if(i.isAncestorOf(t,this.sc,true)){n=this.sc;s=this.so}if(i.isAncestorOf(t,this.ec,true)){o=this.ec;a=this.eo}ae(e,n,s,o,a)}return new v(e,this.clonePartiallySelectedTextNodes)},detach:function(e){if(e){this.range.detach()}this.range=this._current=this._next=this._first=this._last=this.sc=this.so=this.ec=this.eo=null}};function _(e){this.code=this[e];this.codeName=e;this.message="RangeException: "+this.codeName}_.prototype={BAD_BOUNDARYPOINTS_ERR:1,INVALID_NODE_TYPE_ERR:2};_.prototype.toString=function(){return this.message};function w(e,t,i){this.nodes=g(e,t,i);this._next=this.nodes[0];this._position=0}w.prototype={_current:null,hasNext:function(){return!!this._next},next:function(){this._current=this._next;this._next=this.nodes[++this._position];return this._current},detach:function(){this._current=this._next=this.nodes=null}};var b=[1,3,4,5,7,8,10];var y=[2,9,11];var C=[5,6,10,12];var x=[1,3,4,5,7,8,10,11];var k=[1,3,4,5,7,8];function S(e){return function(t,n){
var s,o=n?t:t.parentNode;while(o){s=o.nodeType;if(i.arrayContains(e,s)){return o}o=o.parentNode}return null}}var E=i.getRootContainer;var T=S([9,11]);var L=S(C);var M=S([6,10,12]);function D(e,t){if(M(e,t)){throw new _("INVALID_NODE_TYPE_ERR")}}function A(e){if(!e.startContainer){throw new s("INVALID_STATE_ERR")}}function I(e,t){if(!i.arrayContains(t,e.nodeType)){throw new _("INVALID_NODE_TYPE_ERR")}}function q(e,t){if(t<0||t>(i.isCharacterDataNode(e)?e.length:e.childNodes.length)){throw new s("INDEX_SIZE_ERR")}}function N(e,t){if(T(e,true)!==T(t,true)){throw new s("WRONG_DOCUMENT_ERR")}}function O(e){if(L(e,true)){throw new s("NO_MODIFICATION_ALLOWED_ERR")}}function R(e,t){if(!e){throw new s(t)}}function P(e){return!i.arrayContains(y,e.nodeType)&&!T(e,true)}function B(e,t){return t<=(i.isCharacterDataNode(e)?e.length:e.childNodes.length)}function F(e){return!!e.startContainer&&!!e.endContainer&&!P(e.startContainer)&&!P(e.endContainer)&&B(e.startContainer,e.startOffset)&&B(e.endContainer,e.endOffset);
}function U(e){A(e);if(!F(e)){throw new Error("Range error: Range is no longer valid after DOM mutation ("+e.inspect()+")")}}var j=document.createElement("style");var H=false;try{j.innerHTML="<b>x</b>";H=j.firstChild.nodeType==3}catch(Q){}e.features.htmlParsingConforms=H;var W=H?function(e){var t=this.startContainer;var n=i.getDocument(t);if(!t){throw new s("INVALID_STATE_ERR")}var o=null;if(t.nodeType==1){o=t}else if(i.isCharacterDataNode(t)){o=i.parentElement(t)}if(o===null||o.nodeName=="HTML"&&i.isHtmlNamespace(i.getDocument(o).documentElement)&&i.isHtmlNamespace(o)){o=n.createElement("body")}else{o=o.cloneNode(false)}o.innerHTML=e;return i.fragmentFromNodeChildren(o)}:function(e){A(this);var t=r(this);var n=t.createElement("body");n.innerHTML=e;return i.fragmentFromNodeChildren(n)};var V=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer"];var z=0,G=1,K=2,J=3;var X=0,Y=1,Z=2,ee=3;function te(){}te.prototype={attachListener:function(e,t){this._listeners[e].push(t);
},compareBoundaryPoints:function(e,t){U(this);N(this.startContainer,t.startContainer);var n,s,o,r;var a=e==J||e==z?"start":"end";var d=e==G||e==z?"start":"end";n=this[a+"Container"];s=this[a+"Offset"];o=t[d+"Container"];r=t[d+"Offset"];return i.comparePoints(n,s,o,r)},insertNode:function(e){U(this);I(e,x);O(this.startContainer);if(i.isAncestorOf(e,this.startContainer,true)){throw new s("HIERARCHY_REQUEST_ERR")}var t=c(e,this.startContainer,this.startOffset);this.setStartBefore(t)},cloneContents:function(){U(this);var e,t;if(this.collapsed){return r(this).createDocumentFragment()}else{if(this.startContainer===this.endContainer&&i.isCharacterDataNode(this.startContainer)){e=this.startContainer.cloneNode(true);e.data=e.data.slice(this.startOffset,this.endOffset);t=r(this).createDocumentFragment();t.appendChild(e);return t}else{var n=new v(this,true);e=u(n);n.detach()}return e}},canSurroundContents:function(){U(this);O(this.startContainer);O(this.endContainer);var e=new v(this,true);var t=e._first&&o(e._first,this)||e._last&&o(e._last,this);
e.detach();return!t},surroundContents:function(e){I(e,k);if(!this.canSurroundContents()){throw new _("BAD_BOUNDARYPOINTS_ERR")}var t=this.extractContents();if(e.hasChildNodes()){while(e.lastChild){e.removeChild(e.lastChild)}}c(e,this.startContainer,this.startOffset);e.appendChild(t);this.selectNode(e)},cloneRange:function(){U(this);var e=new le(r(this));var t=V.length,i;while(t--){i=V[t];e[i]=this[i]}return e},toString:function(){U(this);var e=this.startContainer;if(e===this.endContainer&&i.isCharacterDataNode(e)){return e.nodeType==3||e.nodeType==4?e.data.slice(this.startOffset,this.endOffset):""}else{var t=[],n=new v(this,true);h(n,function(e){if(e.nodeType==3||e.nodeType==4){t.push(e.data)}});n.detach();return t.join("")}},compareNode:function(e){U(this);var t=e.parentNode;var n=i.getNodeIndex(e);if(!t){throw new s("NOT_FOUND_ERR")}var o=this.comparePoint(t,n),r=this.comparePoint(t,n+1);if(o<0){return r>0?Z:X}else{return r>0?Y:ee}},comparePoint:function(e,t){U(this);R(e,"HIERARCHY_REQUEST_ERR");
N(e,this.startContainer);if(i.comparePoints(e,t,this.startContainer,this.startOffset)<0){return-1}else if(i.comparePoints(e,t,this.endContainer,this.endOffset)>0){return 1}return 0},createContextualFragment:W,toHtml:function(){U(this);var e=r(this).createElement("div");e.appendChild(this.cloneContents());return e.innerHTML},intersectsNode:function(e,t){U(this);R(e,"NOT_FOUND_ERR");if(i.getDocument(e)!==r(this)){return false}var n=e.parentNode,s=i.getNodeIndex(e);R(n,"NOT_FOUND_ERR");var o=i.comparePoints(n,s,this.endContainer,this.endOffset),a=i.comparePoints(n,s+1,this.startContainer,this.startOffset);return t?o<=0&&a>=0:o<0&&a>0},isPointInRange:function(e,t){U(this);R(e,"HIERARCHY_REQUEST_ERR");N(e,this.startContainer);return i.comparePoints(e,t,this.startContainer,this.startOffset)>=0&&i.comparePoints(e,t,this.endContainer,this.endOffset)<=0},intersectsRange:function(e,t){U(this);if(r(e)!=r(this)){throw new s("WRONG_DOCUMENT_ERR")}var n=i.comparePoints(this.startContainer,this.startOffset,e.endContainer,e.endOffset),o=i.comparePoints(this.endContainer,this.endOffset,e.startContainer,e.startOffset);
return t?n<=0&&o>=0:n<0&&o>0},intersection:function(e){if(this.intersectsRange(e)){var t=i.comparePoints(this.startContainer,this.startOffset,e.startContainer,e.startOffset),n=i.comparePoints(this.endContainer,this.endOffset,e.endContainer,e.endOffset);var s=this.cloneRange();if(t==-1){s.setStart(e.startContainer,e.startOffset)}if(n==1){s.setEnd(e.endContainer,e.endOffset)}return s}return null},union:function(e){if(this.intersectsRange(e,true)){var t=this.cloneRange();if(i.comparePoints(e.startContainer,e.startOffset,this.startContainer,this.startOffset)==-1){t.setStart(e.startContainer,e.startOffset)}if(i.comparePoints(e.endContainer,e.endOffset,this.endContainer,this.endOffset)==1){t.setEnd(e.endContainer,e.endOffset)}return t}else{throw new _("Ranges do not intersect")}},containsNode:function(e,t){if(t){return this.intersectsNode(e,false)}else{return this.compareNode(e)==ee}},containsNodeContents:function(e){return this.comparePoint(e,0)>=0&&this.comparePoint(e,i.getNodeLength(e))<=0;
},containsRange:function(e){return this.intersection(e).equals(e)},containsNodeText:function(e){var t=this.cloneRange();t.selectNode(e);var i=t.getNodes([3]);if(i.length>0){t.setStart(i[0],0);var n=i.pop();t.setEnd(n,n.length);var s=this.containsRange(t);t.detach();return s}else{return this.containsNodeContents(e)}},createNodeIterator:function(e,t){U(this);return new w(this,e,t)},getNodes:function(e,t){U(this);return g(this,e,t)},getDocument:function(){return r(this)},collapseBefore:function(e){A(this);this.setEndBefore(e);this.collapse(false)},collapseAfter:function(e){A(this);this.setStartAfter(e);this.collapse(true)},getName:function(){return"DomRange"},equals:function(e){return le.rangesEqual(this,e)},isValid:function(){return F(this)},inspect:function(){return m(this)}};function ie(e){e.START_TO_START=z;e.START_TO_END=G;e.END_TO_END=K;e.END_TO_START=J;e.NODE_BEFORE=X;e.NODE_AFTER=Y;e.NODE_BEFORE_AND_AFTER=Z;e.NODE_INSIDE=ee}function ne(e){ie(e);ie(e.prototype)}function se(e,t){return function(){
U(this);var n=this.startContainer,s=this.startOffset,o=this.commonAncestorContainer;var r=new v(this,true);var a,d;if(n!==o){a=i.getClosestAncestorIn(n,o,true);d=l(a);n=d.node;s=d.offset}h(r,O);r.reset();var c=e(r);r.detach();t(this,n,s,n,s);return c}}function oe(t,n,s){function r(e,t){return function(i){A(this);I(i,b);I(E(i),y);var n=(e?d:l)(i);(t?a:c)(this,n.node,n.offset)}}function a(e,t,s){var o=e.endContainer,r=e.endOffset;if(t!==e.startContainer||s!==e.startOffset){if(E(t)!=E(o)||i.comparePoints(t,s,o,r)==1){o=t;r=s}n(e,t,s,o,r)}}function c(e,t,s){var o=e.startContainer,r=e.startOffset;if(t!==e.endContainer||s!==e.endOffset){if(E(t)!=E(o)||i.comparePoints(t,s,o,r)==-1){o=t;r=s}n(e,o,r,t,s)}}function u(e,t,i){if(t!==e.startContainer||i!==e.startOffset||t!==e.endContainer||i!==e.endOffset){n(e,t,i,t,i)}}t.prototype=new te;e.util.extend(t.prototype,{setStart:function(e,t){A(this);D(e,true);q(e,t);a(this,e,t)},setEnd:function(e,t){A(this);D(e,true);q(e,t);c(this,e,t)},setStartBefore:r(true,true),
setStartAfter:r(false,true),setEndBefore:r(true,false),setEndAfter:r(false,false),collapse:function(e){U(this);if(e){n(this,this.startContainer,this.startOffset,this.startContainer,this.startOffset)}else{n(this,this.endContainer,this.endOffset,this.endContainer,this.endOffset)}},selectNodeContents:function(e){A(this);D(e,true);n(this,e,0,e,i.getNodeLength(e))},selectNode:function(e){A(this);D(e,false);I(e,b);var t=d(e),i=l(e);n(this,t.node,t.offset,i.node,i.offset)},extractContents:se(p,n),deleteContents:se(f,n),canSurroundContents:function(){U(this);O(this.startContainer);O(this.endContainer);var e=new v(this,true);var t=e._first&&o(e._first,this)||e._last&&o(e._last,this);e.detach();return!t},detach:function(){s(this)},splitBoundaries:function(){U(this);var e=this.startContainer,t=this.startOffset,s=this.endContainer,o=this.endOffset;var r=e===s;if(i.isCharacterDataNode(s)&&o>0&&o<s.length){i.splitDataNode(s,o)}if(i.isCharacterDataNode(e)&&t>0&&t<e.length){e=i.splitDataNode(e,t);if(r){
o-=t;s=e}else if(s==e.parentNode&&o>=i.getNodeIndex(e)){o++}t=0}n(this,e,t,s,o)},normalizeBoundaries:function(){U(this);var e=this.startContainer,t=this.startOffset,s=this.endContainer,o=this.endOffset;var r=function(e){var t=e.nextSibling;if(t&&t.nodeType==e.nodeType){s=e;o=e.length;e.appendData(t.data);t.parentNode.removeChild(t)}};var a=function(n){var r=n.previousSibling;if(r&&r.nodeType==n.nodeType){e=n;var a=n.length;t=r.length;n.insertData(0,r.data);r.parentNode.removeChild(r);if(e==s){o+=t;s=e}else if(s==n.parentNode){var d=i.getNodeIndex(n);if(o==d){s=n;o=a}else if(o>d){o--}}}};var d=true;if(i.isCharacterDataNode(s)){if(s.length==o){r(s)}}else{if(o>0){var l=s.childNodes[o-1];if(l&&i.isCharacterDataNode(l)){r(l)}}d=!this.collapsed}if(d){if(i.isCharacterDataNode(e)){if(t==0){a(e)}}else{if(t<e.childNodes.length){var c=e.childNodes[t];if(c&&i.isCharacterDataNode(c)){a(c)}}}}else{e=s;t=o}n(this,e,t,s,o)},collapseToPoint:function(e,t){A(this);D(e,true);q(e,t);u(this,e,t)}});ne(t)}function re(e){
e.collapsed=e.startContainer===e.endContainer&&e.startOffset===e.endOffset;e.commonAncestorContainer=e.collapsed?e.startContainer:i.getCommonAncestor(e.startContainer,e.endContainer)}function ae(e,t,i,n,s){var o=e.startContainer!==t||e.startOffset!==i;var r=e.endContainer!==n||e.endOffset!==s;e.startContainer=t;e.startOffset=i;e.endContainer=n;e.endOffset=s;re(e);a(e,"boundarychange",{startMoved:o,endMoved:r})}function de(e){A(e);e.startContainer=e.startOffset=e.endContainer=e.endOffset=null;e.collapsed=e.commonAncestorContainer=null;a(e,"detach",null);e._listeners=null}function le(e){this.startContainer=e;this.startOffset=0;this.endContainer=e;this.endOffset=0;this._listeners={boundarychange:[],detach:[]};re(this)}oe(le,ae,de);e.rangePrototype=te.prototype;le.rangeProperties=V;le.RangeIterator=v;le.copyComparisonConstants=ne;le.createPrototypeRange=oe;le.inspect=m;le.getRangeDocument=r;le.rangesEqual=function(e,t){return e.startContainer===t.startContainer&&e.startOffset===t.startOffset&&e.endContainer===t.endContainer&&e.endOffset===t.endOffset;
};e.DomRange=le;e.RangeException=_});rangy.createModule("WrappedRange",function(e,t){e.requireModules(["DomUtil","DomRange"]);var i;var n=e.dom;var s=n.DomPosition;var o=e.DomRange;function r(e){var t=e.parentElement();var i=e.duplicate();i.collapse(true);var s=i.parentElement();i=e.duplicate();i.collapse(false);var o=i.parentElement();var r=s==o?s:n.getCommonAncestor(s,o);return r==t?r:n.getCommonAncestor(t,r)}function a(e){return e.compareEndPoints("StartToEnd",e)==0}function d(e,t,i,o){var r=e.duplicate();r.collapse(i);var a=r.parentElement();if(!n.isAncestorOf(t,a,true)){a=t}if(!a.canHaveHTML){return new s(a.parentNode,n.getNodeIndex(a))}var d=n.getDocument(a).createElement("span");var l,c=i?"StartToStart":"StartToEnd";var u,h,f,p;do{a.insertBefore(d,d.previousSibling);r.moveToElementText(d)}while((l=r.compareEndPoints(c,e))>0&&d.previousSibling);p=d.nextSibling;if(l==-1&&p&&n.isCharacterDataNode(p)){r.setEndPoint(i?"EndToStart":"EndToEnd",e);var g;if(/[\r\n]/.test(p.data)){var m=r.duplicate();
var v=m.text.replace(/\r\n/g,"\r").length;g=m.moveStart("character",v);while((l=m.compareEndPoints("StartToEnd",m))==-1){g++;m.moveStart("character",1)}}else{g=r.text.length}f=new s(p,g)}else{u=(o||!i)&&d.previousSibling;h=(o||i)&&d.nextSibling;if(h&&n.isCharacterDataNode(h)){f=new s(h,0)}else if(u&&n.isCharacterDataNode(u)){f=new s(u,u.length)}else{f=new s(a,n.getNodeIndex(d))}}d.parentNode.removeChild(d);return f}function l(e,t){var i,s,o=e.offset;var r=n.getDocument(e.node);var a,d,l=r.body.createTextRange();var c=n.isCharacterDataNode(e.node);if(c){i=e.node;s=i.parentNode}else{d=e.node.childNodes;i=o<d.length?d[o]:null;s=e.node}a=r.createElement("span");a.innerHTML="&#feff;";if(i){s.insertBefore(a,i)}else{s.appendChild(a)}l.moveToElementText(a);l.collapse(!t);s.removeChild(a);if(c){l[t?"moveStart":"moveEnd"]("character",o)}return l}if(e.features.implementsDomRange&&(!e.features.implementsTextRange||!e.config.preferTextRange)){(function(){var t;var s=o.rangeProperties;var r;function a(e){
var t=s.length,i;while(t--){i=s[t];e[i]=e.nativeRange[i]}}function d(e,t,i,n,s){var o=e.startContainer!==t||e.startOffset!=i;var r=e.endContainer!==n||e.endOffset!=s;if(o||r){e.setEnd(n,s);e.setStart(t,i)}}function l(e){e.nativeRange.detach();e.detached=true;var t=s.length,i;while(t--){i=s[t];e[i]=null}}var c;i=function(e){if(!e){throw new Error("Range must be specified")}this.nativeRange=e;a(this)};o.createPrototypeRange(i,d,l);t=i.prototype;t.selectNode=function(e){this.nativeRange.selectNode(e);a(this)};t.deleteContents=function(){this.nativeRange.deleteContents();a(this)};t.extractContents=function(){var e=this.nativeRange.extractContents();a(this);return e};t.cloneContents=function(){return this.nativeRange.cloneContents()};t.surroundContents=function(e){this.nativeRange.surroundContents(e);a(this)};t.collapse=function(e){this.nativeRange.collapse(e);a(this)};t.cloneRange=function(){return new i(this.nativeRange.cloneRange())};t.refresh=function(){a(this)};t.toString=function(){return this.nativeRange.toString();
};var u=document.createTextNode("test");n.getBody(document).appendChild(u);var h=document.createRange();h.setStart(u,0);h.setEnd(u,0);try{h.setStart(u,1);r=true;t.setStart=function(e,t){this.nativeRange.setStart(e,t);a(this)};t.setEnd=function(e,t){this.nativeRange.setEnd(e,t);a(this)};c=function(e){return function(t){this.nativeRange[e](t);a(this)}}}catch(f){r=false;t.setStart=function(e,t){try{this.nativeRange.setStart(e,t)}catch(i){this.nativeRange.setEnd(e,t);this.nativeRange.setStart(e,t)}a(this)};t.setEnd=function(e,t){try{this.nativeRange.setEnd(e,t)}catch(i){this.nativeRange.setStart(e,t);this.nativeRange.setEnd(e,t)}a(this)};c=function(e,t){return function(i){try{this.nativeRange[e](i)}catch(n){this.nativeRange[t](i);this.nativeRange[e](i)}a(this)}}}t.setStartBefore=c("setStartBefore","setEndBefore");t.setStartAfter=c("setStartAfter","setEndAfter");t.setEndBefore=c("setEndBefore","setStartBefore");t.setEndAfter=c("setEndAfter","setStartAfter");h.selectNodeContents(u);if(h.startContainer==u&&h.endContainer==u&&h.startOffset==0&&h.endOffset==u.length){
t.selectNodeContents=function(e){this.nativeRange.selectNodeContents(e);a(this)}}else{t.selectNodeContents=function(e){this.setStart(e,0);this.setEnd(e,o.getEndOffset(e))}}h.selectNodeContents(u);h.setEnd(u,3);var p=document.createRange();p.selectNodeContents(u);p.setEnd(u,4);p.setStart(u,2);if(h.compareBoundaryPoints(h.START_TO_END,p)==-1&h.compareBoundaryPoints(h.END_TO_START,p)==1){t.compareBoundaryPoints=function(e,t){t=t.nativeRange||t;if(e==t.START_TO_END){e=t.END_TO_START}else if(e==t.END_TO_START){e=t.START_TO_END}return this.nativeRange.compareBoundaryPoints(e,t)}}else{t.compareBoundaryPoints=function(e,t){return this.nativeRange.compareBoundaryPoints(e,t.nativeRange||t)}}if(e.util.isHostMethod(h,"createContextualFragment")){t.createContextualFragment=function(e){return this.nativeRange.createContextualFragment(e)}}n.getBody(document).removeChild(u);h.detach();p.detach()})();e.createNativeRange=function(e){e=e||document;return e.createRange()}}else if(e.features.implementsTextRange){
i=function(e){this.textRange=e;this.refresh()};i.prototype=new o(document);i.prototype.refresh=function(){var e,t;var i=r(this.textRange);if(a(this.textRange)){t=e=d(this.textRange,i,true,true)}else{e=d(this.textRange,i,true,false);t=d(this.textRange,i,false,false)}this.setStart(e.node,e.offset);this.setEnd(t.node,t.offset)};o.copyComparisonConstants(i);var c=function(){return this}();if(typeof c.Range=="undefined"){c.Range=i}e.createNativeRange=function(e){e=e||document;return e.body.createTextRange()}}if(e.features.implementsTextRange){i.rangeToTextRange=function(e){if(e.collapsed){var t=l(new s(e.startContainer,e.startOffset),true);return t}else{var i=l(new s(e.startContainer,e.startOffset),true);var o=l(new s(e.endContainer,e.endOffset),false);var r=n.getDocument(e.startContainer).body.createTextRange();r.setEndPoint("StartToStart",i);r.setEndPoint("EndToEnd",o);return r}}}i.prototype.getName=function(){return"WrappedRange"};e.WrappedRange=i;e.createRange=function(t){t=t||document;return new i(e.createNativeRange(t));
};e.createRangyRange=function(e){e=e||document;return new o(e)};e.createIframeRange=function(t){return e.createRange(n.getIframeDocument(t))};e.createIframeRangyRange=function(t){return e.createRangyRange(n.getIframeDocument(t))};e.addCreateMissingNativeApiListener(function(t){var i=t.document;if(typeof i.createRange=="undefined"){i.createRange=function(){return e.createRange(this)}}i=t=null})});rangy.createModule("WrappedSelection",function(e,t){e.requireModules(["DomUtil","DomRange","WrappedRange"]);e.config.checkSelectionRanges=true;var i="boolean",n="_rangySelection",s=e.dom,o=e.util,r=e.DomRange,a=e.WrappedRange,d=e.DOMException,l=s.DomPosition,c,u,h="Control";function f(e){return(e||window).getSelection()}function p(e){return(e||window).document.selection}var g=e.util.isHostMethod(window,"getSelection"),m=e.util.isHostObject(document,"selection");var v=m&&(!g||e.config.preferTextRange);if(v){c=p;e.isSelectionValid=function(e){var t=(e||window).document,i=t.selection;return i.type!="None"||s.getDocument(i.createRange().parentElement())==t;
}}else if(g){c=f;e.isSelectionValid=function(){return true}}else{t.fail("Neither document.selection or window.getSelection() detected.")}e.getNativeSelection=c;var _=c();var w=e.createNativeRange(document);var b=s.getBody(document);var y=o.areHostObjects(_,["anchorNode","focusNode"]&&o.areHostProperties(_,["anchorOffset","focusOffset"]));e.features.selectionHasAnchorAndFocus=y;var C=o.isHostMethod(_,"extend");e.features.selectionHasExtend=C;var x=typeof _.rangeCount=="number";e.features.selectionHasRangeCount=x;var k=false;var S=true;if(o.areHostMethods(_,["addRange","getRangeAt","removeAllRanges"])&&typeof _.rangeCount=="number"&&e.features.implementsDomRange){(function(){var e=document.createElement("iframe");e.frameBorder=0;e.style.position="absolute";e.style.left="-10000px";b.appendChild(e);var t=s.getIframeDocument(e);t.open();t.write("<html><head></head><body>12</body></html>");t.close();var i=s.getIframeWindow(e).getSelection();var n=t.documentElement;var o=n.lastChild,r=o.firstChild;
var a=t.createRange();a.setStart(r,1);a.collapse(true);i.addRange(a);S=i.rangeCount==1;i.removeAllRanges();var d=a.cloneRange();a.setStart(r,0);d.setEnd(r,2);i.addRange(a);i.addRange(d);k=i.rangeCount==2;a.detach();d.detach();b.removeChild(e)})()}e.features.selectionSupportsMultipleRanges=k;e.features.collapsedNonEditableSelectionsSupported=S;var E=false,T;if(b&&o.isHostMethod(b,"createControlRange")){T=b.createControlRange();if(o.areHostProperties(T,["item","add"])){E=true}}e.features.implementsControlRange=E;if(y){u=function(e){return e.anchorNode===e.focusNode&&e.anchorOffset===e.focusOffset}}else{u=function(e){return e.rangeCount?e.getRangeAt(e.rangeCount-1).collapsed:false}}function L(e,t,i){var n=i?"end":"start",s=i?"start":"end";e.anchorNode=t[n+"Container"];e.anchorOffset=t[n+"Offset"];e.focusNode=t[s+"Container"];e.focusOffset=t[s+"Offset"]}function M(e){var t=e.nativeSelection;e.anchorNode=t.anchorNode;e.anchorOffset=t.anchorOffset;e.focusNode=t.focusNode;e.focusOffset=t.focusOffset;
}function D(e){e.anchorNode=e.focusNode=null;e.anchorOffset=e.focusOffset=0;e.rangeCount=0;e.isCollapsed=true;e._ranges.length=0}function A(t){var i;if(t instanceof r){i=t._selectionNativeRange;if(!i){i=e.createNativeRange(s.getDocument(t.startContainer));i.setEnd(t.endContainer,t.endOffset);i.setStart(t.startContainer,t.startOffset);t._selectionNativeRange=i;t.attachListener("detach",function(){this._selectionNativeRange=null})}}else if(t instanceof a){i=t.nativeRange}else if(e.features.implementsDomRange&&t instanceof s.getWindow(t.startContainer).Range){i=t}return i}function I(e){if(!e.length||e[0].nodeType!=1){return false}for(var t=1,i=e.length;t<i;++t){if(!s.isAncestorOf(e[0],e[t])){return false}}return true}function q(e){var t=e.getNodes();if(!I(t)){throw new Error("getSingleElementFromRange: range "+e.inspect()+" did not consist of a single element")}return t[0]}function N(e){return!!e&&typeof e.text!="undefined"}function O(e,t){var i=new a(t);e._ranges=[i];L(e,i,false);e.rangeCount=1;
e.isCollapsed=i.collapsed}function R(t){t._ranges.length=0;if(t.docSelection.type=="None"){D(t)}else{var i=t.docSelection.createRange();if(N(i)){O(t,i)}else{t.rangeCount=i.length;var n,o=s.getDocument(i.item(0));for(var r=0;r<t.rangeCount;++r){n=e.createRange(o);n.selectNode(i.item(r));t._ranges.push(n)}t.isCollapsed=t.rangeCount==1&&t._ranges[0].collapsed;L(t,t._ranges[t.rangeCount-1],false)}}}function P(e,t){var i=e.docSelection.createRange();var n=q(t);var o=s.getDocument(i.item(0));var r=s.getBody(o).createControlRange();for(var a=0,d=i.length;a<d;++a){r.add(i.item(a))}try{r.add(n)}catch(l){throw new Error("addRange(): Element within the specified Range could not be added to control selection (does it have layout?)")}r.select();R(e)}var B;if(o.isHostMethod(_,"getRangeAt")){B=function(e,t){try{return e.getRangeAt(t)}catch(i){return null}}}else if(y){B=function(t){var i=s.getDocument(t.anchorNode);var n=e.createRange(i);n.setStart(t.anchorNode,t.anchorOffset);n.setEnd(t.focusNode,t.focusOffset);
if(n.collapsed!==this.isCollapsed){n.setStart(t.focusNode,t.focusOffset);n.setEnd(t.anchorNode,t.anchorOffset)}return n}}function F(e,t,i){this.nativeSelection=e;this.docSelection=t;this._ranges=[];this.win=i;this.refresh()}e.getSelection=function(e){e=e||window;var t=e[n];var i=c(e),s=m?p(e):null;if(t){t.nativeSelection=i;t.docSelection=s;t.refresh(e)}else{t=new F(i,s,e);e[n]=t}return t};e.getIframeSelection=function(t){return e.getSelection(s.getIframeWindow(t))};var U=F.prototype;function j(e,t){var i=s.getDocument(t[0].startContainer);var n=s.getBody(i).createControlRange();for(var o=0,r;o<rangeCount;++o){r=q(t[o]);try{n.add(r)}catch(a){throw new Error("setRanges(): Element within the one of the specified Ranges could not be added to control selection (does it have layout?)")}}n.select();R(e)}if(!v&&y&&o.areHostMethods(_,["removeAllRanges","addRange"])){U.removeAllRanges=function(){this.nativeSelection.removeAllRanges();D(this)};var H=function(t,i){var n=r.getRangeDocument(i);var s=e.createRange(n);
s.collapseToPoint(i.endContainer,i.endOffset);t.nativeSelection.addRange(A(s));t.nativeSelection.extend(i.startContainer,i.startOffset);t.refresh()};if(x){U.addRange=function(t,i){if(E&&m&&this.docSelection.type==h){P(this,t)}else{if(i&&C){H(this,t)}else{var n;if(k){n=this.rangeCount}else{this.removeAllRanges();n=0}this.nativeSelection.addRange(A(t));this.rangeCount=this.nativeSelection.rangeCount;if(this.rangeCount==n+1){if(e.config.checkSelectionRanges){var s=B(this.nativeSelection,this.rangeCount-1);if(s&&!r.rangesEqual(s,t)){t=new a(s)}}this._ranges[this.rangeCount-1]=t;L(this,t,V(this.nativeSelection));this.isCollapsed=u(this)}else{this.refresh()}}}}}else{U.addRange=function(e,t){if(t&&C){H(this,e)}else{this.nativeSelection.addRange(A(e));this.refresh()}}}U.setRanges=function(e){if(E&&e.length>1){j(this,e)}else{this.removeAllRanges();for(var t=0,i=e.length;t<i;++t){this.addRange(e[t])}}}}else if(o.isHostMethod(_,"empty")&&o.isHostMethod(w,"select")&&E&&v){U.removeAllRanges=function(){
try{this.docSelection.empty();if(this.docSelection.type!="None"){var e;if(this.anchorNode){e=s.getDocument(this.anchorNode)}else if(this.docSelection.type==h){var t=this.docSelection.createRange();if(t.length){e=s.getDocument(t.item(0)).body.createTextRange()}}if(e){var i=e.body.createTextRange();i.select();this.docSelection.empty()}}}catch(n){}D(this)};U.addRange=function(e){if(this.docSelection.type==h){P(this,e)}else{a.rangeToTextRange(e).select();this._ranges[0]=e;this.rangeCount=1;this.isCollapsed=this._ranges[0].collapsed;L(this,e,false)}};U.setRanges=function(e){this.removeAllRanges();var t=e.length;if(t>1){j(this,e)}else if(t){this.addRange(e[0])}}}else{t.fail("No means of selecting a Range or TextRange was found");return false}U.getRangeAt=function(e){if(e<0||e>=this.rangeCount){throw new d("INDEX_SIZE_ERR")}else{return this._ranges[e]}};var Q;if(v){Q=function(t){var i;if(e.isSelectionValid(t.win)){i=t.docSelection.createRange()}else{i=s.getBody(t.win.document).createTextRange();
i.collapse(true)}if(t.docSelection.type==h){R(t)}else if(N(i)){O(t,i)}else{D(t)}}}else if(o.isHostMethod(_,"getRangeAt")&&typeof _.rangeCount=="number"){Q=function(t){if(E&&m&&t.docSelection.type==h){R(t)}else{t._ranges.length=t.rangeCount=t.nativeSelection.rangeCount;if(t.rangeCount){for(var i=0,n=t.rangeCount;i<n;++i){t._ranges[i]=new e.WrappedRange(t.nativeSelection.getRangeAt(i))}L(t,t._ranges[t.rangeCount-1],V(t.nativeSelection));t.isCollapsed=u(t)}else{D(t)}}}}else if(y&&typeof _.isCollapsed==i&&typeof w.collapsed==i&&e.features.implementsDomRange){Q=function(e){var t,i=e.nativeSelection;if(i.anchorNode){t=B(i,0);e._ranges=[t];e.rangeCount=1;M(e);e.isCollapsed=u(e)}else{D(e)}}}else{t.fail("No means of obtaining a Range or TextRange from the user's selection was found");return false}U.refresh=function(e){var t=e?this._ranges.slice(0):null;Q(this);if(e){var i=t.length;if(i!=this._ranges.length){return false}while(i--){if(!r.rangesEqual(t[i],this._ranges[i])){return false}}return true;
}};var W=function(e,t){var i=e.getAllRanges(),n=false;e.removeAllRanges();for(var s=0,o=i.length;s<o;++s){if(n||t!==i[s]){e.addRange(i[s])}else{n=true}}if(!e.rangeCount){D(e)}};if(E){U.removeRange=function(e){if(this.docSelection.type==h){var t=this.docSelection.createRange();var i=q(e);var n=s.getDocument(t.item(0));var o=s.getBody(n).createControlRange();var r,a=false;for(var d=0,l=t.length;d<l;++d){r=t.item(d);if(r!==i||a){o.add(t.item(d))}else{a=true}}o.select();R(this)}else{W(this,e)}}}else{U.removeRange=function(e){W(this,e)}}var V;if(!v&&y&&e.features.implementsDomRange){V=function(e){var t=false;if(e.anchorNode){t=s.comparePoints(e.anchorNode,e.anchorOffset,e.focusNode,e.focusOffset)==1}return t};U.isBackwards=function(){return V(this)}}else{V=U.isBackwards=function(){return false}}U.toString=function(){var e=[];for(var t=0,i=this.rangeCount;t<i;++t){e[t]=""+this._ranges[t]}return e.join("")};function z(e,t){if(e.anchorNode&&s.getDocument(e.anchorNode)!==s.getDocument(t)){throw new d("WRONG_DOCUMENT_ERR");
}}U.collapse=function(t,i){z(this,t);var n=e.createRange(s.getDocument(t));n.collapseToPoint(t,i);this.removeAllRanges();this.addRange(n);this.isCollapsed=true};U.collapseToStart=function(){if(this.rangeCount){var e=this._ranges[0];this.collapse(e.startContainer,e.startOffset)}else{throw new d("INVALID_STATE_ERR")}};U.collapseToEnd=function(){if(this.rangeCount){var e=this._ranges[this.rangeCount-1];this.collapse(e.endContainer,e.endOffset)}else{throw new d("INVALID_STATE_ERR")}};U.selectAllChildren=function(t){z(this,t);var i=e.createRange(s.getDocument(t));i.selectNodeContents(t);this.removeAllRanges();this.addRange(i)};U.deleteFromDocument=function(){if(E&&m&&this.docSelection.type==h){var e=this.docSelection.createRange();var t;while(e.length){t=e.item(0);e.remove(t);t.parentNode.removeChild(t)}this.refresh()}else if(this.rangeCount){var i=this.getAllRanges();this.removeAllRanges();for(var n=0,s=i.length;n<s;++n){i[n].deleteContents()}this.addRange(i[s-1])}};U.getAllRanges=function(){
return this._ranges.slice(0)};U.setSingleRange=function(e){this.setRanges([e])};U.containsNode=function(e,t){for(var i=0,n=this._ranges.length;i<n;++i){if(this._ranges[i].containsNode(e,t)){return true}}return false};U.toHtml=function(){var e="";if(this.rangeCount){var t=r.getRangeDocument(this._ranges[0]).createElement("div");for(var i=0,n=this._ranges.length;i<n;++i){t.appendChild(this._ranges[i].cloneContents())}e=t.innerHTML}return e};function G(e){var t=[];var i=new l(e.anchorNode,e.anchorOffset);var n=new l(e.focusNode,e.focusOffset);var s=typeof e.getName=="function"?e.getName():"Selection";if(typeof e.rangeCount!="undefined"){for(var o=0,a=e.rangeCount;o<a;++o){t[o]=r.inspect(e.getRangeAt(o))}}return"["+s+"(Ranges: "+t.join(", ")+")(anchor: "+i.inspect()+", focus: "+n.inspect()+"]"}U.getName=function(){return"WrappedSelection"};U.inspect=function(){return G(this)};U.detach=function(){this.win[n]=null;this.win=this.anchorNode=this.focusNode=null};F.inspect=G;e.Selection=F;e.selectionPrototype=U;
e.addCreateMissingNativeApiListener(function(t){if(typeof t.getSelection=="undefined"){t.getSelection=function(){return e.getSelection(this)}}t=null})})});define("shared/rangy",["shared/polyfills","gating","third_party/rangy-core"],function Ho(require,exports,e){var t=require("gating"),i;if(t.use_native_selection){i={getSelection:function(){return window.getSelection()},createRange:function(){return document.createRange()},init:function(){}}}else{require("third_party/rangy-core");i=window.rangy}exports.rangy=i;exports.rangeFromPoint=function(e,t){var n,s,o,r,a;if(document.caretPositionFromPoint){n=document.caretPositionFromPoint(e,t);o=n.offsetNode;r=n.offset}else if(document.caretRangeFromPoint){s=document.caretRangeFromPoint(e,t);o=s.startContainer;r=s.startOffset}else if(document.elementFromPoint){o=document.elementFromPoint(e,t);r=0}if(o&&r!==undefined){a=i.createRange();a.setStart(o,r);a.setEnd(o,r);a.collapse(true);return a}return null}});define("qtext2/constants",["shared/polyfills"],function Qo(require,exports,e){
exports.CONTENT_TYPES={TEXT:"text/plain",HTML:"text/html",PUBLIC_HTML:"public.html"};exports.FRACTIONS={"â":[1,7],"â":[1,9],"â":[1,10],"â":[1,3],"â":[2,3],"â":[1,5],"â":[2,5],"â":[3,5],"â":[4,5],"â":[1,6],"â":[5,6],"â":[1,8],"â":[3,8],"â":[5,8],"â":[7,8]};exports.ELLIPSIS="â¦";exports.OPEN_SINGLE_QUOTE="â";exports.CLOSE_SINGLE_QUOTE="â";exports.OPEN_DOUBLE_QUOTE="â";exports.CLOSE_DOUBLE_QUOTE="â";exports.SINGLE_PRIME="â²";exports.DOUBLE_PRIME="â³";exports.EN_DASH="â";exports.EM_DASH="â";exports.LEFT_ARROW="â";exports.RIGHT_ARROW="â";exports.WORD_START_REGEX=/\s|[({[]/});define("qtext2/container",["shared/polyfills","shared/Class","qtext2/util"],function Wo(require,exports,e){var t=require("shared/Class").Class,i=require("qtext2/util").Util;var n=t.extend({__init__:function(e){this.kind=e;this.node=i.create("DIV");this.node.className=this.kind;this.children=[]},init:function(){},insertAfter:function(e,t){if(e.parent){e.parent.removeChild(e)}if(t){var i=t.node.nextSibling;this.node.insertBefore(e.node,i);
this.children.splice(this.children.indexOf(t)+1,0,e)}else{this.node.appendChild(e.node);this.children.push(e)}e.parent=this},insertBefore:function(e,t){if(e.parent){e.parent.removeChild(e)}if(t){this.node.insertBefore(e.node,t.node);this.children.splice(this.children.indexOf(t),0,e)}else{this.node.appendChild(e.node);this.children.push(e)}e.parent=this},appendChild:function(e){this.insertBefore(e)},appendChildren:function(e){e.forEach(this.appendChild.bind(this))},hasChild:function(e){return this.children.indexOf(e)!==-1},removeChild:function(e){if(!this.hasChild(e)){return}var t=this.children.indexOf(e);this.children.splice(t,1);i.safeRemoveChild(e.node,this.node)},removeChildren:function(){var e=this.firstChild(),t;while(e){t=e.nextSibling();this.removeChild(e);e=t}},previousSibling:function(){return this.node.previousSibling&&this.Class.get(this.node.previousSibling)},nextSibling:function(){return this.node.nextSibling&&this.Class.get(this.node.nextSibling)},firstChild:function(){if(this.children.length===0){
return null}return this.children[0]},lastChild:function(){if(this.children.length===0){return null}return this.children[this.children.length-1]}});n.create=function(e,t){var s;i.assert(!t.__init__,"Do not override __init__");t.__init__=function(){this._super(e);this.init.apply(this,arguments);this.Class=s;s.add(this,this.node)};s=n.extend(t);s.add=function(e,t){i.setData(t,"kind",e.kind);t.qtextContainer=e};s.get=function(e){i.assert(s.is(e));return e.qtextContainer};s.is=function(t){if(!t){return false}return t.nodeType==1&&i.getData(t,"kind")==e};return s};exports.Container=n});define("qtext2/position",["shared/polyfills","shared/Class"],function Vo(require,exports,e){var t=require("shared/Class").Class;var i=t.extend({__init__:function(e,t){this.span=e;this.offset=t},toJSON:function(){var e=this.span.parent;return{spanIdx:e.children.indexOf(this.span),sectionIdx:e.parent.children.indexOf(e),offset:this.offset}},clone:function(){return new i(this.span,this.offset)},atSpanStart:function(){
return this.offset===0},atSpanEnd:function(){return this.offset==this.span.getLength()},atSectionStart:function(){var e=this.span.parent;return this.atSpanStart()&&this.span==e.firstChild()},atSectionEnd:function(){var e=this.span.parent;return this.atSpanEnd()&&this.span==e.lastChild()},atDocStart:function(){var e=this.span.parent,t=e.parent;return this.atSectionStart()&&e==t.firstChild()},atDocEnd:function(){var e=this.span.parent,t=e.parent;return this.atSectionEnd()&&e==t.lastChild()},equals:function(e){return e.span===this.span&&e.offset===this.offset},charBefore:function(){if(this.atSectionStart()){return null}return this.prevPositionInSection().charAfter()},hasCharBefore:function(){var e=this.charBefore();return!!e&&e.trim().length!==0},charAfter:function(){if(this.atSectionEnd()){return null}var e=this.span,t=this.offset;if(this.atSpanEnd()){e=e.nextSibling();t=0}return e.getText()[t]},hasCharAfter:function(){var e=this.charAfter();return!!e&&e.trim().length!==0},previousWordBoundary:function(e){
e=e||/\W/;var t=this.span,n=this.offset-1,s=t.getText();if(this.atDocStart()){return this}if(this.atSectionStart()){return t.previous().last()}while(t){while(n>0){if(s[n-1].match(e)){return new i(t,n)}n--}t=t.previousSibling();if(t){s=t.getText();n=s.length}}return this.span.parent.first()},nextWordBoundary:function(e){e=e||/\W/;var t=this.span,n=this.offset+1,s=t.getText();if(this.atDocEnd()){return this}if(this.atSectionEnd()){return t.next().first()}while(t){while(n<s.length){if(s[n].match(e)){return new i(t,n)}n++}t=t.nextSibling();if(t){s=t.getText();n=0}}return this.span.parent.last()},relativePositionInSection:function(e){if(e===0){return this}var t=this.span,n=this.offset,s=t.getLength(),o=t.previousSibling(),r=t.nextSibling(),a=e+n;if(0<=a&&a<=s){return new i(t,a)}else if(a<0&&o){return o.last().relativePositionInSection(e+n)}else if(a>s&&r){return r.first().relativePositionInSection(e-(s-n))}else{return null}},prevPositionInSection:function(e){e=e||1;return this.relativePositionInSection(e*-1);
},nextPositionInSection:function(e){return this.relativePositionInSection(e||1)}});exports.Position=i});define("qtext2/modifiers",["shared/polyfills"],function zo(require,exports,e){exports.allModifiers=function(){return["bold","italic","underline","link","citation","math","code","image","embed","tweet"]};var t=exports.mutuallyExclusiveSet=function(){return["link","citation"]};exports.nonEditableSet=function(){return["image","embed","tweet"]};exports.editableSet=function(){return["bold","italic","underline","link","citation","math","code"]};var i=exports.restrictedSets=function(){return[["image","embed","tweet"],["math"],["code"]]};var n=exports.canSetModifier=function(e,n){var s=e.parent;if(s&&s.allowedModifiers().indexOf(n)==-1){return false}if(t().indexOf(n)!=-1&&t().some(function(t){return t!=n&&e.hasModifier(t)})){return false}var o=i().some(function(t){if(t.indexOf(n)!=-1&&e.hasDifferentModifier(t)){return true}if(t.indexOf(n)==-1&&e.hasAnyModifier(t)){return true}return false});if(o){
return false}return true};exports.canForceModifier=function(e,s){if(n(e,s)){return true}var o=e.parent;if(o&&o.allowedModifiers().indexOf(s)==-1){return false}if(t().indexOf(s)!=-1){return true}return i().some(function(e){return e.indexOf(s)!=-1})}});define("qtext2/span",["shared/polyfills","qtext2/container","qtext2/position","qtext2/constants","qtext2/modifiers","shared/util","qtext2/util","shared/twitter_oembed"],function Go(require,exports,e){var t=require("qtext2/container").Container,i=require("qtext2/position").Position,n=require("qtext2/constants").CONTENT_TYPES,s=require("qtext2/modifiers"),o=require("shared/util").extend,r=require("qtext2/util").Util,a=require("shared/twitter_oembed").loadEmbeds;var d=t.create("span",{init:function(e,t){t=t||{};this.modifiers={};this._content=this.createContentNode();this.node.appendChild(this._content);this._image=null;if(e){this.setText(e)}else{this.setPlaceholder()}for(var i in t){this.setModifier(i,t[i],true)}},createContentNode:function(){
var e=r.create("div");e.className="content";e.qtextSpanContent=true;return e},merge:function(e){if(!this.isEditable()||!e.isEditable()){return}if(!this.hasSameModifiers(e)){return}this.setText(this.getText()+e.getText());e.parent.removeChild(e);return this},hasSameModifiers:function(e){var t=this.modifiers,i=e.modifiers,n=Object.getOwnPropertyNames(t),s=Object.getOwnPropertyNames(i);if(n.length!=s.length){return false}return n.every(function(e){if(e=="link"&&i.link){var n=t.link.url;if(n&&n.substr(-1)!="/"){n+="/"}var s=i.link.url;if(s&&s.substr(-1)!="/"){s+="/"}return n==s}return t[e]==i[e]})},toJSON:function(e,t){return{modifiers:o({},this.modifiers),text:this.getText().slice(e,t)}},previous:function(){return this.previousSibling()||this.parent.previousSibling()&&this.parent.previousSibling().lastChild()},next:function(){return this.nextSibling()||this.parent.nextSibling()&&this.parent.nextSibling().firstChild()},first:function(){return new i(this,0)},last:function(){return new i(this,this.getLength());
},updateModifiers:function(e,t){var i=Object.keys(e),n,s;for(s=0;s<i.length;s++){n=i[s];this.setModifier(n,e[n],t)}this._updateClass()},setModifier:function(e,t,i){if(s.canSetModifier(this,e)){this._setModifier(e,t);return}if(!i||!s.canForceModifier(this,e)){return}var n=this.modifiers;this.modifiers={};this._setModifier(e,t);var o=this;Object.keys(n).forEach(function(e){o.setModifier(e,n[e])})},_setModifier:function(e,t){this.modifiers[e]=t||true;if(e=="image"){if(this._image===null){this._image=r.create("img")}this.setText("");this._content.appendChild(this._image);this._image.src=t}if(e=="tweet"){var i=t.root,n=t.shouldLoad;this._content.appendChild(i);if(n){a()}}if(e=="underline"){this._content.style.textDecoration="underline"}this._updateClass()},isEditable:function(){var e=this;return!s.nonEditableSet().some(function(t){return e.hasModifier(t)})},hasAnyModifier:function(e){return Object.keys(this.modifiers).some(function(t){return e.indexOf(t)!=-1})},hasDifferentModifier:function(e){
return Object.keys(this.modifiers).some(function(t){return e.indexOf(t)==-1})},removeAllModifiers:function(){this.modifiers={};this._updateClass()},removeModifier:function(e){delete this.modifiers[e];this._updateClass()},getModifier:function(e){return this.modifiers[e]},getModifiers:function(){return o({},this.modifiers)},hasModifier:function(e){return e in this.modifiers},_updateClass:function(){this.node.className="span";for(var e in this.modifiers){if(this.modifiers.hasOwnProperty(e)&&this.modifiers[e]){this.node.className+=" "+e}}},isEmpty:function(){if(!this.isEditable()){return false}return this.node.textContent===""||this.node.innerHTML===""||this.node.innerHTML=="<br>"},getText:function(){return this._content.textContent},setText:function(e){this._content.textContent=e},insertText:function(e,t){var i=this.getText();this.setText(i.slice(0,t)+e+i.slice(t))},deleteText:function(e,t){this.setText(this.getText().slice(0,e)+this.getText().slice(t))},getLength:function(){if(!this.isEditable()){
return 1}return this.getText().length},isOnlyWhiteSpace:function(){if(!this.isEditable()){return false}if(this.hasModifier("citation")){return false}return this.getText().trim().length==0},getFocusNode:function(){if(r.isTextNode(this._content.firstChild)){return this._content.firstChild}return this._content},setPlaceholder:function(){this._content.innerHTML="<br/>";for(var e in this.modifiers){this.removeModifier(e)}},shouldAvoidSplitting:function(){return this.hasModifier("link")||this.hasModifier("code")||this.hasModifier("math")},split:function(e,t){var i;if(!t&&this.shouldAvoidSplitting()){return this}if(this.isEmpty()){i=new d(null,this.modifiers)}else if(e===0){i=new d(this.getText(),this.modifiers);this.setPlaceholder()}else{i=new d(this.getText().slice(e),this.modifiers);this.setText(this.getText().slice(0,e))}this.parent.insertBefore(i,this.nextSibling());return i},_toText:function(){var e,t;e=this.getText();if(this.hasModifier("math")){e="$"+e+"$"}if(this.hasModifier("italic")){
e="*"+e+"*"}if(this.hasModifier("bold")){e="**"+e+"**"}if(this.hasModifier("underline")){e="_"+e+"_"}if(this.hasModifier("link")){t=this.getModifier("link");e+=" ("+t.url+")"}return e},_toHTML:function(){var e,t;if(this.hasModifier("image")){return'<img src="'+this.getModifier("image")+'"/>'}e=this.getText();e=r.escapeHTML(e);e=e.replace(/\n/gi,"<br>");if(this.hasModifier("italic")){e="<i>"+e+"</i>"}if(this.hasModifier("bold")){e="<b>"+e+"</b>"}if(this.hasModifier("underline")){e="<u>"+e+"</u>"}if(this.hasModifier("link")){t=this.getModifier("link");e='<a href="'+t.url+'">'+e+"</a>"}if(this.hasModifier("code")){e="<code>"+e+"</code>"}else if(this.hasModifier("math")){e="<math>"+e+"</math>"}return e},toContent:function(e){if(e==n.TEXT){return this._toText()}else if(e==n.HTML){return this._toHTML()}}});exports.Span=d});define("qtext2/undo",["shared/polyfills","shared/Class"],function Ko(require,exports,e){var t=require("shared/Class").Class;var i=t.extend({__init__:function(e){this.current={
state:e,next:null,prev:null}},state:function(){return this.current.state},add:function(e){if(this.current.next){this.current.next.prev=null}this.current.next={state:e,prev:this.current,next:null};this.current=this.current.next},undo:function(){if(this.current.prev){this.current=this.current.prev}},redo:function(){if(this.current.next){this.current=this.current.next}},canUndo:function(){return!!this.current.prev},canRedo:function(){return!!this.current.next}});exports.UndoManager=i});define("qtext2/sections/plain",["shared/polyfills","qtext2/section"],function Jo(require,exports,e){var t=require("qtext2/section").Section;var i=t.extend({init:function(e,t,i){this._super("plain",e,t,i)},htmlIndentPrefix:"",htmlIndentSuffix:"",htmlPrefix:"<p>",htmlSuffix:"</p>"});exports.PlainSection=i});define("qtext2/sections/code",["shared/polyfills","qtext2/section"],function Xo(require,exports,e){var t=require("qtext2/section"),i=t.Section;var n=i.extend({init:function(e,t,i){this._super("code",e,t,i);this.children.forEach(function(e){
e.removeAllModifiers()})},allowedModifiers:function(){return[]},htmlIndentPrefix:"",htmlIndentSuffix:"",htmlPrefix:"<pre>",htmlSuffix:"</pre>"});exports.CodeSection=n});define("qtext2/sections/image",["shared/polyfills","qtext2/section","qtext2/span","qtext2/util"],function Yo(require,exports,e){var t=require("qtext2/section"),i=t.Section,n=require("qtext2/span").Span,s=require("qtext2/util").Util;var o=i.extend({init:function(e,t,i){s.assert(e.length==1,"ImageSections should have exactly one child:",e);s.assert(e[0].hasModifier("image"),"missing image modifier on image span");this._super("image",e,t,i)},allowedModifiers:function(){return["image"]},htmlIndentPrefix:"",htmlIndentSuffix:"",htmlPrefix:"<p>",htmlSuffix:"</p>"});o.fromURL=function(e){return new o([new n("",{image:e})])};exports.ImageSection=o});define("qtext2/sections/horizontal_rule",["shared/polyfills","qtext2/section","qtext2/span"],function Zo(require,exports,e){var t=require("qtext2/section").Section,i=require("qtext2/span").Span;
var n=t.extend({init:function(){var e=[new i("",{image:"/static/images/hr_img_3.png"})];this._super("horizontal-rule",e,0,false)},allowedModifiers:function(){return["image"]},getChildrenContents:function(){return""},_getHTMLPrefix:function(){return"<hr>"},_getHTMLSuffix:function(){return"</hr>"}});exports.HorizontalRuleSection=n});define("qtext2/sections/lists",["shared/polyfills","qtext2/section"],function er(require,exports,e){var t=require("qtext2/section"),i=t.Section;var n=exports.isListSection=function(e){return e instanceof s};var s=i.extend({allowsMultipleSoftReturns:function(){return true},maxIndent:function(){if(this.parent){var e=this.previousSibling();if(!e||!n(e)){return 0}else{return Math.min(2,e.getIndent()+1)}}return 2},htmlPrefix:"<li>",htmlSuffix:"</li>"});exports.UnorderedListSection=s.extend({init:function(e,t,i){this._super("unordered-list",e,t,i)},_getTextPrefix:function(e){return this._super(e)+"* "},htmlIndentPrefix:"<ul>",htmlIndentSuffix:"</ul>"});exports.OrderedListSection=s.extend({
init:function(e,t,i){this._super("ordered-list",e,t,i)},_getTextPrefix:function(e){var t=this._super(e),i,n=this.getIndent(),s=e.indexOf(this)-1,o=1;while(s>=0){i=e[s];if(n>i.getIndent()||!(i instanceof this.constructor)){break}if(n==i.getIndent()){o++}s--}return t+o+". "},htmlIndentPrefix:"<ol>",htmlIndentSuffix:"</ol>"})});define("shared/embedly",["shared/polyfills","interface/rpc"],function tr(require,exports,e){var t=require("interface/rpc").rpc;function i(e,t){n(e,function(e){if(e){t(e)}else{t(null)}})}function n(e,i){t("/embedly_/get_oembedly_json_POST").kwargs({url:e}).success(function(e){if("error"in e){i(null)}else{i(e)}}).error(function(){i(null)}).send()}exports.getOEmbedlyData=i});define("qtext2/sections/embed",["shared/polyfills","qtext2/span","qtext2/section","qtext2/modifiers","qtext2/sections/plain","qtext2/util","shared/errors","qtext2/constants","shared/twitter_oembed","shared/embedly","gating"],function ir(require,exports,e){var t=require("qtext2/span").Span,i=require("qtext2/section").Section,n=require("qtext2/modifiers"),s=require("qtext2/sections/plain").PlainSection,o=require("qtext2/util").Util,r=require("shared/errors"),a=require("qtext2/constants").CONTENT_TYPES,d=require("shared/twitter_oembed").getTweetData;
var l=i.extend({init:function(e,t,i){o.assert(e.length==1,"EmbedSections should have exactly one child:",e);o.assert(e[0].hasModifier("embed"),"missing embed modifier on embed span");this._super(this.type,e,t,i);var n=e[0].getModifier("embed").url;this._setEmbed(n)},toContent:function(e,i){var n=this.children[0].getModifier("embed").url;if(e==a.TEXT){return n}else{var s=new t(n,{link:{type:"url",url:n}});return s.toContent(e)}},toJSON:function(){var e={type:this.getType(),indent:this.getIndent(),quoted:this.isQuoted(),spans:[]};this.children.forEach(function(t){var i=t.toJSON();for(var n in i.modifiers){if(n!=="embed"){delete i.modifiers[n]}}e.spans.push(i)});return e},_setEmbed:function(){return},allowedModifiers:function(){return n.nonEditableSet()},_onEmbedSectionCallbackError:function(){var e=this.children[0].getModifier("embed").url;this.children[0].removeModifier("embed");this.children[0].setText(e);this.children[0].setModifier("link",{type:"url",url:e});this.changeType(s)}});l.getValidRegex=function(e){
var t=[];e._VALID_REGEXES.forEach(function(e){t.push("(?:"+e.source+")")});var i=t.join("|");return new RegExp(i)};l.fromOtherSection=function(e){var i=null;if(!e.isEditable()){return null}p.some(function(n){var s=g()[n];var r=true,a="",d=0;var c=l.getValidRegex(s);e.children.forEach(function(e){if(e.hasModifier("link")){var t=e.getModifier("link").url;if(t&&t.match(c)){d+=1;a=e.getModifier("link").url}else{r=false}}else{var i=e.getText();o.splitByRegex(i,c).forEach(function(e){if(e.match){d+=1;a=e.text}else{if(!e.text.match(/^ *$/)){r=false}}})}});if(d==1&&r){i=new s([new t("",{embed:{url:a}})]);return true}return false});return i};var c=l.extend({_onOEmbedCallbackSuccess:function(e,t,i,n){var s=this.children[0].getModifier("embed");if(i!==undefined&&i!==null){o.assert(n===undefined||n===null,"If iframe_html is supplied, iframe_url has to be null / undefined.");var r=o.create("div");r.innerHTML=i;n=r.children[0].src}o.assert(n!==null,"For OEmbedSection, we have to have the iframe URL.");
s.thumbnail_url=t;s.content_type=e;s.iframe={url:n};this.children[0].setModifier("embed",s);this.children[0].setModifier("image",t)}});var u=c.extend({_setEmbed:function(e){var t=this;var i=this.children[0].getModifier("embed");if(i.thumbnail_url&&i.content_type&&i.iframe&&i.iframe.url){t._onOEmbedCallbackSuccess(i.content_type,i.thumbnail_url,null,i.iframe.url)}else{require("shared/embedly").getOEmbedlyData(e,function(e){if(e){t._onOEmbedCallbackSuccess(e.type,e.thumbnail_url,e.html)}else{t._onEmbedSectionCallbackError()}})}},type:"oembedly"});u._VALID_REGEXES=[/http:\/\/www.vimeo.com\/groups\/*\/videos\/.*/,/http:\/\/www.vimeo.com\/.*/,/https:\/\/www.vimeo.com\/.*/,/http:\/\/vimeo.com\/groups\/.*\/videos\/.*/,/http:\/\/vimeo.com\/.*/,/https:\/\/vimeo.com\/.*/,/http:\/\/vimeo.com\/m\/#\/.*/,/http:\/\/player.vimeo.com\/.*/,/https:\/\/player.vimeo.com\/.*/,/http:\/\/www.hulu.com\/watch.*/,/http:\/\/www.hulu.com\/w\/.*/,/http:\/\/www.hulu.com\/embed\/.*/,/http:\/\/hulu.com\/watch.*/,/http:\/\/hulu.com\/w\/.*/,/http:\/\/hulu.tv\/.*/,/http:\/\/www.ustream.tv\/recorded\/.*/,/http:\/\/www.ustream.tv\/channel\/.*/,/http:\/\/www.ustream.tv\/.*/,/http:\/\/ustre.am\/.*/,/http:\/\/link.brightcove.com\/services\/player\/bcpid.*/,/http:\/\/bcove.me\/.*/,/http:\/\/www.vevo.com\/watch\/.*/,/http:\/\/www.vevo.com\/video\/.*/,/http:\/\/video.google.com\/videoplay\?.*/,/http:\/\/.*.dailymotion.com\/video\/.*/,/http:\/\/.*.dailymotion.com\/.*\/video\/.*/,/http:\/\/khanacademy.org\/*/,/http:\/\/www.khanacademy.org\/*/,/https:\/\/khanacademy.org\/*/,/https:\/\/www.khanacademy.org\/*/,/http:\/\/www.ted.com\/talks\/.*.html.*/,/http:\/\/www.ted.com\/talks\/lang\/.*\/.*.html*/,/http:\/\/www.ted.com\/index.php\/talks\/.*.html.*/,/http:\/\/www.ted.com\/index.php\/talks\/lang\/.*\/.*.html/,/http:\/\/www.ted.com\/talks\/.*/];
var h=l.extend({_setEmbed:function(e){var t,i;i=l.getValidRegex(h).exec(e);if(i){t=i[1]}else{r.report(new Error("VideoSection: url did not match regex: "+e));t=""}this.children[0].setModifier("image","https://img.youtube.com/vi/"+t+"/0.jpg")},type:"video",htmlIndentPrefix:"",htmlIndentSuffix:"",htmlPrefix:"<p>",htmlSuffix:"</p>"});h._VALID_REGEXES=[/(?:https?:\/{2})?(?:w{3}\.)?(?:youtube\.com\/watch.+v=|youtu.be\/|youtube.com\/embed\/)([^\s?]+)(\?[^\s]+)?/];var f=l.extend({_onTweetCallbackSuccess:function(e,t){var i={root:e,shouldLoad:t};this.children[0].setModifier("tweet",i)},_setEmbed:function(e){var t=this;d(e,function(e,i){if(e){t._onTweetCallbackSuccess(e,i)}else{t._onEmbedSectionCallbackError()}})},type:"tweet",htmlIndentPrefix:"",htmlIndentSuffix:"",htmlPrefix:"<p>",htmlSuffix:"</p>"});f._VALID_REGEXES=[/https:\/\/twitter.com\/.*\/status\/.*/];var p=["oembedly","video"];if(require("gating").render_tweets_as_embeds){p.push("tweet")}var g=function(){var e={};e.video=h;e.oembedly=u;
if(require("gating").render_tweets_as_embeds){e.tweet=f}return e};exports.EmbedSection=l;exports.OEmbedlySection=u;exports.VideoSection=h;exports.TweetSection=f;exports.EMBED_SECTION_TYPES=p});define("qtext2/section",["shared/polyfills","qtext2/container","qtext2/constants","qtext2/modifiers","qtext2/span","qtext2/util","qtext2/sections/plain","qtext2/sections/code","qtext2/sections/image","qtext2/sections/horizontal_rule","qtext2/sections/lists","qtext2/sections/embed","gating"],function nr(require,exports,e){var t=require("qtext2/container").Container,i=require("qtext2/constants").CONTENT_TYPES,n=require("qtext2/modifiers"),s=require("qtext2/span").Span,o=require("qtext2/util").Util;var r=function(){var e={};e.plain=require("qtext2/sections/plain").PlainSection;e.code=require("qtext2/sections/code").CodeSection;e.image=require("qtext2/sections/image").ImageSection;var t=require("qtext2/sections/horizontal_rule");e["horizontal-rule"]=t.HorizontalRuleSection;var i=require("qtext2/sections/lists");
e["ordered-list"]=i.OrderedListSection;e["unordered-list"]=i.UnorderedListSection;var n=require("qtext2/sections/embed");e.embed=n.EmbedSection;e.video=n.VideoSection;e.oembedly=n.OEmbedlySection;if(require("gating").render_tweets_as_embeds){e.tweet=n.TweetSection}return e};var a=t.create("section",{init:function(e,t,i,n){var r=this;t=t&&t.length!==0?t:[new s];t.slice().forEach(function(e){r.appendChild(e)});o.setData(this.node,"type",e);this.setIndent(i||0);this.setQuoted(n)},getType:function(){return o.getData(this.node,"type")},getLength:function(){var e=0;this.children.forEach(function(t){e+=t.getLength()});return e},getIndent:function(){return parseInt(o.getData(this.node,"indent"))},setIndent:function(e){e=Math.min(this.maxIndent(),Math.max(0,e));o.setData(this.node,"indent",e);return this.maxIndent()!==0},setQuoted:function(e){if(e){o.setData(this.node,"quoted","true")}else{o.removeData(this.node,"quoted")}},isQuoted:function(){return!!o.getData(this.node,"quoted")},isEditable:function(){
return!this.children.some(function(e){return!e.isEditable()})},allowsMultipleSoftReturns:function(){return false},allowedModifiers:function(){return n.editableSet()},toContent:function(e,t){var i=[];i.push(this.getContentPrefix(e,t));i.push(this.getChildrenContents(e));i.push(this.getContentSuffix(e,t));i=i.join("");return i},getChildrenContents:function(e){return this.children.map(function(t){return t.toContent(e)}).join("")},toJSON:function(){var e={type:this.getType(),indent:this.getIndent(),quoted:this.isQuoted(),spans:[]};this.children.forEach(function(t){e.spans.push(t.toJSON())});return e},first:function(){return this.firstChild().first()},last:function(){return this.lastChild().last()},getText:function(){var e="";this.children.forEach(function(t){e+=t.getText()});return e},deleteText:function(e,t){if(e.span==t.span){e.span.deleteText(e.offset,t.offset)}else{e.span.deleteText(e.offset,e.span.getLength());while(e.span.nextSibling()!=t.span){this.removeChild(e.span.nextSibling())}if(t.span){
t.span.deleteText(0,t.offset);if(t.span.isEmpty()){this.removeChild(t.span)}}}},isEmpty:function(){return this.children.length==1&&this.children[0].isEmpty()},isOnlyWhiteSpace:function(){return this.children.every(function(e){return e.isOnlyWhiteSpace()})},_createSplitSection:function(e){return new this.constructor(e,this.getIndent(),this.isQuoted())},split:function(e){var t,i,n,o,r=e.span,a=e.offset;if(a===0){if(r==this.firstChild()){this.insertBefore(new s,r)}o=r}else if(a===r.getLength()){if(r==this.lastChild()){o=new s;this.appendChild(o)}else{o=r.nextSibling()}}else{o=r.split(a,true)}t=this.children.indexOf(o)+1;n=this.children.slice(t);n.unshift(o);i=this._createSplitSection(n);this.parent.insertBefore(i,this.nextSibling());return o.first()},merge:function(e){var t,i,n;if(!e.isEditable()){if(this.isEmpty()){if(this.parent){this.parent.removeChild(this)}}t=e.first()}else if(e.isEmpty()){if(e.parent){e.parent.removeChild(e)}t=this.last()}else if(!this.isEditable()){if(this.parent){this.parent.removeChild(this);
}t=e.first()}else{if(this.isEmpty()){this.removeChild(this.firstChild());this.setIndent(e.getIndent());this.setQuoted(e.isQuoted());t=e.first()}else{t=this.last()}while(e.children.length){this.appendChild(e.firstChild())}i=this.firstChild();while(i){n=i.nextSibling();if(n&&i.hasSameModifiers(n)){i=i.merge(n)}else{i=n}}if(e.parent){e.parent.removeChild(e)}}return t},changeType:function(e){var t=new e(this.children,this.getIndent(),this.isQuoted());if(this.parent){this.parent.insertBefore(t,this);this.parent.removeChild(this)}return t},getContentPrefix:function(e,t){if(e==i.TEXT){return this._getTextPrefix(t)}else if(e==i.HTML){return this._getHTMLPrefix(t)}},getContentSuffix:function(e,t){if(e==i.TEXT){return this._getTextSuffix(t)}else if(e==i.HTML){return this._getHTMLSuffix(t)}},_getTextPrefix:function(){var e,t="";for(e=0;e<this.getIndent()*4;e++){t+=" "}if(this.isQuoted()){t+=">"}return t},_getTextSuffix:function(){return"\n"},_getHTMLPrefix:function(e){var t="",i=e.indexOf(this),n=this.getIndent(),s=-1,o;
if(i>0){o=e[i-1];if(o instanceof this.constructor){s=o.getIndent()}if(this.isQuoted()&&!o.isQuoted()){t+="<blockquote>"}}else if(this.isQuoted()){t+="<blockquote>"}while(n>s){t+=this.htmlIndentPrefix;n--}return t+this.htmlPrefix},_getHTMLSuffix:function(e){var t=this.htmlSuffix,i=e.indexOf(this),n=this.getIndent(),s=-1,o;if(i<e.length-1){o=e[i+1];if(o instanceof this.constructor){s=o.getIndent()}}while(n>s){n--;t+=this.htmlIndentSuffix}if(this.isQuoted()&&(!o||!o.isQuoted())){t+="</blockquote>"}return t},maxIndent:function(){return 0}});a.fromJSON=function(e){var t=[],i=r()[e.type];e.spans.forEach(function(e){t.push(new s(e.text,e.modifiers))});return new i(t,e.indent,e.quoted)};exports.Section=a});define("qtext2/formatting_state",["shared/polyfills","shared/Class","qtext2/util"],function sr(require,exports,e){var t=require("shared/Class").Class,i=require("qtext2/util").Util;exports.FormattingState=t.extend({__init__:function(e){this._modifiers={};this.update(e)},is:function(e){return e in this._modifiers;
},update:function(e){this.updatePosition(e);this._modifiers=e.start.span.getModifiers();if(!this._isLinked()){delete this._modifiers.link;delete this._modifiers.citation}},updatePosition:function(e){this.caret=e;this.position=e.start.clone();this.spanLength=e.start.span.getLength()},_isLinked:function(){var e=this.caret.start.span;if(!(e.hasModifier("link")||e.hasModifier("citation"))){return false}if(this.caret.isCollapsed()){return!this.caret.start.atSpanStart()&&!this.caret.start.atSpanEnd()}return e==this.caret.end.span},toggleModifier:function(e,t){if(t in this._modifiers){delete this._modifiers[t]}else if(t!="link"&&t!="citation"){this._modifiers[t]=true}this.position=e.start.clone()},hasChanged:function(e){return!i.jsonEqual(this._modifiers,e.start.span.getModifiers())&&this.spanLength!=e.start.span.getLength()},apply:function(e){var t=!i.jsonEqual(e.modifiers,this._modifiers);e.removeAllModifiers();e.updateModifiers(this._modifiers);return t}})});define("qtext2/selection",["shared/polyfills","shared/Class"],function or(require,exports,e){
var t=require("shared/Class").Class;var i=exports.Selection=t.extend({__init__:function(e,t,i){this.start=e;this.end=t;this.doc=i},toJSON:function(){return{start:this.start.toJSON(),end:this.end.toJSON()}},equals:function(e){return this.start.equals(e.start)&&this.end.equals(e.end)},getStartNode:function(){return this.start.span.getFocusNode()},getEndNode:function(){return this.end.span.getFocusNode()},moveStart:function(e){this.start.span=e.span;this.start.offset=e.offset},moveEnd:function(e){this.end.span=e.span;this.end.offset=e.offset},isCollapsed:function(){return this.start.equals(this.end)},charBefore:function(){return this.start.charBefore()},hasCharBefore:function(){return this.start.hasCharBefore()},previousTextUntil:function(e){var t=this.start.span,i=this.start.offset,n="";while(t&&t!=e.span){n=t.getText().substring(0,i)+n;t=t.previousSibling();if(t){i=t.getLength()}}if(t){n=t.getText().substring(e.offset,i)+n}return n},hasCharAfter:function(){return this.start.hasCharAfter();
},charAfter:function(){return this.end.charAfter()},charPosition:function(){var e=this.start.offset;var t=this.start.span.previousSibling();while(t){e+=t.getLength();t=t.previousSibling()}var i=this.start.span.parent.previousSibling();while(i){e+=i.getLength()+1;i=i.previousSibling()}return e},containsEntireSection:function(e){var t=this.start,i=this.end,n;n=t.span.parent;while(n&&n.previousSibling()!=i.span.parent){if(e==n&&(t.span.parent!=e||t.atSectionStart())&&(i.span.parent!=e||i.atSectionEnd())){return true}n=n.nextSibling()}return false},getCoveringSpans:function(){var e=this.start.span,t=[];while(e&&e!=this.end.span){t.push(e);e=e.next()}t.push(e);return t},getText:function(){var e="";if(this.start.span.parent!=this.end.span.parent){var t=this.start.span.parent,n=this.end.span.parent,s=new i(this.start,t.last()),o=new i(n.first(),this.end);e+=s.getText();for(var r=t.nextSibling();r&&r!=n;r=r.nextSibling()){e+=r.getText()}e+=o.getText();return e}var a=this.start.span,d=this.start.offset;
while(a&&a!=this.end.span){e+=a.getText().substring(d,a.getLength());d=0;a=a.nextSibling()}if(a){e+=a.getText().substring(d,this.end.offset)}return e}})});define("qtext2/caret",["shared/polyfills","shared/Class","interface/jquery","qtext2/util","shared/rangy","settings","qtext2/span","qtext2/section","qtext2/base","qtext2/position","qtext2/selection","shared/client"],function rr(require,exports,e){var t=require("shared/Class").Class,$=require("interface/jquery")._jQuery,i=require("qtext2/util").Util,n=require("shared/rangy").rangy,s=require("settings"),o=s.pageIsMobile,r=require("qtext2/span").Span,a=require("qtext2/section").Section,d=require("qtext2/base"),l=require("qtext2/position").Position,c=require("qtext2/selection").Selection,u=require("shared/client"),h;if(o){h=require("mobile_app2/messages")}exports.Caret=t.extend({__init__:function(e,t,i){this.selection=new c(e,t,i);this.doc=i;var n=this;Object.defineProperty(n,"start",{get:function(){return n.selection.start},set:function(e){
n.selection=new c(e,n.end)}});Object.defineProperty(n,"end",{get:function(){return n.selection.end},set:function(e){n.selection=new c(n.start,e)}})},toJSON:function(){return this.selection.toJSON()},getStartNode:function(){return this.selection.getStartNode()},getEndNode:function(){return this.selection.getEndNode()},moveStart:function(e){return this.selection.moveStart(e)},moveEnd:function(e){return this.selection.moveEnd(e)},move:function(e,t,i){t=t||e;var n=true;if(this.start.equals(e)&&this.end.equals(t)){n=false}this.start.span=e.span;this.start.offset=e.offset;this.end.span=t.span;this.end.offset=t.offset;this._apply(i);return n},isCollapsed:function(){return this.selection.isCollapsed()},charBefore:function(){return this.selection.charBefore()},hasCharBefore:function(){return this.selection.hasCharBefore()},previousTextUntil:function(e){return this.selection.previousTextUntil(e)},charAfter:function(){return this.selection.charAfter()},charPosition:function(){return this.selection.charPosition();
},hasCharAfter:function(){return this.selection.hasCharAfter()},updateAndroidCaretPosition:function(e){e=e||0;if(o&&u.isAndroidApp()){h.send("setCaretPos",{selectionStart:this.charPosition()+e})}},update:function(e){var t=n.getSelection(),i,s,o;if(!t.anchorNode){return false}if(t.isCollapsed){i=s=this._fromNode(t.anchorNode,t.anchorOffset)}else{o=t.getRangeAt(0);i=this._fromNode(o.startContainer,o.startOffset);s=this._fromNode(o.endContainer,o.endOffset)}if(!(i&&s)){return false}return this.move(i,s,e)},_fromNode:function(e,t){var i,n,c,h;if(!this.doc.contains(e)){if(o&&u.isAndroidApp()&&s.osVersion<4.4){var f=e;while(f){if(d.Doc.is(f)){break}f=f.parentNode}if(!f){return null}}else{return null}}if(d.Doc.is(e)){h=d.Doc.get(e);if(t===0){n=h.firstChild().firstChild();c=0}else{n=h.lastChild().lastChild();c=n.getLength()}}else if(a.is(e)){i=a.get(e);if(t===0){n=i.firstChild();c=0}else{n=i.lastChild();c=n.getLength()}}else if(r.is(e.parentNode)&&(t===1||t===0)){n=r.get(e.parentNode);c=t===0?0:n.getLength();
}else{while(e&&!r.is(e)){e=e.parentNode}if(!e){return null}n=r.get(e);c=t}return new l(n,c)},_apply:function(e){var t=n.getSelection(),i=this.getStartNode(),s,o;if(this.isCollapsed()){if(!e&&t.isCollapsed&&i==t.anchorNode&&this.start.offset==t.anchorOffset){return}o=n.createRange();o.setStart(i,this.start.offset);o.setEnd(i,this.start.offset);o.collapse(true);t.removeAllRanges();t.addRange(o)}else{s=this.end.span.getFocusNode();if(!t.isCollapsed){o=t.getRangeAt(0);if(!e&&i==o.startContainer&&this.start.offset==o.startOffset&&s==o.endContainer&&this.end.offset==o.endOffset){return}}else{o=n.createRange()}o.setStart(i,this.start.offset);o.setEnd(s,this.end.offset);t.removeAllRanges();t.addRange(o)}return},getAbsolutePosition:function(){var e=window.getSelection(),t=i.firstScrollingParent(this.doc.node),s=document.body.parentElement,o=e.rangeCount>0&&e.getRangeAt(0),r=o?o.getClientRects():[];if(r.length>0){var a={top:r[0].top,left:r[0].left};a.top+=t.scrollTop||s.scrollTop;a.left+=t.scrollLeft||s.scrollLeft;
return a}var d=n.getSelection().anchorNode;if(i.isTextNode(d)){d=this.start.span.parent.node}if($(d).children().first().is("img")){return $(d).children().first().offset()}return i.getContainerOffset(d)},scrollIntoViewIfNeeded:function(){if(!this.isCollapsed()){return}if(!n.getSelection().anchorNode){return}var e=this.getAbsolutePosition(),t=i.firstScrollingParent(this.doc.node),s=document.body.parentElement,r=t.scrollTop||s.scrollTop,a=r+window.innerHeight,d,l,c=30;if(!o){a-=50}if(!e){return}d=e.top;l=d+c;setTimeout(function(){if(d<r){t.scrollTop+=d-r;s.scrollTop+=d-r}else if(l>a){t.scrollTop+=l-a;s.scrollTop+=l-a}},0)},containsEntireSection:function(e){return this.selection.containsEntireSection(e)},mergeAdjacentSpans:function(){if(!this.isCollapsed()){return}var e=this.start.span,t=e.nextSibling(),n=e.previousSibling(),s=this.start.offset;if(t&&i.jsonEqual(e.modifiers,t.modifiers)){e.setText(e.getText()+t.getText());t.parent.removeChild(t);this.move(new l(e,s))}if(n&&i.jsonEqual(e.modifiers,n.modifiers)){
s+=n.getLength();e.setText(n.getText()+e.getText());n.parent.removeChild(n);this.move(new l(e,s))}},getCoveringSpans:function(){return this.selection.getCoveringSpans()}})});define("third_party/mutation-summary",["shared/polyfills"],function ar(require,exports,e){var t=this.__extends||function(e,t){for(var i in t)if(t.hasOwnProperty(i))e[i]=t[i];function n(){this.constructor=e}n.prototype=t.prototype;e.prototype=new n};var i;if(typeof WebKitMutationObserver!=="undefined")i=WebKitMutationObserver;else i=MutationObserver;if(i===undefined){console.error("DOM Mutation Observers are required.");console.error("https://developer.mozilla.org/en-US/docs/DOM/MutationObserver");throw Error("DOM Mutation Observers are required")}var n=function(){function e(){this.nodes=[];this.values=[]}e.prototype.isIndex=function(e){return+e===e>>>0};e.prototype.nodeId=function(t){var i=t[e.ID_PROP];if(!i)i=t[e.ID_PROP]=e.nextId_++;return i};e.prototype.set=function(e,t){var i=this.nodeId(e);this.nodes[i]=e;this.values[i]=t;
};e.prototype.get=function(e){var t=this.nodeId(e);return this.values[t]};e.prototype.has=function(e){return this.nodeId(e)in this.nodes};e.prototype["delete"]=function(e){var t=this.nodeId(e);delete this.nodes[t];this.values[t]=undefined};e.prototype.keys=function(){var e=[];for(var t in this.nodes){if(!this.isIndex(t))continue;e.push(this.nodes[t])}return e};e.ID_PROP="__mutation_summary_node_map_id__";e.nextId_=1;return e}();var s;(function(e){e[e["STAYED_OUT"]=0]="STAYED_OUT";e[e["ENTERED"]=1]="ENTERED";e[e["STAYED_IN"]=2]="STAYED_IN";e[e["REPARENTED"]=3]="REPARENTED";e[e["REORDERED"]=4]="REORDERED";e[e["EXITED"]=5]="EXITED"})(s||(s={}));function o(e){return e===s.ENTERED||e===s.EXITED}var r=function(){function e(e,t,i,n,s,o,r,a){if(t===void 0){t=false}if(i===void 0){i=false}if(n===void 0){n=false}if(s===void 0){s=null}if(o===void 0){o=false}if(r===void 0){r=null}if(a===void 0){a=null}this.node=e;this.childList=t;this.attributes=i;this.characterData=n;this.oldParentNode=s;this.added=o;
this.attributeOldValues=r;this.characterDataOldValue=a;this.isCaseInsensitive=this.node.nodeType===window.Node.ELEMENT_NODE&&this.node instanceof window.HTMLElement&&this.node.ownerDocument instanceof window.HTMLDocument}e.prototype.getAttributeOldValue=function(e){if(!this.attributeOldValues)return undefined;if(this.isCaseInsensitive)e=e.toLowerCase();return this.attributeOldValues[e]};e.prototype.getAttributeNamesMutated=function(){var e=[];if(!this.attributeOldValues)return e;for(var t in this.attributeOldValues){e.push(t)}return e};e.prototype.attributeMutated=function(e,t){this.attributes=true;this.attributeOldValues=this.attributeOldValues||{};if(e in this.attributeOldValues)return;this.attributeOldValues[e]=t};e.prototype.characterDataMutated=function(e){if(this.characterData)return;this.characterData=true;this.characterDataOldValue=e};e.prototype.removedFromParent=function(e){this.childList=true;if(this.added||this.oldParentNode)this.added=false;else this.oldParentNode=e};e.prototype.insertedIntoParent=function(){
this.childList=true;this.added=true};e.prototype.getOldParent=function(){if(this.childList){if(this.oldParentNode)return this.oldParentNode;if(this.added)return null}return this.node.parentNode};return e}();var a=function(){function e(){this.added=new n;this.removed=new n;this.maybeMoved=new n;this.oldPrevious=new n;this.moved=undefined}return e}();var d=function(e){t(i,e);function i(t,i){e.call(this);this.rootNode=t;this.reachableCache=undefined;this.wasReachableCache=undefined;this.anyParentsChanged=false;this.anyAttributesChanged=false;this.anyCharacterDataChanged=false;for(var n=0;n<i.length;n++){var s=i[n];switch(s.type){case"childList":this.anyParentsChanged=true;for(var o=0;o<s.removedNodes.length;o++){var r=s.removedNodes[o];this.getChange(r).removedFromParent(s.target)}for(var o=0;o<s.addedNodes.length;o++){var r=s.addedNodes[o];this.getChange(r).insertedIntoParent()}break;case"attributes":this.anyAttributesChanged=true;var a=this.getChange(s.target);a.attributeMutated(s.attributeName,s.oldValue);
break;case"characterData":this.anyCharacterDataChanged=true;var a=this.getChange(s.target);a.characterDataMutated(s.oldValue);break}}}i.prototype.getChange=function(e){var t=this.get(e);if(!t){t=new r(e);this.set(e,t)}return t};i.prototype.getOldParent=function(e){var t=this.get(e);return t?t.getOldParent():e.parentNode};i.prototype.getIsReachable=function(e){if(e===this.rootNode)return true;if(!e)return false;this.reachableCache=this.reachableCache||new n;var t=this.reachableCache.get(e);if(t===undefined){t=this.getIsReachable(e.parentNode);this.reachableCache.set(e,t)}return t};i.prototype.getWasReachable=function(e){if(e===this.rootNode)return true;if(!e)return false;this.wasReachableCache=this.wasReachableCache||new n;var t=this.wasReachableCache.get(e);if(t===undefined){t=this.getWasReachable(this.getOldParent(e));this.wasReachableCache.set(e,t)}return t};i.prototype.reachabilityChange=function(e){if(this.getIsReachable(e)){return this.getWasReachable(e)?s.STAYED_IN:s.ENTERED}return this.getWasReachable(e)?s.EXITED:s.STAYED_OUT;
};return i}(n);var l=function(){function e(e,t,i,s,o){this.rootNode=e;this.mutations=t;this.selectors=i;this.calcReordered=s;this.calcOldPreviousSibling=o;this.treeChanges=new d(e,t);this.entered=[];this.exited=[];this.stayedIn=new n;this.visited=new n;this.childListChangeMap=undefined;this.characterDataOnly=undefined;this.matchCache=undefined;this.processMutations()}e.prototype.processMutations=function(){if(!this.treeChanges.anyParentsChanged&&!this.treeChanges.anyAttributesChanged)return;var e=this.treeChanges.keys();for(var t=0;t<e.length;t++){this.visitNode(e[t],undefined)}};e.prototype.visitNode=function(e,t){if(this.visited.has(e))return;this.visited.set(e,true);var i=this.treeChanges.get(e);var n=t;if(i&&i.childList||n==undefined)n=this.treeChanges.reachabilityChange(e);if(n===s.STAYED_OUT)return;this.matchabilityChange(e);if(n===s.ENTERED){this.entered.push(e)}else if(n===s.EXITED){this.exited.push(e);this.ensureHasOldPreviousSiblingIfNeeded(e)}else if(n===s.STAYED_IN){var o=s.STAYED_IN;
if(i&&i.childList){if(i.oldParentNode!==e.parentNode){o=s.REPARENTED;this.ensureHasOldPreviousSiblingIfNeeded(e)}else if(this.calcReordered&&this.wasReordered(e)){o=s.REORDERED}}this.stayedIn.set(e,o)}if(n===s.STAYED_IN)return;for(var r=e.firstChild;r;r=r.nextSibling){this.visitNode(r,n)}};e.prototype.ensureHasOldPreviousSiblingIfNeeded=function(e){if(!this.calcOldPreviousSibling)return;this.processChildlistChanges();var t=e.parentNode;var i=this.treeChanges.get(e);if(i&&i.oldParentNode)t=i.oldParentNode;var n=this.childListChangeMap.get(t);if(!n){n=new a;this.childListChangeMap.set(t,n)}if(!n.oldPrevious.has(e)){n.oldPrevious.set(e,e.previousSibling)}};e.prototype.getChanged=function(e,t,i){this.selectors=t;this.characterDataOnly=i;for(var n=0;n<this.entered.length;n++){var o=this.entered[n];var r=this.matchabilityChange(o);if(r===s.ENTERED||r===s.STAYED_IN)e.added.push(o)}var a=this.stayedIn.keys();for(var n=0;n<a.length;n++){var o=a[n];var r=this.matchabilityChange(o);if(r===s.ENTERED){
e.added.push(o)}else if(r===s.EXITED){e.removed.push(o)}else if(r===s.STAYED_IN&&(e.reparented||e.reordered)){var d=this.stayedIn.get(o);if(e.reparented&&d===s.REPARENTED)e.reparented.push(o);else if(e.reordered&&d===s.REORDERED)e.reordered.push(o)}}for(var n=0;n<this.exited.length;n++){var o=this.exited[n];var r=this.matchabilityChange(o);if(r===s.EXITED||r===s.STAYED_IN)e.removed.push(o)}};e.prototype.getOldParentNode=function(e){var t=this.treeChanges.get(e);if(t&&t.childList)return t.oldParentNode?t.oldParentNode:null;var i=this.treeChanges.reachabilityChange(e);if(i===s.STAYED_OUT||i===s.ENTERED)throw Error("getOldParentNode requested on invalid node.");return e.parentNode};e.prototype.getOldPreviousSibling=function(e){var t=e.parentNode;var i=this.treeChanges.get(e);if(i&&i.oldParentNode)t=i.oldParentNode;var n=this.childListChangeMap.get(t);if(!n)throw Error("getOldPreviousSibling requested on invalid node.");return n.oldPrevious.get(e)};e.prototype.getOldAttribute=function(e,t){
var i=this.treeChanges.get(e);if(!i||!i.attributes)throw Error("getOldAttribute requested on invalid node.");var n=i.getAttributeOldValue(t);if(n===undefined)throw Error("getOldAttribute requested for unchanged attribute name.");return n};e.prototype.attributeChangedNodes=function(e){if(!this.treeChanges.anyAttributesChanged)return{};var t;var i;if(e){t={};i={};for(var n=0;n<e.length;n++){var o=e[n];t[o]=true;i[o.toLowerCase()]=o}}var r={};var a=this.treeChanges.keys();for(var n=0;n<a.length;n++){var d=a[n];var l=this.treeChanges.get(d);if(!l.attributes)continue;if(s.STAYED_IN!==this.treeChanges.reachabilityChange(d)||s.STAYED_IN!==this.matchabilityChange(d)){continue}var c=d;var u=l.getAttributeNamesMutated();for(var h=0;h<u.length;h++){var o=u[h];if(t&&!t[o]&&!(l.isCaseInsensitive&&i[o])){continue}var f=l.getAttributeOldValue(o);if(f===c.getAttribute(o))continue;if(i&&l.isCaseInsensitive)o=i[o];r[o]=r[o]||[];r[o].push(c)}}return r};e.prototype.getOldCharacterData=function(e){var t=this.treeChanges.get(e);
if(!t||!t.characterData)throw Error("getOldCharacterData requested on invalid node.");return t.characterDataOldValue};e.prototype.getCharacterDataChanged=function(){if(!this.treeChanges.anyCharacterDataChanged)return[];var e=this.treeChanges.keys();var t=[];for(var i=0;i<e.length;i++){var n=e[i];if(s.STAYED_IN!==this.treeChanges.reachabilityChange(n))continue;var o=this.treeChanges.get(n);if(!o.characterData||n.textContent==o.characterDataOldValue)continue;t.push(n)}return t};e.prototype.computeMatchabilityChange=function(e,t){if(!this.matchCache)this.matchCache=[];if(!this.matchCache[e.uid])this.matchCache[e.uid]=new n;var i=this.matchCache[e.uid];var s=i.get(t);if(s===undefined){s=e.matchabilityChange(t,this.treeChanges.get(t));i.set(t,s)}return s};e.prototype.matchabilityChange=function(e){var t=this;if(this.characterDataOnly){switch(e.nodeType){case Node.COMMENT_NODE:case Node.TEXT_NODE:return s.STAYED_IN;default:return s.STAYED_OUT}}if(!this.selectors)return s.STAYED_IN;if(e.nodeType!==Node.ELEMENT_NODE)return s.STAYED_OUT;
var i=e;var n=this.selectors.map(function(e){return t.computeMatchabilityChange(e,i)});var o=s.STAYED_OUT;var r=0;while(o!==s.STAYED_IN&&r<n.length){switch(n[r]){case s.STAYED_IN:o=s.STAYED_IN;break;case s.ENTERED:if(o===s.EXITED)o=s.STAYED_IN;else o=s.ENTERED;break;case s.EXITED:if(o===s.ENTERED)o=s.STAYED_IN;else o=s.EXITED;break}r++}return o};e.prototype.getChildlistChange=function(e){var t=this.childListChangeMap.get(e);if(!t){t=new a;this.childListChangeMap.set(e,t)}return t};e.prototype.processChildlistChanges=function(){if(this.childListChangeMap)return;this.childListChangeMap=new n;for(var e=0;e<this.mutations.length;e++){var t=this.mutations[e];if(t.type!="childList")continue;if(this.treeChanges.reachabilityChange(t.target)!==s.STAYED_IN&&!this.calcOldPreviousSibling)continue;var i=this.getChildlistChange(t.target);var o=t.previousSibling;function r(e,t){if(!e||i.oldPrevious.has(e)||i.added.has(e)||i.maybeMoved.has(e))return;if(t&&(i.added.has(t)||i.maybeMoved.has(t)))return;i.oldPrevious.set(e,t);
}for(var a=0;a<t.removedNodes.length;a++){var d=t.removedNodes[a];r(d,o);if(i.added.has(d)){i.added["delete"](d)}else{i.removed.set(d,true);i.maybeMoved["delete"](d)}o=d}r(t.nextSibling,o);for(var a=0;a<t.addedNodes.length;a++){var d=t.addedNodes[a];if(i.removed.has(d)){i.removed["delete"](d);i.maybeMoved.set(d,true)}else{i.added.set(d,true)}}}};e.prototype.wasReordered=function(e){if(!this.treeChanges.anyParentsChanged)return false;this.processChildlistChanges();var t=e.parentNode;var i=this.treeChanges.get(e);if(i&&i.oldParentNode)t=i.oldParentNode;var s=this.childListChangeMap.get(t);if(!s)return false;if(s.moved)return s.moved.get(e);s.moved=new n;var o=new n;function r(e){if(!e)return false;if(!s.maybeMoved.has(e))return false;var t=s.moved.get(e);if(t!==undefined)return t;if(o.has(e)){t=true}else{o.set(e,true);t=c(e)!==d(e)}if(o.has(e)){o["delete"](e);s.moved.set(e,t)}else{t=s.moved.get(e)}return t}var a=new n;function d(e){var t=a.get(e);if(t!==undefined)return t;t=s.oldPrevious.get(e);
while(t&&(s.removed.has(t)||r(t))){t=d(t)}if(t===undefined)t=e.previousSibling;a.set(e,t);return t}var l=new n;function c(e){if(l.has(e))return l.get(e);var t=e.previousSibling;while(t&&(s.added.has(t)||r(t)))t=t.previousSibling;l.set(e,t);return t}s.maybeMoved.keys().forEach(r);return s.moved.get(e)};return e}();var c=function(){function e(e,t){var i=this;this.projection=e;this.added=[];this.removed=[];this.reparented=t.all||t.element||t.characterData?[]:undefined;this.reordered=t.all?[]:undefined;e.getChanged(this,t.elementFilter,t.characterData);if(t.all||t.attribute||t.attributeList){var n=t.attribute?[t.attribute]:t.attributeList;var s=e.attributeChangedNodes(n);if(t.attribute){this.valueChanged=s[t.attribute]||[]}else{this.attributeChanged=s;if(t.attributeList){t.attributeList.forEach(function(e){if(!i.attributeChanged.hasOwnProperty(e))i.attributeChanged[e]=[]})}}}if(t.all||t.characterData){var o=e.getCharacterDataChanged();if(t.characterData)this.valueChanged=o;else this.characterDataChanged=o;
}if(this.reordered)this.getOldPreviousSibling=e.getOldPreviousSibling.bind(e)}e.prototype.getOldParentNode=function(e){return this.projection.getOldParentNode(e)};e.prototype.getOldAttribute=function(e,t){return this.projection.getOldAttribute(e,t)};e.prototype.getOldCharacterData=function(e){return this.projection.getOldCharacterData(e)};e.prototype.getOldPreviousSibling=function(e){return this.projection.getOldPreviousSibling(e)};return e}();var u=/[a-zA-Z_]+/;var h=/[a-zA-Z0-9_\-]+/;function f(e){return'"'+e.replace(/"/,'\\"')+'"'}var p=function(){function e(){}e.prototype.matches=function(e){if(e===null)return false;if(this.attrValue===undefined)return true;if(!this.contains)return this.attrValue==e;var t=e.split(" ");for(var i=0;i<t.length;i++){if(this.attrValue===t[i])return true}return false};e.prototype.toString=function(){if(this.attrName==="class"&&this.contains)return"."+this.attrValue;if(this.attrName==="id"&&!this.contains)return"#"+this.attrValue;if(this.contains)return"["+this.attrName+"~="+f(this.attrValue)+"]";
if("attrValue"in this)return"["+this.attrName+"="+f(this.attrValue)+"]";return"["+this.attrName+"]"};return e}();var g=function(){function e(){this.uid=e.nextUid++;this.qualifiers=[]}Object.defineProperty(e.prototype,"caseInsensitiveTagName",{get:function(){return this.tagName.toUpperCase()},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"selectorString",{get:function(){return this.tagName+this.qualifiers.join("")},enumerable:true,configurable:true});e.prototype.isMatching=function(t){return t[e.matchesSelector](this.selectorString)};e.prototype.wasMatching=function(e,t,i){if(!t||!t.attributes)return i;var n=t.isCaseInsensitive?this.caseInsensitiveTagName:this.tagName;if(n!=="*"&&n!==e.tagName)return false;var s=[];var o=false;for(var r=0;r<this.qualifiers.length;r++){var a=this.qualifiers[r];var d=t.getAttributeOldValue(a.attrName);s.push(d);o=o||d!==undefined}if(!o)return i;for(var r=0;r<this.qualifiers.length;r++){var a=this.qualifiers[r];var d=s[r];if(d===undefined)d=e.getAttribute(a.attrName);
if(!a.matches(d))return false}return true};e.prototype.matchabilityChange=function(e,t){var i=this.isMatching(e);if(i)return this.wasMatching(e,t,i)?s.STAYED_IN:s.ENTERED;else return this.wasMatching(e,t,i)?s.EXITED:s.STAYED_OUT};e.parseSelectors=function(t){var i=[];var n;var s;function o(){if(n){if(s){n.qualifiers.push(s);s=undefined}i.push(n)}n=new e}function r(){if(s)n.qualifiers.push(s);s=new p}var a=/\s/;var d;var l="Invalid or unsupported selector syntax.";var c=1;var f=2;var g=3;var m=4;var v=5;var _=6;var w=7;var b=8;var y=9;var C=10;var x=11;var k=12;var S=13;var E=14;var T=c;var L=0;while(L<t.length){var M=t[L++];switch(T){case c:if(M.match(u)){o();n.tagName=M;T=f;break}if(M=="*"){o();n.tagName="*";T=g;break}if(M=="."){o();r();n.tagName="*";s.attrName="class";s.contains=true;T=m;break}if(M=="#"){o();r();n.tagName="*";s.attrName="id";T=m;break}if(M=="["){o();r();n.tagName="*";s.attrName="";T=_;break}if(M.match(a))break;throw Error(l);case f:if(M.match(h)){n.tagName+=M;break}if(M=="."){
r();s.attrName="class";s.contains=true;T=m;break}if(M=="#"){r();s.attrName="id";T=m;break}if(M=="["){r();s.attrName="";T=_;break}if(M.match(a)){T=E;break}if(M==","){T=c;break}throw Error(l);case g:if(M=="."){r();s.attrName="class";s.contains=true;T=m;break}if(M=="#"){r();s.attrName="id";T=m;break}if(M=="["){r();s.attrName="";T=_;break}if(M.match(a)){T=E;break}if(M==","){T=c;break}throw Error(l);case m:if(M.match(u)){s.attrValue=M;T=v;break}throw Error(l);case v:if(M.match(h)){s.attrValue+=M;break}if(M=="."){r();s.attrName="class";s.contains=true;T=m;break}if(M=="#"){r();s.attrName="id";T=m;break}if(M=="["){r();T=_;break}if(M.match(a)){T=E;break}if(M==","){T=c;break}throw Error(l);case _:if(M.match(u)){s.attrName=M;T=w;break}if(M.match(a))break;throw Error(l);case w:if(M.match(h)){s.attrName+=M;break}if(M.match(a)){T=b;break}if(M=="~"){s.contains=true;T=y;break}if(M=="="){s.attrValue="";T=x;break}if(M=="]"){T=g;break}throw Error(l);case b:if(M=="~"){s.contains=true;T=y;break}if(M=="="){s.attrValue="";
T=x;break}if(M=="]"){T=g;break}if(M.match(a))break;throw Error(l);case y:if(M=="="){s.attrValue="";T=x;break}throw Error(l);case C:if(M=="]"){T=g;break}if(M.match(a))break;throw Error(l);case x:if(M.match(a))break;if(M=='"'||M=="'"){d=M;T=S;break}s.attrValue+=M;T=k;break;case k:if(M.match(a)){T=C;break}if(M=="]"){T=g;break}if(M=="'"||M=='"')throw Error(l);s.attrValue+=M;break;case S:if(M==d){T=C;break}s.attrValue+=M;break;case E:if(M.match(a))break;if(M==","){T=c;break}throw Error(l)}}switch(T){case c:case f:case g:case v:case E:o();break;default:throw Error(l)}if(!i.length)throw Error(l);return i};e.nextUid=1;e.matchesSelector=function(){var e=document.createElement("div");if(typeof e["webkitMatchesSelector"]==="function")return"webkitMatchesSelector";if(typeof e["mozMatchesSelector"]==="function")return"mozMatchesSelector";if(typeof e["msMatchesSelector"]==="function")return"msMatchesSelector";return"matchesSelector"}();return e}();var m=/^([a-zA-Z:_]+[a-zA-Z0-9_\-:\.]*)$/;function v(e){
if(typeof e!="string")throw Error("Invalid request opion. attribute must be a non-zero length string.");e=e.trim();if(!e)throw Error("Invalid request opion. attribute must be a non-zero length string.");if(!e.match(m))throw Error("Invalid request option. invalid attribute name: "+e);return e}function _(e){if(!e.trim().length)throw Error("Invalid request option: elementAttributes must contain at least one attribute.");var t={};var i={};var n=e.split(/\s+/);for(var s=0;s<n.length;s++){var o=n[s];if(!o)continue;var o=v(o);var r=o.toLowerCase();if(t[r])throw Error("Invalid request option: observing multiple case variations of the same attribute is not supported.");i[o]=true;t[r]=true}return Object.keys(i)}function w(e){var t={};e.forEach(function(e){e.qualifiers.forEach(function(e){t[e.attrName]=true})});return Object.keys(t)}var b=function(){function e(t){var n=this;this.connected=false;this.options=e.validateOptions(t);this.observerOptions=e.createObserverOptions(this.options.queries);this.root=this.options.rootNode;
this.callback=this.options.callback;this.elementFilter=Array.prototype.concat.apply([],this.options.queries.map(function(e){return e.elementFilter?e.elementFilter:[]}));if(!this.elementFilter.length)this.elementFilter=undefined;this.calcReordered=this.options.queries.some(function(e){return e.all});this.queryValidators=[];if(e.createQueryValidator){this.queryValidators=this.options.queries.map(function(t){return e.createQueryValidator(n.root,t)})}this.observer=new i(function(e){n.observerCallback(e)});this.reconnect()}e.createObserverOptions=function(e){var t={childList:true,subtree:true};var i;function n(e){if(t.attributes&&!i)return;t.attributes=true;t.attributeOldValue=true;if(!e){i=undefined;return}i=i||{};e.forEach(function(e){i[e]=true;i[e.toLowerCase()]=true})}e.forEach(function(e){if(e.characterData){t.characterData=true;t.characterDataOldValue=true;return}if(e.all){n();t.characterData=true;t.characterDataOldValue=true;return}if(e.attribute){n([e.attribute.trim()]);return}var i=w(e.elementFilter).concat(e.attributeList||[]);
if(i.length)n(i)});if(i)t.attributeFilter=Object.keys(i);return t};e.validateOptions=function(t){for(var i in t){if(!(i in e.optionKeys))throw Error("Invalid option: "+i)}if(typeof t.callback!=="function")throw Error("Invalid options: callback is required and must be a function");if(!t.queries||!t.queries.length)throw Error("Invalid options: queries must contain at least one query request object.");var n={callback:t.callback,rootNode:t.rootNode||document,observeOwnChanges:!!t.observeOwnChanges,oldPreviousSibling:!!t.oldPreviousSibling,queries:[]};for(var s=0;s<t.queries.length;s++){var o=t.queries[s];if(o.all){if(Object.keys(o).length>1)throw Error("Invalid request option. all has no options.");n.queries.push({all:true});continue}if("attribute"in o){var r={attribute:v(o.attribute)};r.elementFilter=g.parseSelectors("*["+r.attribute+"]");if(Object.keys(o).length>1)throw Error("Invalid request option. attribute has no options.");n.queries.push(r);continue}if("element"in o){var a=Object.keys(o).length;
var r={element:o.element,elementFilter:g.parseSelectors(o.element)};if(o.hasOwnProperty("elementAttributes")){r.attributeList=_(o.elementAttributes);a--}if(a>1)throw Error("Invalid request option. element only allows elementAttributes option.");n.queries.push(r);continue}if(o.characterData){if(Object.keys(o).length>1)throw Error("Invalid request option. characterData has no options.");n.queries.push({characterData:true});continue}throw Error("Invalid request option. Unknown query request.")}return n};e.prototype.createSummaries=function(e){if(!e||!e.length)return[];var t=new l(this.root,e,this.elementFilter,this.calcReordered,this.options.oldPreviousSibling);var i=[];for(var n=0;n<this.options.queries.length;n++){i.push(new c(t,this.options.queries[n]))}return i};e.prototype.checkpointQueryValidators=function(){this.queryValidators.forEach(function(e){if(e)e.recordPreviousState()})};e.prototype.runQueryValidators=function(e){this.queryValidators.forEach(function(t,i){if(t)t.validate(e[i]);
})};e.prototype.changesToReport=function(e){return e.some(function(e){var t=["added","removed","reordered","reparented","valueChanged","characterDataChanged"];if(t.some(function(t){return e[t]&&e[t].length}))return true;if(e.attributeChanged){var i=Object.keys(e.attributeChanged);var n=i.some(function(t){return!!e.attributeChanged[t].length});if(n)return true}return false})};e.prototype.observerCallback=function(e){if(!this.options.observeOwnChanges)this.observer.disconnect();var t=this.createSummaries(e);this.runQueryValidators(t);if(this.options.observeOwnChanges)this.checkpointQueryValidators();if(this.changesToReport(t))this.callback(t);if(!this.options.observeOwnChanges&&this.connected){this.checkpointQueryValidators();this.observer.observe(this.root,this.observerOptions)}};e.prototype.reconnect=function(){if(this.connected)throw Error("Already connected");this.observer.observe(this.root,this.observerOptions);this.connected=true;this.checkpointQueryValidators()};e.prototype.takeSummaries=function(){
if(!this.connected)throw Error("Not connected");var e=this.createSummaries(this.observer.takeRecords());return this.changesToReport(e)?e:undefined};e.prototype.disconnect=function(){var e=this.takeSummaries();this.observer.disconnect();this.connected=false;return e};e.NodeMap=n;e.parseElementFilter=g.parseSelectors;e.optionKeys={callback:true,queries:true,rootNode:true,oldPreviousSibling:true,observeOwnChanges:true};return e}();exports.MutationSummary=b});define("qtext2/mutations",["shared/polyfills","qtext2/base","qtext2/section","qtext2/sections/plain","qtext2/span","qtext2/position","qtext2/util","shared/log","shared/util","shared/Class","third_party/mutation-summary"],function dr(require,exports,e){var t=require("qtext2/base"),i=t.Doc,n=require("qtext2/section"),s=n.Section,o=require("qtext2/sections/plain").PlainSection,r=require("qtext2/span").Span,a=require("qtext2/position").Position,d=require("qtext2/util").Util,l=require("shared/log").log,c=require("shared/util").extend,u=require("shared/Class").Class;
l=l.bind(l,"qtext2");var h=function(){l.apply(l,arguments)};exports.MutationFixer=u.extend({__init__:function(e){this.doc=e;try{var t=require("third_party/mutation-summary");this.mutationSummary=new t.MutationSummary({rootNode:e.node,observeOwnChanges:false,queries:[{all:true}],callback:this.handleMutationSummaries.bind(this)})}catch(i){h("Mutation summary initialization failed.")}},pause:function(){this.mutationSummary.disconnect()},resume:function(){this.mutationSummary.reconnect()},handleMutationSummaries:function(e){var t=e[0];h("Mutation summary",t);this.handleNodesAdded(t);this.handleNodesRemoved(t);this.handleNodeAttributeChanges(t);this.doc.trigger("meaningfulChange")},handleNodesAdded:function(e){var t=e.added;if(!(t&&t.length!==0)){return}var i=this;t.forEach(function(e){try{i._handleNodeAdded(e)}catch(t){h("Error while handling added node",t,t.stack)}})},_handleNodeAdded:function(e){if(this.isValidQText2Node(e)){h("Valid qtext2 node added",e);return}if(!e.parentElement){h("Node detached from a previous operation",e);
return}if(!this.isValidQText2Node(e.parentElement)){h("Skipping invalid node added",e);h("Processing node.parentElement instead",e.parentElement);return}h("Fixing invalid node added:",e,e.parentElement);var t;if(this.isQText2SpanContent(e.parentElement)){t=this._handleNodeAddedToSpanContent(e)}else if(this.isQText2Span(e.parentElement)){t=this._handleNodeAddedToSpan(e,this.getQText2Span(e.parentElement))}else if(this.isQText2Container(e.parentElement)){t=this._handleNodeAddedToContainer(e,this.getQText2Container(e.parentElement))}else{h("Unhandled node.",e,e.parentElement)}if(t){this.doc.moveCaret(t)}return},_handleNodeAddedToSpanContent:function(e){var t=this.getQText2Span(e.parentElement.parentElement),i=this._getModifiersFromNode(e),n,s,o,a,d;if(this.nodeShouldBeSingleChild(e)){n=t.parent;s=t.previous();o=s?s.last():t.next().first();n.removeChild(t);return o}n=t.parent;a=e.parentElement.childNodes[0];d=true;while(a){if(a==e){d=false}else{n.insertBefore(new r(a.textContent,t.modifiers),d?t:t.nextSibling());
}a=a.nextSibling}t.setText(e.textContent);this._applyModifier(t,i);this.safeRemoveNodeFromDom(e);return t.last()},_handleNodeAddedToSpan:function(e,t,i){i=c(this._getModifiersFromNode(e),i||{});var n=t.node.textContent,s=e,o=e.textContent.length;while(s.previousSibling){s=s.previousSibling;o+=s.textContent.length}var r=Array.prototype.slice.call(t.node.childNodes);for(var d=0;d<r.length;d++){if(r[d]!=t._content){this.safeRemoveNodeFromDom(r[d])}}if(!t._content){t._content=t.createContentNode()}if(t.node!=t._content.parentElement){t.node.appendChild(t._content)}t.setText(n);this._applyModifier(t,i);return new a(t,o)},_handleNodeAddedToContainer:function(e,t,i){i=c(this._getModifiersFromNode(e),i||{});var n=this.doc,s,a,l,u;if(t.hasChild(this.getQText2Container(e))){this._applyModifiersToContainer(this.getQText2Container(e),i);return}t.children.forEach(function(e){if(!n.contains(e.node)){t.removeChild(e)}});if(d.isTextNode(e)){if(t.kind=="section"){a=s=new r(e.textContent,i)}else if(t.kind=="doc"){
s=new r(e.textContent,i);a=new o([s])}this._replaceNodeWithContainer(e,a,t);u=a.last()}else if(e.nodeName=="BR"){if(t.kind=="section"){u=this._splitSectionAtNode(e,t)}else if(t.kind=="doc"){a=new o;this._replaceNodeWithContainer(e,a,t);u=a.first()}}l=this._emptyNodeContents(e);for(var h=0;h<l.length;h++){u=this._handleNodeAddedToContainer(l[h],t,i)}return u},_emptyNodeContents:function(e){var t=Array.prototype.slice.call(e.childNodes);for(var i=0;i<t.length;i++){e.parentElement.insertBefore(t[i],e)}this.safeRemoveNodeFromDom(e);return t},_splitSectionAtNode:function(e,t){var i,n;i=this.getQText2Span(e.nextSibling);if(i){n=i.first()}i=this.getQText2Span(e.previousSibling);if(i){n=i.last()}this.safeRemoveNodeFromDom(e);n=n||t.last();return t.split(n)},_replaceNodeWithContainer:function(e,t,i){var n;n=this.getQText2Container(e.nextSibling,t.Class);if(n){i.insertBefore(t,n);this.safeRemoveNodeFromDom(e);return}n=this.getQText2Container(e.previousSibling,t.Class);if(n){i.insertAfter(t,n);this.safeRemoveNodeFromDom(e);
return}i.appendChild(t);i.node.insertBefore(t.node,i.node.firstElementChild);this.safeRemoveNodeFromDom(e)},safeRemoveNodeFromDom:function(e){if(!e.parentElement){return}d.safeRemoveChild(e,e.parentElement)},_getQText2ContainerType:function(e,t){return t.is(e)&&t.get(e)},isQText2SpanContent:function(e){return!!e.qtextSpanContent},getQText2Span:function(e){return this._getQText2ContainerType(e,r)},isQText2Span:function(e){return!!this.getQText2Span(e)},getQText2Section:function(e){return this._getQText2ContainerType(e,s)},isQText2Section:function(e){return!!this.getQText2Section(e)},getQText2Doc:function(e){return this._getQText2ContainerType(e,i)},isQText2Doc:function(e){return!!this.getQText2Doc(e)},isValidQText2Node:function(e){if(!e){return false}if(this.isQText2Container(e)){return true}if(this.isQText2SpanContent(e)){return true}if(!e.parentElement){return false}if(this.isQText2SpanContent(e.parentElement)){if(d.isTextNode(e)){return true}if(this.nodeShouldBeSingleChild(e)){var t=this.getQText2Span(e.parentElement.parentElement);
return t&&t.parent.children.length==1}}return false},nodeShouldBeSingleChild:function(e){return e&&(e.nodeName=="IMG"||e.nodeName=="BR"||e.nodeName=="IFRAME"||e.nodeName=="TWITTERWIDGET"||e.className=="twitter-tweet")},getQText2Container:function(e){var t=[r,s,i];var n;for(var o=0;o<t.length;o++){n=this._getQText2ContainerType(e,t[o]);if(n){break}}return n},isQText2Container:function(e){return!!this.getQText2Container(e)},handleNodesRemoved:function(e){var t=e.removed;if(!(t&&t.length!==0)){return}var i=this;t.forEach(function(t){try{i._handleNodeRemoved(t,e.getOldParentNode(t))}catch(n){h("Error while handling removed node",n,n.stack)}})},_handleNodeRemoved:function(e,t){var n,o;if(r.is(t)){n=r.get(t);o=n.parent;if(this.doc.contains(t)||this.doc.hasChild(o)&&o.hasChild(n)){o.removeChild(n);if(o.children.length===0){this.doc.removeChild(o)}}}else if(s.is(t)){o=s.get(t);if(!o){return}if(r.is(e)){n=r.get(e);if(o.hasChild(n)){o.removeChild(n)}}if(o.children.length===0){this.doc.removeChild(o);
}}else if(i.is(t)){if(s.is(e)){o=s.get(e);if(this.doc.hasChild(o)){this.doc.removeChild(o)}}}if(!this.doc.node.firstElementChild){this.doc.clear();this.doc.focus()}},handleNodeAttributeChanges:function(e){var t=e.attributeChanged;if(t.style&&t.style.length){t.style.forEach(this._handleNodeStyleAttributeChanged.bind(this))}},_handleNodeStyleAttributeChanged:function(e){h("Fixing external node style changes:",e);var t=this._getModifiersFromNode(e);e.style.cssText="";var i=[];if(r.is(e)){i.push(r.get(e))}else if(r.is(e.parentElement)){i.push(r.get(e.parentElement))}else if(s.is(e)){var n=s.get(e);var o=n.firstChild();while(o){i.push(o);o=o.nextSibling()}}this._applyModifiers(i,t)},_getModifiersFromNode:function(e){var t={};if(e.style){var i=e.style.cssText;i=i.replace(/\s|;/g,"");if(i=="font-weight:bold"){t.bold=true}else if(i=="font-weight:normal"){t.bold=false}else if(i=="text-decoration:none"){t.underline=false}else if(i=="text-decoration:underline"){t.underline=false}}var n={B:"bold",STRONG:"bold",
I:"italic",EM:"italic"}[e.nodeName];if(n){t[n]=true}return t},_applyModifiers:function(e,t){var i=this;e.forEach(function(e){i._applyModifier(e,t)})},_applyModifiersToContainer:function(e,t){var i=[];if(e.kind=="span"){i=[e]}else if(e.kind=="section"){i=e.children}else if(e.kind=="doc"){e.children.forEach(function(e){i.push.apply(i,e.children)})}this._applyModifiers(i,t)},_applyModifier:function(e,t){var i=Object.keys(t);for(var n=0;n<i.length;n++){var s=i[n];if(t[s]){e.setModifier(s,true)}else{e.removeModifier(s)}}}})});define("shared/parse_html",["shared/polyfills","shared/browser"],function lr(require,exports,e){var t=require("shared/browser");exports.htmlToNode=function(e){var i;if(!(t.msie&&t.version<9)&&document.implementation&&document.implementation.createHTMLDocument){var n=document.implementation.createHTMLDocument("title for old FF versions");i=n.createElement("DIV")}else{i=document.createElement("DIV")}i.innerHTML=e;return i}});define("qtext2/parser",["shared/polyfills","shared/Class","shared/log","qtext2/util","shared/util","qtext2/position","shared/parse_html","qtext2/span","qtext2/base","qtext2/constants","qtext2/sections/plain","qtext2/sections/code","qtext2/sections/lists","qtext2/sections/image","qtext2/sections/horizontal_rule"],function cr(require,exports,e){
var t=require("shared/Class").Class,i=require("shared/log").log,n=require("qtext2/util").Util,s=require("shared/util").extend,o=require("qtext2/position").Position,r=require("shared/parse_html").htmlToNode,a=require("qtext2/span").Span,d=require("qtext2/base"),l=d.Doc,c=require("qtext2/constants").CONTENT_TYPES,u=require("qtext2/sections/plain").PlainSection,h=require("qtext2/sections/code").CodeSection,f=require("qtext2/sections/lists").UnorderedListSection,p=require("qtext2/sections/lists").OrderedListSection,g=require("qtext2/sections/image").ImageSection,m=require("qtext2/sections/horizontal_rule").HorizontalRuleSection;var v=function(e){return["B","I","U","A","EM","STRONG","MATH","CODE"].indexOf(e)!=-1};var _=function(e){return["OL","UL"].indexOf(e)!=-1};var w=function(e){return["H1","H2","H3","H4","H5"].indexOf(e)!=-1};var b=function(e){return e=="BLOCKQUOTE"};var y=function(e){var t=["STYLE","LINK"];if(e.nodeType==e.COMMENT_NODE){return true}return t.indexOf(e.nodeName)!=-1};var C=t.extend({
__init__:function(e,t){this.spans=t||[];this.modifiers=s(e,{});this.indent=0;this.content=""},visit:function(e){this._enter(e);this._exit(e)},_visitChildren:function(e){for(var t=e.firstChild;t!==null;t=t.nextSibling){this.visit(t)}},_enter:function(e){if(n.isTextNode(e)){var t=e.textContent;t=t.replace(/\n/g," ");t=t.replace(/ {2,}/g," ");this.content+=t;return}var i=e.nodeName.toUpperCase();if(i=="BR"){this.content+="\n";return}if(this._getModifier(e)){this.modifiers[this._getModifier(e)]=this._getModifierValue(e)}this._visitChildren(e)},_exit:function(e){if(n.isTextNode(e)||e.nodeName.toUpperCase()=="BR"){this._createSpan();return}if(this._getModifier(e)){delete this.modifiers[this._getModifier(e)]}},_createSpan:function(){var e=this.content;if(!e.length){return}e=e.replace(/(\u00a0)+/gm," ");if(this.spans.length>0){var t=this.spans[this.spans.length-1];if(n.jsonEqual(t.modifiers,this.modifiers)){var i=t.getText();t.setText(i+e);this.content="";return}}this.spans.push(new a(e,this.modifiers));
this.content=""},_getModifier:function(e){return{B:"bold",STRONG:"bold",I:"italic",EM:"italic",U:"italic",A:"link",CODE:"code",MATH:"math"}[e.nodeName.toUpperCase()]},_getModifierValue:function(e){return{B:true,I:true,EM:true,U:true,A:{type:"url",url:e.href},CODE:true,MATH:true}[e.nodeName.toUpperCase()]}});var x=function(e,t,i){var n=new C(t,i);n.visit(e);return n.spans};var k=function(e,t){var i,s=e.nodeName.toUpperCase()=="OL"?p:f,o=[],r;t=t||0;n.assert(_(e.nodeName),"Unknown list type",e);for(var a=e.firstElementChild;a;a=a.nextElementSibling){i=a.nodeName.toUpperCase();if(i=="LI"){r=new s(x(a,{}));r.setIndent(t);o.push(r)}else if(_(i)){o=o.concat(k(a,t+1))}}return o};var S=function(e){var t=[],i=new h,n,s;t.push(i);for(s=e.firstChild;s;s=s.nextSibling){if(s.nodeName.toUpperCase()=="BR"){i=new h;t.push(i)}else{n=i.firstChild();n.setText(n.getText()+s.textContent)}}return t};var E=function(e,t){var i,r=[],a,d=new l({});t=t||{};var c=function(){if(r.length){var e=new u(r);if(/\S/.test(e.getText())){
d.appendChild(e);var t=e.firstChild();while(t){var i=t.getText();var n=i.indexOf("\n\n");if(n==-1){t=t.nextSibling();continue}t.setText(i.replace("\n\n",""));t.parent.split(new o(t,n));t=d.lastChild().firstChild()}}r=[]}};for(var h=e.firstChild;h;h=h.nextSibling){i=h.nodeName.toUpperCase();if(i=="SPAN"&&h.textContent.length!==0||n.isTextNode(h)||i=="BR"||v(i)){r=x(h,t,r)}else{c();if(y(h)){}else if(_(i)){d.appendChildren(k(h))}else if(w(i)){d.appendChildren(E(h,s({bold:true},t)))}else if(b(i)){a=E(h);a.forEach(function(e){e.setQuoted(true)});d.appendChildren(a)}else if(i=="HR"){d.appendChild(new m)}else if(i=="PRE"){d.appendChildren(S(h))}else if(i=="IMG"){if(!h.src.startsWith("file://")){d.appendChild(g.fromURL(h.src))}}else{d.appendChildren(E(h))}}}c();d.destroy();return d.children.slice(1,d.children.length)};var T=function(e){var t=r(e),n;n=E(t);i.log("qtext2",t);return n};var L=function(e){var t=[];if(e.length===0){return[]}n.splitLines(e).forEach(function(e){t.push(new u([new a(e)]));
});return t};var M=function(e,t){if(t==c.HTML||t==c.PUBLIC_HTML){return T(e)}if(t==c.TEXT){return L(e)}return[]};exports.parseHTML=T;exports.parseText=L;exports.parse=M});define("qtext2/command/base",["shared/polyfills","shared/Class","qtext2/modifiers"],function ur(require,exports,e){var t=require("shared/Class").Class,i=require("qtext2/modifiers").canForceModifier;var n=exports.Command=t.extend({__init__:function(e){this.doc=e},exec:function(e){throw new Error("Sub-classes should implement this method.")},shouldExec:function(e){return true},run:function(e){if(!this.shouldExec(e)){return true}return this.exec.apply(this,arguments)}});exports.spanModifierToggle=function(e){return n.extend({exec:function(){this.doc.saveState();return this.doc.toggleModifier(e)},shouldExec:function(){var t=this.doc.caret.getCoveringSpans();return t.some(function(t){return t.hasModifier(e)||i(t,e)})}})};exports.sectionTypeToggle=function(e){return n.extend({exec:function(){this.doc.saveState();return this.doc.toggleSectionType(e);
}})};exports.eventProxy=function(e){return n.extend({exec:function(){return this.doc.trigger(e)}})}});define("qtext2/command/backspace",["shared/polyfills","qtext2/command/base","qtext2/position","qtext2/sections/plain"],function hr(require,exports,e){var t=require("qtext2/command/base").Command,i=require("qtext2/position").Position,n=require("qtext2/sections/plain").PlainSection;exports.Backspace=t.extend({exec:function(){this.doc.saveState();var e=this._actualBackspace();this.doc.updateSpellingSuggestions();this.doc.caret.scrollIntoViewIfNeeded();return e},_actualBackspace:function(){var e,t,s,o;if(!this.doc.caret.isCollapsed()){this.doc._deleteSelection(true);return false}s=this.doc.caret.start.clone();e=s.span.parent;t=e.previousSibling();o=s.span.getText();if(!e.isEditable()){if(this.doc.caret.start.atSectionStart()){if(t&&t.isEmpty()){this.doc.removeChild(t)}}else{if(!t){t=new n;this.doc.insertBefore(t,e)}this.doc.removeChild(e);this.doc.moveCaret(t.last());this.doc.caret.updateAndroidCaretPosition();
}return false}if(s.atDocStart()){e=this.doc.progressivelyExitSection(e);this.doc.moveCaret(e.first(),e.first(),true);return false}if(s.atSectionStart()){if(e.getIndent()>0){e.setIndent(e.getIndent()-1);this.doc.caret.updateAndroidCaretPosition()}else{if(!t.isEditable()&&!e.isEmpty()){this.doc.moveCaret(t.last())}else{this.doc.moveCaret(t.merge(e));this.doc.caret.mergeAdjacentSpans()}}return false}if(s.atSpanStart()){s.span=s.span.previous();s.offset=s.span.getLength();o=s.span.getText()}var r=o.slice(0,s.offset),a=o.slice(s.offset),d=0;for(var l=r.length;l>0;l--){if(r[l-1]!="\n"){break}d+=1}if(d==1&&a.startsWith("\n")){a=a.slice(1)}r=r.slice(0,-1);if(s.atSectionEnd()&&r.endsWith("\n")&&d===0){r=r+"\n"}s.span.setText(r+a);if(s.span.isEmpty()){s=this.doc._handleEmptySpan(s.span,true);this.doc.moveCaret(s,s,true)}else{this.doc.moveCaret(new i(s.span,r.length))}return false}})});define("qtext2/command/code",["shared/polyfills","qtext2/command/base","qtext2/sections/code","qtext2/modifiers"],function fr(require,exports,e){
var t=require("qtext2/command/base").Command,i=require("qtext2/sections/code").CodeSection,n=require("qtext2/modifiers").canForceModifier;exports.Code=t.extend({exec:function(){this.doc.saveState();if(this.doc.caret.isCollapsed()){if(this.doc.formattingState.is("code")||!this.doc.allowsMultipleSections()){this.doc.toggleModifier("code")}else{this.doc.toggleSectionType(i)}return false}var e=this.doc._getSelectedSections();var t=e.some(function(e){return!e.isEditable()});if(!t&&this.doc.caret.start.atSectionStart()&&this.doc.caret.end.atSectionEnd()){this.doc.toggleSectionType(i)}else{this.doc._toggleMathOrCodeModifier("code")}return false},shouldExec:function(){if(this.doc.caret.isCollapsed()){return this.doc.caret.start.span.parent.isEditable()}var e=this.doc._getSelectedSections();var t=e.some(function(e){return!e.isEditable()});if(!t&&this.doc.caret.start.atSectionStart()&&this.doc.caret.end.atSectionEnd()){return true}var i=this.doc.caret.getCoveringSpans();return i.some(function(e){
return n(e,"code")})}})});define("qtext2/command/copy",["shared/polyfills","qtext2/command/base","qtext2/section","interface/settings","qtext2/constants","shared/client","shared/browser"],function pr(require,exports,e){var t=require("qtext2/command/base").Command,i=require("qtext2/section").Section,n=require("interface/settings").pageIsMobile,s=require("qtext2/constants").CONTENT_TYPES,o=require("shared/client"),r=require("shared/browser"),a;if(n){a=require("mobile_app2/messages")}exports.Copy=t.extend({exec:function(e,t){if(n&&o.isIOSMobileWeb()){return}if(r.msedge){return}var d=this._selectedSectionsJSON(),l=d.map(i.fromJSON),c=this.getContentForType(l,s.TEXT),u=this.getContentForType(l,s.HTML);t.clipboardData.setData(s.TEXT,c);t.clipboardData.setData(s.HTML,u);t.preventDefault();t.stopPropagation();if(n){if(o.isIOSApp()){a.send("setClipboard",{text:c,html:u})}}if(e=="cut"){this.doc._deleteSelection()}},getContentForType:function(e,t){return e.map(function(i){return i.toContent(t,e)}).join("");
},_selectedSectionsJSON:function(){if(this.doc.caret.isCollapsed()){return[]}var e=[],t=this.doc.caret.start.clone(),i=this.doc.caret.end.clone(),n=t.span,s,o;for(n=t.span;n&&n.previous()!=i.span;n=n.next()){if(t.span===n&&t.atSpanEnd()||i.span===n&&i.atSpanStart()){continue}if(s!=n.parent){s=n.parent;o=s.toJSON();o.spans=[];e.push(o)}var r=t.span===n?t.offset:undefined;var a=i.span===n?i.offset:undefined;o.spans.push(n.toJSON(r,a))}return e}})});define("qtext2/command/delete",["shared/polyfills","qtext2/command/base","qtext2/sections/plain"],function gr(require,exports,e){var t=require("qtext2/command/base").Command,i=require("qtext2/sections/plain").PlainSection;exports.Delete=t.extend({exec:function(e){this.doc.saveState();if(this.doc.caret.isCollapsed()){if(e=="delete"){return this._deleteSingle()}if(e=="delete-forward"){this.doc.moveCaretEnd(this.doc.caret.start.span.parent.last())}else if(e=="delete-backward"){this.doc.moveCaretStart(this.doc.caret.start.span.parent.first())}else if(e=="delete-next-word"){
this.doc.moveCaretEnd(this.doc.caret.start.nextWordBoundary())}else if(e=="delete-previous-word"){this.doc.moveCaretStart(this.doc.caret.start.previousWordBoundary())}}return this._deleteSelection()},_deleteSelection:function(){if(!this.doc.caret.isCollapsed()){this.doc._deleteSelection(false);return false}},_deleteSingle:function(){var e,t,n;n=this.doc.caret.start.clone();e=n.span.parent;t=e.nextSibling();if(!this.doc.caret.isCollapsed()){return}if(!e.isEditable()){if(this.doc.caret.start.atSectionEnd()){if(t&&t.isEmpty()){this.doc.removeChild(t)}}else{if(!t){t=new i;this.doc.insertBefore(t,e)}this.doc.removeChild(e);this.doc.moveCaret(t.first());this.doc.caret.updateAndroidCaretPosition()}return false}if(n.atDocEnd()){return false}if(n.atSectionEnd()){e=n.span.parent;this.doc.moveCaret(e.merge(e.nextSibling()));return false}if(n.atSpanEnd()){n.span=n.span.next();n.offset=0}n.span.deleteText(n.offset,n.offset+1);if(n.span.isEmpty()){this.doc.moveCaret(this.doc._handleEmptySpan(n.span,true));
}else{this.doc.moveCaret(n)}return false}})});define("qtext2/command/indent",["shared/polyfills","qtext2/command/base","qtext2/sections/code","qtext2/position"],function mr(require,exports,e){var t=require("qtext2/command/base").Command,i=require("qtext2/sections/code").CodeSection,n=require("qtext2/position").Position;exports.Indent=t.extend({exec:function(e){if(e=="indent"){return this._indent()}else{return this._deindent()}},_maybeInsertTab:function(){var e=this.doc.caret.isCollapsed(),t=this.doc.caret.start.clone(),s=t.span,o=s.parent,r=s.getText(),a=t.offset;if(e&&o instanceof i){s.setText(r.slice(0,a)+"	"+r.slice(a));this.doc.moveCaret(new n(s,a+1));return true}return false},_afterIndent:function(e){if(e){this.doc.forceDomReflow()}this.doc.updateCaret()},_indent:function(){if(this._maybeInsertTab()){return false}var e=this.doc._getSelectedSections();var t=false;e.forEach(function(e){if(e.setIndent(e.getIndent()+1)){t=true}});this._afterIndent(t);return!t},_deindent:function(){var e=this.doc._getSelectedSections();
var t=false;e.forEach(function(e){if(e.setIndent(e.getIndent()-1)){t=true}});this._afterIndent(t);return!t}})});define("qtext2/command/image",["shared/polyfills","qtext2/command/base","qtext2/sections/image","qtext2/sections/plain","qtext2/sections/lists"],function vr(require,exports,e){var t=require("qtext2/command/base").Command,i=require("qtext2/sections/image").ImageSection,n=require("qtext2/sections/plain").PlainSection,s=require("qtext2/sections/lists").OrderedListSection;exports.Image=t.extend({exec:function(e,t){if(t.length===0){return}this.doc.saveState();var o=this.doc.caret.start.clone(),r=o.span.parent,a,d;if(o.atSectionStart()){a=r}else{if(!o.atSectionEnd()){r.split(o)}a=r.nextSibling()}for(d=0;d<t.length;d++){this.doc.insertBefore(i.fromURL(t[d]),a)}if(!a){a=new n;this.doc.appendChild(a)}this.doc.moveCaret(a.first());if(a instanceof s){this.doc.forceDomReflow()}}})});define("qtext2/command/link",["shared/polyfills","qtext2/command/base","qtext2/span","qtext2/util","qtext2/position","qtext2/extension/link_interaction","qtext2/modifiers"],function _r(require,exports,e){
var t=require("qtext2/command/base").Command,i=require("qtext2/span").Span,n=require("qtext2/util").Util,s=require("qtext2/position").Position,o=require("qtext2/extension/link_interaction").linkInteractionEnabled,r=require("qtext2/modifiers").canForceModifier;exports.Link=t.extend({exec:function(){var e=this.doc.caret.start.span,t,i,n;if(!e.isEditable()){return false}if(e.hasModifier("link")){if(!this.doc.caret.isCollapsed()){this.doc.saveState()}this.doc.formattingState.toggleModifier(this.doc.caret,"link");this.doc._getSelectedSpans(true).forEach(function(e){e.removeModifier("link")});if(!o()){return false}t=e.getModifier("link");n=false}else if(e.hasModifier("citation")){t=e.getModifier("citation").target;n=true}if(t){i=t.url}this.doc.linkSelector.getExternalURL(this.onLinkInput.bind(this),i,n);return false},shouldExec:function(){return r(this.doc.caret.start.span,"link")},onLinkInput:function(e){var t=this.doc.caret.isCollapsed(),r=this.doc.caret.start.clone(),a=this.doc._getSelectedSpans(true),d=e.url,l=e.isCitation,c=this.doc.caret.start.span,u=l&&c.hasModifier("citation")||!l&&c.hasModifier("link"),h=u?c.getText():d,f,p,g;
this.doc.saveState();if(d){d=n.ensureProtocol(d);f={type:"url",url:d};if(!l){a=this.doc._mergeSpansBySection(a)}if(t){p=this.doc._insertOrModifyLink(h,f,l,!o());r=new s(p.nextSibling(),1)}else{if(l){p=new i(" ",{citation:{target:f}});g=a[a.length-1];g.parent.insertAfter(p,g)}else{a.forEach(function(e){e.setModifier("link",f)})}}if(p&&!(c.hasModifier("link")&&u)){this.doc._previewLink(p)}}else if(o()&&t){c.removeModifier("link");c.removeModifier("citation")}this.doc.node.focus();if(t){this.doc.moveCaret(r)}else{this.doc.moveCaret(a[0].first(),a[a.length-1].last())}this.doc.caret.scrollIntoViewIfNeeded()}})});define("qtext2/command/math",["shared/polyfills","qtext2/command/base","qtext2/modifiers"],function wr(require,exports,e){var t=require("qtext2/command/base").Command,i=require("qtext2/modifiers").canForceModifier;exports.Math=t.extend({exec:function(){this.doc.saveState();if(this.doc.caret.isCollapsed()){this.doc.formattingState.toggleModifier(this.doc.caret,"math")}else{this.doc._toggleMathOrCodeModifier("math");
}return false},shouldExec:function(){var e=this.doc.caret.getCoveringSpans(false);return e.some(function(e){return i(e,"math")})}})});define("qtext2/command/mention",["shared/polyfills","qtext2/command/base","qtext2/constants","settings"],function br(require,exports,e){var t=require("qtext2/command/base").Command,i=require("qtext2/constants"),n=require("settings").pageIsMobile;exports.Mention=t.extend({exec:function(e,t){if(!this.doc._shouldAllowLinks()){return}if(this.doc.linkSelector.isActive()){return}if(t=="@"){var s=this.doc.caret.charBefore();if(s&&!i.WORD_START_REGEX.test(s)){return}}this.doc.focus();if(n){this.doc.linkSelector.show(t)}else{var o=this.doc.caret.getAbsolutePosition()||{};this.doc.linkSelector.show(t,o.left,o.top)}return false}})});define("qtext2/command/paste",["shared/polyfills","qtext2/command/base","qtext2/parser","qtext2/constants"],function yr(require,exports,e){var t=require("qtext2/command/base").Command,i=require("qtext2/parser"),n=require("qtext2/constants").CONTENT_TYPES,s=[n.PUBLIC_HTML,n.HTML,n.TEXT];
exports.Paste=t.extend({exec:function(e,t){if(!t.clipboardData||!t.clipboardData.types||!t.clipboardData.getData){return false}var i=this,n;s.some(function(e){for(var s=0;s<t.clipboardData.types.length;s++){if(t.clipboardData.types[s]==e){n=t.clipboardData.getData(e);if(n){t.stopImmediatePropagation();i.doc.saveState();i._paste(n,e);return true}}}});return false},_paste:function(e,t){var n=i.parse(e,t);n=this.doc.sanitizeContent(n);this.doc._insertSections(n)}})});define("qtext2/command/quote",["shared/polyfills","qtext2/command/base","qtext2/sections/lists"],function Cr(require,exports,e){var t=require("qtext2/command/base").Command,i=require("qtext2/sections/lists").isListSection;exports.Quote=t.extend({exec:function(){var e=this.doc._getSelectedSections(),t=e[0],n=t.isQuoted(),s=[],o,r;this.doc.saveState();while(i(t)){o=t.previousSibling();if(o&&o.getType()==t.getType()){s.push(o);t=o}else{break}}t=e[e.length-1];while(i(t)){r=t.nextSibling();if(r&&r.getType()==t.getType()){s.push(r);t=r;
}else{break}}e=e.concat(s);e.forEach(function(e){e.setQuoted(!n)});return false}})});define("qtext2/command/return",["shared/polyfills","qtext2/command/base","qtext2/sections/plain","qtext2/sections/code"],function xr(require,exports,e){var t=require("qtext2/command/base").Command,i=require("qtext2/sections/plain").PlainSection,n=require("qtext2/sections/code").CodeSection;exports.Return=t.extend({exec:function(){this.doc.saveState();var e=this._actualReturn();this.doc.updateSpellingSuggestions();this.doc.caret.scrollIntoViewIfNeeded();this.doc.caret.updateAndroidCaretPosition();return e},_actualReturn:function(){var e,t,s,o,r;if(!this.doc.caret.isCollapsed()){this.doc._deleteSelection(false)}e=this.doc.caret.start.span.parent;t=e.previousSibling();s=t&&t.isEmpty();r=this.doc.caret.start.clone();if(!e.isEditable()){o=new i;if(this.doc.caret.start.atSectionStart()){this.doc.insertBefore(o,e)}else{this.doc.insertBefore(o,e.nextSibling());this.doc.moveCaret(o.first())}return false}if(!e.isEmpty()&&e.node.textContent.trim()!==""){
r=e.split(r)}else if(e instanceof n&&t instanceof n&&!s){r=e.split(r)}else if(e instanceof i&&!e.isQuoted()&&e.getIndent()===0){r=e.split(r)}else{e=this.doc.progressivelyExitSection(e);r=e.first()}this.doc.moveCaret(r);this.doc.trigger("command-return");return false}})});define("qtext2/command/soft_return",["shared/polyfills","qtext2/command/base","qtext2/sections/code","qtext2/position"],function kr(require,exports,e){var t=require("qtext2/command/base").Command,i=require("qtext2/sections/code").CodeSection,n=require("qtext2/position").Position;exports.SoftReturn=t.extend({exec:function(){var e=this.doc.caret.start,t=e.span,s=e.offset,o=t.parent,r=t.getText(),a=this.doc.caret.charBefore()=="\n";if(!o.isEditable()){return this.doc.handleCommand("return")}this.doc.saveState();if(o instanceof i){var d=o.split(e);this.doc.moveCaret(d);return false}if(!o.allowsMultipleSoftReturns()){if(a){while(r.endsWith("\n")){r=r.slice(0,-1)}t.setText(r);return this.doc.handleCommand("return")}}if(e.atSectionEnd()){
t.setText(r+"\n\n");this.doc.moveCaret(t.last())}else{t.setText(r.slice(0,s)+"\n"+r.slice(s));this.doc.moveCaret(new n(t,s+1))}this.doc.moveCaret(new n(t,s+1));return false}})});define("qtext2/command/undoredo",["shared/polyfills","qtext2/command/base","qtext2/util"],function Sr(require,exports,e){var t=require("qtext2/command/base").Command,i=require("qtext2/util").Util;exports.UndoRedo=t.extend({exec:function(e){if(e=="undo"){return this._undo()}else{return this._redo()}},_undo:function(){if(!this.doc.undoManager.canRedo()){if(!i.jsonEqual(this.doc.toJSON(),this.doc.undoManager.state())){this.doc.saveState()}}this.doc.undoManager.undo();this.doc.fromJSON(this.doc.undoManager.state());return false},_redo:function(){this.doc.undoManager.redo();this.doc.fromJSON(this.doc.undoManager.state());return false}})});define("qtext2/command/video",["shared/polyfills","qtext2/command/base","qtext2/sections/embed"],function Er(require,exports,e){var t=require("qtext2/command/base").Command,i=require("qtext2/sections/embed").EmbedSection;
exports.Video=t.extend({exec:function(e,t){t.forEach(function(e,n){var s=i.fromOtherSection(e);if(s!==null){t[n]=s}})}})});define("qtext2/commands",["shared/polyfills","qtext2/command/base","qtext2/command/backspace","qtext2/command/code","qtext2/command/copy","qtext2/command/delete","qtext2/command/indent","qtext2/command/image","qtext2/command/link","qtext2/command/math","qtext2/command/mention","qtext2/command/paste","qtext2/command/quote","qtext2/command/return","qtext2/command/soft_return","qtext2/command/undoredo","qtext2/command/video","qtext2/sections/lists"],function Tr(require,exports,e){var t=require("qtext2/command/base"),i=require("qtext2/command/backspace").Backspace,n=require("qtext2/command/code").Code,s=require("qtext2/command/copy").Copy,o=require("qtext2/command/delete").Delete,r=require("qtext2/command/indent").Indent,a=require("qtext2/command/image").Image,d=require("qtext2/command/link").Link,l=require("qtext2/command/math").Math,c=require("qtext2/command/mention").Mention,u=require("qtext2/command/paste").Paste,h=require("qtext2/command/quote").Quote,f=require("qtext2/command/return").Return,p=require("qtext2/command/soft_return").SoftReturn,g=require("qtext2/command/undoredo").UndoRedo,m=require("qtext2/command/video").Video,v=require("qtext2/sections/lists").OrderedListSection,_=require("qtext2/sections/lists").UnorderedListSection;
exports.COMMANDS={backspace:i,cite:d,code:n,copy:s,cut:s,deindent:r,"delete":o,"delete-backward":o,"delete-forward":o,"delete-next-word":o,"delete-previous-word":o,indent:r,image:a,link:d,math:l,mention:c,paste:u,quote:h,redo:g,"return":f,"soft-return":p,undo:g,video:m,bold:t.spanModifierToggle("bold"),italic:t.spanModifierToggle("italic"),ordered_list:t.sectionTypeToggle(v),unordered_list:t.sectionTypeToggle(_),space:t.eventProxy("command-space")}});define("qtext2/extension/tooltips",["shared/polyfills","qtext2/extension/base","qtext2/util","qtext2/tooltip"],function $r(require,exports,e){var t=require("qtext2/extension/base").Extension,i=require("qtext2/util").Util,n=require("qtext2/tooltip");exports.Tooltips=t.extend({install:function(){this._activeLinkSpan=null;this.doc.on("caretMoved",this.onCaretMoved.bind(this));this.doc.on("blur",this.onDocBlur.bind(this))},destroy:function(){this._hideTooltip()},onDocBlur:function(){this._hideTooltip()},onCaretMoved:function(){this._maybeShowTooltip();
},_maybeShowTooltip:function(){if(this._shouldShowTooltip()){this._showTooltip()}else{this._hideTooltip()}},_shouldShowTooltip:function(){var e=this.doc.caret.start.span;return e.hasModifier("link")||e.hasModifier("citation")},_showTooltip:function(){var e=this.doc.caret.start.span,t,s;if(e.hasModifier("link")){s=e.getModifier("link")}else if(e.hasModifier("citation")){t=e.getModifier("citation");s=t.target}if(!(s&&s.url)){return}if(this._activeLinkSpan===e){return}this._activeLinkSpan=e;var o=i.create("a");o.target="_blank";o.rel="noreferrer nofollow";o.href=s.url;o.textContent=s.url;n.show(e.node,o)},_hideTooltip:function(){this._activeLinkSpan=null;n.hide()}})});define("qtext2/extension/autolist",["shared/polyfills","qtext2/extension/base","qtext2/position","qtext2/sections/plain","qtext2/sections/lists","qtext2/constants"],function Lr(require,exports,e){var t=require("qtext2/extension/base").Extension,i=require("qtext2/position").Position,n=require("qtext2/sections/plain").PlainSection,s=require("qtext2/sections/lists").UnorderedListSection,o=require("qtext2/sections/lists").OrderedListSection,r=require("qtext2/constants");
exports.Autolist=t.extend({install:function(){this.doc.on("command-space",this.onSpace.bind(this))},onSpace:function(){if(!this.shouldAutoList()){return}var e=this.doc.caret.start.clone();var t=e.span;var n=t.parent;var a=e.offset;var d=t.getText();var l=d.slice(0,a);var c=new RegExp("^([-*+]|--|"+r.EM_DASH+")$");var u=/^1[.)]$/;if(n.firstChild()!=t){return}if(!(c.test(l)||u.test(l))){return}var h=c.exec(l)||u.exec(l);h=h[0];t.setText(d.slice(0,h.length)+" "+d.slice(h.length));this.doc.moveCaret(new i(t,h.length+1));this.doc.saveState();if(c.test(l)){this.doc.toggleSectionType(s)}else{this.doc.toggleSectionType(o)}t.setText(d.slice(h.length));if(t.getText()===""&&!t.nextSibling()){t.setPlaceholder()}this.doc.moveCaret(t.first(),null,true);return false},shouldAutoList:function(){if(this.doc.isDisabledCommand("ordered_list")||this.doc.isDisabledCommand("unordered_list")){return false}var e=this.doc.caret.isCollapsed(),t=this.doc.caret.start.span,i=t.parent;if(!e){return false}if(t.hasModifier("link")||t.hasModifier("math")||t.hasModifier("code")){
return false}return i instanceof n}})});define("qtext2/extension/autolink",["shared/polyfills","qtext2/extension/base","qtext2/span","qtext2/util","qtext2/position"],function Mr(require,exports,e){var t=require("qtext2/extension/base").Extension,i=require("qtext2/span").Span,n=require("qtext2/util").Util,s=require("qtext2/position").Position;exports.Autolink=t.extend({install:function(){this.doc.on("command-space",this.onSpace.bind(this));this.doc.on("command-return",this.onReturn.bind(this))},onSpace:function(){return this.detectLinksBeforeCaret()},onReturn:function(){return this.detectLinksBeforeCaret(true)},detectLinksBeforeCaret:function(e){var t=this.doc.caret.start,i=t.span;if(e&&t.atSectionStart()){i=i.previous();if(!i){return false}t=i.last()}return!this._detectLinks(i,t,!e)},_detectLinks:function(e,t,o){if(!this.doc._shouldAllowLinks(e)){return false}var r=e.parent,a=t||e.last(),d=a.offset,l=a.previousWordBoundary(/\s/),c=e.getText(),u=c.slice(l.offset,d),h=n.linkify(u),f;h.forEach(function(e){
var t=e.text,n=e.href;if(n&&t==u){f=new i(u,{link:{type:"url",url:n}})}else{u=u.slice(t.length)}});if(!f){return false}if(o){e.setText(c.slice(0,d)+" "+c.slice(d));this.doc.moveCaret(new s(e,d+1))}this.doc.saveState();l=new s(a.span,d-u.length);var p=e,g,m;if(l.equals(e.first())&&a.equals(e.last())){if(o){p.setText(" ");m=new s(p,1)}else{p=null}}else{if(!l.equals(e.first())){g=new i(e.getText().slice(0,l.offset),e.modifiers)}if(o){p.setText(" "+p.getText().slice(a.offset));m=new s(p,1)}else if(!a.equals(e.last())){p.setText(p.getText().slice(a.offset))}else{p=null}}if(g){r.insertBefore(g,e)}r.insertBefore(f,e);if(!p){r.removeChild(e)}if(m&&o){this.doc.moveCaret(m)}this.doc._previewLink(f);return true}})});define("qtext2/extension/typing_change_base",["shared/polyfills","qtext2/extension/base","qtext2/sections/code"],function Dr(require,exports,e){var t=require("qtext2/extension/base").Extension,i=require("qtext2/sections/code").CodeSection;exports.TypingExtension=t.extend({install:function(){},
isActive:function(e){if(!e){e=this.doc.caret.selection}var t=e.start.span.parent;if(t instanceof i){return false}if(e.getCoveringSpans().some(function(e){return e.hasModifier("code")||e.hasModifier("math")})){return false}if(this.doc.formattingState.is("code")||this.doc.formattingState.is("math")){return false}return true}})});define("qtext2/extension/ellipses",["shared/polyfills","qtext2/extension/typing_change_base","qtext2/selection","qtext2/constants"],function Ar(require,exports,e){var t=require("qtext2/extension/typing_change_base").TypingExtension,i=require("qtext2/selection").Selection,n=require("qtext2/constants").ELLIPSIS;exports.Ellipses=t.extend({install:function(){this.doc.on("keypress",this.onKeypress.bind(this))},onKeypress:function(e,t){if(t!="."){return}if(!this.isActive()){return}var s=this.doc.caret.start.prevPositionInSection(2);if(!s){return}var o=new i(s,this.doc.caret.start);if(!this.isActive(o)){return}if(o.getText()!=".."){return}var r=o.start.span.parent;r.deleteText(o.start,o.end);
o.start.span.insertText(n,o.start.offset);this.doc.moveCaret(o.start.nextPositionInSection());this.doc.caret.updateAndroidCaretPosition();this.doc.saveState();return false}})});define("qtext2/extension/hr",["shared/polyfills","qtext2/extension/base","qtext2/sections/plain","qtext2/sections/horizontal_rule","qtext2/constants"],function Ir(require,exports,e){var t=require("qtext2/extension/base").Extension,i=require("qtext2/sections/plain").PlainSection,n=require("qtext2/sections/horizontal_rule").HorizontalRuleSection,s=require("qtext2/constants");exports.HR=t.extend({install:function(){this.doc.on("command-return",this.onReturn.bind(this))},onReturn:function(){if(!this.isActive()){return}var e=new RegExp("^([-*+_=]{3,}|["+s.EM_DASH+"-]{2,})$"),t=this.doc.caret.start.clone(),o=t.span,r=o.parent,a=r.previousSibling();if(!a){return}if(a instanceof i&&e.test(a.getText().trim())&&!a.isQuoted()){this.doc.insertBefore(new n,a);this.doc.removeChild(a)}},isActive:function(){return!this.doc.isDisabledCommand("horizontal-rule");
}})});define("qtext2/extension/undo_state",["shared/polyfills","qtext2/extension/base"],function qr(require,exports,e){var t=require("qtext2/extension/base").Extension;exports.UndoState=t.extend({install:function(){this.doc.on("keypress",this.onKeypress.bind(this))},onKeypress:function(e,t){if(t=="."||t==","){this.doc.saveState()}}})});define("qtext2/extension/mention",["shared/polyfills","qtext2/extension/base"],function Nr(require,exports,e){var t=require("qtext2/extension/base").Extension;exports.Mention=t.extend({install:function(){this.doc.on("keypress",this.onKeypress.bind(this))},onKeypress:function(e,t){if(t=="@"){this.doc.handleCommand("mention",t)}}})});define("qtext2/extension/non_editable_cursors",["shared/polyfills","qtext2/extension/base","qtext2/section"],function Or(require,exports,e){var t=require("qtext2/extension/base").Extension,i=require("qtext2/section").Section;exports.NonEditableCursors=t.extend({install:function(){this.doc.on("mousedown",this.onMousedown.bind(this));
this.doc.on("longpress",this.onLongpress.bind(this))},onLongpress:function(e,t){var i=this._sectionFromNode(t.target);if(!i){return}if(i.isEditable()){return}this.doc.moveCaret(i.first(),i.last());this.doc.updateCaret()},onMousedown:function(e,t){var i=this._sectionFromNode(t.target);if(!i){return}if(i.isEditable()){return}var n=t.target.getBoundingClientRect();var s=n.left+document.body.scrollLeft;var o=t.pageX-s;if(t.target.width/2>o){this.doc.moveCaret(i.first())}else{this.doc.moveCaret(i.last())}this.doc.updateCaret()},_sectionFromNode:function(e){var t=e;while(t){if(i.is(t)){return i.get(t)}t=t.parentElement}return null}})});define("qtext2/extension/smart_quotes",["shared/polyfills","qtext2/extension/typing_change_base","qtext2/position","qtext2/selection","qtext2/constants"],function Rr(require,exports,e){var t=require("qtext2/extension/typing_change_base").TypingExtension,i=require("qtext2/position").Position,n=require("qtext2/selection").Selection,s=require("qtext2/constants");exports.SmartQuotes=t.extend({
install:function(){this.initializeConstants();this.doc.on("keypress",this.onKeypress.bind(this));this.doc.on("command-space",this.onSpace.bind(this))},onSpace:function(){if(!this.isActive()){return}var e=this.doc.caret.start.previousWordBoundary(/\s/),t=e.charAfter(),i=this.doc.caret.start;if(t!==null&&e.atSpanEnd()){e=e.span.nextSibling().first()}if(t===s.OPEN_SINGLE_QUOTE){var n=this.doc.caret.previousTextUntil(e).slice(1);if(this.frontApostropheRegex.test(n)){var o=e.span.getText();e.span.setText(o.slice(0,e.offset)+s.CLOSE_SINGLE_QUOTE+o.slice(e.offset+1));this.doc.moveCaret(i)}}},onKeypress:function(e,t){if(!this.isActive()){return}if(t=="'"){this.handleSingleQuote();this.doc.updateSpellingSuggestions();return false}if(t=='"'){this.handleDoubleQuote();this.doc.updateSpellingSuggestions();return false}if(t.toUpperCase()=="S"){if(this.doc.caret.start.charBefore()==s.SINGLE_PRIME){var i=this.doc.caret.start.prevPositionInSection(),n=this.doc.caret.start.span.parent;n.deleteText(i,this.doc.caret.start);
i.span.insertText(s.CLOSE_SINGLE_QUOTE,i.offset);this.doc.moveCaret(i.nextPositionInSection());this.doc.updateSpellingSuggestions();return}}},handleSingleQuote:function(){var e=this.doc.caret.charBefore(),t=s.CLOSE_SINGLE_QUOTE,i=this.doc.caret,o=i.start.span.parent,r=new n(o.first(),i.start);if(e===null||s.WORD_START_REGEX.test(e)){t=s.OPEN_SINGLE_QUOTE}else if(this.primeRegex.test(e)){if(!this.unclosedSingleQuoteRegex.test(r.getText())){t=s.SINGLE_PRIME}}this.insertChar(t)},handleDoubleQuote:function(){var e=this.doc.caret.charBefore(),t=s.CLOSE_DOUBLE_QUOTE,i=this.doc.caret,o=i.start.span.parent,r=new n(o.first(),i.start);if(e===null||/\s|[({[]/.test(e)){t=s.OPEN_DOUBLE_QUOTE}else if(this.primeRegex.test(e)){if(!this.unclosedDoubleQuoteRegex.test(r.getText())){t=s.DOUBLE_PRIME}}this.insertChar(t)},insertChar:function(e){var t=this.doc.caret.start,n=t.span,s=n.getText(),o=t.offset;n.setText(s.slice(0,o)+e+s.slice(o));this.doc.moveCaret(new i(n,o+1))},initializeConstants:function(){var e=Object.keys(s.FRACTIONS).join("");
this.primeRegex=new RegExp("\\d|["+e+"]");var t=["bout","cause","course","d","e_ll","em","er","ere","e_s","fraid","fro","kay","lo","m","n","n_","pon","round","sblood","scuse","sfar","sfoot","sup","t","taint","tain_t","til","tis","tisn_t","tshall","twas","twasn_t","tween","twere","tweren_t","twill","twixt","twon_t","twou_d","twou_dn_t","twould","twouldn_t","um","ve"];var i="['âââ²]";var n="";for(var o=0;o<t.length;++o){n+="|"+t[o].replace(/_/g,i)}this.frontApostropheRegex=new RegExp("^(\\d\\ds?"+n+")$","i");this.unclosedSingleQuoteRegex=new RegExp(s.OPEN_SINGLE_QUOTE+"[^"+s.CLOSE_SINGLE_QUOTE+"]*$");this.unclosedDoubleQuoteRegex=new RegExp(s.OPEN_DOUBLE_QUOTE+"[^"+s.CLOSE_DOUBLE_QUOTE+"]*$")}})});define("qtext2/extension/double_space",["shared/polyfills","qtext2/extension/typing_change_base","qtext2/selection"],function Pr(require,exports,e){var t=require("qtext2/extension/typing_change_base").TypingExtension,i=require("qtext2/selection").Selection;exports.DoubleSpace=t.extend({install:function(){
this.doc.on("command-space",this.onSpace.bind(this));this.MAX_SPACES=2;this.spacesExp=new RegExp("\\s{"+this.MAX_SPACES+"}")},onSpace:function(){if(!this.isActive()){return}var e=this.doc.caret,t=e.start.prevPositionInSection(this.MAX_SPACES)||e.start.span.parent.first(),n=new i(t,e.start),s=e.start.nextPositionInSection(this.MAX_SPACES)||e.start.span.parent.last(),o=new i(e.start,s),r=e.start.nextPositionInSection(),a=n.getText(),d=o.getText(),l=e.charAfter();if(/\s/.test(l)&&l!="\n"&&r&&!r.span.hasModifier("citation")&&this.spacesExp.test(a+d)){this.doc.moveCaret(r);this.doc.caret.updateAndroidCaretPosition();return false}if(this.spacesExp.test(a)){this.doc.caret.updateAndroidCaretPosition();return false}return}})});define("qtext2/extension/dashes",["shared/polyfills","qtext2/extension/typing_change_base","qtext2/position","qtext2/selection","qtext2/constants"],function Br(require,exports,e){var t=require("qtext2/extension/typing_change_base").TypingExtension,i=require("qtext2/position").Position,n=require("qtext2/selection").Selection,s=require("qtext2/constants");
exports.Dashes=t.extend({install:function(){this.doc.on("keypress",this.onKeypress.bind(this))},onKeypress:function(e,t){var o=this.doc.caret.start;var r=o.span;var a=r.parent;if(o.atSpanStart()){r=r.previousSibling();if(!r){return}o=r.last()}var d=o.offset;var l=o.prevPositionInSection();if(!l){return}var c=Object.keys(s.FRACTIONS).join("");var u=new RegExp("(\\d|["+c+"])[-"+s.EM_DASH+"]");if(/\d/.test(t)){var h=l.prevPositionInSection();if(!h){return}var f=new n(h,this.doc.caret.start);if(!this.isActive(f)){return}if(u.test(f.getText())){a.deleteText(l,this.doc.caret.start);l.span.insertText(s.EN_DASH,l.offset);this.doc.moveCaret(new i(r,d))}return}if(t=="-"){if(!this.isActive(new n(l,this.doc.caret.start))){return}if(this.doc.caret.charBefore()=="-"){a.deleteText(l,this.doc.caret.start);l.span.insertText(s.EM_DASH,l.offset);this.doc.moveCaret(new i(r,d));this.doc.caret.updateAndroidCaretPosition();return false}return}}})});define("qtext2/extension/arrows",["shared/polyfills","qtext2/extension/typing_change_base","qtext2/position","qtext2/selection","qtext2/constants"],function Fr(require,exports,e){
var t=require("qtext2/extension/typing_change_base").TypingExtension,i=require("qtext2/position").Position,n=require("qtext2/selection").Selection,s=require("qtext2/constants");exports.Arrows=t.extend({install:function(){this.doc.on("keypress",this.onKeypress.bind(this))},onKeypress:function(e,t){if(!this.isActive()){return}var o=this.doc.caret.start.span,r=o.parent,a=this.doc.caret.start.offset,d;var l=this.doc.caret.start.prevPositionInSection();if(!l){return}if(t==">"){d=new n(l,this.doc.caret.start);if(!this.isActive(d)){return}if(d.getText()==s.EM_DASH){r.deleteText(l,this.doc.caret.start);l.span.insertText(s.RIGHT_ARROW,l.offset);this.doc.moveCaret(new i(o,a));this.doc.caret.updateAndroidCaretPosition();return false}return}if(t=="-"){var c=l.prevPositionInSection();if(!c){return}d=new n(c,this.doc.caret.start);if(!this.isActive(d)){return}var u=d.getText();if(u=="<"+s.EM_DASH||u=="<-"){r.deleteText(d.start,d.end);d.start.span.insertText(s.LEFT_ARROW,d.start.offset);this.doc.moveCaret(this.doc.caret.start.prevPositionInSection());
this.doc.caret.updateAndroidCaretPosition();return false}}}})});define("qtext2/extensions",["shared/polyfills","qtext2/extension/tooltips","qtext2/extension/autolist","qtext2/extension/autolink","qtext2/extension/ellipses","qtext2/extension/hr","qtext2/extension/undo_state","qtext2/extension/mention","qtext2/extension/non_editable_cursors","qtext2/extension/smart_quotes","qtext2/extension/double_space","qtext2/extension/dashes","qtext2/extension/link_interaction","qtext2/extension/arrows"],function Ur(require,exports,e){var t=require("qtext2/extension/tooltips").Tooltips,i=require("qtext2/extension/autolist").Autolist,n=require("qtext2/extension/autolink").Autolink,s=require("qtext2/extension/ellipses").Ellipses,o=require("qtext2/extension/hr").HR,r=require("qtext2/extension/undo_state").UndoState,a=require("qtext2/extension/mention").Mention,d=require("qtext2/extension/non_editable_cursors").NonEditableCursors,l=require("qtext2/extension/smart_quotes").SmartQuotes,c=require("qtext2/extension/double_space").DoubleSpace,u=require("qtext2/extension/dashes").Dashes,h=require("qtext2/extension/link_interaction").LinkInteraction,f=require("qtext2/extension/arrows").Arrows;
exports.EXTENSIONS=[o,t,n,i,s,r,a,d,l,c,u,h,f]});define("qtext2/base",["shared/polyfills","shared/rangy","shared/browser","qtext2/constants","shared/log","qtext2/util","shared/util","qtext2/container","qtext2/position","qtext2/span","qtext2/quirks","shared/email","qtext2/undo","interface/settings","qtext2/keys","qtext2/shortcuts","qtext2/section","qtext2/sections/plain","qtext2/sections/lists","qtext2/sections/code","qtext2/sections/image","qtext2/sections/horizontal_rule","qtext2/formatting_state","qtext2/caret","qtext2/sections/embed","shared/client","qtext2/modifiers","qtext2/mutations","qtext2/parser","qtext2/commands","qtext2/extensions"],function jr(require,exports,e){var t=require("shared/rangy"),i=require("shared/browser"),n=require("qtext2/constants").CONTENT_TYPES,s=require("shared/log").log,o=require("qtext2/util").Util,r=require("shared/util").extend,a=require("qtext2/container").Container,d=require("qtext2/position").Position,l=require("qtext2/span").Span,c=require("qtext2/quirks").Quirks,u=require("shared/email").isValidEmail,h=require("qtext2/undo").UndoManager,f=require("interface/settings").pageIsMobile,p=require("qtext2/keys"),g=require("qtext2/shortcuts").SHORTCUTS,m=require("qtext2/section"),v=m.Section,_=require("qtext2/sections/plain").PlainSection,w=require("qtext2/sections/lists").UnorderedListSection,b=require("qtext2/sections/lists").OrderedListSection,y=require("qtext2/sections/code").CodeSection,C=require("qtext2/sections/image").ImageSection,x=require("qtext2/sections/horizontal_rule").HorizontalRuleSection,k=require("qtext2/formatting_state").FormattingState,S=require("qtext2/caret").Caret,E=require("qtext2/sections/embed").EmbedSection,T=require("shared/client"),L=require("qtext2/modifiers").canSetModifier,M;
if(f){M=require("mobile_app2/messages")}s=s.bind(s,"qtext2");var D=a.create("doc",{init:function(e){t.rangy.init();this.disabledCommands=[];this.fromJSON(e);this._listeners={};this.node.setAttribute("contenteditable","true");this._attachEventListeners();this._commands={};this._attachCommands();this._extensions=[];this._initExtensions();var i=require("qtext2/mutations").MutationFixer;this.mutationFixer=new i(this);var n=this.firstChild().firstChild();this.caret=new S(n.first(),n.first(),this);this.formattingState=new k(this.caret);this.undoManager=new h(e);this.linkSelector=null;this.imageUploader=null;this.photoSearch=null;this._backspaceCount=0;this._runForever(this._updatePlaceholder.bind(this));this.linkInputFocus=true},setLinkInputFocus:function(e){this.linkInputFocus=e},destroy:function(){this._destroyed=true;o.safeRemoveChild(this.node,this.node.parentElement);this._extensions.forEach(function(e){e.destroy()})},contains:function(e){return this.node.contains(e)},isEmpty:function(){
return this.children.length==1&&this.children[0].isEmpty()},isOnlyWhiteSpace:function(){return this.children.every(function(e){return e.isOnlyWhiteSpace()})},getLength:function(){var e=0;this.children.forEach(function(t){e+=t.getLength()});return e},disableCommands:function(e){this.disabledCommands=e||[]},isDisabledCommand:function(e){return this.disabledCommands.indexOf(e)!=-1},allowsMultipleSections:function(){return!this.isDisabledCommand("return")},disable:function(){this.node.removeAttribute("contenteditable")},enable:function(){this.node.setAttribute("contenteditable","true")},focus:function(){if(!this.node){return}var e=window.scrollX,t=window.scrollY;this.node.focus();window.scrollTo(e,t);this.moveCaret(this.caret.start,this.caret.end,true)},clear:function(){this.fromJSON({})},forceDomReflow:function(){this.fromJSON(this.toJSON())},toJSON:function(){var e={sections:[],caret:this.caret.toJSON()};this.children.forEach(function(t){e.sections.push(t.toJSON())});return o.removeNullValues(e);
},fromJSON:function(e){var t,i,n=this;this.removeChildren();if(e.sections&&e.sections.length){e.sections.forEach(function(e){n.appendChild(v.fromJSON(e))})}else{this.appendChild(new _)}if(e.caret){t=e.caret.start;i=e.caret.end;this.moveCaret(new d(this.children[t.sectionIdx].children[t.spanIdx],t.offset),new d(this.children[i.sectionIdx].children[i.spanIdx],i.offset))}else{this.caret=new S(this.lastChild().last(),this.lastChild().last(),this)}},hasChanged:function(e){var t=this.toJSON();return!o.jsonEqual(t.sections,e.sections)},on:function(e,t){this._listeners[e]=this._listeners[e]||[];this._listeners[e].push(t)},trigger:function(e){if(!(e in this._listeners)){return null}var t=this._listeners[e],i=false,n,s,o,r=new Array(arguments.length);r[0]=i;for(n=1;n<arguments.length;++n){r[n]=arguments[n]}for(n=0;n<t.length;n++){s=t[n];r[0]=i;o=s.apply(s,r);if(o===false){i=true}}return i?false:null},getToolbarState:function(e){var t=this,i=this.caret.start.span,n=i.parent,s=this.caret.isCollapsed()&&this.caret.hasCharBefore(),o=this.formattingState.is("bold"),r=this.formattingState.is("italic"),a=this.formattingState.is("link"),d=this.formattingState.is("math"),l=this.formattingState.is("code")||n instanceof y,c=n instanceof b,u=n instanceof w,h=c||u,p=i.isEditable(),g=l||d||!p,m=!this.undoManager.canUndo(),v=!this.undoManager.canRedo(),_;
if(T.isAndroid()){g=s||g}if(e===0){_=[{name:"link_input",focused:this.linkInputFocus},{name:"space"},{name:"cite"},{name:"link_save"}]}else if(e===1){_=[{name:"bold",pressed:o,disabled:g},{name:"italic",pressed:r,disabled:g},{name:"ordered_list",pressed:c,disabled:!p},{name:"unordered_list",pressed:u,disabled:!p}];if(h){_=_.concat([{name:"indent"},{name:"deindent"}])}_.push({name:"space"});if(!(f&&h)){_.push({name:"image"})}_=_.concat([{name:"link",pressed:a,disabled:g},{name:"overflow_show",grayBackground:true}])}else if(e===2){_=[{name:"mention",disabled:a||l||d||!p},{name:"quote",pressed:n.isQuoted()},{name:"code",pressed:l,disabled:!p},{name:"math",pressed:d,disabled:!p},{name:"space"},{name:"undo",disabled:m},{name:"redo",disabled:v},{name:"overflow_hide"}]}_.forEach(function(e){if(t.isDisabledCommand(e.name)){e.pressed=false;e.disabled=true}});return _},updateSpellingSuggestions:function(){if(T.isIOSApp()){setTimeout(function(){M.send("selectionChanged")},0)}},handleCommand:function(e){
var t=this,n=e,s=new Array(arguments.length-1),o;for(var r=1;r<arguments.length;++r){s[r-1]=arguments[r]}if(this.isDisabledCommand(n)){return false}if(i.ios&&t._backspaceCount>20&&n=="backspace"){n="delete-previous-word"}if(n in this._commands){o=this._commands[n];return o.run.apply(o,[n].concat(s))}},progressivelyExitSection:function(e,t){if(e.getIndent()>0){e.setIndent(e.getIndent()-1)}else if(!(e instanceof _)&&!t){e=e.changeType(_);var i=e.previousSibling();while(i&&i.isEditable()&&(i.isEmpty()||i.node.textContent.trim()==="")){var n=i;i=i.previousSibling();this.removeChild(n)}}else if(e.isQuoted()){e.setQuoted(false)}return e},toggleModifier:function(e){var t,i;this.formattingState.toggleModifier(this.caret,e);if(this.caret.isCollapsed()){return false}t=this._getSelectedSpans(false);i=t[0].getModifier(e);t.forEach(function(t){if(!t.isEditable()){return}if(i){t.removeModifier(e)}else{t.setModifier(e,true)}});return false},toggleSectionType:function(e){var t=this._getSelectedSections(),i=t[0]instanceof e,n=this.caret.start.clone(),s=this.caret.end.clone();
t.forEach(function(t){if(t.isEditable()){if(i){t.changeType(_)}else{t.changeType(e)}}});this.moveCaret(n,s);if(!i&&t.length>1){this.forceDomReflow()}return false},cloneSelection:function(){var e=this,t=this._getSelectedSpans(false),i=[],n,s;t.forEach(function(t){if(n!=t.parent){n=t.parent;s=t.parent.toJSON();s.spans=[];if(!e.caret.containsEntireSection(n)){s.type="plain"}i.push(s)}s.spans.push(t.toJSON())});return i.map(function(e){return v.fromJSON(e)})},sanitizeContent:function(e){var t=this;var i=e.filter(function(e){if(e instanceof C&&t.isDisabledCommand("image")){return false}if(e instanceof E&&t.isDisabledCommand("video")){return false}if(e instanceof x&&t.isDisabledCommand("horizontal-rule")){return false}return true});if(!t.allowsMultipleSections()&&e.length>0){i=[i.reduce(function(e,t){e.merge(t);return e})]}i=i.map(function(e){var i=e instanceof y&&t.isDisabledCommand("code");i=i||e instanceof w&&t.isDisabledCommand("unordered_list");i=i||e instanceof b&&t.isDisabledCommand("ordered_list");
if(i){e=e.changeType(_)}e.setQuoted(e.isQuoted()&&!t.isDisabledCommand("quote"));e.children.forEach(function(e){for(var i in e.modifiers){if(t.isDisabledCommand(i)){e.removeModifier(i)}}});return e});return i},saveState:function(){this.undoManager.add(this.toJSON());this.trigger("meaningfulChange")},setImageUploader:function(e){this.imageUploader=e},setLinkSelector:function(e){var t=this;t.linkSelector=e;e.onSubmit(function(i){var n=t._insertOrModifyLink(i.text,i.target||{type:"url",url:i.url});e.hide();t.focus();t.moveCaret(n.nextSibling().last());setTimeout(function(){t.focus();t.caret.scrollIntoViewIfNeeded()},0);t.saveState()});e.onCancel(function(i){e.hide();t.focus();if(i){var n=t.caret.start.span.modifiers,s=new l(i,n);t.insertSpan(t.caret.start,s);t.moveCaret(s.last())}})},setPhotoSearch:function(e){var t=this;t.photoSearch=e;e.onInsert(function(i){t.handleCommand("image",[i]);e.hide();t.focus()});e.onCancel(function(){e.hide();t.focus()})},detectLinksInSection:function(e){var t=this;
e.children.forEach(function(i){if(!L(i,"link")||i.hasModifier("link")){return}var n=o.linkify(i.getText());if(n.length===0||n.length==1&&!n[0].href){return}var s=i.modifiers;n.forEach(function(n){var o=n.text,r=n.href,a=new l(o,s);if(r){a.setModifier("link",{type:"url",url:r},true);t._previewLink(a)}e.insertBefore(a,i)});e.removeChild(i)})},uploadImageUrl:function(e,t){var i=this;this.imageUploader.showUploading();this.imageUploader.uploadImageUrl(e,function(e){if(t.previousSibling()){i.moveCaret(t.previousSibling().last())}else if(t.nextSibling()){i.moveCaret(t.nextSibling().first())}else{t.parent.insertBefore(new l(" "),t);i.moveCaret(t.previousSibling().first())}t.parent.removeChild(t);i.insertImages([e]);i.imageUploader.hideDropZone()})},insertSpan:function(e,t){var i;if(e.atSpanStart()){i=e.span}else if(e.atSpanEnd()){i=e.span.nextSibling()}else{i=e.span.split(e.offset)}e.span.parent.insertBefore(t,i);if(e.span.getText()===""){e.span.parent.removeChild(e.span)}return t.last()},insertImages:function(e){
this.handleCommand("image",e)},moveCaret:function(e,t,i){var n=this.caret.move(e,t,i);this.trigger("caretMoved");return n},moveCaretEnd:function(e){var t=this.caret.moveEnd(e);this.trigger("caretMoved");return t},moveCaretStart:function(e){var t=this.caret.moveStart(e);this.trigger("caretMoved");return t},_updatePlaceholder:function(){var e=this.isEmpty()&&this.children[0]instanceof _&&!this.children[0].isQuoted();if(e){this.node.classList.add("empty")}else{this.node.classList.remove("empty")}},_handleEmptySpan:function(e,t){var i,n,s;if(e.parent.firstChild()==e&&e.parent.children.length==1){e.setPlaceholder();return e.first()}n=e.previousSibling();s=e.nextSibling();e.parent.removeChild(e);if(t){if(n){e=n;i=n.getLength()}else{e=s;i=0}}else{if(s){e=s;i=0}else{e=n;i=n.getLength()}}return new d(e,i)},updateCaret:function(){var e=this.caret.update();if(e){this.trigger("caretMoved");this.trigger("meaningfulChange")}this._updateActiveSpans();return e},_updateCaretAndFormattingState:function(){
var e=this.updateCaret();if(e){this._updateFormattingState()}},_updateActiveSpans:function(){var e=this.node.querySelectorAll(".active"),t=this.caret.start.span,i=this.caret.end.span,n,s;for(n=0;n<e.length;n++){e[n].classList.remove("active")}for(s=t;s!=i;s=s.next()){s.node.classList.add("active")}s.node.classList.add("active")},_debugEvent:function(e,t){s(e,t.which,t,this.caret)},_attachEventListeners:function(){var e=this,t=this._debugEvent.bind(this),n=new p.Hub(this.node),s,r,a;for(r in g){a=g[r];n.on(r,this.handleCommand.bind(this,a))}["Left","Up","Home"].forEach(function(t){n.on(t,function(){return!(e.caret.isCollapsed()&&e.caret.start.atDocStart())})});["Right","Down","End"].forEach(function(t){n.on(t,function(){return!(e.caret.isCollapsed()&&e.caret.start.atDocEnd())})});o.on("keydown",this.node,function(o){t("keydown",o);var r;if(!(p.isNavigation(o)&&!e.caret.isCollapsed())){e.updateCaret()}if(!p.isOnlyShiftKey(o)){e.caret.scrollIntoViewIfNeeded()}if(i.ios){if(o.which===8){e._backspaceCount+=1;
}else{e._backspaceCount=0}if(s<+new Date-500){e._backspaceCount=0}}r=n.trigger(o);e.trigger("keydown");setTimeout(e.trigger.bind(e,"meaningfulChange"),0);return r});o.on("keypress",this.node,function(i){t("keypress",i);e.updateCaret();if(i&&i.which!==0&&!i.ctrlKey&&!i.metaKey&&!i.altKey){e._beforeTextInput(i)}if(String.fromCharCode(i.which)=="@"){return e.handleCommand("mention","@")}var n=String.fromCharCode(i.which);return e.trigger("keypress",n)});o.on("keyup",this.node,function(n){t("keyup",n);if(e.caret.isCollapsed()||!p.isNavigation(n)||!n.shiftKey||p.isOnlyShiftKey(n)){e.updateCaret()}if(i.ios){s=+new Date}if(p.isNavigation(n)||!e.caret.isCollapsed()){e._updateFormattingState()}else{e._afterTextInput()}return false});o.on("compositionstart",this.node,function(e){t("compositionstart",e)});o.on(["textInput","compositionupdate"],this.node,function(n,s){t(s,n);if(!T.isAndroid()){e.updateCaret()}e._beforeTextInput(n);if(s=="textInput"&&c.usesCompositionEvents()){return true}if(s=="compositionupdate"&&!c.usesCompositionEvents()){
return true}if(!e.caret.isCollapsed()){return true}var o=e.caret.start.span;var r=n.data;if(r==" "&&e.handleCommand("space")===false||e.trigger("keypress",r)===false){return false}if(r.endsWith("\n")){n.preventDefault();var a=o.getText();var l=e.caret.start.offset;var u=l+r.length-1;var h=[a.slice(0,l),r.slice(0,r.length-1),a.slice(l)].join("");o.setText(h);e.moveCaret(new d(o,u));e.handleCommand("return");return false}if(o.isEmpty()){if(i.msedge){return}o.setText(" ");e.moveCaret(o.first(),null,true)}setTimeout(function(){e.updateCaret();e._afterTextInput()},0)});o.on("compositionend",this.node,function(e){t("compositionend",e)});o.on("focus",this.node,function(){if(e.linkSelector){e.linkSelector.hide()}if(e.photoSearch){e.photoSearch.hide()}e.trigger("focus")});o.on("blur",this.node,function(){e.trigger("blur")});if(i.mobile||i.ipad){e._runForever(function(){e.updateCaret()})}this._attachMouseAndTouchEvents();this._attachClipboardEvents();this._attachDragAndDropListeners()},_attachClipboardEvents:function(){
o.on("copy",this.node,this.handleCommand.bind(this,"copy"));o.on("cut",this.node,this.handleCommand.bind(this,"cut"));o.on("paste",this.node,this.handleCommand.bind(this,"paste"))},_attachMouseAndTouchEvents:function(){var e=this,t=null,i=this.trigger.bind(this,"longpress"),n=this._debugEvent.bind(this);o.on(["mousedown","touchstart"],this.node,function(s,o){if(!t){t=setTimeout(function(){i(s)},500)}n(o,s);setTimeout(e._updateCaretAndFormattingState.bind(e),0);e.trigger(o,s)});o.on(["mouseup","touchend"],this.node,function(i,s){if(t){clearTimeout(t);t=null}n(s,i);setTimeout(e._updateCaretAndFormattingState.bind(e),0);e.trigger(s,i)});o.on(["mousemove","touchmove"],this.node,function(t,i){setTimeout(e._updateCaretAndFormattingState.bind(e),0);e.trigger(i,t)})},_attachDragAndDropListeners:function(){if(i.mobile){return}var e=this,s=false,r=this._debugEvent.bind(this);o.on(["dragstart","dragend"],this.node,function(t,i){r(i,t);s=i=="dragstart";var n=e.caret.start.span.parent,o;if(e.caret.isCollapsed()){
if(!n.isEditable()){e.moveCaret(n.first(),n.last())}else if(t.target.nodeName=="IMG"){o=l.get(t.target.parentElement.parentElement);n=o.parent;e.moveCaret(n.first(),n.last())}}});o.on("drop",this.node,function(i){r("drop",i);var o,a,d,l=[n.PUBLIC_HTML,n.HTML],c,u;if(s){s=false;d=e.cloneSelection()}else{for(c=0;c<l.length;c++){u=i.dataTransfer.getData(l[c]);if(u){d=require("qtext2/parser").parse(u,l[c]);d=e.sanitizeContent(d);break}}d=d||[]}try{o=t.rangeFromPoint(i.clientX,i.clientY);a=e.caret._fromNode(o.startContainer,o.startOffset);e.saveState();e._deleteSelection(true);e.moveCaret(a);e._insertSections(d);i.preventDefault()}catch(h){console.error(h)}})},_attachCommands:function(){var e=require("qtext2/commands").COMMANDS,t=Object.keys(e),i,n,s;for(s=0;s<t.length;s++){n=t[s];i=e[n];if(!this.isDisabledCommand(s)){this._commands[n]=new i(this)}}},_initExtensions:function(){var e=require("qtext2/extensions").EXTENSIONS,t,i,n;for(n=0;n<e.length;n++){t=e[n];i=new t(this);i.install();this._extensions.push(i);
}},_runForever:function(e){var t=this;var i=function(){if(!t._destroyed){try{e()}catch(n){s("Error in _runForever:",n)}finally{window.requestAnimationFrame(i)}}};window.requestAnimationFrame(i)},_beforeTextInput:function(e){var t=this.caret.start.span.parent;if(!this.caret.isCollapsed()){this.saveState();this._deleteSelection(true);t=this.caret.start.span.parent}if(!t.isEditable()){var i=new _;if(this.caret.start.atSectionStart()){this.insertBefore(i,t)}else{this.insertAfter(i,t)}this.moveCaret(i.first());this.caret.updateAndroidCaretPosition(1)}this.formattingState.updatePosition(this.caret)},_afterTextInput:function(){if(this.formattingState.hasChanged(this.caret)){this._applyFormattingChange()}},_updateFormattingState:function(){this.formattingState.update(this.caret)},_applyFormattingChange:function(){var e=this.caret.start.span,t=this.formattingState.position.offset,i=this.caret.start.offset;if(e===this.formattingState.position.span){if(i>t){if(i<e.getLength()){e.split(i,true)}if(t>0){
e=e.split(t,true)}this.formattingState.apply(e);this.moveCaret(e.last());this._updateFormattingState()}else if(i<t){this._updateFormattingState()}else{}}else{this._updateFormattingState()}},_deleteSelection:function(e){var t=this.caret.start,i=this.caret.end,n=t.span.parent,s=i.span.parent,o,r;if(n==s){if(n.isEditable()){n.deleteText(t,i)}else{t=t.span.next().first();this.removeChild(n)}}else{if(n.isEditable()){n.deleteText(t,n.last())}else{o=new _;this.insertBefore(o,n);this.removeChild(n);n=o}while(n.nextSibling()!=s){this.removeChild(n.nextSibling())}if(s.isEditable()){s.deleteText(s.first(),i)}else{o=new _;this.insertBefore(o,s);this.removeChild(s);s=o}t=n.merge(s)}if(t.span.isEmpty()){r=this._handleEmptySpan(t.span,e)}else{r=t}this.moveCaret(r,r,true)},_getSelectedSpans:function(e){this.updateCaret();var t=[],i=this.caret.start,n=this.caret.end;if(this.caret.isCollapsed()){return[]}if(i.span==n.span){if(n.offset<n.span.getLength()){n.span.split(n.offset,e)}if(i.offset>0){n.span=i.span=i.span.split(i.offset,e);
}t=[i.span]}else{if(i.offset>0){if(i.offset==i.span.getLength()){i.span=i.span.next()}else{i.span=i.span.split(i.offset,e)}}if(n.offset<n.span.getLength()){if(n.offset===0){n.span=n.span.previous()}else{n.span.split(n.offset,e)}}for(var s=i.span;s!=n.span;s=s.next()){t.push(s)}t.push(n.span)}this.moveCaret(i.span.first(),n.span.last());return t},_toggleMathOrCodeModifier:function(e){if(this.caret.isCollapsed()){return}var t=this._getSelectedSpans(true),i=t[0].getModifier(e);if(i){t.forEach(function(t){t.removeModifier(e)})}else{t=this._mergeSpansBySection(t);t.forEach(function(t){t.setModifier(e,true,true)});this.moveCaret(t[0].first(),t[t.length-1].last())}this._updateFormattingState()},_getSelectedSections:function(){this.updateCaret();var e=[],t=this.caret.start,i=this.caret.end,n;if(this.caret.isCollapsed()){e.push(t.span.parent)}else{for(n=t.span.parent;n!=i.span.parent;n=n.nextSibling()){e.push(n)}e.push(i.span.parent)}return e},_insertSections:function(e){var t=this,i,n,s,o,a,d,l;
if(e.length===0){return}if(!t.caret.isCollapsed()){t._deleteSelection(true)}this.handleCommand("video",e);i=t.caret.start;s=i.span.parent;if(!s.isEditable()){var c=new _;if(t.caret.start.atSectionStart()){t.insertBefore(c,s)}else{t.insertAfter(c,s)}t.moveCaret(c.first());s=c;i=c.first()}l=r({},i.span.modifiers);s.split(i);o=s.nextSibling();e.forEach(function(e){e.children.forEach(function(t){if(e.isEditable()){t.updateModifiers(l,true)}});t.insertBefore(e,o);if(s instanceof y&&e.isEditable()){e.changeType(y)}t.detectLinksInSection(e);e.setIndent(e.getIndent())});a=s.nextSibling();if(a.constructor==s.constructor||a instanceof _){s.merge(a)}d=o.previousSibling();if(d.isEditable()&&(d.constructor==o.constructor||o instanceof _)){n=d.last();d.merge(o)}else{n=o.first()}this.moveCaret(n)},_shouldAllowLinks:function(e){e=e||this.caret.start.span;var t=e.parent;if(!this.caret.isCollapsed()){return false}if(e.hasModifier("link")){return false}if(t instanceof y||e.hasModifier("code")){return false;
}if(e.hasModifier("math")){return false}return true},_insertOrModifyLink:function(e,t,i,n){var s=this.caret.start,o=!n&&s.span.hasAnyModifier(["link","citation"]),r=o?s.span:new l(e),a=new l(" ");if(!o){r.updateModifiers(s.span.modifiers)}r.removeModifier("link");r.removeModifier("citation");a.updateModifiers(r.modifiers);if(!o){s=this.insertSpan(s,r)}if(!i){r.setModifier("link",t);r.setText(e)}else{r.setModifier("citation",{target:t});r.setText(" ")}s=r.last();this.caret.move(s);if(this.caret.charAfter()!==" "){s=this.insertSpan(s,a);this.caret.move(s)}return r},_previewLink:function(e){var t=this,i,n,a;if(e.hasModifier("link")){a=e.getModifier("link").url}else if(e.hasModifier("citation")){i=e.getModifier("citation");n="target"in i?i.target:i;a=n.url}else{a=e.getText()}if(a.startsWith("mailto:")&&u(a.slice(7))){return}a=o.ensureProtocol(a);this.linkSelector.getLinkPreview(a,function(i){if(e.hasModifier("citation")){e.setModifier("citation",r({title:i.title},e.getModifier("citation")));
}else if(i.type=="image"){t.uploadImageUrl(a,e)}else{e.setText(i.title);if(t.caret.start.span==e){t.moveCaret(e.last());t._updateFormattingState()}}t.saveState()},function(){s("Link preview error",a,arguments)})},_mergeSpansBySection:function(e){var t=null,i=null,n,s=[];e.forEach(function(e){if(e.parent!=i){t=e;i=e.parent;s.push(e)}else{n=o.objectIntersection(t.modifiers,e.modifiers);t.removeAllModifiers();t.updateModifiers(n);t.setText(t.getText()+e.getText());e.parent.removeChild(e)}});return s}});exports.Doc=D});
